import{h as M,k as b,l as W,m as v,n as R,o as A,p as V,q as E,r as O,c as P,s as U,e as x,t as F,u as D,b as h,g as u,v as B,w as N,a as H,d as T}from"./s2-playable-CCYpOjF1.js";import{a as G,S as d}from"./s2-lerp-anim-BiCWT6VV.js";import{a as I,S as Y}from"./s2-step-animator-Btxnf0HZ.js";import{M as m}from"./mtl-colors-BFHaR8KK.js";class q extends M{position;anchor;extents;valueWidth;background;highlight;text;padding;constructor(t){super(),this.position=new b(0,0,t.getWorldSpace()),this.anchor=new W(0,0),this.extents=new v(0,0,t.getViewSpace()),this.valueWidth=new R(2,t.getWorldSpace()),this.background=new _(t),this.highlight=new z(t),this.text=new Z(t),this.padding=new v(15,5,t.getViewSpace())}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.anchor.setOwner(t),this.extents.setOwner(t),this.valueWidth.setOwner(t),this.background.setOwner(t),this.highlight.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.extents.clearDirty(),this.valueWidth.clearDirty(),this.background.clearDirty(),this.highlight.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class _ extends A{fill;stroke;opacity;cornerRadius;constructor(t){super(),this.fill=new V,this.stroke=new E(t),this.opacity=new O(1),this.cornerRadius=new R(5,t.getViewSpace()),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.cornerRadius.clearDirty()}}class z extends A{cornerRadius;padding;constructor(t){super(),this.cornerRadius=new R(7,t.getViewSpace()),this.padding=new v(2,2,t.getViewSpace())}setOwner(t=null){this.cornerRadius.setOwner(t),this.padding.setOwner(t)}clearDirty(){this.cornerRadius.clearDirty(),this.padding.clearDirty()}}class Z extends A{fill;addressFill;stroke;opacity;font;constructor(t){super(),this.fill=new V,this.addressFill=new V,this.stroke=new E(t),this.opacity=new O(1),this.font=new P(t),this.stroke.width.set(0,t.getViewSpace()),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.addressFill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.font.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.addressFill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.font.clearDirty()}}class K extends G{space;polyCurve;constructor(t){super(t),this.space=t.getWorldSpace(),this.polyCurve=new U}getSpace(){return this.space}setSpace(t){return this.space=t,this}getCurve(){return this.polyCurve}}class X extends K{property;constructor(t,s){super(t),this.property=s,this.properties.add(s),this.space=s.space}setElapsedPropertyImpl(t){if(t!==this.property)return;const s=this.polyCurve.getPointAt(this.wrapedCycleAlpha);this.property.setV(s,this.space)}}class j{scene;parentMemory;index;values;names;address;highlight;hLine;isStacked;lowerBound;upperBound;basePosName;basePosValue;available;constructor(t,s){const e=t.getScene();this.scene=e,this.parentMemory=t,this.index=s,this.values=[],this.names=[],this.address=new x(e),this.hLine=new F(e),this.lowerBound=new b(0,0,e.getWorldSpace()),this.upperBound=new b(0,0,e.getWorldSpace()),this.basePosName=new b(0,0,e.getWorldSpace()),this.basePosValue=new b(0,0,e.getWorldSpace()),this.highlight=new D(e),this.hLine.setParent(t),this.highlight.setParent(t),this.highlight.data.isEnabled.set(!1),this.address.setParent(t),this.address.data.textAnchor.set(1),this.isStacked=!1,this.available=!0}setAvailability(t){this.available=t}isAvailable(){return this.available}setAddress(t){this.address.setContent(t)}setValue(t,s={}){const e=new x(this.scene);return e.setParent(this.parentMemory),e.data.layer.set(2),e.data.textAnchor.set(-1),e.data.position.copyIfUnlocked(this.basePosValue),e.data.font.copyIfUnlocked(this.parentMemory.data.text.font),e.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),e.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),s.color&&e.data.fill.color.copy(s.color).lock(),e.setContent(t),this.values.push(e),e}setName(t,s={}){const e=new x(this.scene);return e.setParent(this.parentMemory),e.data.layer.set(2),e.data.textAnchor.set(-1),e.data.position.copyIfUnlocked(this.basePosName),e.data.font.copyIfUnlocked(this.parentMemory.data.text.font),e.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),e.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),s.color&&e.data.fill.color.copy(s.color).lock(),e.setContent(t),this.names.push(e),e}animateSetValue(t,s,e={}){const a=s.ensureLabel(e.label),n=e.offset??0,i=e.duration??500;let o=0;if(this.values.length>0){const c=this.values[this.values.length-1];c.data.isEnabled&&(this.animateFadeOut(c,s,new h(30,0),a,i,n),o=250)}const r=this.setValue(t,{color:e.color});return this.animateFadeIn(r,s,new h(-5,0),a,i,n+o),r}animateSetName(t,s,e={}){const a=s.ensureLabel(e.label),n=e.offset??0,i=e.duration??500;let o=0;if(this.names.length>0){const c=this.names[this.names.length-1];c.data.isEnabled&&(this.animateFadeOut(c,s,new h(30,0),a,i,n),o=250)}const r=this.setName(t,{color:e.color});return this.animateFadeIn(r,s,new h(-5,0),a,i,n+o),r}animateDestroy(t,s={}){const e=t.ensureLabel(s.label),a=s.offset??0,n=s.duration??500;if(this.values.length>0){const i=this.values[this.values.length-1];this.animateFadeOut(i,t,new h(30,0),e,n,a)}if(this.names.length>0){const i=this.names[this.names.length-1];this.animateFadeOut(i,t,new h(30,0),e,n,a)}}animateCopyValue(t,s,e={}){if(t.values.length===0)throw new Error("Source row has no value to copy");const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.values[t.values.length-1],i=this.setValue(n.getContent());return this.animateCopy(n,i,s,{lastText:a,...e}),i}animateCopyAddress(t,s,e={}){const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.address,i=this.setValue(n.getContent());return this.animateCopy(n,i,s,{lastText:a,...e}),i}animateColor(t,s,e={}){const a=s.ensureLabel(e.label),n=e.offset??0,i=e.duration??500;if(this.values.length>0){const o=this.values[this.values.length-1],r=d.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),s.addAnimation(r,a,n)}if(this.names.length>0){const o=this.names[this.names.length-1],r=d.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),s.addAnimation(r,a,n)}}animateHighlightIn(t,s={}){const e=t.ensureLabel(s.label),a=s.offset??0,n=s.duration??500;this.highlight.data.opacity.set(0),this.highlight.data.fill.opacity.set(.15),this.highlight.data.stroke.width.set(1,this.scene.getViewSpace());const i=d.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(u.inOut);this.highlight.data.opacity.set(1),i.commitFinalState(),t.addAnimation(i,e,a),t.enableElement(this.highlight,!0,e,a),s.color&&(t.addTrigger(new I(this.highlight.data.fill.color,s.color),e,a),t.addTrigger(new I(this.highlight.data.stroke.color,s.color),e,a))}animateHighlightOut(t,s={}){const e=t.ensureLabel(s.label),a=s.offset??0,n=s.duration??500;this.highlight.data.opacity.set(1);const i=d.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(u.inOut);this.highlight.data.opacity.set(0),i.commitFinalState(),t.addAnimation(i,e,a),t.enableElement(this.highlight,!1,e,a+n)}animateHLine(t,s={}){const e=t.ensureLabel(s.label),a=s.offset??0,n=s.duration??500;if(s.color){const i=d.create(this.scene,this.hLine.data.stroke.color).setCycleDuration(n);this.hLine.data.stroke.color.copy(s.color).lock(),i.commitFinalState(),t.addAnimation(i,e,a)}if(s.width){const i=d.create(this.scene,this.hLine.data.stroke.width).setCycleDuration(n).setEasing(u.inOut);this.hLine.data.stroke.width.set(s.width,this.scene.getViewSpace()).lock(),i.commitFinalState(),t.addAnimation(i,e,a)}}animateCopy(t,s,e,a={}){const n=e.ensureLabel(a.label),i=a.offset??0,o=a.duration??500,r=a.srcAngle??180,c=a.dstAngle??180,l=a.curveTension??.4;let g=0;a.lastText&&a.lastText.data.isEnabled&&(this.animateFadeOut(a.lastText,e,new h(30,0),n,o,i),g=250);const y=this.scene.getWorldSpace(),f=this.scene.acquireVec2(),w=this.scene.acquireVec2();t.getPositionInto(f,y),s.getPositionInto(w,y);const S=new X(this.scene,s.data.localShift).setCycleDuration(o).setEasing(u.inOut).setSpace(y),k=f.subV(w),L=k.length();if(S.getCurve().clear().addCubic(k,h.addV(k,h.setPolar(r,l*L,"deg")),h.setPolar(c,l*L,"deg"),new h(0,0),16).updateLength(),s.data.localShift.set(0,0,y),e.enableElement(s,!0,n,i+g),e.addAnimation(S,n,i+g),a.color){s.data.fill.color.copy(t.data.fill.color);const C=d.create(this.scene,s.data.fill.color).setCycleDuration(o);s.data.fill.color.copy(a.color).lock(),C.commitFinalState(),e.addAnimation(C,n,i+g)}}animateFadeIn(t,s,e,a,n,i){t.data.opacity.set(0);const o=d.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(u.out);if(t.data.opacity.set(1),o.commitFinalState(),s.enableElement(t,!0,a,i),s.addAnimation(o,a,i),h.isZeroV(e)===!1){t.data.localShift.setV(e,this.scene.getViewSpace());const r=d.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(u.inOut);t.data.localShift.set(0,0,this.scene.getViewSpace()),r.commitFinalState(),s.addAnimation(r,a,i)}}animateFadeOut(t,s,e,a,n,i){t.data.opacity.set(1);const o=d.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(u.out);if(t.data.opacity.set(0),o.commitFinalState(),s.addAnimation(o,a,i),h.isZeroV(e)===!1){t.data.localShift.set(0,0,this.scene.getViewSpace());const r=d.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(u.inOut);t.data.localShift.setV(e,this.scene.getViewSpace()),r.commitFinalState(),s.addAnimation(r,a,i)}s.enableElement(t,!1,a,i+n)}setWorldBounds(t,s){this.lowerBound.setV(t,this.scene.getWorldSpace()),this.upperBound.setV(s,this.scene.getWorldSpace())}updateGeometry(){const t=this.parentMemory.data;if((this.lowerBound.isDirty()||this.upperBound.isDirty()||t.padding.isDirty()||t.text.font.isDirty())===!1)return;const e=this.scene.getWorldSpace(),a=this.lowerBound.get(e),n=this.upperBound.get(e),i=n.y-a.y,o=n.x-a.x,r=t.text.font,c=r.relativeAscenderHeight.value*r.size.get(e),l=a.y+i/2-c/2,g=t.padding.get(e).x,y=t.valueWidth.get(e),f=o-y;this.address.data.position.set(a.x-g,l,e),this.basePosValue.set(a.x+g,l,e),this.basePosName.set(a.x+y+g,l,e);for(const k of this.values)k.data.position.setV(this.basePosValue.value,e);for(const k of this.names)k.data.position.setV(this.basePosName.value,e);this.isStacked?(this.hLine.data.startPosition.set(a.x,n.y,e),this.hLine.data.endPosition.set(n.x,n.y,e)):(this.hLine.data.startPosition.set(a.x,a.y,e),this.hLine.data.endPosition.set(n.x,a.y,e));const w=new h(a.x+.75*o,a.y+.5*i);this.highlight.data.position.setV(w,e);const S=t.highlight.padding.get(e);this.highlight.data.position.setV(w,e),this.highlight.data.extents.set(.5*f-2*S.x,.5*i-2*S.y,e),this.highlight.data.cornerRadius.set(t.highlight.cornerRadius.get(e),e),this.highlight.data.anchor.set(0,0)}update(){this.updateGeometry();for(const t of this.values)t.update();for(const t of this.names)t.update();this.address.update(),this.hLine.update(),this.highlight.update()}}class J{memoryRef;index;constructor(t,s){this.memoryRef=t,this.index=s}free(){this.memoryRef.destroyMemoryId(this)}setValue(t,s={}){return this.memoryRef.getRow(this.index).setValue(t,s)}setName(t,s={}){return this.memoryRef.getRow(this.index).setName(t,s)}animateSetValue(t,s,e={}){return this.memoryRef.getRow(this.index).animateSetValue(t,s,e)}animateSetName(t,s,e={}){return this.memoryRef.getRow(this.index).animateSetName(t,s,e)}animateSetNameAndValue(t,s,e,a={}){const n=a.offset??0,i=a.delay??100,o=e.ensureLabel(a.label),r={duration:a.duration,label:o,color:a.valueColor,offset:n},c={duration:a.duration,label:o,color:a.nameColor,offset:n+i};return{value:this.memoryRef.getRow(this.index).animateSetValue(s,e,r),name:this.memoryRef.getRow(this.index).animateSetName(t,e,c)}}animateDestroy(t,s={}){this.memoryRef.getRow(this.index).animateDestroy(t,s),this.free()}animateCopyValue(t,s,e={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyValue(a,s,e)}animateCopyAddress(t,s,e={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyAddress(a,s,e)}animateColor(t,s,e={}){this.memoryRef.getRow(this.index).animateColor(t,s,e)}animateHighlightIn(t,s={}){this.memoryRef.getRow(this.index).animateHighlightIn(t,s)}animateHighlightOut(t,s={}){this.memoryRef.getRow(this.index).animateHighlightOut(t,s)}animateHLine(t,s={}){this.memoryRef.getRow(this.index).animateHLine(t,s)}animateRestoreHLine(t,s={}){const e={...s,color:this.memoryRef.data.background.stroke.color,width:this.memoryRef.data.background.stroke.width.value};this.memoryRef.getRow(this.index).animateHLine(t,e)}}class it extends B{element;addressCount;background;vLine;rows;isStacked;constructor(t,s,e={}){super(t,new q(t));const a=e.isStacked??!1,n=e.addressStart??0,i=e.addressPrefix??"@",o=e.addressRadix??10;this.element=document.createElementNS(N,"g"),this.addressCount=s,this.isStacked=a,this.background=new D(t),this.vLine=new F(t),this.background.setParent(this),this.vLine.setParent(this),this.rows=[];for(let r=0;r<this.addressCount;r++){const c=n+(this.isStacked?this.addressCount-1-r:r),l=new j(this,r);l.isStacked=this.isStacked,l.setAddress(i+c.toString(o).toUpperCase()),this.rows.push(l)}this.rows[this.addressCount-1].hLine.setEnabled(!1),this.element.dataset.role="memory"}getSVGElement(){return this.element}getExtentsInto(t,s){return this.data.extents.getInto(t,s),this}getCenterInto(t,s){return this.data.anchor.getCenterInto(t,s,this.data.position,this.data.extents),this}getRow(t){if(t<0||t>=this.addressCount)throw new Error("Invalid row ID");return this.rows[t]}createMemoryId(){let t=0;for(;t<this.addressCount&&!this.rows[t].isAvailable();)t++;if(t>=this.addressCount)throw new Error("Memory is full");return this.rows[t].setAvailability(!1),new J(this,t)}destroyMemoryId(t){if(t.memoryRef!==this||t.index<0||t.index>=this.addressCount)throw new Error("Invalid memory ID");this.rows[t.index].setAvailability(!0)}updateBackground(){const t=this.scene.getViewSpace(),s=this.scene.acquireVec2(),e=this.scene.acquireVec2();this.getCenterInto(s,t),this.getExtentsInto(e,t),this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background instanceof D&&this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius),this.background.data.position.setV(s,t),this.background.data.extents.setV(e,t),this.background.data.anchor.set(0,0);const a=this.data.valueWidth.get(t),n=s.x-e.x+a;this.vLine.data.startPosition.set(n,s.y+e.y,t),this.vLine.data.endPosition.set(n,s.y-e.y,t),this.vLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),this.vLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width),this.scene.releaseVec2(s),this.scene.releaseVec2(e),this.background.update(),this.vLine.update()}updateVariables(){const t=this.scene.getWorldSpace(),s=this.scene.acquireVec2(),e=this.scene.acquireVec2();this.getCenterInto(s,t),this.getExtentsInto(e,t);const a=this.isStacked?1:-1,n=2*e.y/this.addressCount;for(let i=0;i<this.rows.length;i++){const o=this.rows[i],r=s.y+a*((i+.5)*n-e.y),c=new h(s.x-e.x,r-.5*n),l=new h(s.x+e.x,r+.5*n);o.setWorldBounds(c,l),o.hLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),o.hLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width)}if(this.scene.releaseVec2(s),this.scene.releaseVec2(e),this.data.text.font.isDirty())for(const i of this.rows){for(const o of i.values)o.data.font.copyIfUnlocked(this.data.text.font);for(const o of i.names)o.data.font.copyIfUnlocked(this.data.text.font);i.address.data.font.copyIfUnlocked(this.data.text.font)}for(const i of this.rows)i.address.data.fill.copyIfUnlocked(this.data.text.addressFill),i.update()}update(){this.skipUpdate()||(this.updateSVGChildren(),this.updateBackground(),this.updateVariables(),this.clearDirty())}}class nt extends H{animator;font;fillRect;setDefaultFont(t=16){this.font.family.set("monospace"),this.font.size.set(t,this.getViewSpace()),this.font.relativeAscenderHeight.set(.7),this.font.relativeLineHeight.set(1.3)}setDefaultCodeStyle(t){const s=this.getViewSpace(),e=this.getWorldSpace(),a=t.data;a.text.font.copy(this.font),a.text.fill.color.copy(m.WHITE),a.padding.set(20,15,s),a.background.fill.color.copy(m.GREY_9),a.background.stroke.color.copy(m.GREY_7),a.background.stroke.width.set(2,s),a.background.cornerRadius.set(10,s),a.currentLine.opacity.set(1),a.currentLine.fill.color.copy(m.BLACK),a.currentLine.fill.opacity.set(.5),a.currentLine.stroke.color.copy(m.WHITE),a.currentLine.stroke.width.set(1,s),a.currentLine.stroke.opacity.set(.2),a.currentLine.padding.set(-.5,2,s),a.currentLine.index.set(0),a.position.set(-6,4,e),a.anchor.set(-1,-1),a.minExtents.set(2.5,1,e)}setDefaultMemoryStyle(t){const s=this.getViewSpace(),e=this.getWorldSpace(),a=t.data;a.extents.set(2,4,e),a.padding.set(15,0,s),a.valueWidth.set(2,e),a.text.fill.color.copyIfUnlocked(m.WHITE),a.text.addressFill.color.copyIfUnlocked(m.GREY_4),a.text.font.copyIfUnlocked(this.font),a.background.fill.color.copyIfUnlocked(m.GREY_9),a.background.stroke.color.copyIfUnlocked(m.GREY_7),a.background.stroke.width.set(2,s),a.background.cornerRadius.set(10,s),a.highlight.cornerRadius.set(7,s),a.highlight.padding.set(3,3,s),a.position.set(6,0,e),a.anchor.set(1,0)}constructor(t){super(t),this.camera.setExtents(8,4.5),this.setViewportSize(640*1.5,360*1.5),this.animator=new Y(this),this.font=new P(this),this.fillRect=this.addFillRect(),this.fillRect.data.color.copy(T.lerp(m.GREY_8,m.GREY_9,.7)),this.setDefaultFont(16)}animateCallIn(t,s,e,a={}){const n=this.getViewSpace(),i=t.findTokenTSpan(e,{category:"fn"});if(!i)return;const o=this.animator.ensureLabel(a.label),r=a.offset??0,c=a.duration??500,l=30,g=t.data.position.get(n),y=this.acquireVec2(),f=this.acquireVec2();i.getBBoxInto(y,f,n),s.data.position.set(g.x+10+l,f.y+5,n),s.data.anchor.set(-1,-1),s.data.opacity.set(0);const w=d.create(this,s.data.position).setCycleDuration(c).setEasing(u.inOut),S=d.create(this,s.data.opacity).setCycleDuration(c).setEasing(u.inOut);s.data.position.set(g.x+10,f.y+5,n),s.data.opacity.set(1),this.animator.enableElement(s,!0,o,r),this.animator.addAnimation(w.commitFinalState(),o,r),this.animator.addAnimation(S.commitFinalState(),o,r),this.releaseVec2(y),this.releaseVec2(f)}animateCallOut(t,s={}){const e=this.getViewSpace(),a=this.animator.ensureLabel(s.label),n=s.offset??0,i=s.duration??500,o=30,r=d.create(this,t.data.position).setCycleDuration(i).setEasing(u.inOut),c=d.create(this,t.data.opacity).setCycleDuration(i).setEasing(u.inOut),l=t.data.position.get(e);t.data.position.set(l.x+o,l.y,e),t.data.opacity.set(0),this.animator.addAnimation(r.commitFinalState(),a,n),this.animator.addAnimation(c.commitFinalState(),a,n),this.animator.enableElement(t,!1,a,n+i)}}export{nt as B,it as S};
