import{k as M,l as S,m as U,n as R,o as A,p as L,q as C,r as P,s as V,c as I,t as B,u as N,g as b,v as F,w as D,S as h,i as c,j as m,x as O,y as H,z as W,A as G,b as T,M as u,f as Y}from"./s2-lerp-anim-PicSQhJC.js";class _ extends M{position;anchor;extents;valueWidth;background;highlight;text;padding;constructor(){super(),this.position=new S(0,0,"world"),this.anchor=new U("center"),this.extents=new R(0,0,"view"),this.valueWidth=new A(2,"world"),this.background=new z,this.highlight=new Z,this.text=new j,this.padding=new R(15,5,"view")}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.anchor.setOwner(t),this.extents.setOwner(t),this.valueWidth.setOwner(t),this.background.setOwner(t),this.highlight.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.extents.clearDirty(),this.valueWidth.clearDirty(),this.background.clearDirty(),this.highlight.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class z extends L{fill;stroke;opacity;cornerRadius;constructor(){super(),this.fill=new C,this.stroke=new P,this.opacity=new V(1),this.cornerRadius=new A(5,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.cornerRadius.clearDirty()}}class Z extends L{cornerRadius;padding;constructor(){super(),this.cornerRadius=new A(7,"view"),this.padding=new R(2,2,"view")}setOwner(t=null){this.cornerRadius.setOwner(t),this.padding.setOwner(t)}clearDirty(){this.cornerRadius.clearDirty(),this.padding.clearDirty()}}class j extends L{fill;addressFill;stroke;opacity;font;constructor(){super(),this.fill=new C,this.addressFill=new C,this.stroke=new P,this.opacity=new V(1),this.font=new I,this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.addressFill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.font.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.addressFill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.font.clearDirty()}}class q extends B{space;polyCurve;constructor(t){super(t),this.space="world",this.polyCurve=new N}getSpace(){return this.space}setSpace(t){return this.space=t,this}getCurve(){return this.polyCurve}}class K extends q{property;constructor(t,e){super(t),this.property=e,this.properties.add(e),this.space=e.space}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.polyCurve.getPointAt(this.wrapedCycleAlpha);this.property.setV(e,this.space)}}class X{scene;parentMemory;index;values;names;address;highlight;hLine;isStacked;lowerBound;upperBound;basePosName;basePosValue;available;constructor(t,e){const s=t.getScene();this.scene=s,this.parentMemory=t,this.index=e,this.values=[],this.names=[],this.address=new b(s),this.hLine=new F(s),this.lowerBound=new S,this.upperBound=new S,this.basePosName=new S,this.basePosValue=new S,this.highlight=new D(s),this.hLine.setParent(t),this.highlight.setParent(t),this.highlight.data.isEnabled.set(!1),this.address.setParent(t),this.address.data.textAnchor.set("end"),this.isStacked=!1,this.available=!0}setAvailability(t){this.available=t}isAvailable(){return this.available}setAddress(t){this.address.setContent(t)}setValue(t,e={}){const s=new b(this.scene);return s.setParent(this.parentMemory),s.data.layer.set(2),s.data.textAnchor.set("start"),s.data.position.copyIfUnlocked(this.basePosValue),s.data.font.copyIfUnlocked(this.parentMemory.data.text.font),s.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),s.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),e.color&&s.data.fill.color.copy(e.color).lock(),s.setContent(t),this.values.push(s),s}setName(t,e={}){const s=new b(this.scene);return s.setParent(this.parentMemory),s.data.layer.set(2),s.data.textAnchor.set("start"),s.data.position.copyIfUnlocked(this.basePosName),s.data.font.copyIfUnlocked(this.parentMemory.data.text.font),s.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),s.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),e.color&&s.data.fill.color.copy(e.color).lock(),s.setContent(t),this.names.push(s),s}animateSetValue(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;let o=0;if(this.values.length>0){const l=this.values[this.values.length-1];l.data.isEnabled&&(this.animateFadeOut(l,e,new h(30,0),a,i,n),o=250)}const r=this.setValue(t,{color:s.color});return this.animateFadeIn(r,e,new h(-5,0),a,i,n+o),r}animateSetName(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;let o=0;if(this.names.length>0){const l=this.names[this.names.length-1];l.data.isEnabled&&(this.animateFadeOut(l,e,new h(30,0),a,i,n),o=250)}const r=this.setName(t,{color:s.color});return this.animateFadeIn(r,e,new h(-5,0),a,i,n+o),r}animateDestroy(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;if(this.values.length>0){const i=this.values[this.values.length-1];this.animateFadeOut(i,t,new h(30,0),s,n,a)}if(this.names.length>0){const i=this.names[this.names.length-1];this.animateFadeOut(i,t,new h(30,0),s,n,a)}}animateCopyValue(t,e,s={}){if(t.values.length===0)throw new Error("Source row has no value to copy");const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.values[t.values.length-1],i=this.setValue(n.getContent());return this.animateCopy(n,i,e,{lastText:a,...s}),i}animateCopyAddress(t,e,s={}){const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.address,i=this.setValue(n.getContent());return this.animateCopy(n,i,e,{lastText:a,...s}),i}animateColor(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;if(this.values.length>0){const o=this.values[this.values.length-1],r=c.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),e.addAnimation(r,a,n)}if(this.names.length>0){const o=this.names[this.names.length-1],r=c.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),e.addAnimation(r,a,n)}}animateHighlightIn(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;this.highlight.data.opacity.set(0),this.highlight.data.fill.opacity.set(.15),this.highlight.data.stroke.width.set(1,"view");const i=c.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(m.inOut);this.highlight.data.opacity.set(1),i.commitFinalState(),t.addAnimation(i,s,a),t.enableElement(this.highlight,!0,s,a),e.color&&(t.addTrigger(new O(this.highlight.data.fill.color,e.color),s,a),t.addTrigger(new O(this.highlight.data.stroke.color,e.color),s,a))}animateHighlightOut(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;this.highlight.data.opacity.set(1);const i=c.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(m.inOut);this.highlight.data.opacity.set(0),i.commitFinalState(),t.addAnimation(i,s,a),t.enableElement(this.highlight,!1,s,a+n)}animateHLine(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;if(e.color){const i=c.create(this.scene,this.hLine.data.stroke.color).setCycleDuration(n);this.hLine.data.stroke.color.copy(e.color).lock(),i.commitFinalState(),t.addAnimation(i,s,a)}if(e.width){const i=c.create(this.scene,this.hLine.data.stroke.width).setCycleDuration(n).setEasing(m.inOut);this.hLine.data.stroke.width.set(e.width,"view").lock(),i.commitFinalState(),t.addAnimation(i,s,a)}}animateCopy(t,e,s,a={}){const n=s.ensureLabel(a.label),i=a.offset??0,o=a.duration??500,r=a.srcAngle??180,l=a.dstAngle??180,d=a.curveTension??.4;let y=0;a.lastText&&a.lastText.data.isEnabled&&(this.animateFadeOut(a.lastText,s,new h(30,0),n,o,i),y=250);const g="world",k=t.getPosition(g),x=e.getPosition(g);t.data.textAnchor.get()==="end"&&(k.x-=2*t.getExtents(g).x);const v=new K(this.scene,e.data.localShift).setCycleDuration(o).setEasing(m.inOut).setSpace(g),p=k.subV(x),w=p.length();if(v.getCurve().clear().addCubic(p,h.add(p,h.fromPolarDeg(r,d*w)),h.fromPolarDeg(l,d*w),new h(0,0),16).updateLength(),e.data.localShift.set(0,0,g),s.enableElement(e,!0,n,i+y),s.addAnimation(v,n,i+y),a.color){e.data.fill.color.copy(t.data.fill.color);const E=c.create(this.scene,e.data.fill.color).setCycleDuration(o);e.data.fill.color.copy(a.color).lock(),E.commitFinalState(),s.addAnimation(E,n,i+y)}}animateFadeIn(t,e,s,a,n,i){t.data.opacity.set(0);const o=c.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(m.out);if(t.data.opacity.set(1),o.commitFinalState(),e.enableElement(t,!0,a,i),e.addAnimation(o,a,i),h.isZero(s)===!1){t.data.localShift.setV(s,"view");const r=c.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(m.inOut);t.data.localShift.set(0,0,"view"),r.commitFinalState(),e.addAnimation(r,a,i)}}animateFadeOut(t,e,s,a,n,i){t.data.opacity.set(1);const o=c.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(m.out);if(t.data.opacity.set(0),o.commitFinalState(),e.addAnimation(o,a,i),h.isZero(s)===!1){t.data.localShift.set(0,0,"view");const r=c.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(m.inOut);t.data.localShift.setV(s,"view"),r.commitFinalState(),e.addAnimation(r,a,i)}e.enableElement(t,!1,a,i+n)}setWorldBounds(t,e){this.lowerBound.setV(t,"world"),this.upperBound.setV(e,"world")}updateGeometry(){const t=this.parentMemory.data;if((this.lowerBound.isDirty()||this.upperBound.isDirty()||t.padding.isDirty()||t.text.font.isDirty())===!1)return;const s="world",a=this.scene.getActiveCamera(),n=this.lowerBound.toSpace(s,a),i=this.upperBound.toSpace(s,a),o=i.y-n.y,r=i.x-n.x,l=t.text.font,d=l.relativeAscenderHeight.value*l.size.toSpace(s,a),y=n.y+o/2-d/2,g=t.padding.toSpace(s,a).x,k=t.valueWidth.toSpace(s,a),x=r-k;this.address.data.position.set(n.x-g,y,s),this.basePosValue.set(n.x+g,y,s),this.basePosName.set(n.x+k+g,y,s);for(const w of this.values)w.data.position.setV(this.basePosValue.value,s);for(const w of this.names)w.data.position.setV(this.basePosName.value,s);this.isStacked?(this.hLine.data.startPosition.set(n.x,i.y,s),this.hLine.data.endPosition.set(i.x,i.y,s)):(this.hLine.data.startPosition.set(n.x,n.y,s),this.hLine.data.endPosition.set(i.x,n.y,s));const v=new h(n.x+.75*r,n.y+.5*o);this.highlight.data.position.setV(v,s);const p=t.highlight.padding.toSpace(s,a);this.highlight.data.position.setV(v,s),this.highlight.data.extents.set(.5*x-2*p.x,.5*o-2*p.y,s),this.highlight.data.cornerRadius.set(t.highlight.cornerRadius.toSpace(s,a),s),this.highlight.data.anchor.set("center")}update(){this.updateGeometry();for(const t of this.values)t.update();for(const t of this.names)t.update();this.address.update(),this.hLine.update(),this.highlight.update()}}class J{memoryRef;index;constructor(t,e){this.memoryRef=t,this.index=e}free(){this.memoryRef.destroyMemoryId(this)}setValue(t,e={}){return this.memoryRef.getRow(this.index).setValue(t,e)}setName(t,e={}){return this.memoryRef.getRow(this.index).setName(t,e)}animateSetValue(t,e,s={}){return this.memoryRef.getRow(this.index).animateSetValue(t,e,s)}animateSetName(t,e,s={}){return this.memoryRef.getRow(this.index).animateSetName(t,e,s)}animateSetNameAndValue(t,e,s,a={}){const n=a.offset??0,i=a.delay??100,o=s.ensureLabel(a.label),r={duration:a.duration,label:o,color:a.valueColor,offset:n},l={duration:a.duration,label:o,color:a.nameColor,offset:n+i};return{value:this.memoryRef.getRow(this.index).animateSetValue(e,s,r),name:this.memoryRef.getRow(this.index).animateSetName(t,s,l)}}animateDestroy(t,e={}){this.memoryRef.getRow(this.index).animateDestroy(t,e),this.free()}animateCopyValue(t,e,s={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyValue(a,e,s)}animateCopyAddress(t,e,s={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyAddress(a,e,s)}animateColor(t,e,s={}){this.memoryRef.getRow(this.index).animateColor(t,e,s)}animateHighlightIn(t,e={}){this.memoryRef.getRow(this.index).animateHighlightIn(t,e)}animateHighlightOut(t,e={}){this.memoryRef.getRow(this.index).animateHighlightOut(t,e)}animateHLine(t,e={}){this.memoryRef.getRow(this.index).animateHLine(t,e)}animateRestoreHLine(t,e={}){const s=this.memoryRef.getScene().getActiveCamera(),a={...e,color:this.memoryRef.data.background.stroke.color,width:this.memoryRef.data.background.stroke.width.get("view",s)};this.memoryRef.getRow(this.index).animateHLine(t,a)}}class et extends H{element;addressCount;background;vLine;rows;isStacked;constructor(t,e,s={}){super(t,new _);const a=s.isStacked??!1,n=s.addressStart??0,i=s.addressPrefix??"@",o=s.addressRadix??10;this.element=document.createElementNS(W,"g"),this.addressCount=e,this.isStacked=a,this.background=new D(t),this.vLine=new F(t),this.background.setParent(this),this.vLine.setParent(this),this.rows=[];for(let r=0;r<this.addressCount;r++){const l=n+(this.isStacked?this.addressCount-1-r:r),d=new X(this,r);d.isStacked=this.isStacked,d.setAddress(i+l.toString(o).toUpperCase()),this.rows.push(d)}this.rows[this.addressCount-1].hLine.setEnabled(!1),this.element.dataset.role="memory"}getSVGElement(){return this.element}getExtents(t){return this.data.extents.toSpace(t,this.scene.getActiveCamera())}getCenter(t){return G.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.data.extents)}getRow(t){if(t<0||t>=this.addressCount)throw new Error("Invalid row ID");return this.rows[t]}createMemoryId(){let t=0;for(;t<this.addressCount&&!this.rows[t].isAvailable();)t++;if(t>=this.addressCount)throw new Error("Memory is full");return this.rows[t].setAvailability(!1),new J(this,t)}destroyMemoryId(t){if(t.memoryRef!==this||t.index<0||t.index>=this.addressCount)throw new Error("Invalid memory ID");this.rows[t.index].setAvailability(!0)}updateBackground(){const t="view",e=this.getCenter(t),s=this.getExtents(t);this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background instanceof D&&this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius),this.background.data.position.setV(e,t),this.background.data.extents.setV(s,t),this.background.data.anchor.set("center");const a=this.data.valueWidth.toSpace(t,this.scene.getActiveCamera()),n=e.x-s.x+a;this.vLine.data.startPosition.set(n,e.y+s.y,t),this.vLine.data.endPosition.set(n,e.y-s.y,t),this.vLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),this.vLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width),this.background.update(),this.vLine.update()}updateVariables(){const t="world",e=this.getCenter(t),s=this.getExtents(t),a=this.isStacked?1:-1,n=2*s.y/this.addressCount;for(let i=0;i<this.rows.length;i++){const o=this.rows[i],r=e.y+a*((i+.5)*n-s.y),l=new h(e.x-s.x,r-.5*n),d=new h(e.x+s.x,r+.5*n);o.setWorldBounds(l,d),o.hLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),o.hLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width)}if(this.data.text.font.isDirty())for(const i of this.rows){for(const o of i.values)o.data.font.copyIfUnlocked(this.data.text.font);for(const o of i.names)o.data.font.copyIfUnlocked(this.data.text.font);i.address.data.font.copyIfUnlocked(this.data.text.font)}for(const i of this.rows)i.address.data.fill.copyIfUnlocked(this.data.text.addressFill),i.update()}update(){this.skipUpdate()||(this.updateSVGChildren(),this.updateBackground(),this.updateVariables(),this.clearDirty())}}class st extends T{animator;font;fillRect;setDefaultFont(t=16){this.font.family.set("monospace"),this.font.size.set(t,"view"),this.font.relativeAscenderHeight.set(.7),this.font.relativeLineHeight.set(1.3)}setDefaultCodeStyle(t){const e=t.data;e.text.font.copy(this.font),e.text.fill.color.copy(u.WHITE),e.padding.set(20,15,"view"),e.background.fill.color.copy(u.GREY_9),e.background.stroke.color.copy(u.GREY_7),e.background.stroke.width.set(2,"view"),e.background.cornerRadius.set(10,"view"),e.currentLine.opacity.set(1),e.currentLine.fill.color.copy(u.BLACK),e.currentLine.fill.opacity.set(.5),e.currentLine.stroke.color.copy(u.WHITE),e.currentLine.stroke.width.set(1,"view"),e.currentLine.stroke.opacity.set(.2),e.currentLine.padding.set(-.5,2,"view"),e.currentLine.index.set(0),e.position.set(-5.5,0,"world"),e.anchor.set("west")}setDefaultMemoryStyle(t){const e=t.data;e.extents.set(2,4,"world"),e.padding.set(15,0,"view"),e.valueWidth.set(2,"world"),e.text.fill.color.copyIfUnlocked(u.WHITE),e.text.addressFill.color.copyIfUnlocked(u.GREY_4),e.text.font.copyIfUnlocked(this.font),e.background.fill.color.copyIfUnlocked(u.GREY_9),e.background.stroke.color.copyIfUnlocked(u.GREY_7),e.background.stroke.width.set(2,"view"),e.background.cornerRadius.set(10,"view"),e.highlight.cornerRadius.set(7,"view"),e.highlight.padding.set(3,3,"view"),e.position.set(5.5,0,"world"),e.anchor.set("east")}constructor(t,e){super(t,e),this.animator=new Y(this),this.font=new I,this.fillRect=this.addFillRect(),this.fillRect.data.color.copy(u.GREY_8),this.setDefaultFont(16)}}export{st as B,et as S};
