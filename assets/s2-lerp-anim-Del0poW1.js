class c{x;y;constructor(t=0,e=0){this.x=t,this.y=e}static set(t,e){return new c(t,e)}static fromPolarRad(t,e=1){return new c(e*Math.cos(t),e*Math.sin(t))}static fromPolarDeg(t,e=1){return t*=Math.PI/180,new c(e*Math.cos(t),e*Math.sin(t))}static add(t,e,s,i){return new c(t+s,e+i)}static addV(t,e){return new c(t.x+e.x,t.y+e.y)}static sub(t,e,s,i){return new c(t-s,e-i)}static subV(t,e){return new c(t.x-e.x,t.y-e.y)}static mul(t,e,s,i){return new c(t*s,e*i)}static mulV(t,e){return new c(t.x*e.x,t.y*e.y)}static scale(t,e,s){return new c(t*s,e*s)}static scaleV(t,e){return new c(t.x*e,t.y*e)}static lerp(t,e,s,i,n){const a=1-n;return new c(a*t+n*s,a*e+n*i)}static lerpV(t,e,s){return c.lerp(t.x,t.y,e.x,e.y,s)}static eq(t,e,s,i,n=1e-4){return Math.abs(t-s)<n&&Math.abs(e-i)<n}static eqV(t,e,s=1e-4){return Math.abs(t.x-e.x)<s&&Math.abs(t.y-e.y)<s}static isZeroV(t,e=1e-4){return Math.abs(t.x)<e&&Math.abs(t.y)<e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setV(t){return this.x=t.x,this.y=t.y,this}setFromPolarRad(t,e=1){return this.set(e*Math.cos(t),e*Math.sin(t))}setFromPolarDeg(t,e=1){return t*=Math.PI/180,this.set(e*Math.cos(t),e*Math.sin(t))}shiftX(t){return this.x+=t,this}shiftY(t){return this.y+=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new c(this.x,this.y)}copy(t){return this.setV(t)}add(t,e){return this.x+=t,this.y+=e,this}addV(t){return this.x+=t.x,this.y+=t.y,this}sub(t,e){return this.x-=t,this.y-=e,this}subV(t){return this.x-=t.x,this.y-=t.y,this}mul(t,e){return this.x*=t,this.y*=e,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}scale(t){return this.x*=t,this.y*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this}min(t,e){return this.x=Math.min(this.x,t),this.y=Math.min(this.y,e),this}minV(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t,e){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,e),this}maxV(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}apply2x2(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i,this.y=e[1]*s+e[3]*i,this}apply2x3(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i+e[4],this.y=e[1]*s+e[3]*i+e[5],this}apply2x3Offset(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i,this.y=e[1]*s+e[3]*i,this}dot(t){return this.x*t.x+this.y*t.y}det(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceSq(t){const e=t.x-this.x,s=t.y-this.y;return e*e+s*s}distance(t){return Math.sqrt(this.distanceSq(t))}normalize(){return this.length()===0?this:this.scale(1/this.length())}setLength(t){return this.scale(t/this.length())}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}angle(){return Math.atan2(-this.y,this.x)}angleTo(t){const e=this.det(t),s=this.dot(t);return Math.atan2(e,s)}perp(t=!1){const e=this.x,s=t?-1:1;return this.x=-s*this.y,this.y=s*e,this}rotateRad(t){const e=Math.sin(t),s=Math.cos(t),i=this.x,n=this.y;return this.x=s*i-e*n,this.y=e*i+s*n,this}rotateDeg(t){return this.rotateRad(t*Math.PI/180)}*[Symbol.iterator](){yield this.x,yield this.y}}class I{elements=[0,0,0,0,0,0];constructor(t=0,e=0,s=0,i=0,n=0,a=0){this.set(t,e,s,i,n,a)}static createIdentity(){return new I(1,0,0,0,1,0)}static lerp(t,e,s){return new I().lerp(t,e,s)}static eq(t,e,s=1e-4){for(let i=0;i<6;i++)if(Math.abs(t.elements[i]-e.elements[i])>=s)return!1;return!0}lerp(t,e,s){const i=1-s;for(let n=0;n<6;n++)this.elements[n]=i*t.elements[n]+s*e.elements[n];return this}set(t=0,e=0,s=0,i=0,n=0,a=0){return this.elements[0]=t,this.elements[2]=e,this.elements[4]=s,this.elements[1]=i,this.elements[3]=n,this.elements[5]=a,this}fromArray(t,e=0){for(let s=0;s<6;s++)this.elements[s]=t[s+e];return this}isIdentity(){const t=this.elements;return t[0]===1&&t[2]===0&&t[4]===0&&t[1]===0&&t[3]===1&&t[5]===0}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,a=s[0],h=s[1],l=s[2],u=s[3],y=s[4],p=s[5],w=i[0],x=i[1],O=i[2],V=i[3],X=i[4],N=i[5];return n[0]=a*w+l*x,n[1]=h*w+u*x,n[2]=a*O+l*V,n[3]=h*O+u*V,n[4]=a*X+l*N+y,n[5]=h*X+u*N+p,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}copy(t){for(let e=0;e<6;e++)this.elements[e]=t.elements[e];return this}clone(){return new I().copy(this)}makeIdentity(){return this.set(1,0,0,0,1,0)}makeTranslation(t,e){return this.set(1,0,t,0,1,e)}makeScale(t,e){return this.set(t,0,0,0,e,0)}makeScaleFrom(t,e,s,i){return this.set(t,0,-t*s+s,0,e,-e*i+i)}makeRotationRad(t){const e=Math.sin(t),s=Math.cos(t);return this.set(s,-e,0,+e,s,0)}makeRotationDeg(t){return this.makeRotationRad(t*Math.PI/180)}makeRotationFromRad(t,e,s){const i=Math.sin(t),n=Math.cos(t);return this.set(n,-i,-e*n+s*i+e,+i,n,-s*n-e*i+s)}makeRotationFromDeg(t,e,s){return this.makeRotationFromRad(t*Math.PI/180,e,s)}}class xe{position;extents;scaleFactor=1;viewportSize;worldToViewScale=new c(1,1);viewToWorldScale=new c(1,1);worldToViewMat=new I;viewToWorldMat=new I;dirty=!0;rotation=0*Math.PI;constructor(t,e,s){this.position=t,this.extents=e,this.viewportSize=s,this.update()}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0)}clearDirty(){this.dirty=!1}getViewportSize(){return this.viewportSize}getRotationRad(){return this.rotation}getRotationDeg(){return this.rotation*180/Math.PI}getWorldToViewMatrix(){return this.update(),this.worldToViewMat}getViewToWorldMatrix(){return this.update(),this.viewToWorldMat}getWorldToViewScale(){return this.update(),this.worldToViewScale}getViewToWorldScale(){return this.update(),this.viewToWorldScale}getLower(){return this.update(),c.subV(this.position,c.scaleV(this.extents,this.scaleFactor))}getUpper(){return this.update(),c.addV(this.position,c.scaleV(this.extents,this.scaleFactor))}setPosition(t,e){return this.position.set(t,e),this.markDirty(),this}setExtents(t,e){return this.extents.set(t,e),this.markDirty(),this}setZoom(t){return this.scaleFactor=1/t,this.markDirty(),this}setRotationRad(t){return this.rotation=t,this.markDirty(),this}setRotationDeg(t){return this.rotation=t*Math.PI/180,this.markDirty(),this}update(){if(!this.isDirty())return;this.worldToViewScale.set(.5*this.viewportSize.x/(this.extents.x*this.scaleFactor),.5*this.viewportSize.y/(this.extents.y*this.scaleFactor)),this.viewToWorldScale.set(2*(this.extents.x*this.scaleFactor)/this.viewportSize.x,2*(this.extents.y*this.scaleFactor)/this.viewportSize.y);const t=this.viewportSize.x/2,e=this.viewportSize.y/2,s=+this.worldToViewScale.x,i=-this.worldToViewScale.y,n=Math.cos(-this.rotation),a=Math.sin(-this.rotation),h=this.position.x,l=this.position.y;this.worldToViewMat.set(+s*n,-s*a,-h*s*n+l*s*a+t,+i*a,+i*n,-h*i*a-l*i*n+e);const u=+this.viewToWorldScale.x,y=-this.viewToWorldScale.y;this.viewToWorldMat.set(+u*n,+y*a,-t*n*u-e*a*y+h,-u*a,+y*n,+t*a*u-e*n*y+l),this.clearDirty()}viewToWorld(t,e,s){return s=s??new c,s.set(t,e).apply2x3(this.viewToWorldMat)}viewToWorldV(t,e){return this.viewToWorld(t.x,t.y,e)}viewToWorldOffset(t,e,s){return s=s??new c,s.set(t,e).apply2x3Offset(this.viewToWorldMat)}viewToWorldOffsetV(t,e){return this.viewToWorldOffset(t.x,t.y,e)}worldToView(t,e,s){return s=s??new c,s.set(t,e).apply2x3(this.worldToViewMat)}worldToViewV(t,e){return this.worldToView(t.x,t.y,e)}worldToViewOffset(t,e,s){return s=s??new c,s.set(t,e).apply2x3Offset(this.worldToViewMat)}worldToViewOffsetV(t,e){return this.worldToViewOffset(t.x,t.y,e)}convertPoint(t,e,s,i,n){if(n=n??new c,s===i)return n.set(t,e);switch(s){case"world":return this.worldToView(t,e,n);case"view":return this.viewToWorld(t,e,n)}}convertPointV(t,e,s,i){return this.convertPoint(t.x,t.y,e,s,i)}convertOffset(t,e,s,i,n){if(n=n??new c,s===i)return n.set(t,e);switch(s){case"world":return this.worldToViewOffset(t,e,n);case"view":return this.viewToWorldOffset(t,e,n)}}convertOffsetV(t,e,s,i){return this.convertOffset(t.x,t.y,e,s,i)}convertExtents(t,e,s,i,n){if(n=n??new c,s===i)return n.set(t,e);switch(s){case"world":return n.set(t,e).mulV(this.worldToViewScale);case"view":return n.set(t,e).mulV(this.viewToWorldScale)}}convertExtentsV(t,e,s,i){return this.convertExtents(t.x,t.y,e,s,i)}convertLength(t,e,s){if(e===s)return t;switch(e){case"world":return t*this.worldToViewScale.x;case"view":return t*this.viewToWorldScale.x}}}class G{dirty=!0;owner=null;locked=!1;setOwner(t=null){this.owner=t}getOwner(){return this.owner}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}clearDirty(){this.dirty=!1}isLocked(){return this.locked}lock(){return this.locked||(this.locked=!0),this}unlock(){return this.locked&&(this.locked=!1),this}}class T{static clamp(t,e,s){return Math.max(e,Math.min(s,t))}static clamp01(t){return T.clamp(t,0,1)}static lerp(t,e,s){return(1-s)*t+s*e}static invLerp(t,e,s){return t!==e?(s-t)/(e-t):0}static remap(t,e,s,i,n){return T.lerp(s,i,T.invLerp(t,e,n))}static mod(t,e){return(t%e+e)%e}static damp(t,e,s,i){return T.lerp(t,e,1-Math.exp(-s*i))}static snap(t,e){return e<=0?t:Math.round(t/e)*e}static snapToArray(t,e){return e.length===0?t:e.reduce((s,i)=>Math.abs(i-t)<Math.abs(s-t)?i:s)}}class r extends G{kind="color";r;g;b;constructor(t=0,e=0,s=0,i=!1){super(),this.r=t,this.g=e,this.b=s,this.locked=i}clone(){return new r(this.r,this.g,this.b,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.r===t.r&&this.g===t.g&&this.b===t.b?this:(this.r=t.r,this.g=t.g,this.b=t.b,this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get(),a=T.lerp(i.r,n.r,s),h=T.lerp(i.g,n.g,s),l=T.lerp(i.b,n.b,s);return this.set(a,h,l),this}static lerp(t,e,s){return new r().lerp(t,e,s)}set(t,e,s){return this.r===t&&this.g===e&&this.b===s?this:(this.r=t,this.g=e,this.b=s,this.markDirty(),this)}setFromHex(t){if(!/^#([0-9A-Fa-f]{6})$/.test(t))throw new Error(`Invalid hex color: ${t}`);const e=parseInt(t.substring(1),16);return this.r=e>>16&255,this.g=e>>8&255,this.b=e&255,this.markDirty(),this}static fromHex(t){return new r().setFromHex(t)}toHex(){return"#"+[this.r,this.g,this.b].map(t=>t.toString(16).padStart(2,"0")).join("")}toRgb(){return`rgb(${Math.floor(this.r)}, ${Math.floor(this.g)}, ${Math.floor(this.b)})`}get(){return{r:this.r,g:this.g,b:this.b}}}const ve={RED:new r(244,67,54),PINK:new r(233,30,99),PURPLE:new r(156,39,176),DEEP_PURPLE:new r(103,58,183),INDIGO:new r(63,81,181),BLUE:new r(33,150,243),LIGHT_BLUE:new r(3,169,244),CYAN:new r(0,188,212),TEAL:new r(0,150,136),GREEN:new r(76,175,80),LIGHT_GREEN:new r(139,195,74),LIME:new r(205,220,57),YELLOW:new r(255,235,59),AMBER:new r(255,193,7),ORANGE:new r(255,152,0),DEEP_ORANGE:new r(255,87,34),BROWN:new r(121,85,72),GREY:new r(158,158,158),BLUE_GREY:new r(96,125,139),BLACK:new r(0,0,0),WHITE:new r(255,255,255),RED_0:new r(255,235,238),RED_1:new r(255,205,210),RED_2:new r(239,154,154),RED_3:new r(229,115,115),RED_4:new r(239,83,80),RED_5:new r(244,67,54),RED_6:new r(229,57,53),RED_7:new r(211,47,47),RED_8:new r(198,40,40),RED_9:new r(183,28,28),PINK_0:new r(252,228,236),PINK_1:new r(248,187,208),PINK_2:new r(244,143,177),PINK_3:new r(240,98,146),PINK_4:new r(236,64,122),PINK_5:new r(233,30,99),PINK_6:new r(216,27,96),PINK_7:new r(194,24,91),PINK_8:new r(173,20,87),PINK_9:new r(136,14,79),PURPLE_0:new r(243,229,245),PURPLE_1:new r(225,190,231),PURPLE_2:new r(206,147,216),PURPLE_3:new r(186,104,200),PURPLE_4:new r(171,71,188),PURPLE_5:new r(156,39,176),PURPLE_6:new r(142,36,170),PURPLE_7:new r(123,31,162),PURPLE_8:new r(106,27,154),PURPLE_9:new r(74,20,140),DEEP_PURPLE_0:new r(237,231,246),DEEP_PURPLE_1:new r(209,196,233),DEEP_PURPLE_2:new r(179,157,219),DEEP_PURPLE_3:new r(149,117,205),DEEP_PURPLE_4:new r(126,87,194),DEEP_PURPLE_5:new r(103,58,183),DEEP_PURPLE_6:new r(94,53,177),DEEP_PURPLE_7:new r(81,45,168),DEEP_PURPLE_8:new r(69,39,160),DEEP_PURPLE_9:new r(49,27,146),INDIGO_0:new r(232,234,246),INDIGO_1:new r(197,202,233),INDIGO_2:new r(159,168,218),INDIGO_3:new r(121,134,203),INDIGO_4:new r(92,107,192),INDIGO_5:new r(63,81,181),INDIGO_6:new r(57,73,171),INDIGO_7:new r(48,63,159),INDIGO_8:new r(40,53,147),INDIGO_9:new r(26,35,126),BLUE_0:new r(227,242,253),BLUE_1:new r(187,222,251),BLUE_2:new r(144,202,249),BLUE_3:new r(100,181,246),BLUE_4:new r(66,165,245),BLUE_5:new r(33,150,243),BLUE_6:new r(30,136,229),BLUE_7:new r(25,118,210),BLUE_8:new r(21,101,192),BLUE_9:new r(13,71,161),LIGHT_BLUE_0:new r(225,245,254),LIGHT_BLUE_1:new r(179,229,252),LIGHT_BLUE_2:new r(129,212,250),LIGHT_BLUE_3:new r(79,195,247),LIGHT_BLUE_4:new r(41,182,246),LIGHT_BLUE_5:new r(3,169,244),LIGHT_BLUE_6:new r(3,155,229),LIGHT_BLUE_7:new r(2,136,209),LIGHT_BLUE_8:new r(2,119,189),LIGHT_BLUE_9:new r(1,87,155),CYAN_0:new r(224,247,250),CYAN_1:new r(178,235,242),CYAN_2:new r(128,222,234),CYAN_3:new r(77,208,225),CYAN_4:new r(38,198,218),CYAN_5:new r(0,188,212),CYAN_6:new r(0,172,193),CYAN_7:new r(0,151,167),CYAN_8:new r(0,131,143),CYAN_9:new r(0,96,100),TEAL_0:new r(224,242,241),TEAL_1:new r(178,223,219),TEAL_2:new r(128,203,196),TEAL_3:new r(77,182,172),TEAL_4:new r(38,166,154),TEAL_5:new r(0,150,136),TEAL_6:new r(0,137,123),TEAL_7:new r(0,121,107),TEAL_8:new r(0,105,92),TEAL_9:new r(0,77,64),GREEN_0:new r(232,245,233),GREEN_1:new r(200,230,201),GREEN_2:new r(165,214,167),GREEN_3:new r(129,199,132),GREEN_4:new r(102,187,106),GREEN_5:new r(76,175,80),GREEN_6:new r(67,160,71),GREEN_7:new r(56,142,60),GREEN_8:new r(46,125,50),GREEN_9:new r(27,94,32),LIGHT_GREEN_0:new r(241,248,233),LIGHT_GREEN_1:new r(220,237,200),LIGHT_GREEN_2:new r(197,225,165),LIGHT_GREEN_3:new r(174,213,129),LIGHT_GREEN_4:new r(156,204,101),LIGHT_GREEN_5:new r(139,195,74),LIGHT_GREEN_6:new r(124,179,66),LIGHT_GREEN_7:new r(104,159,56),LIGHT_GREEN_8:new r(85,139,47),LIGHT_GREEN_9:new r(51,105,30),LIME_0:new r(249,251,231),LIME_1:new r(240,244,195),LIME_2:new r(230,238,156),LIME_3:new r(220,231,117),LIME_4:new r(212,225,87),LIME_5:new r(205,220,57),LIME_6:new r(192,202,51),LIME_7:new r(175,180,43),LIME_8:new r(158,157,36),LIME_9:new r(130,119,23),YELLOW_0:new r(255,253,231),YELLOW_1:new r(255,249,196),YELLOW_2:new r(255,245,157),YELLOW_3:new r(255,241,118),YELLOW_4:new r(255,238,88),YELLOW_5:new r(255,235,59),YELLOW_6:new r(253,216,53),YELLOW_7:new r(251,192,45),YELLOW_8:new r(249,168,37),YELLOW_9:new r(245,127,23),AMBER_0:new r(255,248,225),AMBER_1:new r(255,236,179),AMBER_2:new r(255,224,130),AMBER_3:new r(255,213,79),AMBER_4:new r(255,202,40),AMBER_5:new r(255,193,7),AMBER_6:new r(255,179,0),AMBER_7:new r(255,160,0),AMBER_8:new r(255,143,0),AMBER_9:new r(255,111,0),ORANGE_0:new r(255,243,224),ORANGE_1:new r(255,224,178),ORANGE_2:new r(255,204,128),ORANGE_3:new r(255,183,77),ORANGE_4:new r(255,167,38),ORANGE_5:new r(255,152,0),ORANGE_6:new r(251,140,0),ORANGE_7:new r(245,124,0),ORANGE_8:new r(239,108,0),ORANGE_9:new r(230,81,0),DEEP_ORANGE_0:new r(251,233,231),DEEP_ORANGE_1:new r(255,204,188),DEEP_ORANGE_2:new r(255,171,145),DEEP_ORANGE_3:new r(255,138,101),DEEP_ORANGE_4:new r(255,112,67),DEEP_ORANGE_5:new r(255,87,34),DEEP_ORANGE_6:new r(244,81,30),DEEP_ORANGE_7:new r(230,74,25),DEEP_ORANGE_8:new r(216,67,21),DEEP_ORANGE_9:new r(191,54,12),BROWN_0:new r(239,235,233),BROWN_1:new r(215,204,200),BROWN_2:new r(188,170,164),BROWN_3:new r(161,136,127),BROWN_4:new r(141,110,99),BROWN_5:new r(121,85,72),BROWN_6:new r(109,76,65),BROWN_7:new r(93,64,55),BROWN_8:new r(78,52,46),BROWN_9:new r(62,39,35),GREY_0:new r(250,250,250),GREY_1:new r(245,245,245),GREY_2:new r(238,238,238),GREY_3:new r(224,224,224),GREY_4:new r(189,189,189),GREY_5:new r(158,158,158),GREY_6:new r(117,117,117),GREY_7:new r(97,97,97),GREY_8:new r(66,66,66),GREY_9:new r(33,33,33),BLUE_GREY_0:new r(236,239,241),BLUE_GREY_1:new r(207,216,220),BLUE_GREY_2:new r(176,190,197),BLUE_GREY_3:new r(144,164,174),BLUE_GREY_4:new r(120,144,156),BLUE_GREY_5:new r(96,125,139),BLUE_GREY_6:new r(84,110,122),BLUE_GREY_7:new r(69,90,100),BLUE_GREY_8:new r(55,71,79),BLUE_GREY_9:new r(38,50,56)},b="http://www.w3.org/2000/svg";class Z{space="world";position=new c;tangent=new c;strokeWidth=1;pathLength=1}class W{static getCenter(t,e,s,i,n){const a=e==="world"?1:-1,h=n.get(e,s),l=i.get(e,s);switch(t){case"north-west":l.shiftY(-a*h.y).shiftX(+h.x);break;case"north":l.shiftY(-a*h.y);break;case"north-east":l.shiftY(-a*h.y).shiftX(-h.x);break;case"west":l.shiftX(+h.x);break;case"center":break;case"east":l.shiftX(-h.x);break;case"south-west":l.shiftY(+a*h.y).shiftX(+h.x);break;case"south":l.shiftY(+a*h.y);break;case"south-east":l.shiftY(+a*h.y).shiftX(-h.x);break}return l}static getNorthWest(t,e,s,i,n){const a=e==="world"?1:-1,h=n.get(e,s),l=i.get(e,s);switch(t){case"north-west":break;case"north":l.shiftX(-h.x);break;case"north-east":l.shiftX(-2*h.x);break;case"west":l.shiftY(a*h.y);break;case"center":l.shiftY(a*h.y).shiftX(-h.x);break;case"east":l.shiftY(a*h.y).shiftX(-2*h.x);break;case"south-west":l.shiftY(2*a*h.y);break;case"south":l.shiftY(2*a*h.y).shiftX(-h.x);break;case"south-east":l.shiftY(2*a*h.y).shiftX(-2*h.x);break}return l}}class kt{static computeSizes(t,e,s,i,n){const a=e.reduce((u,y)=>u+y,0),h=2*i+n*Math.max(t.length-1,0),l=Math.max((s-h)/a,t.map((u,y)=>u/e[y]).reduce((u,y)=>Math.max(u,y),0));for(let u=0;u<t.length;u++)t[u]=e[u]*l;return l*a+h}}class z{curves=[];length=0;cumulativeLengths=[];constructor(){}clone(){const t=new z;for(const e of this.curves)t.curves.push(e.clone());return t.length=this.length,t.cumulativeLengths=this.cumulativeLengths.slice(),t}copy(t){return this.curves=t.curves.map(e=>e.clone()),this.length=t.length,this.cumulativeLengths=t.cumulativeLengths.slice(),this}clear(){return this.curves.length=0,this.length=0,this.cumulativeLengths.length=0,this}getCurve(t){return this.curves[t]}getCurveCount(){return this.curves.length}getLastCurve(){return this.curves[this.curves.length-1]}getCurveParam(t){const e=t*this.length;for(let s=0;s<this.cumulativeLengths.length;s++){const i=this.cumulativeLengths[s];if(e<i)return{index:s,t:T.invLerp(i-this.curves[s].getLength(),i,e)}}return{index:this.curves.length-1,t:1}}getStart(){return this.curves[0].getStart()}getEnd(){return this.curves[this.curves.length].getEnd()}getStartTangent(){return this.curves[0].getStartTangent()}getEndTangent(){return this.curves[this.curves.length-1].getEndTangent()}updateLength(){this.cumulativeLengths.length=0,this.length=0;for(let t=0;t<this.curves.length;t++)this.length+=this.curves[t].getLength(),this.cumulativeLengths.push(this.length);return this}addLine(t,e){const s=new _(t,e);return this.length+=s.getLength(),this.curves.push(s),this}addQuadratic(t,e,s,i=0){const n=new q(t,e,s).computeLinearLUT(i);return i>0&&n.computeLinearLUT(i),this.length+=n.getLength(),this.curves.push(n),this}addCubic(t,e,s,i,n=0){const a=new B(t,e,s,i);return n>0&&a.computeLinearLUT(n),this.length+=a.getLength(),this.curves.push(a),this}getPointAt(t){if(this.curves.length===0)return new c(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getPointAt(e.t)}getTangentAt(t){if(this.curves.length===0)return new c(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getTangentAt(e.t)}createPartialCurveTo(t){const e=new z;if(this.curves.length===0)return e;const s=this.getCurveParam(t);for(let i=0;i<s.index;i++)e.curves.push(this.curves[i].clone());return e.curves.push(this.curves[s.index].createPartialCurveTo(s.t)),e.updateLength(),e}createPartialCurveFrom(t){const e=new z;if(this.curves.length===0)return e;const s=this.getCurveParam(t);e.curves.push(this.curves[s.index].createPartialCurveFrom(s.t));for(let i=s.index+1;i<this.curves.length;i++)e.curves.push(this.curves[i].clone());return e.updateLength(),e}createPartialCurveRange(t,e){const s=new z;if(this.curves.length===0||t>=e)return s;const i=this.getCurveParam(t),n=this.getCurveParam(e);if(i.index==n.index)s.curves.push(this.curves[i.index].createPartialCurveRange(i.t,n.t));else{s.curves.push(this.curves[i.index].createPartialCurveFrom(i.t));for(let a=i.index+1;a<n.index;a++)s.curves.push(this.curves[a].clone());s.curves.push(this.curves[n.index].createPartialCurveTo(n.t))}return s.updateLength(),s}getLength(){return this.length}}class _{p0;p1;length;constructor(t,e){this.p0=t.clone(),this.p1=e.clone(),this.length=this.p0.distance(this.p1)}copy(t){return this.p0.copy(t.p0),this.p1.copy(t.p1),this.length=t.length,this}getTangentAt(t){return c.subV(this.p1,this.p0)}getStartTangent(){return c.subV(this.p1,this.p0)}getEndTangent(){return c.subV(this.p1,this.p0)}clone(){return new _(this.p0,this.p1)}getLength(){return this.length}getStart(){return this.p0.clone()}getEnd(){return this.p1.clone()}getPointAt(t){return c.lerpV(this.p0,this.p1,t)}createPartialCurveTo(t){return new _(this.p0,this.getPointAt(t))}createPartialCurveFrom(t){return new _(this.getPointAt(t),this.p1)}createPartialCurveRange(t,e){return new _(this.getPointAt(t),this.getPointAt(e))}}class lt{points=[];linearLUT=null;sampleCount=0;length=0;copy(t){return this.points=t.points.map(e=>e.clone()),t.linearLUT&&(this.linearLUT=t.linearLUT.slice(),this.length=t.length,this.sampleCount=t.sampleCount),this}getLength(){return this.length}linearize(t){if(this.linearLUT===null)return t;const e=t*(this.sampleCount+0),s=Math.floor(e);return s<0?0:s>=this.linearLUT.length-1?1:T.lerp(this.linearLUT[s],this.linearLUT[s+1],e-s)}computeLinearLUT(t=8){const e=[0];let s=this.getPointAtCasteljau(0),i=0;for(let a=1;a<=t;a++){const h=this.getPointAtCasteljau(a/t);i+=s.distance(h),e.push(i),s=h}this.length=i,this.sampleCount=t,e.forEach((a,h,l)=>{l[h]=a/i}),this.linearLUT=[0];let n=1;for(let a=1;a<=t;a++){const h=a/t;for(;e[n]<h&&n<e.length-1;)n++;this.linearLUT.push(T.remap(e[n-1],e[n],(n-1)/t,n/t,h))}return this}getPointAt(t){return this.getPointAtCasteljau(this.linearize(t))}getBezierPoint(t){return this.points[t]}getBezierPoints(){return this.points}}class q extends lt{constructor(t,e,s){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.length=t.distance(s)}clone(){const t=this.points,e=new q(t[0],t[1],t[2]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[2].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,a=t*t;return new c(i*e[0].x+n*e[1].x+a*e[2].x,i*e[0].y+n*e[1].y+a*e[2].y)}getTangentAtCasteljau(t){const e=this.points;return new c((1-t)*(e[1].x-e[0].x)+t*(e[2].x-e[1].x),(1-t)*(e[1].y-e[0].y)+t*(e[2].y-e[1].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return c.subV(this.points[1],this.points[0])}getEndTangent(){return c.subV(this.points[2],this.points[1])}reduceToCasteljau(t){const e=c.lerpV(this.points[0],this.points[1],t),s=c.lerpV(this.points[1],this.points[2],t),i=c.lerpV(e,s,t);return new q(this.points[0],e,i)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=c.lerpV(this.points[0],this.points[1],t),s=c.lerpV(this.points[1],this.points[2],t),i=c.lerpV(e,s,t);return new q(i,s,this.points[2])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}class B extends lt{constructor(t,e,s,i){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.points.push(i.clone()),this.length=t.distance(i)}clone(){const t=this.points,e=new B(t[0],t[1],t[2],t[3]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[3].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s*s,n=s*s*t*3,a=s*t*t*3,h=t*t*t;return new c(i*e[0].x+n*e[1].x+a*e[2].x+h*e[3].x,i*e[0].y+n*e[1].y+a*e[2].y+h*e[3].y)}getTangentAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,a=t*t;return new c(i*(e[1].x-e[0].x)+n*(e[2].x-e[1].x)+a*(e[3].x-e[2].x),i*(e[1].y-e[0].y)+n*(e[2].y-e[1].y)+a*(e[3].y-e[2].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return c.subV(this.points[1],this.points[0])}getEndTangent(){return c.subV(this.points[3],this.points[2])}reduceToCasteljau(t){const e=c.lerpV(this.points[0],this.points[1],t),s=c.lerpV(this.points[1],this.points[2],t),i=c.lerpV(this.points[2],this.points[3],t),n=c.lerpV(e,s,t),a=c.lerpV(s,i,t),h=c.lerpV(n,a,t);return new B(this.points[0],e,n,h)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=c.lerpV(this.points[0],this.points[1],t),s=c.lerpV(this.points[1],this.points[2],t),i=c.lerpV(this.points[2],this.points[3],t),n=c.lerpV(e,s,t),a=c.lerpV(s,i,t),h=c.lerpV(n,a,t);return new B(h,a,i,this.points[3])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}class m extends G{kind="position";value;space;constructor(t=0,e=0,s="world",i=!1){super(),this.value=new c(t,e),this.space=s,this.locked=i}clone(){return new m(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return c.eqV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.setV(c.lerpV(a,h,s),n),this}static lerp(t,e,s,i){return new m().lerp(t,e,s,i)}set(t=0,e=0,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return c.eqV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s,i){return c.eq(this.value.x,this.value.y,t,e)&&this.space===s?this:(i.convertPoint(t,e,s,this.space,this.value),this.markDirty(),this)}setValueFromSpaceV(t,e,s){return this.setValueFromSpace(t.x,t.y,e,s)}get(t,e,s){return e.convertPointV(this.value,this.space,t,s)}changeSpace(t,e){return this.space===t?this:(e.convertPointV(this.value,this.space,t,this.value),this.space=t,this)}}class d{static applyPointerEvents(t,e,s){t.isDirty()&&(e.style.pointerEvents=t.value)}static applyStroke(t,e,s){if(t.isDirty()!==!1){if(t.width.isDirty()){const i=t.width.get("view",s.getActiveCamera());e.setAttribute("stroke-width",i.toFixed(2))}t.color.isDirty()&&e.setAttribute("stroke",t.color.toRgb()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("stroke-opacity",t.opacity.toFixed(2)):e.removeAttribute("stroke-opacity")),t.lineCap.isDirty()&&e.setAttribute("stroke-linecap",t.lineCap.value),t.lineJoin.isDirty()&&e.setAttribute("stroke-linejoin",t.lineJoin.value)}}static applyFill(t,e,s){t.isDirty()!==!1&&(t.color.isDirty()&&e.setAttribute("fill",t.color.toRgb()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("fill-opacity",t.opacity.toFixed(2)):e.removeAttribute("fill-opacity")))}static applyColor(t,e,s){t.isDirty()&&e.setAttribute("fill",t.toRgb())}static applyOpacity(t,e,s){t.isDirty()&&(t.value<=1?e.setAttribute("opacity",t.toFixed(2)):e.removeAttribute("opacity"))}static applyTransform(t,e,s){t.isDirty()&&(t.value.isIdentity()===!1?e.setAttribute("transform",t.toFixed(2)):e.removeAttribute("transform"))}static applyFont(t,e,s){if(t.isDirty()!==!1){if(t.size.isDirty()){const i=t.size.get("view",s.getActiveCamera());e.setAttribute("font-size",i.toFixed(1))}t.weight.isDirty()&&e.setAttribute("font-weight",t.weight.toFixed(0)),t.family.isDirty()&&e.setAttribute("font-family",t.family.toString()),t.style.isDirty()&&e.setAttribute("font-style",t.style.value)}}static applyPosition(t,e,s,i="x",n="y"){if(t.isDirty()){const a=t.get("view",s.getActiveCamera());e.setAttribute(i,a.x.toFixed(2)),e.setAttribute(n,a.y.toFixed(2))}}static applyShiftedPosition(t,e,s,i,n="x",a="y"){if(t.isDirty()||e.isDirty()){const h=i.getActiveCamera(),l=t.get("view",h),u=e.get("view",h);s.setAttribute(n,(l.x+u.x).toFixed(2)),s.setAttribute(a,(l.y+u.y).toFixed(2))}}static applyAnchoredPosition(t,e,s,i,n){if(t.isDirty()||e.isDirty()||s.isDirty()){const a=W.getNorthWest(s.value,"view",n.getActiveCamera(),t,e);i.setAttribute("x",a.x.toFixed(2)),i.setAttribute("y",a.y.toFixed(2))}}static applyExtents(t,e,s){if(t.isDirty()){const i=t.get("view",s.getActiveCamera()).scale(2);e.setAttribute("width",i.width.toFixed(2)),e.setAttribute("height",i.height.toFixed(2))}}static applyRadius(t,e,s){if(t.isDirty()){const i=t.get("view",s.getActiveCamera());e.setAttribute("r",i.toFixed(2))}}static applyCornerRadius(t,e,s){if(t.isDirty()){const i=t.get("view",s.getActiveCamera());e.setAttribute("rx",i.toFixed(2)),e.setAttribute("ry",i.toFixed(2))}}static applyPath(t,e,s,i,n,a){t.updateLength();const h=d.polyCurveToSVGPath(t,s.get(),i.get(),a.getActiveCamera(),e.get());h.length>=0?n.setAttribute("d",h):n.removeAttribute("d")}static polyCurveToSVGPath(t,e,s,i,n){e>0&&s<1?t=t.createPartialCurveRange(e,s):e>0?t=t.createPartialCurveFrom(e):s<1&&(t=t.createPartialCurveTo(s));const a=t.getCurveCount();if(a<=0||e>=s)return"";let h="";const l=t.getCurve(0).getStart(),u=new c(1/0,1/0),y=new c;for(let p=0;p<a;p++){const w=t.getCurve(p);if(c.eqV(u,w.getStart())||(i.convertPointV(l,n,"view",y),h+=`M ${y.x},${y.y} `),w instanceof _)i.convertPointV(w.getEnd(),n,"view",y),h+=`L ${y.x},${y.y} `;else if(w instanceof B){const O=w.getBezierPoints();h+="C ";for(let V=1;V<O.length;V++)i.convertPointV(O[V],n,"view",y),h+=`${y.x},${y.y} `}const x=w.getEnd();c.eqV(l,x)&&(h+="Z ",l.copy(x)),u.copy(x)}return h.trimEnd()}static applyPreserveWhitespace(t,e,s){t.isDirty()&&(t.value?e.style.whiteSpaceCollapse="preserve":e.style.whiteSpace="")}static applyTextAnchor(t,e,s){t.isDirty()&&e.setAttribute("text-anchor",t.value)}}class K extends G{kind="boolean";value;constructor(t=!1,e=!1){super(),this.value=t,this.locked=e}clone(){return new K(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value.toString()}}class k extends G{kind="enum";value;constructor(t,e=!1){super(),this.value=t,this.locked=e}clone(){return new k(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}}class D extends G{kind="length";value;space;constructor(t=0,e="world",s=!1){super(),this.value=t,this.space=e,this.locked=s}clone(){return new D(this.value,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value&&this.space===t.space?this:(this.value=t.value,this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.set(T.lerp(a,h,s),n),this}static lerp(t,e,s,i){return new D().lerp(t,e,s,i)}set(t,e){return this.value===t&&this.space===e?this:(this.value=t,e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s){return this.value===t&&this.space===e?this:(this.value=s.convertLength(t,e,this.space),this.markDirty(),this)}get(t,e){return e.convertLength(this.value,this.space,t)}changeSpace(t,e){return this.space===t?this:(this.value=e.convertLength(this.value,this.space,t),this.space=t,this)}}class f extends G{kind="number";value;constructor(t,e=!1){super(),this.value=t,this.locked=e}clone(){return new f(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(T.lerp(i,n,s)),this}static lerp(t,e,s){return new f(0).lerp(t,e,s)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toFixed(t=2){return this.value.toFixed(t)}}class tt extends G{kind="string";value;constructor(t="",e=!1){super(),this.value=t,this.locked=e}clone(){return new tt(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value}}class F{}class P extends F{layer=new f(0);isEnabled=new K(!0);pointerEvents=new k("none");setOwner(t=null){this.layer.setOwner(t),this.isEnabled.setOwner(t),this.pointerEvents.setOwner(t)}clearDirty(){this.layer.clearDirty(),this.isEnabled.clearDirty(),this.pointerEvents.clearDirty()}}class v extends F{color;width;opacity;lineCap;lineJoin;dirty;owner;constructor(){super(),this.color=new r(0,0,0),this.width=new D(0,"view"),this.opacity=new f(1),this.lineCap=new k("round"),this.lineJoin=new k("miter"),this.dirty=!0,this.owner=null,this.color.setOwner(this),this.width.setOwner(this),this.opacity.setOwner(this),this.lineCap.setOwner(this),this.lineJoin.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.width.copy(t.width),this.opacity.copy(t.opacity),this.lineCap.copy(t.lineCap),this.lineJoin.copy(t.lineJoin)}copyIfUnlocked(t){this.color.copyIfUnlocked(t.color),this.width.copyIfUnlocked(t.width),this.opacity.copyIfUnlocked(t.opacity),this.lineCap.copyIfUnlocked(t.lineCap),this.lineJoin.copyIfUnlocked(t.lineJoin)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.width.clearDirty(),this.opacity.clearDirty(),this.lineCap.clearDirty(),this.lineJoin.clearDirty()}}class A extends F{color;opacity;dirty;owner;constructor(){super(),this.color=new r(255,255,255),this.opacity=new f(1),this.dirty=!0,this.owner=null,this.color.setOwner(this),this.opacity.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.opacity.copy(t.opacity)}copyIfUnlocked(t){this.color.copyIfUnlocked(t.color),this.opacity.copyIfUnlocked(t.opacity)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.opacity.clearDirty()}}class L extends F{size;weight;relativeLineHeight;relativeAscenderHeight;family;style;dirty;owner;constructor(){super(),this.size=new D(16,"view"),this.weight=new f(400),this.relativeLineHeight=new f(21/16),this.relativeAscenderHeight=new f(16/16),this.family=new tt("system-ui"),this.style=new k("normal"),this.dirty=!0,this.owner=null,this.size.setOwner(this),this.weight.setOwner(this),this.relativeLineHeight.setOwner(this),this.relativeAscenderHeight.setOwner(this),this.family.setOwner(this),this.style.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.size.copy(t.size),this.weight.copy(t.weight),this.relativeLineHeight.copy(t.relativeLineHeight),this.relativeAscenderHeight.copy(t.relativeAscenderHeight),this.family.copy(t.family),this.style.copy(t.style)}copyIfUnlocked(t){this.size.copyIfUnlocked(t.size),this.weight.copyIfUnlocked(t.weight),this.relativeLineHeight.copyIfUnlocked(t.relativeLineHeight),this.relativeAscenderHeight.copyIfUnlocked(t.relativeAscenderHeight),this.family.copyIfUnlocked(t.family),this.style.copyIfUnlocked(t.style)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.size.clearDirty(),this.weight.clearDirty(),this.relativeLineHeight.clearDirty(),this.relativeAscenderHeight.clearDirty(),this.family.clearDirty(),this.style.clearDirty()}}class S{data;id;scene;dirty=!0;parent=null;children=[];childrenChanged=!1;constructor(t,e){this.data=e,this.scene=t,this.id=t.getNextElementId(),this.data.setOwner(this)}skipUpdate(){return!this.isDirty()}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.parent&&this.parent.markDirty())}clearDirty(){this.dirty=!1,this.data.clearDirty()}setEnabled(t){return this.data.isEnabled.set(t),this.parent&&this.parent.updateSVGChildren(),this}isEnabled(){return this.data.isEnabled.get()}setParent(t){if(this.parent===t)return this;if(this.parent!==null){const e=this.parent.children.indexOf(this);e!==-1?(this.parent.children.splice(e,1),this.parent.childrenChanged=!0,this.parent.markDirty()):console.warn("S2Element: Inconsistent parent-child relationship.",this,this.parent)}return t!==null&&(t.children.push(this),t.childrenChanged=!0,t.markDirty()),this.parent=t,this}getParent(){return this.parent}getChildCount(){return this.children.length}getChild(t){return this.children[t]}getScene(){return this.scene}updateSVGChildren(){if(!this.children.some(n=>n.data.layer.isDirty()||n.data.isEnabled.isDirty())&&!this.childrenChanged)return this;this.children.sort((n,a)=>n.data.layer.value!==a.data.layer.value?n.data.layer.value-a.data.layer.value:n.id-a.id);const e=[];for(const n of this.children)n.data.isEnabled.get()&&e.push(n.getSVGElement());const s=this.getSVGElement();return(s.children.length!==e.length||e.some((n,a)=>n!==s.children[a]))&&s.replaceChildren(...e),this.childrenChanged=!1,this}}class C extends G{kind="transform";value;constructor(t=1,e=0,s=0,i=0,n=1,a=0,h=!1){super(),this.value=new I(t,e,s,i,n,a),this.locked=h}clone(){return new C(this.value.elements[0],this.value.elements[1],this.value.elements[2],this.value.elements[3],this.value.elements[4],this.value.elements[5],this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return I.eq(this.value,t.value)?this:(this.value.copy(t.value),this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(I.lerp(i,n,s)),this}static lerp(t,e,s){return new C().lerp(t,e,s)}set(t){return I.eq(this.value,t)?this:(this.value.copy(t),this.markDirty(),this)}get(){return this.value}toFixed(t=2){return"matrix("+this.value.elements.map(e=>e.toFixed(t)).join(", ")+")"}}class Et extends P{fill;stroke;opacity;transform;position;radius;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.position=new m(0,0,"world"),this.radius=new D(1,"world"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.radius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.radius.clearDirty()}}class j extends S{element;constructor(t){super(t,new Et),this.element=document.createElementNS(b,"circle")}getRadius(t){return this.data.radius.get(t,this.scene.getActiveCamera())}getCenter(t){return this.data.position.get(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}getPointInDirection(t,e,s){const i=this.scene.getActiveCamera(),n=s.get(e,i),a=Math.max(this.data.radius.get(e,i)+n,0);return t.clone().normalize().scale(a).addV(this.data.position.get(e,i))}update(){this.skipUpdate()||(d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPosition(this.data.position,this.element,this.scene,"cx","cy"),d.applyRadius(this.data.radius,this.element,this.scene),this.clearDirty())}}class Dt{static intersectRayCircle(t,e,s,i){const n=t.clone().subV(s),a=e.dot(e),h=2*e.dot(n),l=n.dot(n)-i*i,u=h*h-4*a*l;if(u<0)return[];const y=Math.sqrt(u),p=(-h-y)/(2*a),w=(-h+y)/(2*a),x=[];return p>=0&&x.push(e.clone().scale(p).addV(t)),w>=0&&w!==p&&x.push(e.clone().scale(w).addV(t)),x}static intersectDirectionCircle(t,e,s){const i=t.dot(t),n=-2*t.dot(e),a=e.dot(e)-s*s,h=n*n-4*i*a;if(h<0)return-1;const l=Math.sqrt(h),u=(-n-l)/(2*i),y=(-n+l)/(2*i);return Math.max(u,y)}static intersectDirectionRoundedRectangle(t,e,s){const i=e.x-s+1e-5,n=e.y-s+1e-5;if(t.x>0){const u=t.clone().scale(+e.x/t.x);if(Math.abs(u.y)<=n)return u}if(t.x<0){const u=t.clone().scale(-e.x/t.x);if(Math.abs(u.y)<=n)return u}if(t.y>0){const u=t.clone().scale(+e.y/t.y);if(Math.abs(u.x)<=i)return u}if(t.y<0){const u=t.clone().scale(-e.y/t.y);if(Math.abs(u.x)<=i)return u}const a=e.x-s,h=e.y-s,l=new c;if(t.x>0&&t.y>0){l.set(+a,+h);const u=this.intersectDirectionCircle(t,l,s);if(u>=0)return t.clone().scale(u)}if(t.x<0&&t.y>0){l.set(-a,+h);const u=this.intersectDirectionCircle(t,l,s);if(u>=0)return t.clone().scale(u)}if(t.x>0&&t.y<0){l.set(+a,-h);const u=this.intersectDirectionCircle(t,l,s);if(u>=0)return t.clone().scale(u)}if(t.x<0&&t.y<0){l.set(-a,-h);const u=this.intersectDirectionCircle(t,l,s);if(u>=0)return t.clone().scale(u)}return new c(0,0)}static circleVsCircle(t,e,s,i,n,a){const h=i-t,l=n-e,u=Math.hypot(h,l);if(u>s+a||u<Math.abs(s-a)||u===0)return[];const y=(s*s-a*a+u*u)/(2*u),p=Math.sqrt(s*s-y*y),w=t+y*h/u,x=e+y*l/u,O=-l*(p/u),V=+h*(p/u);return[new c(w+O,x+V),new c(w-O,x-V)]}static getArcCenter(t,e,s,i=!1){const n=e.clone().subV(t),a=n.lengthSq(),h=Math.sqrt(s*s-a/4),l=n.clone().perp(i).scale(h/Math.sqrt(a));return t.clone().addV(n.scale(.5)).addV(l)}static getClosestPoint(t,e){if(e.length<=0)return new c(0,0);let s=0,i=t.distanceSq(e[0]);for(let n=1;n<e.length;n++){const a=t.distanceSq(e[n]);a<i&&(i=a,s=n)}return e[s].clone()}}class E extends G{kind="extents";value;space;constructor(t=0,e=0,s="world",i=!1){super(),this.value=new c(t,e),this.space=s,this.locked=i}clone(){return new E(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return c.eqV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.setV(c.lerpV(a,h,s),n),this}static lerp(t,e,s,i){return new E().lerp(t,e,s,i)}set(t,e,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return c.eqV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s,i){return c.eq(this.value.x,this.value.y,t,e)&&this.space===s?this:(i.convertExtents(t,e,s,this.space,this.value),this.markDirty(),this)}setValueFromSpaceV(t,e,s){return this.setValueFromSpace(t.x,t.y,e,s)}get(t,e,s){return e.convertExtentsV(this.value,this.space,t,s)}changeSpace(t,e){return this.space===t?this:(e.convertExtentsV(this.value,this.space,t,this.value),this.space=t,this)}}class At extends P{fill;stroke;opacity;transform;position;extents;anchor;cornerRadius;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.position=new m(0,0,"world"),this.extents=new E(1,1,"world"),this.anchor=new k("center"),this.cornerRadius=new D(0,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.extents.setOwner(t),this.anchor.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.extents.clearDirty(),this.anchor.clearDirty(),this.cornerRadius.clearDirty()}}class M extends S{element;constructor(t){super(t,new At),this.element=document.createElementNS(b,"rect")}getExtents(t){return this.data.extents.get(t,this.scene.getActiveCamera())}getCornerRadius(t){return this.data.cornerRadius.get(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}getPointInDirection(t,e,s){const i=this.scene.getActiveCamera(),n=s.get(e,i),a=this.data.extents.get(e,i).add(n,n).max(0,0),h=Math.min(Math.max(this.data.cornerRadius.get(e,i)+n,0),a.x,a.y),l=W.getCenter(this.data.anchor.get(),e,i,this.data.position,this.data.extents);return Dt.intersectDirectionRoundedRectangle(t,a,h).addV(l)}update(){this.skipUpdate()||(d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyAnchoredPosition(this.data.position,this.data.extents,this.data.anchor,this.element,this.scene),d.applyExtents(this.data.extents,this.element,this.scene),d.applyCornerRadius(this.data.cornerRadius,this.element,this.scene),this.clearDirty())}}class Pt extends P{stroke;opacity;transform;geometry;constructor(){super(),this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.geometry=new Tt,this.stroke.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.geometry.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.geometry.clearDirty()}}class Tt extends F{boundA;boundB;steps;referencePoint;space=new k("world");constructor(){super(),this.boundA=new m(-8,-4.5,"world"),this.boundB=new m(8,4.5,"world"),this.steps=new E(1,1,"world"),this.referencePoint=new m(0,0,"world")}setOwner(t=null){this.boundA.setOwner(t),this.boundB.setOwner(t),this.steps.setOwner(t),this.referencePoint.setOwner(t),this.space.setOwner(t)}clearDirty(){this.boundA.clearDirty(),this.boundB.clearDirty(),this.steps.clearDirty(),this.referencePoint.clearDirty(),this.space.clearDirty()}}class nt extends S{element;constructor(t){super(t,new Pt),this.element=document.createElementNS(b,"path"),this.data.stroke.width.set(1,"view"),this.data.stroke.lineCap.set("butt")}getSVGElement(){return this.element}applyGeometry(){const t=this.scene,e=this.element,s=this.data.geometry,i=1e-5,n=t.getActiveCamera(),a=s.space.get(),h=s.boundA.get(a,n),l=s.boundB.get(a,n),u=s.steps.get(a,n),y=s.referencePoint.get(a,n),p=Math.min(h.x,l.x),w=Math.max(h.x,l.x),x=Math.min(h.y,l.y),O=Math.max(h.y,l.y),V=y.x-Math.floor((y.x-p)/u.x)*u.x,X=y.y-Math.floor((y.y-x)/u.y)*u.y;let N="";for(let U=V;U<w+i;U+=u.x){const H=t.getActiveCamera().convertPoint(U,x,a,"view"),Y=t.getActiveCamera().convertPoint(U,O,a,"view");N+=`M${H.x},${H.y} L ${Y.x},${Y.y} `}for(let U=X;U<O+i;U+=u.y){const H=t.getActiveCamera().convertPoint(p,U,a,"view"),Y=t.getActiveCamera().convertPoint(w,U,a,"view");N+=`M${H.x},${H.y} L ${Y.x},${Y.y} `}e.setAttribute("d",N.trimEnd())}update(){this.skipUpdate()||(d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),this.applyGeometry(),this.clearDirty())}}class $ extends G{kind="direction";value;space;constructor(t=0,e=0,s="world",i=!1){super(),this.value=new c(t,e),this.space=s,this.locked=i}clone(){return new $(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return c.eqV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.setV(c.lerpV(a,h,s),n),this}static lerp(t,e,s,i){return new $().lerp(t,e,s,i)}set(t=0,e=0,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return c.eqV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s,i){return c.eq(this.value.x,this.value.y,t,e)&&this.space===s?this:(i.convertOffset(t,e,s,this.space,this.value),this.markDirty(),this)}setValueFromSpaceV(t,e,s){return this.setValueFromSpace(t.x,t.y,e,s)}get(t,e,s){return e.convertOffsetV(this.value,this.space,t,s)}changeSpace(t,e){return this.space===t?this:(e.convertOffsetV(this.value,this.space,t,this.value),this.space=t,this)}}class ut extends G{kind="bbox";center;extents;constructor(){super(),this.center=new $(0,0,"view"),this.extents=new E(0,0,"view")}set(t,e,s){if(!t.isConnected){console.warn("Element is not connected to DOM, cannot compute bbox",t.isConnected);return}const i=t.getBBox(),n=e?e.get("view",s):new c(0,0),a=new c(i.x+i.width/2,i.y+i.height/2).subV(n);this.center.setV(a,"view"),this.extents.set(i.width/2,i.height/2,"view"),this.markDirty()}getCenter(t,e){return this.center.get(t,e)}getExtents(t,e){return this.extents.get(t,e)}getLower(t,e){const s=this.getCenter(t,e),i=this.getExtents(t,e);return s.subV(i)}getUpper(t,e){const s=this.getCenter(t,e),i=this.getExtents(t,e);return s.addV(i)}}class Ct extends P{fill;stroke;opacity;transform;font;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.font=new L,this.fill.opacity.set(1),this.stroke.width.set(0,"view")}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty()}}class St extends S{category;content;element;localBBox;parentText;constructor(t,e){super(t,new Ct),this.element=document.createElementNS(b,"tspan"),this.category="",this.content="",this.localBBox=new ut,this.parentText=e,this.localBBox.setOwner(this)}clearDirty(){super.clearDirty(),this.localBBox.clearDirty()}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.content=t,this.localBBox.markDirty(),this}getContent(){return this.content}getLocalCenter(t){return this.localBBox.getCenter(t,this.scene.getActiveCamera())}getCenter(t){return this.getLocalCenter(t).addV(this.parentText.getPosition(t))}getExtents(t){return this.localBBox.getExtents(t,this.scene.getActiveCamera())}getLower(t){return this.localBBox.getLower(t,this.scene.getActiveCamera()).addV(this.parentText.getPosition(t))}getUpper(t){return this.localBBox.getUpper(t,this.scene.getActiveCamera()).addV(this.parentText.getPosition(t))}update(){if(this.skipUpdate())return;d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyFont(this.data.font,this.element,this.scene),(this.localBBox.isDirty()||this.data.font.isDirty()||this.parentText.data.preserveWhitespace.isDirty())&&this.localBBox.set(this.element,this.parentText.data.position,this.scene.getActiveCamera()),this.clearDirty()}}class et extends P{fill;stroke;opacity;transform;position;localShift;font;textAnchor;preserveWhitespace;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.position=new m(0,0,"world"),this.localShift=new $(0,0,"view"),this.font=new L,this.textAnchor=new k("start"),this.preserveWhitespace=new K(!1),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.localShift.setOwner(t),this.font.setOwner(t),this.textAnchor.setOwner(t),this.preserveWhitespace.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.localShift.clearDirty(),this.font.clearDirty(),this.textAnchor.clearDirty(),this.preserveWhitespace.clearDirty()}}class pt extends S{element;tspans;extents;localCenter;constructor(t,e){super(t,e),this.element=document.createElementNS(b,"text"),this.tspans=[],this.extents=new E(0,0,"view"),this.localCenter=new m(0,0,"view"),this.extents.setOwner(this),this.localCenter.setOwner(this)}getSVGElement(){return this.element}getPosition(t){return this.data.position.get(t,this.scene.getActiveCamera())}addTSpan(t,e){const s=new St(this.scene,this);return s.setParent(this),s.setContent(t),s.category=e??"",this.tspans.push(s),this.extents.markDirty(),this.localCenter.markDirty(),s}getExtents(t){return this.extents.get(t,this.scene.getActiveCamera())}getCenter(t){const e=this.localCenter.get(t,this.scene.getActiveCamera()),s=this.getPosition(t);return e.addV(s)}getTSpans(){return this.tspans}getTSpanCount(){return this.tspans.length}getTSpan(t){return this.tspans[t]}findTSpan(t){return this.tspans.find(e=>(t.content?e.getContent()===t.content:!0)&&(t.category?e.category===t.category:!0))}clearText(){return this.children.length=0,this.tspans.length=0,this.element.replaceChildren(),this.updateSVGChildren(),this.extents.markDirty(),this.localCenter.markDirty(),this}updateExtents(){const t=new c(1/0,1/0),e=new c(-1/0,-1/0);for(const s of this.tspans){const i=s.getLocalCenter("view"),n=s.getExtents("view");t.x=Math.min(t.x,i.x-n.x),t.y=Math.min(t.y,i.y-n.y),e.x=Math.max(e.x,i.x+n.x),e.y=Math.max(e.y,i.y+n.y)}return this.extents.set((e.x-t.x)/2,(e.y-t.y)/2,"view"),this.localCenter.set((e.x+t.x)/2,(e.y+t.y)/2,"view"),this.extents.clearDirty(),this.localCenter.clearDirty(),this}update(){if(!this.skipUpdate()){this.updateSVGChildren(),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyShiftedPosition(this.data.position,this.data.localShift,this.element,this.scene,"x","y"),d.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),d.applyTextAnchor(this.data.textAnchor,this.element,this.scene);for(const t of this.tspans)(this.data.fill.isDirty()||t.isDirty())&&t.data.fill.copyIfUnlocked(this.data.fill),(this.data.stroke.isDirty()||t.isDirty())&&t.data.stroke.copyIfUnlocked(this.data.stroke),(this.data.font.isDirty()||t.isDirty())&&t.data.font.copyIfUnlocked(this.data.font),t.update();this.updateExtents(),this.clearDirty()}}}class bt extends pt{constructor(t){super(t,new et)}}class Ot extends et{skip;horizontalAlign;constructor(){super(),this.skip=new D(0,"view"),this.horizontalAlign=new k("left")}setOwner(t=null){super.setOwner(t),this.skip.setOwner(t),this.horizontalAlign.setOwner(t)}clearDirty(){super.clearDirty(),this.skip.clearDirty(),this.horizontalAlign.clearDirty()}}class Lt extends pt{constructor(t){super(t,new Ot)}}class Rt extends P{fill;stroke;opacity;transform;position;font;skip;horizontalAlign;verticalAlign;minExtents;anchor;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.position=new m(0,0,"world"),this.font=new L,this.skip=new D(0,"view"),this.horizontalAlign=new k("left"),this.verticalAlign=new k("middle"),this.minExtents=new E(0,0,"view"),this.anchor=new k("center"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.font.setOwner(t),this.skip.setOwner(t),this.horizontalAlign.setOwner(t),this.verticalAlign.setOwner(t),this.minExtents.setOwner(t),this.anchor.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.font.clearDirty(),this.skip.clearDirty(),this.horizontalAlign.clearDirty(),this.verticalAlign.clearDirty(),this.minExtents.clearDirty(),this.anchor.clearDirty()}}class Vt extends S{element;textLines;contentExtents;extents;constructor(t){super(t,new Rt),this.textLines=[],this.element=document.createElementNS(b,"g"),this.contentExtents=new E(0,0,"view"),this.extents=new E(0,0,"view"),this.element.dataset.role="text-group",this.element.style.whiteSpaceCollapse="preserve"}getSVGElement(){return this.element}addLine(t){const e=new Lt(this.scene);return e.setParent(this),t?.align&&e.data.horizontalAlign.set(t.align),t?.skip!==void 0&&e.data.skip.set(t.skip),this.textLines.push(e),this.updateSVGChildren(),e}getLineCount(){return this.textLines.length}getLine(t){return this.textLines[t]}getTextExtents(t){return this.contentExtents.get(t,this.scene.getActiveCamera())}getExtents(t){return this.extents.get(t,this.scene.getActiveCamera())}getCenter(t){return W.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}update(){if(this.skipUpdate()||this.textLines.length===0)return;const t=this.scene.getActiveCamera(),e="view";this.updateSVGChildren(),d.applyTransform(this.data.transform,this.element,this.scene);const s=this.data.font,i=s.relativeAscenderHeight.value*s.size.value,n=s.relativeLineHeight.value*s.size.value,a=new c(0,0);for(const p of this.textLines){p.data.font.copyIfUnlocked(this.data.font),p.data.fill.copyIfUnlocked(this.data.fill),p.data.stroke.copyIfUnlocked(this.data.stroke),p.data.opacity.copyIfUnlocked(this.data.opacity),p.data.horizontalAlign.copyIfUnlocked(this.data.horizontalAlign),p.data.skip.copyIfUnlocked(this.data.skip),p.update();const w=p.getExtents(e);a.x=Math.max(a.x,w.x),a.y+=n+p.data.skip.value}a.y/=2;const h=this.data.minExtents.get(e,t);h.maxV(a),this.contentExtents.setValueFromSpace(a.x,a.y,e,t),this.extents.setValueFromSpace(h.x,h.y,e,t);const l=this.getCenter(e).subV(h);let u=0,y=l.y+i;switch(this.data.verticalAlign.get()){case"top":break;case"middle":y+=h.y-a.y;break;case"bottom":y+=2*(h.y-a.y);break}for(let p=0;p<this.textLines.length;p++){const w=this.textLines[p];switch(w.data.horizontalAlign.get()){case"left":u=l.x,w.data.textAnchor.set("start");break;case"center":u=l.x+h.x,w.data.textAnchor.set("middle");break;case"right":u=l.x+2*h.x,w.data.textAnchor.set("end");break}w.data.position.set(u,y,"view"),y+=w.data.skip.value+n}for(const p of this.textLines)p.update();this.clearDirty()}}function It(o){return o}function rt(o){return o*o}function at(o){const t=1-o;return 1-t*t}function ot(o){if(o<.5)return 2*o*o;{const t=1-o;return 1-2*t*t}}function Gt(o){return o*o*o}function Ut(o){const t=1-o;return 1-t*t*t}function Ft(o){if(o<.5)return 4*o*o*o;{const t=1-o;return 1-2*t*t*t}}function _t(o){return o*o*o*o}function Bt(o){const t=1-o;return 1-t*t*t*t}function Mt(o){if(o<.5)return 8*o*o*o*o;{const t=1-o;return 1-8*t*t*t*t}}function Nt(o){return o<=0?0:Math.pow(2,10*o-10)}function zt(o){return o>=1?1:1-Math.pow(2,-10*o)}function Wt(o){return o<=0?0:o>=1?1:o<.5?Math.pow(2,20*o-10)/2:(2-Math.pow(2,-20*o+10))/2}function Ht(o){return 1-Math.cos(o*(Math.PI/2))}function Yt(o){return Math.sin(o*(Math.PI/2))}function qt(o){return .5*(1-Math.cos(Math.PI*o))}function jt(o){return o*o*(3-2*o)}function $t(o){return o*o*o*(o*(o*6-15)+10)}const dt={linear:It,in:rt,inSine:Ht,inQuad:rt,inCubic:Gt,inQuart:_t,inExpo:Nt,out:at,outSine:Yt,outQuad:at,outCubic:Ut,outQuart:Bt,outExpo:zt,inOut:ot,inOutSine:qt,inOutQuad:ot,inOutCubic:Ft,inOutQuart:Mt,inOutExpo:Wt,smoothStep:jt,smootherStep:$t};class st{matrix;tmp;constructor(){this.tmp=new I,this.matrix=this.tmp}static setTarget(t,e=!0){return new st().setTarget(t,e)}setTarget(t,e=!0){return this.matrix=t,e&&this.matrix.makeIdentity(),this}identity(){return this.matrix.makeIdentity(),this}rotateRad(t){return this.tmp.makeRotationRad(t),this.matrix.premultiply(this.tmp),this}rotateDeg(t){return this.tmp.makeRotationDeg(t),this.matrix.premultiply(this.tmp),this}translate(t,e){return this.tmp.makeTranslation(t,e),this.matrix.premultiply(this.tmp),this}translateV(t){return this.tmp.makeTranslation(t.x,t.y),this.matrix.premultiply(this.tmp),this}scale(t,e){return this.tmp.makeScale(t,e),this.matrix.premultiply(this.tmp),this}scaleFrom(t,e,s,i){return this.tmp.makeScaleFrom(t,e,s,i),this.matrix.premultiply(this.tmp),this}scaleFromV(t,e,s){return this.scaleFrom(t,e,s.x,s.y)}scaleUniform(t){return this.tmp.makeScale(t,t),this.matrix.premultiply(this.tmp),this}scaleUniformFrom(t,e,s){return this.scaleFrom(t,t,e,s)}scaleUniformFromV(t,e){return this.scaleFrom(t,t,e.x,e.y)}rotateFromRad(t,e,s){return this.tmp.makeRotationFromRad(t,e,s),this.matrix.premultiply(this.tmp),this}rotateFromRadV(t,e){return this.rotateFromRad(t,e.x,e.y)}rotateFromDeg(t,e,s){return this.tmp.makeRotationFromDeg(t,e,s),this.matrix.premultiply(this.tmp),this}rotateFromDegV(t,e){return this.rotateFromDeg(t,e.x,e.y)}}class Xt extends P{fill;stroke;opacity;extents;pathPosition;pathThreshold;pathStrokeFactor;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.pathPosition=new f(1),this.pathThreshold=new D(30,"view"),this.extents=new E(5,5,"view"),this.pathStrokeFactor=new f(1),this.stroke.width.set(0,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.extents.setOwner(t),this.pathPosition.setOwner(t),this.pathThreshold.setOwner(t),this.pathStrokeFactor.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.extents.clearDirty(),this.pathPosition.clearDirty(),this.pathThreshold.clearDirty(),this.pathStrokeFactor.clearDirty()}}class gt extends S{element;transform;anchorAlignment;tipableReference=null;tipTransform;tipShape;tipInset;isReversed;constructor(t){super(t,new Xt),this.element=document.createElementNS(b,"path"),this.transform=new C,this.tipTransform=new Z,this.isReversed=!1,this.tipInset=.25,this.tipShape="",this.anchorAlignment=0,this.updateTipShape()}markDirty(){this.isDirty()||(this.dirty=!0,this.tipableReference&&this.tipableReference.markDirty())}setReversed(t=!1){return this.isReversed=t,this}setTipInset(t=.25){return this.tipInset=t,this.updateTipShape(),this}setAnchorAlignment(t=0){return this.anchorAlignment=t,this}setTipableReference(t){return this.tipableReference=t,this}getSVGElement(){return this.element}updateTipShape(){const t=-10+this.tipInset*20;this.tipShape=`M ${t},0 L -10,10 L 10,0 L -10,-10 Z`}updateTipTransform(){if(this.tipableReference===null)return;const t=this.scene.getActiveCamera();this.tipTransform=this.tipableReference.getTipTransformAt(this.data.pathPosition.get());const e=this.data.extents.get("view",t),s=t.convertLength(this.tipTransform.strokeWidth,this.tipTransform.space,"view");e.x+=s*this.data.pathStrokeFactor.get(),e.y+=s*this.data.pathStrokeFactor.get();const i=t.convertLength(this.tipTransform.pathLength,this.tipTransform.space,"view"),n=this.data.pathThreshold.get("view",t);n>0&&i<n&&e.scale(dt.out(i/n));const a=t.convertPointV(this.tipTransform.position,this.tipTransform.space,"view"),h=this.isReversed?-1:1,l=this.tipTransform.tangent.angle()+t.getRotationRad();st.setTarget(this.transform.value).translate(this.anchorAlignment*10,0).scale(h*e.x/10,e.y/10).rotateRad(l).translateV(a)}update(){this.skipUpdate()||(this.updateTipTransform(),d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.transform,this.element,this.scene),this.element.setAttribute("d",this.tipShape),this.clearDirty())}}class Jt extends P{stroke=new v;opacity=new f(1);transform=new C;startPosition=new m;endPosition=new m;startPadding=new D(0);endPadding=new D(0);setOwner(t=null){super.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.startPosition.setOwner(t),this.endPosition.setOwner(t),this.startPadding.setOwner(t),this.endPadding.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.startPosition.clearDirty(),this.endPosition.clearDirty(),this.startPadding.clearDirty(),this.endPadding.clearDirty()}}class yt extends S{element;arrowTips=[];position0=new m;position1=new m;constructor(t){super(t,new Jt),this.element=document.createElementNS(b,"line")}createArrowTip(){const t=new gt(this.scene);return t.setParent(this.scene.getSVG()),this.arrowTips.push(t),t.data.pathPosition.set(1),t.setTipableReference(this),this.markDirty(),t}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getTipTransformAt(t){const e="world",s=this.scene.getActiveCamera(),i=this.data.startPosition.get(e,s),n=this.data.endPosition.get(e,s),a=new Z;return a.space=e,a.position=c.lerpV(i,n,t),a.tangent=c.subV(n,i),a.pathLength=i.distance(n),a.strokeWidth=this.data.stroke.width.get(a.space,s),a}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t="view",e=this.scene.getActiveCamera();if(d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),this.data.startPosition.isDirty()||this.data.endPosition.isDirty()||this.data.startPadding.isDirty()||this.data.endPadding.isDirty()){const i=this.data.startPosition.get(t,e),n=this.data.endPosition.get(t,e),a=i.distance(n),h=this.data.startPadding.get(t,e),l=this.data.endPadding.get(t,e);if(a<1e-6||a<h+l)this.position0.setV(i,t),this.position1.setV(i,t);else{const u=c.subV(n,i).normalize();i.addV(u.clone().scale(h)),n.subV(u.clone().scale(l)),this.position0.setV(i,t),this.position1.setV(n,t)}d.applyPosition(this.position0,this.element,this.scene,"x1","y1"),d.applyPosition(this.position1,this.element,this.scene,"x2","y2"),this.position0.clearDirty(),this.position1.clearDirty()}for(const i of this.arrowTips)i.data.fill.color.copyIfUnlocked(this.data.stroke.color),i.data.fill.opacity.copyIfUnlocked(this.data.stroke.opacity),i.markDirty(),i.update();this.clearDirty()}}class Kt extends P{position;anchor;background;text;separator;padding;partSep;minExtents;constructor(){super(),this.position=new m(0,0,"world"),this.anchor=new k("center"),this.minExtents=new E(0,0,"view"),this.background=new Qt,this.separator=new te,this.text=new Zt,this.padding=new E(10,5,"view"),this.partSep=new D(5,"view")}}class Qt extends P{fill;stroke;opacity;transform;cornerRadius;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.cornerRadius=new D(5,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}}class Zt extends P{fill;stroke;opacity;transform;font;horizontalAlign;verticalAlign;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.font=new L,this.horizontalAlign=new k("center"),this.verticalAlign=new k("middle"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}}class te extends P{stroke;opacity;constructor(){super(),this.stroke=new v,this.opacity=new f(1),this.stroke.width.set(2,"view"),this.opacity.set(1)}}class Q extends S{element;textGroups;textGrows;sepLines;background=null;extents;constructor(t,e=1){super(t,new Kt),this.element=document.createElementNS(b,"g"),this.textGroups=[],this.textGrows=[],this.sepLines=[];for(let s=0;s<e;s++){const i=new Vt(this.scene);i.data.layer.set(2),i.setParent(this),this.textGroups.push(i),this.textGrows.push(1)}for(let s=0;s<e-1;s++){const i=new yt(this.scene);i.data.layer.set(1),i.setParent(this),this.sepLines.push(i)}this.extents=new E(0,0,"view"),this.element.dataset.role="node",this.updateSVGChildren()}getPosition(t){return this.data.position.get(t,this.scene.getActiveCamera())}getMinExtents(t){return this.data.minExtents.get(t,this.scene.getActiveCamera())}getPadding(t){return this.data.padding.get(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}addLine(t){const e=T.clamp(t?.partIndex??0,0,this.textGroups.length-1);return this.textGroups[e].addLine(t)}createRectBackground(){return this.background!==null&&this.background.setParent(null),this.background=new M(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}createCircleBackground(){return this.background!==null&&this.background.setParent(null),this.background=new j(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}setTextGrowFactor(t,e=1){return this.textGrows[t]=e,this}getBackground(){return this.background}getCenter(t=this.data.position.space){return W.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}getTextGroup(t=0){return this.textGroups[t]}getTextGroupCount(){return this.textGroups.length}getPointInDirection(t,e,s){return this.background?this.background.getPointInDirection(t,e,s):this.data.position.get(e,this.scene.getActiveCamera())}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera();this.background!==null&&(this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background.data.transform.copyIfUnlocked(this.data.background.transform),this.background instanceof M&&this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius));for(const p of this.textGroups)p.data.font.copyIfUnlocked(this.data.text.font),p.data.horizontalAlign.copyIfUnlocked(this.data.text.horizontalAlign),p.data.verticalAlign.copyIfUnlocked(this.data.text.verticalAlign),p.data.fill.copyIfUnlocked(this.data.text.fill),p.data.opacity.copyIfUnlocked(this.data.text.opacity),p.data.stroke.copyIfUnlocked(this.data.text.stroke);for(const p of this.sepLines)p.data.opacity.copyIfUnlocked(this.data.separator.opacity),p.data.stroke.copyIfUnlocked(this.data.separator.stroke);const e=[];let s=0;for(let p=0;p<this.textGroups.length;p++){const x=this.textGroups[p].getTextExtents("view");s=Math.max(s,2*x.x),e.push(2*x.y)}const i=this.data.minExtents.get("view",t),n=this.data.padding.get("view",t),a=this.data.partSep.get("view",t),h=kt.computeSizes(e,this.textGrows,2*i.y,n.y,2*a),l=new c(Math.max(s/2+n.x,i.x),h/2);this.extents.setValueFromSpace(l.x,l.y,"view",t);const u=W.getCenter(this.data.anchor.get(),"view",t,this.data.position,this.extents),y=u.clone().subV(l).addV(n);for(let p=0;p<this.textGroups.length;p++)this.textGroups[p].data.position.setV(y,"view"),this.textGroups[p].data.minExtents.set(l.x-n.x,e[p]/2,"view"),this.textGroups[p].data.anchor.set("north-west"),y.y+=e[p]+2*a;if(this.background instanceof M){this.background.data.position.setV(u,"view"),this.background.data.extents.setV(l,"view"),this.background.data.anchor.set("center");let p=u.y-l.y+n.y+e[0]+a;for(let w=0;w<this.textGroups.length-1;w++)this.sepLines[w].data.startPosition.set(u.x-l.x,p,"view"),this.sepLines[w].data.endPosition.set(u.x+l.x,p,"view"),p+=e[w+1]+2*a}else if(this.background instanceof j){const p=Math.max(l.x,l.y);this.background.data.position.setV(u,"view"),this.background.data.radius.set(p,"view");let w=u.y-l.y+n.y+e[0]+a;for(let x=0;x<this.textGroups.length-1;x++){const O=Math.sqrt(p*p-(w-u.y)*(w-u.y));this.sepLines[x].data.startPosition.set(u.x-O,w,"view"),this.sepLines[x].data.endPosition.set(u.x+O,w,"view"),w+=e[x+1]+2*a}}d.applyFont(this.data.text.font,this.element,this.scene),d.applyFill(this.data.text.fill,this.element,this.scene),d.applyStroke(this.data.text.stroke,this.element,this.scene),d.applyOpacity(this.data.text.opacity,this.element,this.scene),d.applyTransform(this.data.text.transform,this.element,this.scene);for(const p of this.children)p.update();this.clearDirty()}}class ee extends P{fill;stroke;opacity;transform;space;polyCurve;pathFrom;pathTo;constructor(){super(),this.stroke=new v,this.opacity=new f(1),this.fill=new A,this.transform=new C,this.space=new k("world"),this.polyCurve=new z,this.pathFrom=new f(0),this.pathTo=new f(1),this.fill.opacity.set(0)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.space.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.space.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty()}}class ft extends S{element;sampleCount=0;currStart=new c(0,0);endPosition=new c(0,0);arrowTips=[];constructor(t){super(t,new ee),this.element=document.createElementNS(b,"path")}createArrowTip(){const t=new gt(this.scene);return t.setParent(this.scene.getSVG()),this.arrowTips.push(t),t.data.pathPosition.set(1),t.setTipableReference(this),this.markDirty(),t}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getTipTransformAt(t){const e=this.data.pathFrom.get(),s=this.data.pathTo.get();t=t*(s-e)+e;const i=this.scene.getActiveCamera(),n=new Z;return n.space=this.data.space.get(),n.position=this.data.polyCurve.getPointAt(t),n.tangent=this.data.polyCurve.getTangentAt(t),n.pathLength=this.data.polyCurve.getLength()*(s-e),n.strokeWidth=this.data.stroke.width.get(n.space,i),n}setSampleCount(t){return this.sampleCount=t,this.markDirty(),this}getSVGElement(){return this.element}getStart(t){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getStart(),this.data.space.get(),t)}getEnd(t){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getEnd(),this.data.space.get(),t)}getPointAt(t,e){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getPointAt(t),this.data.space.get(),e)}getTangentAt(t,e){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getTangentAt(t),this.data.space.get(),e)}getStartTangent(t){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getStartTangent(),this.data.space.get(),t)}getEndTangent(t){return this.scene.getActiveCamera().convertPointV(this.data.polyCurve.getEndTangent(),this.data.space.get(),t)}getLength(t){return this.scene.getActiveCamera().convertLength(this.data.polyCurve.getLength(),this.data.space.get(),t)}clear(){return this.data.polyCurve.clear(),this.endPosition.set(0,0),this.markDirty(),this}moveTo(t,e){return this.moveToV(new c(t,e))}moveToV(t){return this.currStart.copy(t),this.endPosition.copy(t),this.markDirty(),this}lineTo(t,e){return this.lineToV(new c(t,e))}lineToV(t){return this.data.polyCurve.addLine(this.endPosition,t),this.endPosition.copy(t),this.markDirty(),this}cubicTo(t,e,s,i,n,a,h=this.sampleCount){return this.cubicToV(new c(t,e),new c(s,i),new c(n,a),h)}cubicToV(t,e,s,i=this.sampleCount){return this.data.polyCurve.addCubic(this.endPosition,c.addV(this.endPosition,t),c.addV(s,e),s,i),this.endPosition.copy(s),this.markDirty(),this}smoothCubicTo(t,e,s,i,n=this.sampleCount){return this.smoothCubicToV(new c(t,e),new c(s,i),n)}smoothCubicToV(t,e,s=this.sampleCount){if(this.data.polyCurve.getCurveCount()<=0)return this;const i=this.data.polyCurve.getLastCurve();return i instanceof B?(this.data.polyCurve.addCubic(this.endPosition,c.subV(c.scaleV(this.endPosition,2),i.getBezierPoint(2)),c.addV(e,t),e,s),this.endPosition.copy(e),this.markDirty(),this):this}close(){return c.eqV(this.currStart,this.endPosition)?this:(this.data.polyCurve.addLine(this.endPosition,this.currStart),this.markDirty(),this)}update(){if(!this.skipUpdate()){d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPath(this.data.polyCurve,this.data.space,this.data.pathFrom,this.data.pathTo,this.element,this.scene);for(const t of this.arrowTips)t.data.fill.color.copyIfUnlocked(this.data.stroke.color),t.data.fill.opacity.copyIfUnlocked(this.data.stroke.opacity),t.markDirty(),t.update();this.clearDirty()}}}class se extends P{color;opacity;constructor(){super(),this.color=new r,this.opacity=new f(1)}setOwner(t=null){super.setOwner(t),this.opacity.setOwner(t),this.color.setOwner(t)}clearDirty(){super.clearDirty(),this.opacity.clearDirty(),this.color.clearDirty()}}class ie extends S{element;constructor(t){super(t,new se),this.element=document.createElementNS(b,"rect")}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const e=this.scene.getActiveCamera().getViewportSize();this.element.setAttribute("x","0"),this.element.setAttribute("y","0"),this.element.setAttribute("width",e.x.toString()),this.element.setAttribute("height",e.y.toString()),d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),d.applyColor(this.data.color,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),this.clearDirty()}}class ne extends S{element;constructor(t,e){super(t,e),this.element=document.createElementNS(b,"g")}getSVGElement(){return this.element}update(){if(!this.skipUpdate()){this.updateSVGChildren(),d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene);for(const t of this.children)t.update();this.clearDirty()}}}class re extends P{position;anchor;background;text;padding;minExtents;constructor(){super(),this.position=new m(0,0,"world"),this.anchor=new k("center"),this.minExtents=new E(0,0,"view"),this.background=new ae,this.text=new oe,this.padding=new E(10,5,"view")}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.anchor.setOwner(t),this.minExtents.setOwner(t),this.background.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.minExtents.clearDirty(),this.background.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class ae extends F{fill;stroke;opacity;transform;cornerRadius;shape;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.cornerRadius=new D(5,"view"),this.shape=new k("rectangle"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.cornerRadius.setOwner(t),this.shape.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.cornerRadius.clearDirty(),this.shape.clearDirty()}}class oe extends F{fill;stroke;opacity;transform;font;horizontalAlign;verticalAlign;constructor(){super(),this.fill=new A,this.stroke=new v,this.opacity=new f(1),this.transform=new C,this.font=new L,this.horizontalAlign=new k("center"),this.verticalAlign=new k("middle"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t),this.horizontalAlign.setOwner(t),this.verticalAlign.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty(),this.horizontalAlign.clearDirty(),this.verticalAlign.clearDirty()}}class wt extends S{element;background=null;extents;endPoints;constructor(t){super(t,new re),this.element=document.createElementNS(b,"g"),this.extents=new E(0,0,"view"),this.element.dataset.role="plain-node",this.endPoints=[]}attachEndPoint(t){return this.endPoints.push(t),t.markDirty(),this}detachEndPoint(t){const e=this.endPoints.indexOf(t);return e===-1?this:(this.endPoints.splice(e,1),t.markDirty(),this)}getPosition(t){return this.data.position.get(t,this.scene.getActiveCamera())}getExtents(t){return this.extents.get(t,this.scene.getActiveCamera())}getMinExtents(t){return this.data.minExtents.get(t,this.scene.getActiveCamera())}getPadding(t){return this.data.padding.get(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}getBackground(){return this.background}getCenter(t){return W.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}getPointInDirection(t,e,s){return this.background?this.background.getPointInDirection(t,e,s):this.data.position.get(e,this.scene.getActiveCamera())}updateBackground(){if(this.data.background.shape.isDirty()){switch(this.background!==null&&this.background.setParent(null),this.data.background.shape.value){case"rectangle":this.background=new M(this.scene);break;case"circle":this.background=new j(this.scene);break;case"none":this.background=null;return}this.background&&(this.background.data.layer.set(0),this.background.setParent(this)),this.updateSVGChildren()}if(this.background===null)return;const t=this.scene.getActiveCamera(),e="view",s=this.getCenter(e),i=this.extents.get(e,t);if(this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background.data.transform.copyIfUnlocked(this.data.background.transform),this.background instanceof M&&this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius),this.background instanceof M)this.background.data.position.setV(s,e),this.background.data.extents.setV(i,e),this.background.data.anchor.set("center");else if(this.background instanceof j){const n=Math.max(i.x,i.y);this.background.data.position.setV(s,e),this.background.data.radius.set(n,e)}this.background.update()}updateEndPoints(){for(const t of this.endPoints)t.markDirty(),t.edge?.update()}}class ht{mode;node;position;owner;dirty=!0;edge;constructor(){this.mode="position",this.node=null,this.owner=null,this.position=new m(0,0,"world"),this.edge=null,this.position.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.position.clearDirty()}set(t){return t instanceof wt?(this.mode="node",this.node=t,this.position.copyIfUnlocked(this.node.data.position),this.node.attachEndPoint(this)):(this.mode="position",this.node=null,this.position.copyIfUnlocked(t)),this}copy(t){this.mode=t.mode,this.node=t.node,this.position.copyIfUnlocked(t.position)}getCenter(t,e){return this.mode==="node"&&this.node?this.node.getCenter(t):this.position.get(t,e)}getPointInDirection(t,e,s,i){if(this.mode==="node"&&this.node)return i.value!==-1/0?this.node.getPointInDirection(t,e,i):this.node.getCenter(e);{const n=this.position.get(e,s),a=i.get(e,s);return n.addV(t.clone().normalize().scale(a))}}}class mt extends P{stroke;opacity;pathFrom;pathTo;startDistance;endDistance;startAngle;endAngle;start;end;constructor(){super(),this.stroke=new v,this.opacity=new f(1),this.pathFrom=new f(0),this.pathTo=new f(1),this.startDistance=new D(-1/0,"view"),this.endDistance=new D(-1/0,"view"),this.startAngle=new f(-1/0),this.endAngle=new f(-1/0),this.start=new ht,this.end=new ht,this.stroke.width.set(4,"view"),this.stroke.color.set(0,0,0),this.opacity.set(1)}setOwner(t=null){this.stroke.setOwner(t),this.opacity.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t),this.startDistance.setOwner(t),this.endDistance.setOwner(t),this.startAngle.setOwner(t),this.endAngle.setOwner(t),this.start.setOwner(t),this.end.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty(),this.startDistance.clearDirty(),this.endDistance.clearDirty(),this.startAngle.clearDirty(),this.endAngle.clearDirty(),this.start.clearDirty(),this.end.clearDirty()}}class xt extends S{element;path;constructor(t,e){super(t,e),this.element=document.createElementNS(b,"g"),this.path=new ft(t),this.element.appendChild(this.path.getSVGElement()),this.element.dataset.role="edge",this.data.start.edge=this,this.data.end.edge=this}createArrowTip(){return this.path.createArrowTip()}getTip(t){return this.path.getTip(t)}getTipCount(){return this.path.getTipCount()}detachTip(t){return this.path.detachTip(t),this}detachTipElement(t){return this.path.detachTipElement(t),this}detachTipElements(){return this.path.detachTipElements(),this}getTipTransformAt(t){return this.path.getTipTransformAt(t)}getSVGElement(){return this.element}getPointCenter(t,e){return t instanceof Q?t.getCenter(e):t.get(e,this.scene.getActiveCamera())}getPoint(t,e,s,i){if(t instanceof Q)return s.value!==-1/0?t.getPointInDirection(i,e,s):t.getCenter(e);{const n=this.scene.getActiveCamera(),a=t.get(e,n);if(s.value!==-1/0){const h=s.get(e,n);a.addV(i.clone().normalize().scale(h))}return a}}getStartToEnd(t){const e=this.scene.getActiveCamera(),s=this.data.start.getCenter(t,e);return this.data.end.getCenter(t,e).subV(s)}applyStyleToPath(){this.path.data.pathFrom.copyIfUnlocked(this.data.pathFrom),this.path.data.pathTo.copyIfUnlocked(this.data.pathTo),this.path.data.stroke.copyIfUnlocked(this.data.stroke),this.path.data.opacity.copyIfUnlocked(this.data.opacity)}}class he extends xt{constructor(t){super(t,new mt)}update(){if(this.skipUpdate())return;const t="world",e=this.scene.getActiveCamera(),s=this.getStartToEnd(t).normalize(),i=s.clone().negate();this.data.startAngle.value!==-1/0&&s.setFromPolarDeg(this.data.startAngle.value),this.data.endAngle.value!==-1/0&&i.setFromPolarDeg(this.data.endAngle.value);const n=this.data.start.getPointInDirection(s,t,e,this.data.startDistance),a=this.data.end.getPointInDirection(i,t,e,this.data.endDistance);this.applyStyleToPath(),this.path.data.space.set(t),this.path.clear().moveToV(n).lineToV(a).update(),this.clearDirty()}}class ce extends mt{curveBendAngle;curveStartTension;curveEndTension;constructor(){super(),this.curveStartTension=new f(.3),this.curveEndTension=new f(.3),this.curveBendAngle=new f(0)}setOwner(t=null){super.setOwner(t),this.curveStartTension.setOwner(t),this.curveEndTension.setOwner(t),this.curveBendAngle.setOwner(t)}clearDirty(){super.clearDirty(),this.curveStartTension.clearDirty(),this.curveEndTension.clearDirty(),this.curveBendAngle.clearDirty()}}class le extends xt{constructor(t){super(t,new ce)}update(){if(this.skipUpdate())return;const t="world",e=this.scene.getActiveCamera(),s=this.getStartToEnd(t).normalize(),i=s.clone().negate();this.data.startAngle.value!==-1/0&&s.setFromPolarDeg(this.data.startAngle.value),this.data.endAngle.value!==-1/0&&i.setFromPolarDeg(this.data.endAngle.value);const n=this.data.curveBendAngle.value!==-1/0?this.data.curveBendAngle.get():0;s.rotateDeg(-1*n),i.rotateDeg(1*n);const a=this.data.start.getPointInDirection(s,t,e,this.data.startDistance),h=this.data.end.getPointInDirection(i,t,e,this.data.endDistance),l=a.distance(h),u=this.data.curveStartTension.value!==-1/0?this.data.curveStartTension.get():.3,y=this.data.curveEndTension.value!==-1/0?this.data.curveEndTension.get():.3;s.scale(u*l),i.scale(y*l),this.applyStyleToPath(),this.path.data.space.set(t),this.path.clear().moveToV(a).cubicToV(s,i,h).update(),this.clearDirty()}}class ue extends S{element;constructor(t,e){super(t,new P),this.element=e}getSVGElement(){return this.element}convertDOMPoint(t,e,s){const i=new DOMPoint(t,e),n=this.element.getScreenCTM();if(!n)return new c(0,0);const a=i.matrixTransform(n.inverse());return s=="world"?this.scene.getActiveCamera().viewToWorld(a.x,a.y):new c(a.x,a.y)}convertDOMPointInto(t,e,s){const i=new DOMPoint(t,e),n=this.element.getScreenCTM();if(!n){s.set(0,0);return}const a=i.matrixTransform(n.inverse());s.setValueFromSpace(a.x,a.y,"view",this.scene.getActiveCamera())}update(){if(this.skipUpdate())return;const e=this.scene.getActiveCamera().getViewportSize();this.element.setAttribute("viewBox",`0 0 ${e.x} ${e.y}`),this.updateSVGChildren(),d.applyPointerEvents(this.data.pointerEvents,this.element,this.scene);for(const s of this.children)s.update();this.clearDirty()}}class pe{svg;activeCamera;nextElementId;nextUpdateId;constructor(t,e){this.activeCamera=e,this.nextElementId=0,this.nextUpdateId=0,t.innerHTML="",this.svg=new ue(this,t),this.svg.update()}getNextElementId(){return this.nextElementId++}getNextUpdateId(){return this.nextUpdateId++}getActiveCamera(){return this.activeCamera}getSVG(){return this.svg}update(){return this.activeCamera.update(),this.svg.update(),this.activeCamera.update(),this}convertDOMPoint(t,e,s){return this.svg.convertDOMPoint(t,e,s)}convertDOMPointInto(t,e,s){this.svg.convertDOMPointInto(t,e,s)}}class g{static setAnchor(t,e){"anchor"in t&&t.anchor instanceof k&&t.anchor.set(e)}static setBackgroundFillColor(t,e){"background"in t&&t.background instanceof F&&"fill"in t.background&&t.background.fill instanceof A&&t.background.fill.color.copyIfUnlocked(e)}static setColor(t,e){"color"in t&&t.color instanceof r&&t.color.copyIfUnlocked(e),"fill"in t&&t.fill instanceof A&&t.fill.color.copyIfUnlocked(e),"stroke"in t&&t.stroke instanceof v&&t.stroke.color.copyIfUnlocked(e)}static setColorRGB(t,e,s,i){"color"in t&&t.color instanceof r&&t.color.set(e,s,i),"fill"in t&&t.fill instanceof A&&t.fill.color.set(e,s,i),"stroke"in t&&t.stroke instanceof v&&t.stroke.color.set(e,s,i)}static setColorHex(t,e){"color"in t&&t.color instanceof r&&t.color.setFromHex(e),"fill"in t&&t.fill instanceof A&&t.fill.color.setFromHex(e),"stroke"in t&&t.stroke instanceof v&&t.stroke.color.setFromHex(e)}static setCornerRadius(t,e,s){"cornerRadius"in t&&t.cornerRadius instanceof D&&t.cornerRadius.set(e,s)}static setEdgeStartDistance(t,e,s="view"){"startDistance"in t&&t.startDistance instanceof D&&t.startDistance.set(e,s)}static setEdgeEndDistance(t,e,s="view"){"endDistance"in t&&t.endDistance instanceof D&&t.endDistance.set(e,s)}static setEdgeStartAngle(t,e){"startAngle"in t&&t.startAngle instanceof f&&t.startAngle.set(e)}static setEdgeEndAngle(t,e){"endAngle"in t&&t.endAngle instanceof f&&t.endAngle.set(e)}static setEdgeBendAngle(t,e){"curveBendAngle"in t&&t.curveBendAngle instanceof f&&t.curveBendAngle.set(e)}static setEdgeTension(t,e){"curveStartTension"in t&&t.curveStartTension instanceof f&&t.curveStartTension.set(e),"curveEndTension"in t&&t.curveEndTension instanceof f&&t.curveEndTension.set(e)}static setEdgeStartTension(t,e){"curveStartTension"in t&&t.curveStartTension instanceof f&&t.curveStartTension.set(e)}static setEdgeEndTension(t,e){"curveEndTension"in t&&t.curveEndTension instanceof f&&t.curveEndTension.set(e)}static setEndPosition(t,e,s,i){"endPosition"in t&&t.endPosition instanceof m&&t.endPosition.set(e,s,i)}static setEndPositionV(t,e,s){"endPosition"in t&&t.endPosition instanceof m&&t.endPosition.setV(e,s)}static setExtents(t,e,s,i){"extents"in t&&t.extents instanceof E&&t.extents.set(e,s,i)}static setExtentsV(t,e,s){"extents"in t&&t.extents instanceof E&&t.extents.setV(e,s)}static setFillColor(t,e){"fill"in t&&t.fill instanceof A&&t.fill.color.copyIfUnlocked(e)}static setFillColorRGB(t,e,s,i){"fill"in t&&t.fill instanceof A&&t.fill.color.set(e,s,i)}static setFillColorHex(t,e){"fill"in t&&t.fill instanceof A&&t.fill.color.setFromHex(e)}static setFillOpacity(t,e){"fill"in t&&t.fill instanceof A&&t.fill.opacity.set(e)}static setFont(t,e){"font"in t&&t.font instanceof L&&t.font.copyIfUnlocked(e)}static setFontSize(t,e,s){"font"in t&&t.font instanceof L&&t.font.size.set(e,s)}static setFontWeight(t,e){"font"in t&&t.font instanceof L&&t.font.weight.set(e)}static setFontStyle(t,e){"font"in t&&t.font instanceof L&&t.font.style.set(e)}static setFontFamily(t,e){"font"in t&&t.font instanceof L&&t.font.family.set(e)}static setFontRelativeLineHeight(t,e){"font"in t&&t.font instanceof L&&t.font.relativeLineHeight.set(e)}static setFontRelativeAscenderHeight(t,e){"font"in t&&t.font instanceof L&&t.font.relativeAscenderHeight.set(e)}static setHorizontalAlign(t,e){"horizontalAlign"in t&&t.horizontalAlign instanceof k&&t.horizontalAlign.set(e)}static setVerticalAlign(t,e){"verticalAlign"in t&&t.verticalAlign instanceof k&&t.verticalAlign.set(e)}static setLayer(t,e){"layer"in t&&t.layer instanceof f&&t.layer.set(e)}static setMinExtents(t,e,s,i){"minExtents"in t&&t.minExtents instanceof E&&t.minExtents.set(e,s,i)}static setMinExtentsV(t,e,s){"minExtents"in t&&t.minExtents instanceof E&&t.minExtents.setV(e,s)}static setOpacity(t,e){"opacity"in t&&t.opacity instanceof f&&t.opacity.set(e)}static setPadding(t,e,s,i){"padding"in t&&t.padding instanceof E&&t.padding.set(e,s,i)}static setPaddingV(t,e,s){"padding"in t&&t.padding instanceof E&&t.padding.setV(e,s)}static setPathFrom(t,e){"pathFrom"in t&&t.pathFrom instanceof f&&t.pathFrom.set(e)}static setPathTo(t,e){"pathTo"in t&&t.pathTo instanceof f&&t.pathTo.set(e)}static setPosition(t,e,s,i){"position"in t&&t.position instanceof m&&t.position.set(e,s,i)}static setPositionV(t,e,s){"position"in t&&t.position instanceof m&&t.position.setV(e,s)}static setStartPosition(t,e,s,i){"startPosition"in t&&t.startPosition instanceof m&&t.startPosition.set(e,s,i)}static setStartPositionV(t,e,s){"startPosition"in t&&t.startPosition instanceof m&&t.startPosition.setV(e,s)}static setRadius(t,e,s){"radius"in t&&t.radius instanceof D&&t.radius.set(e,s)}static setStrokeColor(t,e){"stroke"in t&&t.stroke instanceof v&&t.stroke.color.copyIfUnlocked(e)}static setSpace(t,e){"space"in t&&t.space instanceof k&&t.space.set(e)}static setStrokeColorRGB(t,e,s,i){"stroke"in t&&t.stroke instanceof v&&t.stroke.color.set(e,s,i)}static setStrokeColorHex(t,e){"stroke"in t&&t.stroke instanceof v&&t.stroke.color.setFromHex(e)}static setStrokeLineCap(t,e){"stroke"in t&&t.stroke instanceof v&&t.stroke.lineCap.set(e)}static setStrokeLineJoin(t,e){"stroke"in t&&t.stroke instanceof v&&t.stroke.lineJoin.set(e)}static setStrokeOpacity(t,e){"stroke"in t&&t.stroke instanceof v&&t.stroke.opacity.set(e)}static setStrokeWidth(t,e,s){"stroke"in t&&t.stroke instanceof v&&t.stroke.width.set(e,s)}static setGridBoundA(t,e,s,i){"boundA"in t&&t.boundA instanceof m&&t.boundA.set(e,s,i)}static setGridBoundB(t,e,s,i){"boundB"in t&&t.boundB instanceof m&&t.boundB.set(e,s,i)}static setGridReferencePoint(t,e,s,i){"referencePoint"in t&&t.referencePoint instanceof m&&t.referencePoint.set(e,s,i)}static setGridSteps(t,e,s,i){"steps"in t&&t.steps instanceof E&&t.steps.set(e,s,i)}}class it{targets=[];static setTargets(...t){const e=new it;return e.targets.length=0,e.targets.push(...t),e}setTargets(...t){return this.targets.length=0,this.targets.push(...t),this}setAnchor(t){for(const e of this.targets)g.setAnchor(e,t);return this}setColor(t){for(const e of this.targets)g.setColor(e,t);return this}setColorRGB(t,e,s){for(const i of this.targets)g.setColorRGB(i,t,e,s);return this}setColorHex(t){for(const e of this.targets)g.setColorHex(e,t);return this}setCornerRadius(t,e){for(const s of this.targets)g.setCornerRadius(s,t,e);return this}setEdgeStartDistance(t,e="view"){for(const s of this.targets)g.setEdgeStartDistance(s,t,e);return this}setEdgeEndDistance(t,e="view"){for(const s of this.targets)g.setEdgeEndDistance(s,t,e);return this}setEdgeStartAngle(t){for(const e of this.targets)g.setEdgeStartAngle(e,t);return this}setEdgeEndAngle(t){for(const e of this.targets)g.setEdgeEndAngle(e,t);return this}setEdgeBendAngle(t){for(const e of this.targets)g.setEdgeBendAngle(e,t);return this}setEdgeTension(t){for(const e of this.targets)g.setEdgeTension(e,t);return this}setEdgeStartTension(t){for(const e of this.targets)g.setEdgeStartTension(e,t);return this}setEdgeEndTension(t){for(const e of this.targets)g.setEdgeEndTension(e,t);return this}setExtents(t,e,s){for(const i of this.targets)g.setExtents(i,t,e,s);return this}setExtentsV(t,e){for(const s of this.targets)g.setExtentsV(s,t,e);return this}setFont(t){for(const e of this.targets)g.setFont(e,t);return this}setFontSize(t,e){for(const s of this.targets)g.setFontSize(s,t,e);return this}setFontWeight(t){for(const e of this.targets)g.setFontWeight(e,t);return this}setFontStyle(t){for(const e of this.targets)g.setFontStyle(e,t);return this}setFontFamily(t){for(const e of this.targets)g.setFontFamily(e,t);return this}setFontRelativeLineHeight(t){for(const e of this.targets)g.setFontRelativeLineHeight(e,t);return this}setFontRelativeAscenderHeight(t){for(const e of this.targets)g.setFontRelativeAscenderHeight(e,t);return this}setFillColor(t){for(const e of this.targets)g.setFillColor(e,t);return this}setFillColorRGB(t,e,s){for(const i of this.targets)g.setFillColorRGB(i,t,e,s);return this}setFillColorHex(t){for(const e of this.targets)g.setFillColorHex(e,t);return this}setFillOpacity(t){for(const e of this.targets)g.setFillOpacity(e,t);return this}setHorizontalAlign(t){for(const e of this.targets)g.setHorizontalAlign(e,t);return this}setVerticalAlign(t){for(const e of this.targets)g.setVerticalAlign(e,t);return this}setLayer(t){for(const e of this.targets)g.setLayer(e,t);return this}setMinExtents(t,e,s){for(const i of this.targets)g.setMinExtents(i,t,e,s);return this}setMinExtentsV(t,e){for(const s of this.targets)g.setMinExtentsV(s,t,e);return this}setOpacity(t){for(const e of this.targets)g.setOpacity(e,t);return this}setPadding(t,e,s){for(const i of this.targets)g.setPadding(i,t,e,s);return this}setPaddingV(t,e){for(const s of this.targets)g.setPaddingV(s,t,e);return this}setPathFrom(t){for(const e of this.targets)g.setPathFrom(e,t);return this}setPathTo(t){for(const e of this.targets)g.setPathTo(e,t);return this}setPosition(t,e,s){for(const i of this.targets)g.setPosition(i,t,e,s);return this}setPositionV(t,e){for(const s of this.targets)g.setPositionV(s,t,e);return this}setStartPosition(t,e,s){for(const i of this.targets)g.setStartPosition(i,t,e,s);return this}setStartPositionV(t,e){for(const s of this.targets)g.setStartPositionV(s,t,e);return this}setEndPosition(t,e,s){for(const i of this.targets)g.setEndPosition(i,t,e,s);return this}setEndPositionV(t,e){for(const s of this.targets)g.setEndPositionV(s,t,e);return this}setRadius(t,e){for(const s of this.targets)g.setRadius(s,t,e);return this}setStrokeColor(t){for(const e of this.targets)g.setStrokeColor(e,t);return this}setSpace(t){for(const e of this.targets)g.setSpace(e,t);return this}setStrokeColorRGB(t,e,s){for(const i of this.targets)g.setStrokeColorRGB(i,t,e,s);return this}setStrokeColorHex(t){for(const e of this.targets)g.setStrokeColorHex(e,t);return this}setStrokeLineCap(t){for(const e of this.targets)g.setStrokeLineCap(e,t);return this}setStrokeLineJoin(t){for(const e of this.targets)g.setStrokeLineJoin(e,t);return this}setStrokeOpacity(t){for(const e of this.targets)g.setStrokeOpacity(e,t);return this}setStrokeWidth(t,e){for(const s of this.targets)g.setStrokeWidth(s,t,e);return this}setGridBoundA(t,e,s){for(const i of this.targets)g.setGridBoundA(i,t,e,s);return this}setGridBoundB(t,e,s){for(const i of this.targets)g.setGridBoundB(i,t,e,s);return this}setGridReferencePoint(t,e,s){for(const i of this.targets)g.setGridReferencePoint(i,t,e,s);return this}setGridSteps(t,e,s){for(const i of this.targets)g.setGridSteps(i,t,e,s);return this}}class de extends S{element;localBBox;constructor(t,e){super(t,e),this.element=document.createElementNS(b,"text"),this.localBBox=new ut,this.localBBox.setOwner(this)}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.localBBox.markDirty(),this}getContent(){return this.element.textContent||""}getPosition(t){return this.data.position.get(t,this.scene.getActiveCamera())}getExtents(t){return this.localBBox.getExtents(t,this.scene.getActiveCamera())}getCenter(t){const e=this.localBBox.getCenter(t,this.scene.getActiveCamera()),s=this.getPosition(t);return e.addV(s)}clearText(){return this.element.replaceChildren(),this.localBBox.markDirty(),this}clearDirty(){super.clearDirty(),this.localBBox.clearDirty()}update(){if(this.skipUpdate())return;d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyShiftedPosition(this.data.position,this.data.localShift,this.element,this.scene,"x","y"),d.applyFont(this.data.font,this.element,this.scene),d.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),d.applyTextAnchor(this.data.textAnchor,this.element,this.scene),(this.localBBox.isDirty()||this.data.textAnchor.isDirty()||this.data.font.isDirty()||this.data.preserveWhitespace.isDirty())&&this.localBBox.set(this.element,this.data.position,this.scene.getActiveCamera()),this.clearDirty()}}class ge extends de{constructor(t){super(t,new et)}}class ye extends wt{text;constructor(t){super(t),this.text=new ge(this.scene),this.text.data.layer.set(2),this.text.setParent(this),this.element.dataset.role="plain-node"}setContent(t){return this.text.setContent(t),this}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera(),e="view";this.updateSVGChildren(),this.text.data.font.copyIfUnlocked(this.data.text.font),this.text.data.fill.copyIfUnlocked(this.data.text.fill),this.text.data.opacity.copyIfUnlocked(this.data.text.opacity),this.text.data.stroke.copyIfUnlocked(this.data.text.stroke),this.text.update();const s=this.text.getExtents(e),i=this.data.padding.get(e,t),n=this.data.minExtents.get(e,t);n.max(s.x+i.x,s.y+i.y);const a=n.clone().subV(i);this.extents.setV(n,e);const l=this.getCenter(e).clone().subV(a),u=this.data.text.font,y=u.relativeAscenderHeight.value*u.size.value;let p=0,w=l.y+y;switch(this.data.text.verticalAlign.value){case"top":break;case"middle":w+=a.y-s.y;break;case"bottom":w+=2*(a.y-s.y);break}switch(this.data.text.horizontalAlign.value){case"left":p=l.x,this.text.data.textAnchor.set("start");break;case"center":p=l.x+a.x,this.text.data.textAnchor.set("middle");break;case"right":p=l.x+2*a.x,this.text.data.textAnchor.set("end");break}this.text.data.position.set(p,w,"view"),this.text.update(),this.updateBackground(),this.updateEndPoints(),this.clearDirty()}}class ke extends pe{constructor(t,e){super(t,e)}addCircle(t=this.svg){const e=new j(this);return e.setParent(t),e}addRect(t=this.svg){const e=new M(this);return e.setParent(t),e}addFillRect(t=this.svg){const e=new ie(this);return e.setParent(t),e}addGrid(t=this.svg){const e=new nt(this);return e.setParent(t),e}addWorldGrid(t=this.svg){const e=new nt(this),s=this.getActiveCamera().getViewportSize();return it.setTargets(e.data).setStrokeWidth(1,"view").setTargets(e.data.geometry).setGridBoundA(0,0,"view").setGridBoundB(s.x,s.y,"view").setGridReferencePoint(0,0,"world").setGridSteps(1,1,"world"),e.setParent(t),e}addText(t=this.svg){const e=new bt(this);return e.setParent(t),e}addPlainNode(t=this.svg){const e=new ye(this);return e.setParent(t),e}addNode(t=1,e=this.svg){const s=new Q(this,t);return s.setParent(e),s}addPath(t=this.svg){const e=new ft(this);return e.setParent(t),e}addGroup(t,e=this.svg){const s=new ne(this,t);return s.setParent(e),s}addLine(t=this.svg){const e=new yt(this);return e.setParent(t),e}addLineEdge(t,e,s=this.svg){const i=new he(this);return i.data.start.set(t),i.data.end.set(e),i.setParent(s),i}addCubicEdge(t,e,s=this.svg){const i=new le(this);return i.data.start.set(t),i.data.end.set(e),i.setParent(s),i}}class fe{scene;cycleIndex=0;cycleCount=1;cycleDuration=0;rawCycleAlpha=0;rawElapsed=0;rawDuration=0;wrapedCycleAlpha=0;wrapedCycleElapsed=0;ease=dt.linear;reversed=!1;alternate=!1;properties;constructor(t){this.scene=t,this.properties=new Set}getScene(){return this.scene}getProperties(){return this.properties}getElapsed(){return this.rawElapsed}getDuration(){return this.rawDuration}getCycleDuration(){return this.cycleDuration}getCycleIndex(){return this.cycleIndex}getCycleCount(){return this.cycleCount}setCycleCount(t){return this.cycleCount=t,this.updateRawDuration(),this}setEasing(t){return this.ease=t,this}setReversed(t=!0){return this.reversed=t,this}setAlternate(t=!0){return this.alternate=t,this}setElapsed(t){this.setRawElapsed(t);for(const e of this.properties)this.setElapsedPropertyImpl(e);return this}setElapsedProperty(t,e){return this.setRawElapsed(e),this.setElapsedPropertyImpl(t),this}updateRawDuration(){this.rawDuration=this.cycleDuration*(this.cycleCount<0?1:this.cycleCount)}setRawElapsed(t){this.rawElapsed!==t&&(this.rawElapsed=t,this.cycleIndex=T.clamp(Math.floor(this.rawElapsed/this.cycleDuration),0,this.cycleCount-1),t>=this.cycleCount*this.cycleDuration?this.rawCycleAlpha=1:this.rawCycleAlpha=this.rawElapsed%this.cycleDuration/this.cycleDuration,this.wrapedCycleAlpha=this.reversed?1-this.rawCycleAlpha:this.rawCycleAlpha,this.alternate&&this.cycleIndex%2===1&&(this.wrapedCycleAlpha=1-this.wrapedCycleAlpha),this.wrapedCycleAlpha=this.ease(this.wrapedCycleAlpha),this.wrapedCycleElapsed=T.clamp(this.wrapedCycleAlpha,0,1)*this.cycleDuration)}}class we{currentTime=0;delta=0;unscaledDelta=0;scale=1;maxDelta=200;elapsed=0;unscaledElapsed=0;start(t){return this.currentTime=t,this.delta=0,this}update(t){const e=t-this.currentTime;return this.unscaledDelta=Math.min(e,this.maxDelta),this.delta=this.unscaledDelta*this.scale,this.currentTime=t,this.unscaledElapsed+=this.unscaledDelta,this.elapsed+=this.delta,this}setMaximumDeltaTime(t){return this.maxDelta=t,this}setTimeScale(t){return this.scale=t,this}getTimeScale(){return this.scale}getDelta(){return this.delta}getUnscaledDelta(){return this.unscaledDelta}getElapsed(){return this.elapsed}getUnscaledElapsed(){return this.unscaledElapsed}}class R{static _instance=null;timer;activeAnimations=new Set;sceneToUpdate=new Set;constructor(){this.timer=new we}static getInstance(){if(!R._instance){const t=new R;requestAnimationFrame(t.onFirstFrame),requestAnimationFrame(t.onUpdate),R._instance=t}return R._instance}static addAnimation(t){R.getInstance().activeAnimations.add(t)}static removeAnimation(t){R.getInstance().activeAnimations.delete(t)}static requestUpdate(t){R.getInstance().sceneToUpdate.add(t)}addAnimation(t){return this.activeAnimations.add(t),this}removeAnimation(t){return this.activeAnimations.delete(t),this}wakeUp(){return requestAnimationFrame(this.onUpdate),this}onFirstFrame=t=>{this.timer.start(t)};onUpdate=t=>{this.timer.update(t);const e=this.timer.getDelta();for(const s of this.activeAnimations)s.update(e);for(const s of this.sceneToUpdate)s.update();this.sceneToUpdate.clear(),requestAnimationFrame(this.onUpdate)}}class Ee{animation;state;repeat=!1;speed=1;playFrom;playTo;constructor(t){this.animation=t,this.playFrom=0,this.playTo=this.animation.getDuration(),this.state="stopped"}setRange(t,e){return this.playFrom=Math.max(0,t),this.playTo=Math.min(e,this.animation.getDuration()),this}getAnimation(){return this.animation}setSpeed(t){return this.speed=t,this}getSpeed(){return this.speed}setElapsed(t){return this.animation.setElapsed(t),this}isPlaying(){return this.state==="playing"}isPaused(){return this.state==="paused"}isStopped(){return this.state==="stopped"}play(t=!1){return this.state="playing",this.animation.setElapsed(this.playFrom),R.addAnimation(this),this.repeat=t,this}pause(){return this.state="paused",R.removeAnimation(this),this}stop(){return this.state="stopped",R.removeAnimation(this),this}resume(){return this.state==="paused"?(this.state="playing",R.addAnimation(this)):this.state==="stopped"&&this.play(),this}update(t){if(this.state!=="playing")return this;const e=this.animation.getElapsed()+t*this.speed,s=this.playTo-this.playFrom;if(e>=this.playTo)if(this.repeat){const i=(e-this.playFrom)%s;this.animation.setElapsed(i+this.playFrom)}else this.animation.setElapsed(this.playTo),this.stop();else e<this.playFrom?(this.animation.setElapsed(this.playFrom),this.stop()):this.animation.setElapsed(e);return this.animation.getScene().update(),this}}class me extends fe{setCycleDuration(t){return this.cycleDuration=t,this.updateRawDuration(),this}}class De{static create(t,e){switch(e.kind){case"number":return new ct(t,e);case"color":return new ct(t,e);case"position":return new J(t,e);case"direction":return new J(t,e);case"length":return new J(t,e);case"extents":return new J(t,e);default:throw new Error("Unsupported property type")}}}class vt extends me{}class ct extends vt{property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){t===this.property&&this.property.lerp(this.state0,this.state1,this.wrapedCycleAlpha)}}class J extends vt{property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){t===this.property&&this.property.lerp(this.state0,this.state1,this.wrapedCycleAlpha,this.scene.getActiveCamera())}}export{Vt as A,d as B,Ee as C,fe as D,vt as E,$ as F,R as G,K as H,ve as M,c as S,xe as a,T as b,ke as c,L as d,it as e,r as f,ge as g,bt as h,De as i,dt as j,P as k,m as l,k as m,E as n,D as o,F as p,A as q,v as r,f as s,me as t,z as u,yt as v,M as w,S as x,b as y,W as z};
