class h{x;y;constructor(t=0,e=0){this.x=t,this.y=e}static set(t,e){return new h(t,e)}static setPolar(t,e=1,s="rad"){return s==="deg"&&(t*=Math.PI/180),new h(e*Math.cos(t),e*Math.sin(t))}static add(t,e,s,i){return new h(t+s,e+i)}static addV(t,e){return new h(t.x+e.x,t.y+e.y)}static sub(t,e,s,i){return new h(t-s,e-i)}static subV(t,e){return new h(t.x-e.x,t.y-e.y)}static mul(t,e,s,i){return new h(t*s,e*i)}static mulV(t,e){return new h(t.x*e.x,t.y*e.y)}static scale(t,e,s){return new h(t*s,e*s)}static scaleV(t,e){return new h(t.x*e,t.y*e)}static lerp(t,e,s,i,n){const r=1-n;return new h(r*t+n*s,r*e+n*i)}static lerpV(t,e,s){return h.lerp(t.x,t.y,e.x,e.y,s)}static equals(t,e,s,i,n=1e-4){return Math.abs(t-s)<n&&Math.abs(e-i)<n}static equalsV(t,e,s=1e-4){return Math.abs(t.x-e.x)<=s&&Math.abs(t.y-e.y)<=s}static isZeroV(t,e=1e-4){return Math.abs(t.x)<e&&Math.abs(t.y)<e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setV(t){return this.x=t.x,this.y=t.y,this}setPolar(t,e=1,s="rad"){return s==="deg"&&(t*=Math.PI/180),this.set(e*Math.cos(t),e*Math.sin(t))}lerp(t,e,s){const i=1-s;return this.set(i*this.x+s*t,i*this.y+s*e)}lerpV(t,e){return this.lerp(t.x,t.y,e)}shiftX(t){return this.x+=t,this}shiftY(t){return this.y+=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new h(this.x,this.y)}copy(t){return this.setV(t)}add(t,e){return this.x+=t,this.y+=e,this}addV(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}sub(t,e){return this.x-=t,this.y-=e,this}subV(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}mul(t,e){return this.x*=t,this.y*=e,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}div(t,e){return this.x/=t,this.y/=e,this}divV(t){return this.x/=t.x,this.y/=t.y,this}scale(t){return this.x*=t,this.y*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this}min(t,e){return this.x=Math.min(this.x,t),this.y=Math.min(this.y,e),this}minV(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}minScalar(t){return this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this}max(t,e){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,e),this}maxV(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}maxScalar(t){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this}clamp(t,e,s,i){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampV(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}snap(t,e){return t>0&&(this.x=Math.round(this.x/t)*t),e>0&&(this.y=Math.round(this.y/e)*e),this}snapV(t){return t.x>0&&(this.x=Math.round(this.x/t.x)*t.x),t.y>0&&(this.y=Math.round(this.y/t.y)*t.y),this}snapScalar(t){return t<=0?this:(this.x=Math.round(this.x/t)*t,this.y=Math.round(this.y/t)*t,this)}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}apply2x2(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i,this.y=e[1]*s+e[3]*i,this}apply2x3(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i+e[4],this.y=e[1]*s+e[3]*i+e[5],this}apply2x3Offset(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i,this.y=e[1]*s+e[3]*i,this}dot(t){return this.x*t.x+this.y*t.y}det(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceSq(t){const e=t.x-this.x,s=t.y-this.y;return e*e+s*s}distance(t){return Math.sqrt(this.distanceSq(t))}normalize(){const t=this.length();return t===0?this:this.scale(1/t)}setLength(t){return this.scale(t/this.length())}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}angle(){return Math.atan2(-this.y,this.x)}angleTo(t){const e=this.det(t),s=this.dot(t);return Math.atan2(e,s)}perp(t=!1){const e=this.x;return t?(this.x=this.y,this.y=-e):(this.x=-this.y,this.y=e),this}rotate(t,e="rad"){e==="deg"&&(t*=Math.PI/180);const s=Math.sin(t),i=Math.cos(t),n=this.x,r=this.y;return this.x=i*n-s*r,this.y=s*n+i*r,this}*[Symbol.iterator](){yield this.x,yield this.y}}class C{dirty=!0;owner=null;locked=!1;setOwner(t=null){this.owner=t}getOwner(){return this.owner}isDirty(){return this.dirty}markDirty(){this.dirty=!0,this.owner?.markDirty()}clearDirty(){this.dirty=!1}isLocked(){return this.locked}lock(){return this.locked||(this.locked=!0),this}unlock(){return this.locked&&(this.locked=!1),this}}class w{static clamp(t,e,s){return Math.max(e,Math.min(s,t))}static clamp01(t){return w.clamp(t,0,1)}static lerp(t,e,s){return(1-s)*t+s*e}static invLerp(t,e,s){return t!==e?(s-t)/(e-t):0}static remap(t,e,s,i,n){return w.lerp(s,i,w.invLerp(t,e,n))}static mod(t,e){return(t%e+e)%e}static damp(t,e,s,i){return w.lerp(t,e,1-Math.exp(-s*i))}static snap(t,e){return e<=0?t:Math.round(t/e)*e}static snapToArray(t,e){return e.length===0?t:e.reduce((s,i)=>Math.abs(i-t)<Math.abs(s-t)?i:s)}}class f extends C{kind="color";linearR;linearG;linearB;linearA;constructor(t=0,e=0,s=0,i=!1){super(),this.linearR=f.sRGB255ToLinear(t),this.linearG=f.sRGB255ToLinear(e),this.linearB=f.sRGB255ToLinear(s),this.linearA=1,this.locked=i}static sRGBToLinear(t){return t<=.04045?t=t*.0773993808:t=Math.pow(t*.9478672986+.0521327014,2.4),w.clamp01(t)}static linearToSRGB(t){return t<=.0031308?t=t*12.92:t=1.055*Math.pow(t,.41666)-.055,w.clamp01(t)}static sRGB255ToLinear(t){return f.sRGBToLinear(t/255)}static linearToSRGB255(t){return Math.round(f.linearToSRGB(t)*255)}clone(){const t=new f;return t.linearR=this.linearR,t.linearG=this.linearG,t.linearB=this.linearB,t.linearA=this.linearA,t.locked=this.locked,t}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.linearR===t.linearR&&this.linearG===t.linearG&&this.linearB===t.linearB?this:(this.linearR=t.linearR,this.linearG=t.linearG,this.linearB=t.linearB,this.linearA=t.linearA,this.markDirty(),this)}lerp(t,e,s){const i=w.lerp(t.linearR,e.linearR,s),n=w.lerp(t.linearG,e.linearG,s),r=w.lerp(t.linearB,e.linearB,s),a=w.lerp(t.linearA,e.linearA,s);return this.set(i,n,r,a),this}static lerp(t,e,s){return new f().lerp(t,e,s)}set(t,e,s,i){return this.linearR===t&&this.linearG===e&&this.linearB===s&&this.linearA===i?this:(this.linearR=t,this.linearG=e,this.linearB=s,this.linearA=i,this.markDirty(),this)}setFromHex(t){let e=0,s=0,i=0,n=1;if(/^#([0-9A-Fa-f]{6})$/.test(t)){const r=parseInt(t.substring(1),16);e=f.sRGB255ToLinear(r>>16&255),s=f.sRGB255ToLinear(r>>8&255),i=f.sRGB255ToLinear(r&255)}else if(/^#([0-9A-Fa-f]{8})$/.test(t)){const r=parseInt(t.substring(1),16);e=f.sRGB255ToLinear(r>>24&255),s=f.sRGB255ToLinear(r>>16&255),i=f.sRGB255ToLinear(r>>8&255),n=f.sRGB255ToLinear(r&255)}else throw new Error(`Invalid hex color: ${t}`);return this.set(e,s,i,n)}static fromHex(t){return new f().setFromHex(t)}setFromTheme(t,e,s){return this.setFromHex(t.color(e,s))}static fromTheme(t,e,s){return new f().setFromTheme(t,e,s)}setWhite(t=1,e=1){return this.set(t,t,t,e)}setBlack(t=1,e=1){return t=1-t,this.set(t,t,t,e)}toString(){const t=e=>f.linearToSRGB255(e).toString(16).padStart(2,"0");return`#${t(this.linearR)}${t(this.linearG)}${t(this.linearB)}${t(this.linearA)}`}get(){const t=e=>f.linearToSRGB255(e);return{r:t(this.linearR),g:t(this.linearG),b:t(this.linearB),a:t(this.linearA)}}}const P="http://www.w3.org/2000/svg";class dt{space;position=new h;tangent=new h;strokeWidth=1;pathLength=1;constructor(t){this.space=t.getWorldSpace()}}class Dt{static getCenter(t,e,s,i,n){const r=e===s.getViewSpace()?-1:1,a=n.get(e),c=i.get(e);switch(t){case"north-west":c.shiftY(-r*a.y).shiftX(+a.x);break;case"north":c.shiftY(-r*a.y);break;case"north-east":c.shiftY(-r*a.y).shiftX(-a.x);break;case"west":c.shiftX(+a.x);break;case"center":break;case"east":c.shiftX(-a.x);break;case"south-west":c.shiftY(+r*a.y).shiftX(+a.x);break;case"south":c.shiftY(+r*a.y);break;case"south-east":c.shiftY(+r*a.y).shiftX(-a.x);break}return c}static getNorthWest(t,e,s,i,n){const r=e===s.getViewSpace()?-1:1,a=n.get(e),c=i.get(e);switch(t){case"north-west":break;case"north":c.shiftX(-a.x);break;case"north-east":c.shiftX(-2*a.x);break;case"west":c.shiftY(r*a.y);break;case"center":c.shiftY(r*a.y).shiftX(-a.x);break;case"east":c.shiftY(r*a.y).shiftX(-2*a.x);break;case"south-west":c.shiftY(2*r*a.y);break;case"south":c.shiftY(2*r*a.y).shiftX(-a.x);break;case"south-east":c.shiftY(2*r*a.y).shiftX(-2*a.x);break}return c}}class q{curves=[];length=0;cumulativeLengths=[];constructor(){}clone(){const t=new q;for(const e of this.curves)t.curves.push(e.clone());return t.length=this.length,t.cumulativeLengths=this.cumulativeLengths.slice(),t}copy(t){return this.curves=t.curves.map(e=>e.clone()),this.length=t.length,this.cumulativeLengths=t.cumulativeLengths.slice(),this}clear(){return this.curves.length=0,this.length=0,this.cumulativeLengths.length=0,this}getCurve(t){return this.curves[t]}getCurveCount(){return this.curves.length}getLastCurve(){return this.curves[this.curves.length-1]}getCurveParam(t){const e=t*this.length;for(let s=0;s<this.cumulativeLengths.length;s++){const i=this.cumulativeLengths[s];if(e<i)return{index:s,t:w.invLerp(i-this.curves[s].getLength(),i,e)}}return{index:this.curves.length-1,t:1}}getStart(){return this.curves[0].getStart()}getEnd(){return this.curves[this.curves.length].getEnd()}getStartTangent(){return this.curves[0].getStartTangent()}getEndTangent(){return this.curves[this.curves.length-1].getEndTangent()}updateLength(){this.cumulativeLengths.length=0,this.length=0;for(let t=0;t<this.curves.length;t++)this.length+=this.curves[t].getLength(),this.cumulativeLengths.push(this.length);return this}addLine(t,e){const s=new B(t,e);return this.length+=s.getLength(),this.curves.push(s),this}addQuadratic(t,e,s,i=0){const n=new j(t,e,s).computeLinearLUT(i);return i>0&&n.computeLinearLUT(i),this.length+=n.getLength(),this.curves.push(n),this}addCubic(t,e,s,i,n=0){const r=new W(t,e,s,i);return n>0&&r.computeLinearLUT(n),this.length+=r.getLength(),this.curves.push(r),this}getPointAt(t){if(this.curves.length===0)return new h(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getPointAt(e.t)}getTangentAt(t){if(this.curves.length===0)return new h(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getTangentAt(e.t)}createPartialCurveTo(t){const e=new q;if(this.curves.length===0)return e;const s=this.getCurveParam(t);for(let i=0;i<s.index;i++)e.curves.push(this.curves[i].clone());return e.curves.push(this.curves[s.index].createPartialCurveTo(s.t)),e.updateLength(),e}createPartialCurveFrom(t){const e=new q;if(this.curves.length===0)return e;const s=this.getCurveParam(t);e.curves.push(this.curves[s.index].createPartialCurveFrom(s.t));for(let i=s.index+1;i<this.curves.length;i++)e.curves.push(this.curves[i].clone());return e.updateLength(),e}createPartialCurveRange(t,e){const s=new q;if(this.curves.length===0||t>=e)return s;const i=this.getCurveParam(t),n=this.getCurveParam(e);if(i.index==n.index)s.curves.push(this.curves[i.index].createPartialCurveRange(i.t,n.t));else{s.curves.push(this.curves[i.index].createPartialCurveFrom(i.t));for(let r=i.index+1;r<n.index;r++)s.curves.push(this.curves[r].clone());s.curves.push(this.curves[n.index].createPartialCurveTo(n.t))}return s.updateLength(),s}getLength(){return this.length}}class B{p0;p1;length;constructor(t,e){this.p0=t.clone(),this.p1=e.clone(),this.length=this.p0.distance(this.p1)}copy(t){return this.p0.copy(t.p0),this.p1.copy(t.p1),this.length=t.length,this}getTangentAt(t){return h.subV(this.p1,this.p0)}getStartTangent(){return h.subV(this.p1,this.p0)}getEndTangent(){return h.subV(this.p1,this.p0)}clone(){return new B(this.p0,this.p1)}getLength(){return this.length}getStart(){return this.p0.clone()}getEnd(){return this.p1.clone()}getPointAt(t){return h.lerpV(this.p0,this.p1,t)}createPartialCurveTo(t){return new B(this.p0,this.getPointAt(t))}createPartialCurveFrom(t){return new B(this.getPointAt(t),this.p1)}createPartialCurveRange(t,e){return new B(this.getPointAt(t),this.getPointAt(e))}}class yt{points=[];linearLUT=null;sampleCount=0;length=0;copy(t){return this.points=t.points.map(e=>e.clone()),t.linearLUT&&(this.linearLUT=t.linearLUT.slice(),this.length=t.length,this.sampleCount=t.sampleCount),this}getLength(){return this.length}linearize(t){if(this.linearLUT===null)return t;const e=t*(this.sampleCount+0),s=Math.floor(e);return s<0?0:s>=this.linearLUT.length-1?1:w.lerp(this.linearLUT[s],this.linearLUT[s+1],e-s)}computeLinearLUT(t=8){const e=[0];let s=this.getPointAtCasteljau(0),i=0;for(let r=1;r<=t;r++){const a=this.getPointAtCasteljau(r/t);i+=s.distance(a),e.push(i),s=a}this.length=i,this.sampleCount=t,e.forEach((r,a,c)=>{c[a]=r/i}),this.linearLUT=[0];let n=1;for(let r=1;r<=t;r++){const a=r/t;for(;e[n]<a&&n<e.length-1;)n++;this.linearLUT.push(w.remap(e[n-1],e[n],(n-1)/t,n/t,a))}return this}getPointAt(t){return this.getPointAtCasteljau(this.linearize(t))}getBezierPoint(t){return this.points[t]}getBezierPoints(){return this.points}}class j extends yt{constructor(t,e,s){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.length=t.distance(s)}clone(){const t=this.points,e=new j(t[0],t[1],t[2]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[2].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,r=t*t;return new h(i*e[0].x+n*e[1].x+r*e[2].x,i*e[0].y+n*e[1].y+r*e[2].y)}getTangentAtCasteljau(t){const e=this.points;return new h((1-t)*(e[1].x-e[0].x)+t*(e[2].x-e[1].x),(1-t)*(e[1].y-e[0].y)+t*(e[2].y-e[1].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return h.subV(this.points[1],this.points[0])}getEndTangent(){return h.subV(this.points[2],this.points[1])}reduceToCasteljau(t){const e=h.lerpV(this.points[0],this.points[1],t),s=h.lerpV(this.points[1],this.points[2],t),i=h.lerpV(e,s,t);return new j(this.points[0],e,i)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=h.lerpV(this.points[0],this.points[1],t),s=h.lerpV(this.points[1],this.points[2],t),i=h.lerpV(e,s,t);return new j(i,s,this.points[2])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}class W extends yt{constructor(t,e,s,i){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.points.push(i.clone()),this.length=t.distance(i)}clone(){const t=this.points,e=new W(t[0],t[1],t[2],t[3]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[3].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s*s,n=s*s*t*3,r=s*t*t*3,a=t*t*t;return new h(i*e[0].x+n*e[1].x+r*e[2].x+a*e[3].x,i*e[0].y+n*e[1].y+r*e[2].y+a*e[3].y)}getTangentAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,r=t*t;return new h(i*(e[1].x-e[0].x)+n*(e[2].x-e[1].x)+r*(e[3].x-e[2].x),i*(e[1].y-e[0].y)+n*(e[2].y-e[1].y)+r*(e[3].y-e[2].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return h.subV(this.points[1],this.points[0])}getEndTangent(){return h.subV(this.points[3],this.points[2])}reduceToCasteljau(t){const e=h.lerpV(this.points[0],this.points[1],t),s=h.lerpV(this.points[1],this.points[2],t),i=h.lerpV(this.points[2],this.points[3],t),n=h.lerpV(e,s,t),r=h.lerpV(s,i,t),a=h.lerpV(n,r,t);return new W(this.points[0],e,n,a)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=h.lerpV(this.points[0],this.points[1],t),s=h.lerpV(this.points[1],this.points[2],t),i=h.lerpV(this.points[2],this.points[3],t),n=h.lerpV(e,s,t),r=h.lerpV(s,i,t),a=h.lerpV(n,r,t);return new W(a,r,i,this.points[3])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}class v extends C{kind="position";value;space;constructor(t,e,s,i=!1){super(),this.value=new h(t,e),this.space=s,this.locked=i}clone(){return new v(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return h.equalsV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s){const i=e.space,n=t.get(i),r=e.get(i);return this.setV(h.lerpV(n,r,s),i),this}static lerp(t,e,s){return new v(0,0,e.space).lerp(t,e,s)}set(t=0,e=0,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return h.equalsV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s){return h.equals(this.value.x,this.value.y,t,e)&&this.space===s?this:(s.convertPointInto(this.value,t,e,this.space),this.markDirty(),this)}setValueFromSpaceV(t,e){return this.setValueFromSpace(t.x,t.y,e)}get(t){const e=new h;return this.space.convertPointIntoV(e,this.value,t),e}getInto(t,e){return this.space.convertPointIntoV(t,this.value,e),this}changeSpace(t){return this.space===t?this:(this.space.convertPointIntoV(this.value,this.value,t),this.space=t,this)}}class l{static applyPointerEvents(t,e,s){t.isDirty()&&(e.style.pointerEvents=t.value)}static applyStroke(t,e,s){if(t.isDirty()!==!1){if(t.width.isDirty()){const i=t.width.get(s.getViewSpace());e.setAttribute("stroke-width",i.toFixed(2))}t.color.isDirty()&&e.setAttribute("stroke",t.color.toString()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("stroke-opacity",t.opacity.toFixed(2)):e.removeAttribute("stroke-opacity")),t.lineCap.isDirty()&&e.setAttribute("stroke-linecap",t.lineCap.value),t.lineJoin.isDirty()&&e.setAttribute("stroke-linejoin",t.lineJoin.value)}}static applyFill(t,e,s){t.isDirty()!==!1&&(t.color.isDirty()&&e.setAttribute("fill",t.color.toString()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("fill-opacity",t.opacity.toFixed(2)):e.removeAttribute("fill-opacity")))}static applyColor(t,e,s){t.isDirty()&&e.setAttribute("fill",t.toString())}static applyOpacity(t,e,s){t.isDirty()&&(t.value<=1?e.setAttribute("opacity",t.toFixed(2)):e.removeAttribute("opacity"))}static applyTransform(t,e,s){t.isDirty()&&(t.value.isIdentity()===!1?e.setAttribute("transform",t.toFixed(2)):e.removeAttribute("transform"))}static applyFont(t,e,s){if(t.isDirty()!==!1){if(t.size.isDirty()){const i=t.size.get(s.getViewSpace());e.setAttribute("font-size",i.toFixed(1))}t.weight.isDirty()&&e.setAttribute("font-weight",t.weight.toFixed(0)),t.family.isDirty()&&e.setAttribute("font-family",t.family.toString()),t.style.isDirty()&&e.setAttribute("font-style",t.style.value)}}static applyPosition(t,e,s,i="x",n="y"){if(t.isDirty()){const r=s.acquireVec2();t.getInto(r,s.getViewSpace()),e.setAttribute(i,r.x.toFixed(2)),e.setAttribute(n,r.y.toFixed(2)),s.releaseVec2(r)}}static applyShiftedPosition(t,e,s,i,n="x",r="y"){if(t.isDirty()||e.isDirty()){const a=i.getViewSpace(),c=i.acquireVec2(),u=i.acquireVec2();t.getInto(c,a),e.getInto(u,a),s.setAttribute(n,(c.x+u.x).toFixed(2)),s.setAttribute(r,(c.y+u.y).toFixed(2)),i.releaseVec2(c),i.releaseVec2(u)}}static applyAnchoredPosition(t,e,s,i,n){if(t.isDirty()||e.isDirty()||s.isDirty()){const r=Dt.getNorthWest(s.value,n.getViewSpace(),n,t,e);i.setAttribute("x",r.x.toFixed(2)),i.setAttribute("y",r.y.toFixed(2))}}static applyExtents(t,e,s){if(t.isDirty()){const i=s.acquireVec2();t.getInto(i,s.getViewSpace()),i.scale(2),e.setAttribute("width",i.width.toFixed(2)),e.setAttribute("height",i.height.toFixed(2)),s.releaseVec2(i)}}static applyRadius(t,e,s){if(t.isDirty()){const i=t.get(s.getViewSpace());e.setAttribute("r",i.toFixed(2))}}static applyCornerRadius(t,e,s){if(t.isDirty()){const i=t.get(s.getViewSpace());e.setAttribute("rx",i.toFixed(2)),e.setAttribute("ry",i.toFixed(2))}}static applyPath(t,e,s,i,n,r){t.updateLength();const a=l.polyCurveToSVGPath(t,s.get(),i.get(),e.get(),r);a.length>=0?n.setAttribute("d",a):n.removeAttribute("d")}static polyCurveToSVGPath(t,e,s,i,n){e>0&&s<1?t=t.createPartialCurveRange(e,s):e>0?t=t.createPartialCurveFrom(e):s<1&&(t=t.createPartialCurveTo(s));const r=t.getCurveCount();if(r<=0||e>=s)return"";let a="";const c=t.getCurve(0).getStart(),u=new h(1/0,1/0),p=new h,g=n.getViewSpace();for(let x=0;x<r;x++){const y=t.getCurve(x);if(h.equalsV(u,y.getStart())||(c.copy(y.getStart()),i.convertPointIntoV(p,c,g),a+=`M ${p.x.toFixed(2)},${p.y.toFixed(2)} `),y instanceof B)i.convertPointIntoV(p,y.getEnd(),g),a+=`L ${p.x.toFixed(2)},${p.y.toFixed(2)} `;else if(y instanceof W){const k=y.getBezierPoints();a+="C ";for(let E=1;E<k.length;E++)i.convertPointIntoV(p,k[E],g),a+=`${p.x.toFixed(2)},${p.y.toFixed(2)} `}const m=y.getEnd();h.equalsV(c,m)&&(a+="Z "),u.copy(m)}return a.trimEnd()}static applyPreserveWhitespace(t,e,s){t.isDirty()&&(t.value?e.style.whiteSpaceCollapse="preserve":e.style.whiteSpace="")}static applyTextAnchor(t,e,s){t.isDirty()&&e.setAttribute("text-anchor",t.value)}}class J extends C{kind="boolean";value;constructor(t=!1,e=!1){super(),this.value=t,this.locked=e}clone(){return new J(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value.toString()}}class R extends C{kind="enum";value;constructor(t,e=!1){super(),this.value=t,this.locked=e}clone(){return new R(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}}class T extends C{kind="length";value;space;constructor(t=0,e,s=!1){super(),this.value=t,this.space=e,this.locked=s}clone(){return new T(this.value,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value&&this.space===t.space?this:(this.value=t.value,this.space=t.space,this.markDirty(),this)}lerp(t,e,s){const i=e.space,n=t.get(i),r=e.get(i);return this.set(w.lerp(n,r,s),i),this}static lerp(t,e,s){return new T(0,e.space).lerp(t,e,s)}set(t,e){return this.value===t&&this.space===e?this:(this.value=t,e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e){return this.value===t&&this.space===e?this:(this.value=e.convertLength(t,this.space),this.markDirty(),this)}get(t){return this.space.convertLength(this.value,t)}changeSpace(t){return this.space===t?this:(this.value=this.space.convertLength(this.value,t),this.space=t,this)}}class d extends C{kind="number";value;constructor(t,e=!1){super(),this.value=t,this.locked=e}clone(){return new d(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(w.lerp(i,n,s)),this}static lerp(t,e,s){return new d(0).lerp(t,e,s)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toFixed(t=2){return this.value.toFixed(t)}}class Z extends C{kind="string";value;constructor(t="",e=!1){super(),this.value=t,this.locked=e}clone(){return new Z(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value}}class L{}class I extends L{layer=new d(0);isEnabled=new J(!0);pointerEvents=new R("none");setOwner(t=null){this.layer.setOwner(t),this.isEnabled.setOwner(t),this.pointerEvents.setOwner(t)}clearDirty(){this.layer.clearDirty(),this.isEnabled.clearDirty(),this.pointerEvents.clearDirty()}}class b extends L{color=new f(0,0,0);width;opacity=new d(1);lineCap=new R("round");lineJoin=new R("miter");dirty=!0;owner=null;constructor(t){super(),this.width=new T(0,t.getViewSpace()),this.color.setOwner(this),this.width.setOwner(this),this.opacity.setOwner(this),this.lineCap.setOwner(this),this.lineJoin.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.width.copy(t.width),this.opacity.copy(t.opacity),this.lineCap.copy(t.lineCap),this.lineJoin.copy(t.lineJoin)}copyIfUnlocked(t){this.color.copyIfUnlocked(t.color),this.width.copyIfUnlocked(t.width),this.opacity.copyIfUnlocked(t.opacity),this.lineCap.copyIfUnlocked(t.lineCap),this.lineJoin.copyIfUnlocked(t.lineJoin)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.width.clearDirty(),this.opacity.clearDirty(),this.lineCap.clearDirty(),this.lineJoin.clearDirty()}}class A extends L{color=new f(255,255,255);opacity=new d(1);dirty=!0;owner=null;constructor(){super(),this.color.setOwner(this),this.opacity.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.opacity.copy(t.opacity)}copyIfUnlocked(t){this.color.copyIfUnlocked(t.color),this.opacity.copyIfUnlocked(t.opacity)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.opacity.clearDirty()}}class nt extends L{size;weight=new d(400);relativeLineHeight=new d(21/16);relativeAscenderHeight=new d(10/16);family=new Z("system-ui");style=new R("normal");dirty=!0;owner=null;constructor(t){super(),this.size=new T(16,t.getViewSpace()),this.size.setOwner(this),this.weight.setOwner(this),this.relativeLineHeight.setOwner(this),this.relativeAscenderHeight.setOwner(this),this.family.setOwner(this),this.style.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.dirty=!0,this.owner?.markDirty()}copy(t){this.size.copy(t.size),this.weight.copy(t.weight),this.relativeLineHeight.copy(t.relativeLineHeight),this.relativeAscenderHeight.copy(t.relativeAscenderHeight),this.family.copy(t.family),this.style.copy(t.style)}copyIfUnlocked(t){this.size.copyIfUnlocked(t.size),this.weight.copyIfUnlocked(t.weight),this.relativeLineHeight.copyIfUnlocked(t.relativeLineHeight),this.relativeAscenderHeight.copyIfUnlocked(t.relativeAscenderHeight),this.family.copyIfUnlocked(t.family),this.style.copyIfUnlocked(t.style)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.size.clearDirty(),this.weight.clearDirty(),this.relativeLineHeight.clearDirty(),this.relativeAscenderHeight.clearDirty(),this.family.clearDirty(),this.style.clearDirty()}}class D{data;id;scene;dirty=!0;parent=null;children=[];childrenChanged=!1;constructor(t,e){this.data=e,this.scene=t,this.id=t.getNextElementId(),this.data.setOwner(this)}skipUpdate(){return!this.isDirty()}isDirty(){return this.dirty}markDirty(){this.dirty=!0,this.parent?.markDirty()}clearDirty(){this.dirty=!1,this.data.clearDirty()}setEnabled(t){return this.data.isEnabled.set(t),this.parent?.updateSVGChildren(),this}isEnabled(){return this.data.isEnabled.get()}setParent(t){if(this.parent===t)return this;if(this.parent!==null){const e=this.parent.children.indexOf(this);e!==-1?(this.parent.children.splice(e,1),this.parent.childrenChanged=!0,this.parent.markDirty()):console.warn("S2Element: Inconsistent parent-child relationship.",this,this.parent)}return t!==null&&(t.children.push(this),t.childrenChanged=!0,t.markDirty()),this.parent=t,this}getParent(){return this.parent}getChildCount(){return this.children.length}getChild(t){return this.children[t]}getScene(){return this.scene}updateSVGChildren(){if(!this.children.some(n=>n.data.layer.isDirty()||n.data.isEnabled.isDirty())&&!this.childrenChanged)return this;this.children.sort((n,r)=>n.data.layer.value!==r.data.layer.value?n.data.layer.value-r.data.layer.value:n.id-r.id);const e=[];for(const n of this.children)n.data.isEnabled.get()&&e.push(n.getSVGElement());const s=this.getSVGElement();return(s.children.length!==e.length||e.some((n,r)=>n!==s.children[r]))&&s.replaceChildren(...e),this.childrenChanged=!1,this}}class V{elements=new Float32Array(6);constructor(t=0,e=0,s=0,i=0,n=0,r=0){this.set(t,e,s,i,n,r)}static createIdentity(){return new V(1,0,0,0,1,0)}static lerp(t,e,s){return new V().copy(t).lerp(e,s)}static equals(t,e,s=1e-4){const i=t.elements,n=e.elements;return Math.abs(i[0]-n[0])<=s&&Math.abs(i[1]-n[1])<=s&&Math.abs(i[2]-n[2])<=s&&Math.abs(i[3]-n[3])<=s&&Math.abs(i[4]-n[4])<=s&&Math.abs(i[5]-n[5])<=s}static det(t){const e=t.elements;return e[0]*e[3]-e[2]*e[1]}set(t=0,e=0,s=0,i=0,n=0,r=0){return this.elements[0]=t,this.elements[2]=e,this.elements[4]=s,this.elements[1]=i,this.elements[3]=n,this.elements[5]=r,this}lerp(t,e){const s=1-e,i=this.elements,n=t.elements;return i[0]=s*i[0]+e*n[0],i[1]=s*i[1]+e*n[1],i[2]=s*i[2]+e*n[2],i[3]=s*i[3]+e*n[3],i[4]=s*i[4]+e*n[4],i[5]=s*i[5]+e*n[5],this}fromArray(t,e=0){for(let s=0;s<6;s++)this.elements[s]=t[s+e];return this}isIdentity(t=1e-4){const e=this.elements;return Math.abs(e[0]-1)<=t&&Math.abs(e[1])<=t&&Math.abs(e[2])<=t&&Math.abs(e[3]-1)<=t&&Math.abs(e[4])<=t&&Math.abs(e[5])<=t}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],a=s[1],c=s[2],u=s[3],p=s[4],g=s[5],x=i[0],y=i[1],m=i[2],k=i[3],E=i[4],H=i[5];return n[0]=r*x+c*y,n[1]=a*x+u*y,n[2]=r*m+c*k,n[3]=a*m+u*k,n[4]=r*E+c*H+p,n[5]=a*E+u*H+g,this}composeAfterCoefficients(t,e,s,i,n,r){const a=this.elements,c=a[0],u=a[1],p=a[2],g=a[3],x=a[4],y=a[5];return a[0]=t*c+e*u,a[1]=i*c+n*u,a[2]=t*p+e*g,a[3]=i*p+n*g,a[4]=t*x+e*y+s,a[5]=i*x+n*y+r,this}composeAfter(t){return this.multiplyMatrices(this,t)}composeBefore(t){return this.multiplyMatrices(t,this)}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],a=t[5],c=e*n-i*s;if(c===0)return console.warn("S2Mat2x3: .invert() can not invert matrix, determinant is 0"),this.makeIdentity();const u=1/c;return this.set(n*u,-i*u,(i*a-n*r)*u,-s*u,e*u,(s*r-e*a)*u),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],this}clone(){return new V().copy(this)}det(){const t=this.elements;return t[0]*t[3]-t[2]*t[1]}makeIdentity(){return this.set(1,0,0,0,1,0)}makeTranslation(t,e){return this.set(1,0,t,0,1,e)}makeTranslationV(t){return this.makeTranslation(t.x,t.y)}makeScale(t,e){return this.set(t,0,0,0,e,0)}makeScaleV(t){return this.makeScale(t.x,t.y)}makeScaleFrom(t,e,s,i){return this.set(t,0,-t*s+s,0,e,-e*i+i)}makeScaleFromV(t,e,s){return this.makeScaleFrom(t,e,s.x,s.y)}makeRotation(t,e){e==="deg"&&(t*=Math.PI/180);const s=Math.sin(t),i=Math.cos(t);return this.set(i,-s,0,+s,i,0)}makeRotationFrom(t,e,s,i){e==="deg"&&(t*=Math.PI/180);const n=Math.sin(t),r=Math.cos(t);return this.set(r,-n,-s*r+i*n+s,+n,r,-i*r-s*n+i)}makeRotationFromV(t,e,s){return this.makeRotationFrom(t,e,s.x,s.y)}translate(t,e){const s=this.elements;return s[4]+=t,s[5]+=e,this}translateV(t){return this.translate(t.x,t.y)}scale(t,e){const s=this.elements;return s[0]*=t,s[1]*=e,s[2]*=t,s[3]*=e,s[4]*=t,s[5]*=e,this}scaleV(t){return this.scale(t.x,t.y)}scaleFrom(t,e,s,i){return this.composeAfterCoefficients(t,0,-t*s+s,0,e,-e*i+i)}scaleFromV(t,e,s){return this.scaleFrom(t,e,s.x,s.y)}rotate(t,e="rad"){e==="deg"&&(t*=Math.PI/180);const s=Math.sin(t),i=Math.cos(t);return this.composeAfterCoefficients(i,-s,0,+s,i,0)}rotateFrom(t,e,s,i){e==="deg"&&(t*=Math.PI/180);const n=Math.sin(t),r=Math.cos(t);return this.composeAfterCoefficients(r,-n,-s*r+i*n+s,+n,r,-i*r-s*n+i)}rotateFromV(t,e,s){return this.rotateFrom(t,e,s.x,s.y)}}class S extends C{kind="transform";value;constructor(t=1,e=0,s=0,i=0,n=1,r=0,a=!1){super(),this.value=new V(t,e,s,i,n,r),this.locked=a}clone(){return new S(this.value.elements[0],this.value.elements[1],this.value.elements[2],this.value.elements[3],this.value.elements[4],this.value.elements[5],this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return V.equals(this.value,t.value)?this:(this.value.copy(t.value),this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(V.lerp(i,n,s)),this}static lerp(t,e,s){return new S().lerp(t,e,s)}set(t){return V.equals(this.value,t)?this:(this.value.copy(t),this.markDirty(),this)}get(){return this.value}toFixed(t=2){const e=this.value.elements;return"matrix("+e[0].toFixed(t)+", "+e[1].toFixed(t)+", "+e[2].toFixed(t)+", "+e[3].toFixed(t)+", "+e[4].toFixed(t)+", "+e[5].toFixed(t)+")"}}class kt extends I{fill;stroke;opacity;transform;position;radius;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.position=new v(0,0,t.getWorldSpace()),this.radius=new T(1,t.getWorldSpace()),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.radius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.radius.clearDirty()}}class Vt extends D{element;constructor(t){super(t,new kt(t)),this.element=document.createElementNS(P,"circle")}getSVGElement(){return this.element}update(){this.skipUpdate()||(l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),l.applyPosition(this.data.position,this.element,this.scene,"cx","cy"),l.applyRadius(this.data.radius,this.element,this.scene),this.clearDirty())}}class O extends C{kind="extents";value;space;constructor(t,e,s,i=!1){super(),this.value=new h(t,e),this.space=s,this.locked=i}clone(){return new O(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return h.equalsV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s){const i=e.space,n=t.get(i),r=e.get(i);return this.setV(h.lerpV(n,r,s),i),this}static lerp(t,e,s){return new O(0,0,e.space).lerp(t,e,s)}set(t,e,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return h.equalsV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s){return h.equals(this.value.x,this.value.y,t,e)&&this.space===s?this:(s.convertExtentsInto(this.value,t,e,this.space),this.markDirty(),this)}setValueFromSpaceV(t,e){return this.setValueFromSpace(t.x,t.y,e)}get(t){const e=new h;return this.space.convertExtentsIntoV(e,this.value,t),e}getInto(t,e){return this.space.convertExtentsIntoV(t,this.value,e),this}getMaxLengthInto(t){const e=Math.max(this.value.x,this.value.y);return t.setValueFromSpace(e,this.space),this}getMinLengthInto(t){const e=Math.min(this.value.x,this.value.y);return t.setValueFromSpace(e,this.space),this}changeSpace(t){return this.space===t?this:(this.space.convertExtentsIntoV(this.value,this.value,t),this.space=t,this)}}class N extends C{kind="anchor";value;constructor(t,e,s=!1){super(),this.value=new h(t,e),this.locked=s}clone(){return new N(this.value.x,this.value.y,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return h.equalsV(this.value,t.value)?this:(this.value.copy(t.value),this.markDirty(),this)}lerp(t,e,s){return this.value.copy(t.value).lerpV(e.value,s),this}static lerp(t,e,s){return new N(0,0).lerp(t,e,s)}set(t=0,e=0){return this.value.x===t&&this.value.y===e?this:(this.value.set(t,e),this.markDirty(),this)}setV(t){return h.equalsV(this.value,t)?this:(this.value.copy(t),this.markDirty(),this)}get(){return new h(this.value.x,this.value.y)}getInto(t){return t.copy(this.value),this}getRectPoint(t,e,s,i,n){const r=new h;return this.getRectPointInto(r,t,e,s,i,n),r}getRectPointIntoF(t,e,s,i,n,r,a){return t.set(e-(this.value.x-r)*i,s-(this.value.y-a)*n),this}getRectPointIntoV(t,e,s,i){return t.set(e.x-(this.value.x-i.x)*s.x,e.y-(this.value.y-i.y)*s.y),this}getRectPointInto(t,e,s,i,n,r){s.getInto(t,e);const a=t.x,c=t.y;i.getInto(t,e);const u=t.x,p=t.y;return t.set(a-(this.value.x-n)*u,c-(this.value.y-r)*p),this}getCenter(t,e,s){const i=new h;return this.getCenterInto(i,t,e,s),i}getCenterIntoF(t,e,s,i,n){return t.set(e-this.value.x*i,s-this.value.y*n),this}getCenterIntoV(t,e,s){return t.set(e.x-this.value.x*s.x,e.y-this.value.y*s.y),this}getCenterInto(t,e,s,i){return this.getRectPointInto(t,e,s,i,0,0)}getLower(t,e,s){const i=new h;return this.getLowerInto(i,t,e,s),i}getLowerInto(t,e,s,i){return this.getRectPointInto(t,e,s,i,-1,-1)}getUpper(t,e,s){const i=new h;return this.getUpperInto(i,t,e,s),i}getUpperInto(t,e,s,i){return this.getRectPointInto(t,e,s,i,1,1)}}class Pt extends I{fill;stroke;opacity;transform;position;extents;anchor;cornerRadius;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.position=new v(0,0,t.getWorldSpace()),this.extents=new O(1,1,t.getWorldSpace()),this.anchor=new N(0,0),this.cornerRadius=new T(0,t.getViewSpace()),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.extents.setOwner(t),this.anchor.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.extents.clearDirty(),this.anchor.clearDirty(),this.cornerRadius.clearDirty()}}class Tt extends D{element;svgPosition;constructor(t){super(t,new Pt(t)),this.element=document.createElementNS(P,"rect"),this.svgPosition=new v(0,0,t.getViewSpace())}getSVGElement(){return this.element}getCenterInto(t,e){return this.data.anchor.getCenterInto(t,e,this.data.position,this.data.extents),this}update(){if(this.skipUpdate())return;l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),l.applyExtents(this.data.extents,this.element,this.scene),l.applyCornerRadius(this.data.cornerRadius,this.element,this.scene);const t=this.scene.getViewSpace(),e=this.scene.acquireVec2();this.data.anchor.getRectPointInto(e,t,this.data.position,this.data.extents,-1,-1),this.svgPosition.setV(e,t),l.applyPosition(this.svgPosition,this.element,this.scene),this.svgPosition.clearDirty(),this.scene.releaseVec2(e),this.clearDirty()}}class U extends C{kind="space-ref";value;constructor(t,e=!1){super(),this.value=t,this.locked=e}clone(){return new U(this.value,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}}class It extends I{stroke;opacity=new d(1);transform=new S;geometry;constructor(t){super(),this.stroke=new b(t),this.geometry=new bt(t),this.stroke.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.geometry.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.geometry.clearDirty()}}class bt extends L{space;boundA;boundB;steps;referencePoint;constructor(t){super();const e=t.getWorldSpace();this.space=new U(e),this.boundA=new v(-8,-4.5,e),this.boundB=new v(8,4.5,e),this.steps=new O(1,1,e),this.referencePoint=new v(0,0,e)}setOwner(t=null){this.space.setOwner(t),this.boundA.setOwner(t),this.boundB.setOwner(t),this.steps.setOwner(t),this.referencePoint.setOwner(t)}clearDirty(){this.space.clearDirty(),this.boundA.clearDirty(),this.boundB.clearDirty(),this.steps.clearDirty(),this.referencePoint.clearDirty()}}class at extends D{element;constructor(t){super(t,new It(t)),this.element=document.createElementNS(P,"path"),this.data.stroke.width.set(1,t.getViewSpace()),this.data.stroke.lineCap.set("butt")}getSVGElement(){return this.element}applyGeometry(){const t=this.scene,e=this.element,s=this.data.geometry,i=1e-4,n=s.space.get(),r=t.getViewSpace(),a=_,c=tt;s.boundA.getInto(a,n),s.boundB.getInto(c,n);const u=Math.min(a.x,c.x),p=Math.max(a.x,c.x),g=Math.min(a.y,c.y),x=Math.max(a.y,c.y),y=_,m=tt;s.steps.getInto(y,n),s.referencePoint.getInto(m,n);const k=y.x<=0?y.x:1,E=y.y<=0?y.y:1,H=m.x-Math.floor((m.x-u+i)/k)*k,St=m.y-Math.floor((m.y-g+i)/E)*E;let K="";const $=_,G=tt;for(let M=H;M<p+i;M+=k)n.convertPointInto($,M,g,r),n.convertPointInto(G,M,x,r),K+=`M ${$.x.toFixed(2)},${$.y.toFixed(2)} L ${G.x.toFixed(2)},${G.y.toFixed(2)} `;for(let M=St;M<x+i;M+=E)n.convertPointInto($,u,M,r),n.convertPointInto(G,p,M,r),K+=`M ${$.x.toFixed(2)},${$.y.toFixed(2)} L ${G.x.toFixed(2)},${G.y.toFixed(2)} `;e.setAttribute("d",K.trimEnd())}update(){this.skipUpdate()||(l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),this.applyGeometry(),this.clearDirty())}}const _=new h,tt=new h;class z extends C{kind="offset";value;space;constructor(t,e,s,i=!1){super(),this.value=new h(t,e),this.space=s,this.locked=i}clone(){return new z(this.value.x,this.value.y,this.space,this.locked)}copyIfUnlocked(t){return this.locked?this:this.copy(t)}copy(t){return h.equalsV(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s){const i=e.space,n=t.get(i),r=e.get(i);return this.setV(h.lerpV(n,r,s),i),this}static lerp(t,e,s){return new z(0,0,e.space).lerp(t,e,s)}set(t=0,e=0,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return h.equalsV(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s){return h.equals(this.value.x,this.value.y,t,e)&&this.space===s?this:(s.convertOffsetInto(this.value,t,e,this.space),this.markDirty(),this)}setValueFromSpaceV(t,e){return this.setValueFromSpace(t.x,t.y,e)}get(t){const e=new h;return this.space.convertOffsetIntoV(e,this.value,t),e}getInto(t,e){return this.space.convertOffsetIntoV(t,this.value,e),this}changeSpace(t){return this.space===t?this:(this.space.convertOffsetIntoV(this.value,this.value,t),this.space=t,this)}}class gt extends C{kind="local-bbox";scene;center;extents;constructor(t){super(),this.scene=t,this.center=new z(0,0,t.getViewSpace()),this.extents=new O(0,0,t.getViewSpace())}set(t,e,s){if(!t.isConnected){console.warn("Element is not connected to DOM, cannot compute bbox",t.isConnected);return}const i=this.scene.getViewSpace(),n=t.getBBox(),r=this.scene.acquireVec2().set(n.x+n.width/2,n.y+n.height/2),a=this.scene.acquireVec2().set(0,0);s.convertPointIntoV(a,e,i),r.subV(a),this.center.setV(r,i),this.extents.set(n.width/2,n.height/2,i),this.markDirty(),this.scene.releaseVec2(r),this.scene.releaseVec2(a)}getCenterOffsetInto(t,e){return this.center.getInto(t,e),this}getExtentsInto(t,e){return this.extents.getInto(t,e),this}getBBoxOffsetsInto(t,e,s){const i=Et,n=Ft;return this.getCenterOffsetInto(i,s),this.getExtentsInto(n,s),t.copy(i).subV(n),e.copy(i).addV(n),this}}const Et=new h,Ft=new h;class Ct extends I{fill;stroke;opacity;transform;font;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.font=new nt(t),this.fill.opacity.set(1),this.stroke.width.set(0,t.getViewSpace())}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty()}}class Ot extends D{category;content;element;localBBox;parentText;constructor(t,e){super(t,new Ct(t)),this.element=document.createElementNS(P,"tspan"),this.category="",this.content="",this.localBBox=new gt(t),this.parentText=e}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.content=t,this.localBBox.markDirty(),this.markDirty(),this}markBBoxDirty(){this.localBBox.markDirty(),this.markDirty()}isBBoxDirty(){return this.localBBox.isDirty()||this.data.font.isDirty()||this.data.transform.isDirty()}getContent(){return this.content}getCenterInto(t,e){const s=this.scene.acquireVec2(),i=this.scene.acquireVec2();return this.localBBox.getCenterOffsetInto(s,e),this.parentText.getPositionInto(i,e),t.copy(i).addV(s),this.scene.releaseVec2(s),this.scene.releaseVec2(i),this}getCenterOffsetInto(t,e){return this.localBBox.getCenterOffsetInto(t,e),this}getBBoxInto(t,e,s){const i=this.scene.acquireVec2();return this.parentText.getPositionInto(i,s),this.localBBox.getBBoxOffsetsInto(t,e,s),t.addV(i),e.addV(i),this.scene.releaseVec2(i),this}getBBoxOffsetsInto(t,e,s){return this.localBBox.getBBoxOffsetsInto(t,e,s),this}getExtentsInto(t,e){return this.localBBox.getExtentsInto(t,e),this}updateBBox(){const t=this.scene.getViewSpace(),e=this.scene.acquireVec2();this.parentText.getSVGPositionInto(e,t),this.localBBox.set(this.element,e,t),this.scene.releaseVec2(e)}applyStyle(){l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyFont(this.data.font,this.element,this.scene),this.data.fill.clearDirty(),this.data.stroke.clearDirty(),this.data.opacity.clearDirty(),this.data.font.clearDirty()}update(){this.skipUpdate()||(this.applyStyle(),this.localBBox.isDirty()&&(this.updateBBox(),this.localBBox.clearDirty()),this.clearDirty())}}class xt extends I{fill;stroke;opacity;transform;position;localShift;font;textAnchor;preserveWhitespace;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.position=new v(0,0,t.getWorldSpace()),this.localShift=new z(0,0,t.getViewSpace()),this.font=new nt(t),this.textAnchor=new d(0),this.preserveWhitespace=new J(!1),this.stroke.width.set(0,t.getViewSpace()),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.localShift.setOwner(t),this.font.setOwner(t),this.textAnchor.setOwner(t),this.preserveWhitespace.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.localShift.clearDirty(),this.font.clearDirty(),this.textAnchor.clearDirty(),this.preserveWhitespace.clearDirty()}}class At extends D{element;extents;centerOffset;svgPosition;tspans=[];constructor(t,e){super(t,e);const s=t.getViewSpace();this.element=document.createElementNS(P,"text"),this.extents=new O(0,0,s),this.centerOffset=new z(0,0,s),this.svgPosition=new v(0,0,s),this.element.setAttribute("x",this.svgPosition.value.x.toString()),this.element.setAttribute("y",this.svgPosition.value.y.toString())}getSVGElement(){return this.element}addTSpan(t,e){const s=new Ot(this.scene,this);return s.setParent(this),s.setContent(t),s.category=e??"",this.tspans.push(s),this.extents.markDirty(),this.centerOffset.markDirty(),this.markDirty(),s}getPositionInto(t,e){return this.data.position.getInto(t,e),this}getSVGPositionInto(t,e){return this.svgPosition.getInto(t,e),this}getExtentsInto(t,e){return this.extents.getInto(t,e),this}getCenterInto(t,e){const s=this.scene.acquireVec2(),i=this.scene.acquireVec2();return this.centerOffset.getInto(s,e),this.data.position.getInto(i,e),t.copy(i).addV(s),this.scene.releaseVec2(s),this.scene.releaseVec2(i),this}getTSpans(){return this.tspans}getTSpanCount(){return this.tspans.length}getTSpan(t){return this.tspans[t]}findTSpan(t){return this.tspans.find(e=>(t.content?e.getContent()===t.content:!0)&&(t.category?e.category===t.category:!0))}clearText(){return this.children.length=0,this.tspans.length=0,this.element.replaceChildren(),this.updateSVGChildren(),this.extents.markDirty(),this.centerOffset.markDirty(),this.markDirty(),this}updateExtents(){const t=this.scene.getViewSpace();if(this.tspans.length===0)this.extents.set(0,0,t),this.centerOffset.set(0,0,t);else{const e=this.scene.acquireVec2().set(1/0,1/0),s=this.scene.acquireVec2().set(-1/0,-1/0),i=this.scene.acquireVec2(),n=this.scene.acquireVec2();for(const r of this.tspans)r.getBBoxOffsetsInto(i,n,t),e.minV(i),s.maxV(n);this.extents.set((s.x-e.x)/2,(s.y-e.y)/2,t),this.centerOffset.set((s.x+e.x)/2,(s.y+e.y)/2,t),this.scene.releaseVec2(i),this.scene.releaseVec2(n),this.scene.releaseVec2(e),this.scene.releaseVec2(s)}this.extents.clearDirty(),this.centerOffset.clearDirty()}update(){if(this.skipUpdate())return;this.updateSVGChildren(),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),l.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),this.element.setAttribute("text-anchor","middle"),this.data.stroke.width.value>0?this.element.setAttribute("paint-order","stroke"):this.element.removeAttribute("paint-order");let t=this.data.preserveWhitespace.isDirty()||this.data.font.isDirty()||this.extents.isDirty();for(const a of this.tspans)a.data.fill.copyIfUnlocked(this.data.fill),a.data.stroke.copyIfUnlocked(this.data.stroke),a.data.font.copyIfUnlocked(this.data.font),a.applyStyle(),t=t||a.isBBoxDirty();if(t)for(const a of this.tspans)a.markBBoxDirty();for(const a of this.tspans)a.update();this.updateExtents();const e=this.scene.getViewSpace(),s=this.data.textAnchor.get(),i=this.scene.acquireVec2(),n=this.scene.acquireVec2(),r=this.svgPosition.value;this.svgPosition.space=e,this.data.position.getInto(r,e),this.extents.getInto(i,e),this.data.localShift.getInto(n,e),r.x+=-s*i.x+n.x,r.y+=n.y,this.element.setAttribute("x",r.x.toFixed(2)),this.element.setAttribute("y",r.y.toFixed(2)),this.scene.releaseVec2(i),this.scene.releaseVec2(n);for(const a of this.tspans)a.update();this.clearDirty()}}class Mt extends At{constructor(t){super(t,new xt(t))}}function Bt(o){return o}function ht(o){return o*o}function ot(o){const t=1-o;return 1-t*t}function ct(o){if(o<.5)return 2*o*o;{const t=1-o;return 1-2*t*t}}function Wt(o){return o*o*o}function Rt(o){const t=1-o;return 1-t*t*t}function Lt(o){if(o<.5)return 4*o*o*o;{const t=1-o;return 1-2*t*t*t}}function Ut(o){return o*o*o*o}function $t(o){const t=1-o;return 1-t*t*t*t}function Gt(o){if(o<.5)return 8*o*o*o*o;{const t=1-o;return 1-8*t*t*t*t}}function qt(o){return o<=0?0:Math.pow(2,10*o-10)}function Nt(o){return o>=1?1:1-Math.pow(2,-10*o)}function zt(o){return o<=0?0:o>=1?1:o<.5?Math.pow(2,20*o-10)/2:(2-Math.pow(2,-20*o+10))/2}function jt(o){return 1-Math.cos(o*(Math.PI/2))}function Ht(o){return Math.sin(o*(Math.PI/2))}function Xt(o){return .5*(1-Math.cos(Math.PI*o))}function Yt(o){return o*o*(3-2*o)}function Qt(o){return o*o*o*(o*(o*6-15)+10)}const mt={linear:Bt,in:ht,inSine:jt,inQuad:ht,inCubic:Wt,inQuart:Ut,inExpo:qt,out:ot,outSine:Ht,outQuad:ot,outCubic:Rt,outQuart:$t,outExpo:Nt,inOut:ct,inOutSine:Xt,inOutQuad:ct,inOutCubic:Lt,inOutQuart:Gt,inOutExpo:zt,smoothStep:Yt,smootherStep:Qt};class Jt extends I{fill;stroke;opacity;extents;pathPosition;pathThreshold;pathStrokeFactor;constructor(t){super();const e=t.getViewSpace();this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.pathPosition=new d(1),this.pathThreshold=new T(30,e),this.extents=new O(5,5,e),this.pathStrokeFactor=new d(1),this.stroke.width.set(0,e),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.extents.setOwner(t),this.pathPosition.setOwner(t),this.pathThreshold.setOwner(t),this.pathStrokeFactor.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.extents.clearDirty(),this.pathPosition.clearDirty(),this.pathThreshold.clearDirty(),this.pathStrokeFactor.clearDirty()}}class rt extends D{element;transform;anchorAlignment;tipableReference=null;tipTransform;tipShape;tipInset;isReversed;constructor(t){super(t,new Jt(t)),this.element=document.createElementNS(P,"path"),this.transform=new S,this.tipTransform=new dt(t),this.isReversed=!1,this.tipInset=.25,this.tipShape="",this.anchorAlignment=0,this.updateTipShape()}markDirty(){this.isDirty()||(this.dirty=!0,this.tipableReference&&this.tipableReference.markDirty())}setReversed(t=!1){return this.isReversed=t,this}setTipInset(t=.25){return this.tipInset=t,this.updateTipShape(),this}setAnchorAlignment(t=0){return this.anchorAlignment=t,this}setTipableReference(t){return this.tipableReference=t,this}getSVGElement(){return this.element}updateTipShape(){const t=-10+this.tipInset*20;this.tipShape=`M ${t},0 L -10,10 L 10,0 L -10,-10 Z`}updateTipTransform(){if(this.tipableReference===null)return;const t=this.scene.getViewSpace(),e=this.tipTransform.space;this.tipableReference.getTipTransformAtInto(this.tipTransform,this.data.pathPosition.get());const s=this.data.extents.get(t),i=e.convertLength(this.tipTransform.strokeWidth,t);s.x+=i*this.data.pathStrokeFactor.get(),s.y+=i*this.data.pathStrokeFactor.get();const n=e.convertLength(this.tipTransform.pathLength,t),r=this.data.pathThreshold.get(t);r>0&&n<r&&s.scale(mt.out(n/r));const a=new h;e.convertOffsetIntoV(a,this.tipTransform.tangent,t);const c=-a.angle();e.convertPointIntoV(a,this.tipTransform.position,t);const u=this.isReversed?-1:1;this.transform.value.makeIdentity().translate(this.anchorAlignment*10,0).scale(u*s.x/10,s.y/10).rotate(c,"rad").translateV(a)}update(){this.skipUpdate()||(this.updateTipTransform(),l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.transform,this.element,this.scene),this.element.setAttribute("d",this.tipShape),this.clearDirty())}}class Zt extends I{fill;stroke;opacity;transform;space;polyCurve;pathFrom;pathTo;constructor(t){super(),this.stroke=new b(t),this.opacity=new d(1),this.fill=new A,this.transform=new S,this.space=new U(t.getWorldSpace()),this.polyCurve=new q,this.pathFrom=new d(0),this.pathTo=new d(1),this.fill.opacity.set(0)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.space.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.space.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty()}}class Kt extends D{element;sampleCount=0;currStart=new h(0,0);endPosition=new h(0,0);arrowTips=[];constructor(t){super(t,new Zt(t)),this.element=document.createElementNS(P,"path")}createArrowTip(){const t=new rt(this.scene);return t.setParent(this.scene.getSVG()),this.arrowTips.push(t),t.data.pathPosition.set(1),t.setTipableReference(this),this.markDirty(),t}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getTipTransformAtInto(t,e){const s=this.data.pathFrom.get(),i=this.data.pathTo.get();return e=e*(i-s)+s,t.space=this.data.space.get(),t.position.copy(this.data.polyCurve.getPointAt(e)),t.tangent.copy(this.data.polyCurve.getTangentAt(e)),t.pathLength=this.data.polyCurve.getLength()*(i-s),t.strokeWidth=this.data.stroke.width.get(t.space),t}getTipTransformAt(t){const e=new dt(this.scene);return this.getTipTransformAtInto(e,t)}setSampleCount(t){return this.sampleCount=t,this.markDirty(),this}getSVGElement(){return this.element}getStart(t){const e=this.data.space.get(),s=this.data.polyCurve.getStart();return e.convertPointIntoV(s,s,t),s}getEnd(t){const e=this.data.space.get(),s=this.data.polyCurve.getEnd();return e.convertPointIntoV(s,s,t),s}getPointAt(t,e){const s=this.data.space.get(),i=this.data.polyCurve.getPointAt(t);return s.convertPointIntoV(i,i,e),i}getTangentAt(t,e){const s=this.data.space.get(),i=this.data.polyCurve.getTangentAt(t);return s.convertOffsetIntoV(i,i,e),i}getStartTangent(t){const e=this.data.space.get(),s=this.data.polyCurve.getStartTangent();return e.convertOffsetIntoV(s,s,t),s}getEndTangent(t){const e=this.data.space.get(),s=this.data.polyCurve.getEndTangent();return e.convertOffsetIntoV(s,s,t),s}getLength(t){return this.data.space.get().convertLength(this.data.polyCurve.getLength(),t)}clear(){return this.data.polyCurve.clear(),this.endPosition.set(0,0),this.markDirty(),this}moveTo(t,e){return this.moveToV(new h(t,e))}moveToV(t){return this.currStart.copy(t),this.endPosition.copy(t),this.markDirty(),this}lineTo(t,e){return this.lineToV(new h(t,e))}lineToV(t){return this.data.polyCurve.addLine(this.endPosition,t),this.endPosition.copy(t),this.markDirty(),this}cubicTo(t,e,s,i,n,r,a=this.sampleCount){return this.cubicToV(new h(t,e),new h(s,i),new h(n,r),a)}cubicToV(t,e,s,i=this.sampleCount){return this.data.polyCurve.addCubic(this.endPosition,h.addV(this.endPosition,t),h.addV(s,e),s,i),this.endPosition.copy(s),this.markDirty(),this}smoothCubicTo(t,e,s,i,n=this.sampleCount){return this.smoothCubicToV(new h(t,e),new h(s,i),n)}smoothCubicToV(t,e,s=this.sampleCount){if(this.data.polyCurve.getCurveCount()<=0)return this;const i=this.data.polyCurve.getLastCurve();return i instanceof W?(this.data.polyCurve.addCubic(this.endPosition,h.subV(h.scaleV(this.endPosition,2),i.getBezierPoint(2)),h.addV(e,t),e,s),this.endPosition.copy(e),this.markDirty(),this):this}close(){return h.equalsV(this.currStart,this.endPosition)?this:(this.data.polyCurve.addLine(this.endPosition,this.currStart),this.markDirty(),this)}update(){if(!this.skipUpdate()){l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),l.applyPath(this.data.polyCurve,this.data.space,this.data.pathFrom,this.data.pathTo,this.element,this.scene);for(const t of this.arrowTips)t.data.fill.color.copyIfUnlocked(this.data.stroke.color),t.data.fill.opacity.copyIfUnlocked(this.data.stroke.opacity),t.markDirty(),t.update();this.clearDirty()}}}class _t extends I{color;opacity;constructor(){super(),this.color=new f,this.opacity=new d(1)}setOwner(t=null){super.setOwner(t),this.opacity.setOwner(t),this.color.setOwner(t)}clearDirty(){super.clearDirty(),this.opacity.clearDirty(),this.color.clearDirty()}}class te extends D{element;constructor(t){super(t,new _t),this.element=document.createElementNS(P,"rect")}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t=this.scene.getViewportSize();this.element.setAttribute("x","0"),this.element.setAttribute("y","0"),this.element.setAttribute("width",t.x.toString()),this.element.setAttribute("height",t.y.toString()),l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyColor(this.data.color,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),this.clearDirty()}}class ee extends D{element;constructor(t,e){super(t,e),this.element=document.createElementNS(P,"g")}getSVGElement(){return this.element}update(){if(!this.skipUpdate()){this.updateSVGChildren(),l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene);for(const t of this.children)t.update();this.clearDirty()}}}class se{scene;position=new h;extents=new h;scaleFactor=1;rotation=0;dirty=!0;constructor(t){this.scene=t;const e=t.getViewportAspectRatio();this.position.set(0,0),this.extents=new h(8,8/e),this.update()}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0)}clearDirty(){this.dirty=!1}getRotationRad(){return this.rotation}getRotationDeg(){return this.rotation*180/Math.PI}getLower(){const t=new h;return this.getLowerInto(t),t}getLowerInto(t){return t.copy(this.extents).scale(-this.scaleFactor).addV(this.position),this}getUpper(){const t=new h;return this.getUpperInto(t),t}getUpperInto(t){return t.copy(this.extents).scale(+this.scaleFactor).addV(this.position),this}setPosition(t,e){return this.position.set(t,e),this.markDirty(),this}setExtents(t,e){return this.extents.set(t,e),this.markDirty(),this}setZoom(t){return this.scaleFactor=1/t,this.markDirty(),this}setRotationRad(t){return this.rotation=t,this.markDirty(),this}setRotationDeg(t){return this.rotation=t*Math.PI/180,this.markDirty(),this}update(){if(!this.isDirty())return;const t=this.scene.getViewportWidth(),e=this.scene.getViewportHeight(),s=t/2,i=e/2,n=Math.cos(-this.rotation),r=Math.sin(-this.rotation),a=this.position.x,c=this.position.y,u=+(2*(this.extents.x*this.scaleFactor))/t,p=-(2*(this.extents.y*this.scaleFactor))/e;this.scene.getViewSpace().setSpaceToParent(+u*n,+p*r,-s*n*u-i*r*p+a,-u*r,+p*n,+s*r*u-i*n*p+c),this.clearDirty()}}class ie extends D{element;constructor(t,e){super(t,new I),this.element=e}getSVGElement(){return this.element}convertDOMPoint(t,e,s){const i=new DOMPoint(t,e),n=this.element.getScreenCTM();if(!n)return new h(0,0);const r=i.matrixTransform(n.inverse()),a=new h(r.x,r.y);return this.scene.getViewSpace().convertPointIntoV(a,a,s),a}convertDOMPointInto(t,e,s){const i=new DOMPoint(e,s),n=this.element.getScreenCTM();if(!n){t.set(0,0);return}const r=i.matrixTransform(n.inverse());t.setValueFromSpace(r.x,r.y,this.scene.getViewSpace())}update(){if(this.skipUpdate())return;const t=this.scene.getViewportSize();this.element.setAttribute("viewBox",`0 0 ${t.x} ${t.y}`),this.updateSVGChildren(),l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene);for(const e of this.children)e.update();this.clearDirty()}}class et{parent;dirty=!0;spaceToParent=new V(1,0,0,0,1,0);parentToSpace=new V(1,0,0,0,1,0);spaceToWorld=new V(1,0,0,0,1,0);worldToSpace=new V(1,0,0,0,1,0);extentsScaleToParent=new h(1,1);extentsScaleToWorld=new h(1,1);lengthScaleToParent=1;lengthScaleToWorld=1;isDirect=!0;constructor(t=null){this.parent=t}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.parent?.markDirty())}clearDirty(){this.dirty=!1}update(){if(!this.isDirty())return;const t=this.spaceToParent.elements[0],e=this.spaceToParent.elements[1],s=this.spaceToParent.elements[2],i=this.spaceToParent.elements[3];this.lengthScaleToParent=Math.sqrt(Math.abs(V.det(this.spaceToParent))),this.extentsScaleToParent.set(Math.sqrt(t*t+e*e),Math.sqrt(s*s+i*i)),this.parentToSpace.copy(this.spaceToParent).invert(),this.parent?(this.parent.update(),this.spaceToWorld.multiplyMatrices(this.parent.spaceToWorld,this.spaceToParent),this.worldToSpace.multiplyMatrices(this.parentToSpace,this.parent.worldToSpace),this.lengthScaleToWorld=this.lengthScaleToParent*this.parent.lengthScaleToWorld,this.extentsScaleToWorld.copy(this.extentsScaleToParent).mulV(this.parent.extentsScaleToWorld)):(this.spaceToWorld.copy(this.spaceToParent),this.worldToSpace.copy(this.parentToSpace),this.lengthScaleToWorld=this.lengthScaleToParent,this.extentsScaleToWorld.copy(this.extentsScaleToParent)),this.isDirect=this.spaceToWorld.det()>0,this.clearDirty()}isDirectSpace(){return this.isDirect}getSpaceToParentInto(t){return t.copy(this.spaceToParent),this}getParentToSpaceInto(t){return t.copy(this.parentToSpace),this}getSpaceToWorldInto(t){return t.copy(this.spaceToWorld),this}getWorldToSpaceInto(t){return t.copy(this.worldToSpace),this}getSpaceToWorld(){return this.spaceToWorld}getWorldToSpace(){return this.worldToSpace}getThisToSpaceInto(t,e){return t.copy(this.spaceToWorld),t.multiplyMatrices(e.getWorldToSpace(),t),this}getSpaceToThisInto(t,e){return t.copy(this.worldToSpace),t.multiplyMatrices(t,e.getSpaceToWorld()),this}setFromSpace(t,e,s,i){const n=new V;n.copy(t.getSpaceToWorld()),this.parent&&n.multiplyMatrices(this.parent.getWorldToSpace(),n);const r=s.clone().apply2x3Offset(n),a=i.clone().apply2x3Offset(n),c=e.clone().apply2x3(n);this.spaceToParent.set(r.x,a.x,c.x,r.y,a.y,c.y),this.markDirty(),this.update()}setSpaceToParent(t,e,s,i,n,r){this.spaceToParent.set(t,e,s,i,n,r),this.markDirty(),this.update()}setSpaceToParentMat(t){this.spaceToParent.copy(t),this.markDirty(),this.update()}convertPointInto(t,e,s,i){return t=t.set(e,s),i===this?this:(t.apply2x3(this.spaceToWorld).apply2x3(i.worldToSpace),this)}convertPointIntoV(t,e,s){return this.convertPointInto(t,e.x,e.y,s)}convertOffsetInto(t,e,s,i){return t=t.set(e,s),i===this?this:(t.apply2x3Offset(this.spaceToWorld).apply2x3Offset(i.worldToSpace),this)}convertOffsetIntoV(t,e,s){return this.convertOffsetInto(t,e.x,e.y,s)}convertLength(t,e){return e===this||(t*=this.lengthScaleToWorld,e&&(t/=e.lengthScaleToWorld)),Math.abs(t)}convertExtentsInto(t,e,s,i){return t=t.set(e,s),i===this?this:(t.mulV(this.extentsScaleToWorld),i&&t.divV(i.extentsScaleToWorld),this)}convertExtentsIntoV(t,e,s){return this.convertExtentsInto(t,e.x,e.y,s)}}class ne{svg;worldSpace=new et;viewSpace=new et;viewportSize=new h(640,360);spaces=[];camera;vecPool=[];usedVecs=new Set;tracePoolAllocations=!1;nextElementId;nextUpdateId;constructor(t){this.camera=new se(this),this.spaces.push(this.worldSpace,this.viewSpace),this.nextElementId=0,this.nextUpdateId=0,t.innerHTML="",this.svg=new ie(this,t),this.svg.update();const e=32;for(let s=0;s<e;s++)this.vecPool.push(new h)}acquireVec2(){let t=this.vecPool.pop();return t=t||new h,this.tracePoolAllocations&&this.usedVecs.add(t),t}releaseVec2(t){this.vecPool.push(t),this.tracePoolAllocations&&this.usedVecs.delete(t)}getVecPoolSize(){return this.vecPool.length}getUsedVecCount(){return this.usedVecs.size}getViewportSizeInto(t){return t.set(this.viewportSize.x,this.viewportSize.y),this}getViewportSize(){return this.viewportSize.clone()}getViewportWidth(){return this.viewportSize.x}getViewportHeight(){return this.viewportSize.y}getViewportAspectRatio(){return this.viewportSize.x/this.viewportSize.y}getNextElementId(){return this.nextElementId++}getNextUpdateId(){return this.nextUpdateId++}getCamera(){return this.camera}getWorldSpace(){return this.worldSpace}getViewSpace(){return this.viewSpace}getSVG(){return this.svg}setViewportSize(t,e){return this.viewportSize.set(t,e),this.camera.markDirty(),this.camera.update(),this}setViewportSizeV(t){return this.setViewportSize(t.x,t.y)}createSpace(t=this.worldSpace){const e=new et(t);return this.spaces.push(e),e}detachSpace(t){const e=this.spaces.indexOf(t);return e!==-1&&this.spaces.splice(e,1),this}update(){this.camera.update();for(const t of this.spaces)t.update();return this.svg.update(),this.camera.update(),this}convertDOMPoint(t,e,s){return this.svg.convertDOMPoint(t,e,s)}convertDOMPointInto(t,e,s){this.svg.convertDOMPointInto(t,e,s)}}class re extends I{stroke;opacity=new d(1);transform=new S;startPosition;endPosition;startPadding;endPadding;pathFrom;pathTo;constructor(t){super(),this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.startPosition=new v(0,0,t.getWorldSpace()),this.endPosition=new v(0,0,t.getWorldSpace()),this.startPadding=new T(0,t.getViewSpace()),this.endPadding=new T(0,t.getViewSpace()),this.pathFrom=new d(0),this.pathTo=new d(1)}setOwner(t=null){super.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.startPosition.setOwner(t),this.endPosition.setOwner(t),this.startPadding.setOwner(t),this.endPadding.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.startPosition.clearDirty(),this.endPosition.clearDirty(),this.startPadding.clearDirty(),this.endPadding.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty()}}class ft extends D{element;arrowTips=[];position0;position1;constructor(t){super(t,new re(t)),this.element=document.createElementNS(P,"line"),this.position0=new v(0,0,t.getWorldSpace()),this.position1=new v(0,0,t.getWorldSpace()),this.data.stroke.width.set(2,this.scene.getViewSpace())}createArrowTip(){const t=new rt(this.scene);return t.setParent(this.scene.getSVG()),this.arrowTips.push(t),t.data.pathPosition.set(1),t.setTipableReference(this),this.markDirty(),t}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getTipTransformAtInto(t,e){const s=this.scene.getWorldSpace(),i=this.scene.acquireVec2(),n=this.scene.acquireVec2();return this.data.startPosition.getInto(i,s),this.data.endPosition.getInto(n,s),t.position.copy(i).lerpV(n,e),t.tangent.copy(n).subV(i),t.space=s,t.pathLength=i.distance(n),t.strokeWidth=this.data.stroke.width.get(s),this.scene.releaseVec2(i),this.scene.releaseVec2(n),t}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t=this.scene.getViewSpace();if(l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),this.data.startPosition.isDirty()||this.data.endPosition.isDirty()||this.data.startPadding.isDirty()||this.data.endPadding.isDirty()||this.data.pathFrom.isDirty()||this.data.pathTo.isDirty()){const s=this.scene.acquireVec2(),i=this.scene.acquireVec2(),n=this.scene.acquireVec2(),r=this.scene.acquireVec2();this.data.startPosition.getInto(s,t),this.data.endPosition.getInto(i,t),n.copy(s).lerpV(i,this.data.pathFrom.get()),r.copy(s).lerpV(i,this.data.pathTo.get()),s.copy(n),i.copy(r);const a=s.distance(i),c=this.data.startPadding.get(t),u=this.data.endPadding.get(t);if(a<1e-6||a<c+u)this.position0.setV(s,t),this.position1.setV(s,t);else{const p=h.subV(i,s).normalize();s.addV(p.clone().scale(c)),i.subV(p.clone().scale(u)),this.position0.setV(s,t),this.position1.setV(i,t)}this.scene.releaseVec2(s),this.scene.releaseVec2(i),this.scene.releaseVec2(n),this.scene.releaseVec2(r),l.applyPosition(this.position0,this.element,this.scene,"x1","y1"),l.applyPosition(this.position1,this.element,this.scene,"x2","y2"),this.position0.clearDirty(),this.position1.clearDirty()}for(const s of this.arrowTips)s.data.fill.color.copyIfUnlocked(this.data.stroke.color),s.data.fill.opacity.copyIfUnlocked(this.data.stroke.opacity),s.markDirty(),s.update();this.clearDirty()}}class ae extends D{element;localBBox;svgPosition;constructor(t,e){super(t,e),this.element=document.createElementNS(P,"text"),this.localBBox=new gt(t),this.localBBox.setOwner(this),this.svgPosition=new v(0,0,t.getViewSpace()),this.element.setAttribute("x",this.svgPosition.value.x.toString()),this.element.setAttribute("y",this.svgPosition.value.y.toString())}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.localBBox.markDirty(),this}getContent(){return this.element.textContent||""}getPositionInto(t,e){return this.data.position.getInto(t,e),this}getSVGPositionInto(t,e){return this.svgPosition.getInto(t,e),this}getExtentsInto(t,e){return this.localBBox.getExtentsInto(t,e),this}getCenterInto(t,e){const s=this.scene.acquireVec2(),i=this.scene.acquireVec2();return this.localBBox.getCenterOffsetInto(s,e),this.data.position.getInto(i,e),t.copy(i).addV(s),this.scene.releaseVec2(s),this.scene.releaseVec2(i),this}clearText(){return this.element.replaceChildren(),this.localBBox.markDirty(),this}clearDirty(){super.clearDirty(),this.localBBox.clearDirty()}update(){if(this.skipUpdate())return;l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),l.applyFont(this.data.font,this.element,this.scene),l.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),this.element.setAttribute("text-anchor","middle"),this.data.stroke.width.value>0?this.element.setAttribute("paint-order","stroke"):this.element.removeAttribute("paint-order");const t=this.scene.getViewSpace(),e=this.svgPosition.value;this.svgPosition.space=t;const s=this.localBBox.isDirty()||this.data.font.isDirty()||this.data.preserveWhitespace.isDirty();if(s&&this.localBBox.set(this.element,e,t),s||this.data.position.isDirty()||this.data.localShift.isDirty()||this.data.textAnchor.isDirty()){const n=this.scene.getViewSpace(),r=this.data.textAnchor.get(),a=this.scene.acquireVec2(),c=this.scene.acquireVec2();this.data.position.getInto(e,n),this.localBBox.getExtentsInto(a,n),this.data.localShift.getInto(c,n),e.x+=-r*a.x+c.x,e.y+=c.y,this.element.setAttribute("x",e.x.toString()),this.element.setAttribute("y",e.y.toString()),this.scene.releaseVec2(a),this.scene.releaseVec2(c)}this.clearDirty()}}class he extends ae{constructor(t){super(t,new xt(t))}}class oe extends I{space;position;minExtents;anchor;background;text;padding;constructor(t){super(),this.space=new U(t.getWorldSpace()),this.position=new v(0,0,t.getWorldSpace()),this.anchor=new N(0,0),this.minExtents=new O(0,0,t.getViewSpace()),this.background=new ce(t),this.text=new le(t),this.padding=new O(10,5,t.getViewSpace())}setOwner(t=null){super.setOwner(t),this.space.setOwner(t),this.position.setOwner(t),this.minExtents.setOwner(t),this.anchor.setOwner(t),this.background.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.space.clearDirty(),this.position.clearDirty(),this.minExtents.clearDirty(),this.anchor.clearDirty(),this.background.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class ce extends L{fill;stroke;opacity;transform;cornerRadius;shape;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.cornerRadius=new T(5,t.getViewSpace()),this.shape=new R("rectangle"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.cornerRadius.setOwner(t),this.shape.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.cornerRadius.clearDirty(),this.shape.clearDirty()}}class le extends L{fill;stroke;opacity;transform;font;horizontalAlign;verticalAlign;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.font=new nt(t),this.horizontalAlign=new d(0),this.verticalAlign=new d(0),this.stroke.width.set(0,t.getViewSpace()),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t),this.horizontalAlign.setOwner(t),this.verticalAlign.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty(),this.horizontalAlign.clearDirty(),this.verticalAlign.clearDirty()}}class ue extends I{fill;stroke;opacity;transform;space;position;extents;anchor;cornerRadius;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.space=new U(t.getWorldSpace()),this.position=new v(0,0,t.getWorldSpace()),this.extents=new O(1,1,t.getWorldSpace()),this.anchor=new N(0,0),this.cornerRadius=new T(0,t.getViewSpace()),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.space.setOwner(t),this.position.setOwner(t),this.extents.setOwner(t),this.anchor.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.space.clearDirty(),this.position.clearDirty(),this.extents.clearDirty(),this.anchor.clearDirty(),this.cornerRadius.clearDirty()}}class lt extends D{element;cornerNE0=new h;cornerNE1=new h;cornerNE2=new h;cornerNE3=new h;cornerNW0=new h;cornerNW1=new h;cornerNW2=new h;cornerNW3=new h;cornerSW0=new h;cornerSW1=new h;cornerSW2=new h;cornerSW3=new h;cornerSE0=new h;cornerSE1=new h;cornerSE2=new h;cornerSE3=new h;vecNE=new h;vecNW=new h;vecSE=new h;vecSW=new h;sdfCenter=new h;sdfExtents=new h;sdfRadius=0;constructor(t){super(t,new ue(t)),this.element=document.createElementNS(P,"path")}getExtents(t){return this.data.extents.get(t)}getCornerRadius(t){return this.data.cornerRadius.get(t)}getSVGElement(){return this.element}evaluateSDF(t,e){const s=Math.abs(t-this.sdfCenter.x)-(this.sdfExtents.x-this.sdfRadius),i=Math.abs(e-this.sdfCenter.y)-(this.sdfExtents.y-this.sdfRadius),n=Math.max(s,0),r=Math.max(i,0);return Math.sqrt(n*n+r*r)+Math.min(Math.max(s,i),0)-this.sdfRadius}evaluateSDFV(t){return this.evaluateSDF(t.x,t.y)}updateGeometry(){const t=this.data.space.get(),e=st,s=pe;this.data.position.getInto(e,t),this.data.extents.getInto(s,t),this.data.anchor.getRectPointIntoF(e,e.x,e.y,s.x,s.y,0,0);const i=this.data.cornerRadius.get(t),n=e.x,r=e.y,a=s.x,c=s.y,u=i*.552284749831;this.vecNE.set(n+a,r+c),this.vecNW.set(n-a,r+c),this.vecSW.set(n-a,r-c),this.vecSE.set(n+a,r-c),this.cornerNE0.copy(this.vecNE).add(0,-i),this.cornerNE1.copy(this.vecNE).add(0,-i+u),this.cornerNE2.copy(this.vecNE).add(-i+u,0),this.cornerNE3.copy(this.vecNE).add(-i,0),this.cornerNW0.copy(this.vecNW).add(+i,0),this.cornerNW1.copy(this.vecNW).add(+i-u,0),this.cornerNW2.copy(this.vecNW).add(0,-i+u),this.cornerNW3.copy(this.vecNW).add(0,-i),this.cornerSW0.copy(this.vecSW).add(0,+i),this.cornerSW1.copy(this.vecSW).add(0,+i-u),this.cornerSW2.copy(this.vecSW).add(+i-u,0),this.cornerSW3.copy(this.vecSW).add(+i,0),this.cornerSE0.copy(this.vecSE).add(-i,0),this.cornerSE1.copy(this.vecSE).add(-i+u,0),this.cornerSE2.copy(this.vecSE).add(0,+i-u),this.cornerSE3.copy(this.vecSE).add(0,+i)}updateSVGPath(){const t=this.scene.getViewSpace(),e=this.data.space.get(),s=st;let i="";s.copy(this.cornerNE0),e.convertPointIntoV(s,s,t),i+=`M ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNE1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNE2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNE3),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNW0),e.convertPointIntoV(s,s,t),i+=`L ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNW1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNW2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerNW3),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSW0),e.convertPointIntoV(s,s,t),i+=`L ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSW1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSW2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSW3),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSE0),e.convertPointIntoV(s,s,t),i+=`L ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSE1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSE2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.cornerSE3),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} Z`,this.element.setAttribute("d",i)}updateSDF(){const t=this.data.space.get(),e=st;this.data.position.getInto(e,t),this.data.extents.getInto(this.sdfExtents,t),this.data.anchor.getCenterIntoV(this.sdfCenter,e,this.sdfExtents),this.sdfRadius=this.data.cornerRadius.get(t)}update(){this.skipUpdate()||(l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),this.updateSDF(),this.updateGeometry(),this.updateSVGPath(),this.clearDirty())}}const st=new h,pe=new h;class de extends I{fill;stroke;opacity;transform;space;position;radius;constructor(t){super(),this.fill=new A,this.stroke=new b(t),this.opacity=new d(1),this.transform=new S,this.space=new U(t.getWorldSpace()),this.position=new v(0,0,t.getWorldSpace()),this.radius=new T(1,t.getViewSpace()),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.space.setOwner(t),this.position.setOwner(t),this.radius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.space.clearDirty(),this.position.clearDirty(),this.radius.clearDirty()}}class ut extends D{element;controlE=new h;controlNE1=new h;controlNE2=new h;controlN=new h;controlNW1=new h;controlNW2=new h;controlW=new h;controlSW1=new h;controlSW2=new h;controlS=new h;controlSE1=new h;controlSE2=new h;sdfCenter=new h;sdfRadius=0;constructor(t){super(t,new de(t)),this.element=document.createElementNS(P,"path")}getRadius(t){return this.data.radius.get(t)}getSVGElement(){return this.element}evaluateSDF(t,e){const s=Math.abs(t-this.sdfCenter.x),i=Math.abs(e-this.sdfCenter.y);return Math.sqrt(s*s+i*i)-this.sdfRadius}evaluateSDFV(t){return this.evaluateSDF(t.x,t.y)}updateGeometry(){const t=this.data.space.get(),e=pt;this.data.position.getInto(e,t);const s=this.data.radius.get(t),i=e.x,n=e.y,r=s*.552284749831;this.controlE.set(i+s,n),this.controlW.set(i-s,n),this.controlS.set(i,n-s),this.controlN.set(i,n+s),this.controlNE1.copy(this.controlE).add(0,+r),this.controlNE2.copy(this.controlN).add(+r,0),this.controlNW1.copy(this.controlN).add(-r,0),this.controlNW2.copy(this.controlW).add(0,+r),this.controlSW1.copy(this.controlW).add(0,-r),this.controlSW2.copy(this.controlS).add(-r,0),this.controlSE1.copy(this.controlS).add(+r,0),this.controlSE2.copy(this.controlE).add(0,-r)}updateSVGPath(){const t=this.scene.getViewSpace(),e=this.data.space.get(),s=pt;let i="";s.copy(this.controlE),e.convertPointIntoV(s,s,t),i+=`M ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlNE1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlNE2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlN),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlNW1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlNW2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlW),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlSW1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlSW2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlS),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlSE1),e.convertPointIntoV(s,s,t),i+=`C ${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlSE2),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} `,s.copy(this.controlE),e.convertPointIntoV(s,s,t),i+=`${s.x.toFixed(2)},${s.y.toFixed(2)} Z`,this.element.setAttribute("d",i)}updateSDF(){const t=this.data.space.get();this.data.position.getInto(this.sdfCenter,t),this.sdfRadius=this.data.radius.get(t)}update(){this.skipUpdate()||(l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene),this.updateSDF(),this.updateGeometry(),this.updateSVGPath(),this.clearDirty())}}const pt=new h;class ye{node;center=new h(0,0);radius=0;constructor(t){this.node=t}evaluateSDF(t,e){const s=t-this.center.x,i=e-this.center.y;return Math.sqrt(s*s+i*i)-this.radius}evaluateSDFV(t){return this.evaluateSDF(t.x,t.y)}update(t,e){this.center.copy(t),this.radius=e}getCenterInto(t){t.copy(this.center)}}class ge extends D{element;center;extents;defaultSDF=new ye(this);background=null;edges=[];constructor(t){super(t,new oe(t)),this.element=document.createElementNS(P,"g"),this.extents=new O(0,0,t.getViewSpace()),this.center=new v(0,0,t.getWorldSpace()),this.element.dataset.role="plain-node"}attachEdge(t){return this.edges.push(t),t.markDirty(),this}detachEdge(t){const e=this.edges.indexOf(t);return e===-1?this:(this.edges.splice(e,1),t.markDirty(),this)}getSDF(){return this.background!==null?this.background:this.defaultSDF}getPosition(t){return this.data.position.get(t)}getExtents(t){return this.extents.get(t)}getMinExtents(t){return this.data.minExtents.get(t)}getPadding(t){return this.data.padding.get(t)}getSVGElement(){return this.element}getBackground(){return this.background}getCenterInto(t,e){return this.center.getInto(t,e),this}getPositionInto(t,e){return this.data.position.getInto(t,e),this}getExtentsInto(t,e){return this.extents.getInto(t,e),this}getMinExtentsInto(t,e){return this.data.minExtents.getInto(t,e),this}updateBackground(){if(this.data.background.shape.isDirty()){switch(this.background!==null&&this.background.setParent(null),this.data.background.shape.value){case"rectangle":this.background=new lt(this.scene);break;case"circle":this.background=new ut(this.scene);break;case"none":this.background=null;return}this.background&&(this.background.data.layer.set(0),this.background.setParent(this)),this.updateSVGChildren()}this.background!==null&&(this.background.data.space.set(this.data.space.get()),this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background.data.transform.copyIfUnlocked(this.data.background.transform),this.background instanceof lt?(this.background.data.position.copy(this.center),this.background.data.extents.copy(this.extents),this.background.data.anchor.set(0,0),this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius)):this.background instanceof ut&&(this.background.data.position.copy(this.center),this.extents.getMaxLengthInto(this.background.data.radius)),this.background.update())}updateEdges(){for(const t of this.edges)t.markDirty(),t.update()}}class xe extends ge{text;constructor(t){super(t),this.text=new he(this.scene),this.text.data.layer.set(2),this.text.setParent(this),this.element.dataset.role="plain-node"}setContent(t){return this.text.setContent(t),this}update(){if(this.skipUpdate())return;this.updateSVGChildren();const t=this.data.space.get();this.text.data.font.copyIfUnlocked(this.data.text.font),this.text.data.fill.copyIfUnlocked(this.data.text.fill),this.text.data.opacity.copyIfUnlocked(this.data.text.opacity),this.text.data.stroke.copyIfUnlocked(this.data.text.stroke),this.text.update(),this.extents.space=t;const e=this.extents.value,s=this.scene.acquireVec2(),i=this.scene.acquireVec2(),n=this.scene.acquireVec2();this.text.getExtentsInto(s,t),this.data.padding.getInto(i,t),this.data.minExtents.getInto(e,t),e.max(s.x+i.x,s.y+i.y),n.copy(e).subV(i),this.center.space=t;const r=this.center.value;this.data.position.getInto(r,t),this.data.anchor.getCenterIntoV(r,r,e),this.defaultSDF.update(r,Math.max(e.x,e.y));const a=t.isDirectSpace()?1:-1,c=this.data.text.font,u=c.relativeAscenderHeight.get()*c.size.get(t),p=a*this.data.text.verticalAlign.get(),g=this.data.text.horizontalAlign.get();this.text.data.textAnchor.set(0),this.text.data.position.set(r.x+g*(n.x-s.x),r.y+p*(n.y-s.y)-a*u/2,t),this.text.update(),this.scene.releaseVec2(s),this.scene.releaseVec2(i),this.scene.releaseVec2(n),this.updateBackground(),this.updateEdges(),this.clearDirty()}}class me{x0;y0;x1;y1;constructor(t=0,e=0,s=0,i=0){this.x0=t,this.y0=e,this.x1=s,this.y1=i}setPoints(t,e,s,i){return this.x0=t,this.y0=e,this.x1=s,this.y1=i,this}setPointsV(t,e){return this.x0=t.x,this.y0=t.y,this.x1=e.x,this.y1=e.y,this}setStart(t,e){return this.x0=t,this.y0=e,this}setStartV(t){return this.x0=t.x,this.y0=t.y,this}setEnd(t,e){return this.x1=t,this.y1=e,this}setEndV(t){return this.x1=t.x,this.y1=t.y,this}copy(t){return this.x0=t.x0,this.y0=t.y0,this.x1=t.x1,this.y1=t.y1,this}getPointsIntoV(t,e){return t.set(this.x0,this.y0),e.set(this.x1,this.y1),this}getStartInto(t){return t.set(this.x0,this.y0),this}getEndInto(t){return t.set(this.x1,this.y1),this}getStartTangentInto(t){return t.set(this.x1-this.x0,this.y1-this.y0),this}getEndTangentInto(t){return t.set(this.x1-this.x0,this.y1-this.y0),this}getPointInto(t,e){const s=1-e;return t.set(s*this.x0+e*this.x1,s*this.y0+e*this.y1),this}getTangentInto(t,e){return t.set(this.x1-this.x0,this.y1-this.y0),this}getBoundingBoxInto(t,e){return t.set(Math.min(this.x0,this.x1),Math.min(this.y0,this.y1)),e.set(Math.max(this.x0,this.x1),Math.max(this.y0,this.y1)),this}subdivideLowerInto(t,e){const s=1-e,i=s*this.x0+e*this.x1,n=s*this.y0+e*this.y1;return t.setPoints(this.x0,this.y0,i,n),this}subdivideUpperInto(t,e){const s=1-e,i=s*this.x0+e*this.x1,n=s*this.y0+e*this.y1;return t.setPoints(i,n,this.x1,this.y1),this}subdivideAtInto(t,e,s){const i=1-s,n=i*this.x0+s*this.x1,r=i*this.y0+s*this.y1;return t&&t.setPoints(this.x0,this.y0,n,r),e&&e.setPoints(n,r,this.x1,this.y1),this}subdivideInto(t,e,s){const i=1-e,n=1-s,r=i*this.x0+e*this.x1,a=i*this.y0+e*this.y1,c=n*this.x0+s*this.x1,u=n*this.y0+s*this.y1;return t.setPoints(r,a,c,u),this}}class Q{static evaluateSDF(t,e,s,i){return e.getPointInto(it,i),it.apply2x3(s),t.evaluateSDFV(it)}static findPointAtDistance(t,e,s,i,n,r,a=.01,c=30){let u=this.evaluateSDF(t,e,s,n)-i,p=this.evaluateSDF(t,e,s,r)-i;if(u*p>0)return-1;for(let g=0;g<c;g++){const x=(n+r)/2,y=this.evaluateSDF(t,e,s,x)-i;if(Math.abs(y)<a)return x;u*y<0?(r=x,p=y):(n=x,u=y)}return(n+r)/2}}const it=new h;class wt extends I{stroke;opacity;pathFrom;pathTo;startDistance;endDistance;constructor(t){super();const e=t.getViewSpace();this.stroke=new b(t),this.opacity=new d(1),this.pathFrom=new d(0),this.pathTo=new d(1),this.startDistance=new T(0,e),this.endDistance=new T(0,e),this.stroke.width.set(4,e),this.stroke.color.set(0,0,0,1),this.opacity.set(1)}setOwner(t=null){this.stroke.setOwner(t),this.opacity.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t),this.startDistance.setOwner(t),this.endDistance.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty(),this.startDistance.clearDirty(),this.endDistance.clearDirty()}}class vt extends D{element;start;end;arrowTips=[];constructor(t,e,s,i){super(t,e),this.element=document.createElementNS(P,"g"),this.element.dataset.role="edge",this.start=s,this.end=i}createArrowTip(){const t=new rt(this.scene);return t.setParent(this),t.setTipableReference(this),t.data.pathPosition.set(1),t.data.layer.set(1),this.arrowTips.push(t),this.markDirty(),t}getStart(){return this.start}getEnd(){return this.end}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getSVGElement(){return this.element}updateArrowTips(){for(const t of this.arrowTips)t.data.fill.color.copyIfUnlocked(this.data.stroke.color),t.data.fill.opacity.copyIfUnlocked(this.data.stroke.opacity),t.markDirty(),t.update()}}class fe extends vt{lineCurve;line;constructor(t,e,s){super(t,new wt(t),e,s),this.lineCurve=new me,this.line=new ft(t),this.line.setParent(this)}getTipTransformAtInto(t,e){return this.line.getTipTransformAtInto(t,e)}update(){if(this.skipUpdate())return;this.updateSVGChildren();const t=this.scene.getWorldSpace(),e=this.scene.acquireVec2(),s=this.scene.acquireVec2();this.start.getCenterInto(e,t),this.end.getCenterInto(s,t),this.lineCurve.setPointsV(e,s);const i=this.data.startDistance.get(t),n=this.data.endDistance.get(t);t.getThisToSpaceInto(X,this.start.data.space.get());let r=Q.findPointAtDistance(this.start.getSDF(),this.lineCurve,X,i,0,1);t.getThisToSpaceInto(X,this.end.data.space.get());let a=Q.findPointAtDistance(this.end.getSDF(),this.lineCurve,X,n,0,1);const c=a-r;r+=this.data.pathFrom.get()*c,a-=(1-this.data.pathTo.get())*c,this.lineCurve.subdivideInto(this.lineCurve,r,a),this.lineCurve.getStartInto(e),this.lineCurve.getEndInto(s),this.line.data.startPosition.setV(e,t),this.line.data.endPosition.setV(s,t),a<=r?this.line.data.opacity.set(0):(this.line.data.stroke.copyIfUnlocked(this.data.stroke),this.line.data.opacity.copyIfUnlocked(this.data.opacity),this.line.data.startPadding.set(0),this.line.data.endPadding.set(0)),this.line.update(),this.scene.releaseVec2(e),this.scene.releaseVec2(s),this.updateArrowTips(),this.clearDirty()}}const X=new V;class we{sampleCount;arcLengths;sampleInputValues;length=0;constructor(t=8){this.sampleCount=t,this.arcLengths=new Float32Array(this.sampleCount),this.sampleInputValues=new Float32Array(this.sampleCount)}getLength(){return this.length}getTFromLength(t){if(t<=0)return 0;if(t>=this.length)return 1;const e=this.arcLengths.length-1;let s=0,i=e;for(;s<i;){const n=Math.floor((s+i)/2),r=this.arcLengths[n];if(r<t)s=n+1;else if(r>t)i=n-1;else{s=n;break}}return this.arcLengths[s]>t&&s--,s=w.clamp(s,0,e-1),w.remap(this.arcLengths[s],this.arcLengths[s+1],this.sampleInputValues[s],this.sampleInputValues[s+1],t)}getTFromU(t){return this.getTFromLength(t*this.length)}getUFromT(t){const e=this.arcLengths.length-1;let s=0,i=e;for(;s<i;){const n=Math.floor((s+i)/2),r=this.sampleInputValues[n];if(r<t)s=n+1;else if(r>t)i=n-1;else{s=n;break}}return this.sampleInputValues[s]>t&&s--,s=w.clamp(s,0,e-1),w.remap(this.sampleInputValues[s],this.sampleInputValues[s+1],this.arcLengths[s],this.arcLengths[s+1],t)/this.length}}class ve extends we{curve;constructor(t,e=8){super(e),this.curve=t,this.update()}update(){const t=Se,e=De;this.curve.getPointInto(t,0),this.arcLengths[0]=0,this.sampleInputValues[0]=0;let s=0;for(let i=1;i<this.sampleCount;i++){const n=i/(this.sampleCount-1);this.sampleInputValues[i]=n,this.curve.getPointInto(e,n),s+=t.distance(e),this.arcLengths[i]=s,t.copy(e)}this.length=s}}const Se=new h,De=new h;class ke{x0;y0;x1;y1;x2;y2;x3;y3;constructor(t=0,e=0,s=0,i=0,n=0,r=0,a=0,c=0){this.x0=t,this.y0=e,this.x1=s,this.y1=i,this.x2=n,this.y2=r,this.x3=a,this.y3=c}setControlPoints(t,e,s,i,n,r,a,c){return this.x0=t,this.y0=e,this.x1=s,this.y1=i,this.x2=n,this.y2=r,this.x3=a,this.y3=c,this}setControlPointsV(t,e,s,i){return this.x0=t.x,this.y0=t.y,this.x1=e.x,this.y1=e.y,this.x2=s.x,this.y2=s.y,this.x3=i.x,this.y3=i.y,this}setStart(t,e){return this.x0=t,this.y0=e,this}setStartV(t){return this.x0=t.x,this.y0=t.y,this}setControl1(t,e){return this.x1=t,this.y1=e,this}setControl1V(t){return this.x1=t.x,this.y1=t.y,this}setControl2(t,e){return this.x2=t,this.y2=e,this}setControl2V(t){return this.x2=t.x,this.y2=t.y,this}setEnd(t,e){return this.x3=t,this.y3=e,this}setEndV(t){return this.x3=t.x,this.y3=t.y,this}copy(t){return this.x0=t.x0,this.y0=t.y0,this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this.x3=t.x3,this.y3=t.y3,this}getControlPointsInto(t,e,s,i){return t.set(this.x0,this.y0),e.set(this.x1,this.y1),s.set(this.x2,this.y2),i.set(this.x3,this.y3),this}getStartInto(t){return t.set(this.x0,this.y0),this}getEndInto(t){return t.set(this.x3,this.y3),this}getControl1Into(t){return t.set(this.x1,this.y1),this}getControl2Into(t){return t.set(this.x2,this.y2),this}getStartTangentInto(t){return t.set(this.x1-this.x0,this.y1-this.y0),this}getEndTangentInto(t){return t.set(this.x3-this.x2,this.y3-this.y2),this}getPointInto(t,e){const s=1-e,i=s*s*s,n=s*s*e*3,r=s*e*e*3,a=e*e*e;return t.set(i*this.x0+n*this.x1+r*this.x2+a*this.x3,i*this.y0+n*this.y1+r*this.y2+a*this.y3),this}getTangentInto(t,e){const s=1-e,i=s*s,n=s*e*2,r=e*e;return t.set(i*(this.x1-this.x0)+n*(this.x2-this.x1)+r*(this.x3-this.x2),i*(this.y1-this.y0)+n*(this.y2-this.y1)+r*(this.y3-this.y2)),this}subdivideLowerInto(t,e){const s=this.x0+(this.x1-this.x0)*e,i=this.y0+(this.y1-this.y0)*e,n=this.x1+(this.x2-this.x1)*e,r=this.y1+(this.y2-this.y1)*e,a=this.x2+(this.x3-this.x2)*e,c=this.y2+(this.y3-this.y2)*e,u=s+(n-s)*e,p=i+(r-i)*e,g=n+(a-n)*e,x=r+(c-r)*e,y=u+(g-u)*e,m=p+(x-p)*e;return t.x0=this.x0,t.y0=this.y0,t.x1=s,t.y1=i,t.x2=u,t.y2=p,t.x3=y,t.y3=m,this}subdivideUpperInto(t,e){const s=this.x0+(this.x1-this.x0)*e,i=this.y0+(this.y1-this.y0)*e,n=this.x1+(this.x2-this.x1)*e,r=this.y1+(this.y2-this.y1)*e,a=this.x2+(this.x3-this.x2)*e,c=this.y2+(this.y3-this.y2)*e,u=s+(n-s)*e,p=i+(r-i)*e,g=n+(a-n)*e,x=r+(c-r)*e,y=u+(g-u)*e,m=p+(x-p)*e;return t.x0=y,t.y0=m,t.x1=g,t.y1=x,t.x2=a,t.y2=c,t.x3=this.x3,t.y3=this.y3,this}subdivideAtInto(t,e,s){const i=this.x0+(this.x1-this.x0)*s,n=this.y0+(this.y1-this.y0)*s,r=this.x1+(this.x2-this.x1)*s,a=this.y1+(this.y2-this.y1)*s,c=this.x2+(this.x3-this.x2)*s,u=this.y2+(this.y3-this.y2)*s,p=i+(r-i)*s,g=n+(a-n)*s,x=r+(c-r)*s,y=a+(u-a)*s,m=p+(x-p)*s,k=g+(y-g)*s;return t&&(t.x0=this.x0,t.y0=this.y0,t.x1=i,t.y1=n,t.x2=p,t.y2=g,t.x3=m,t.y3=k),e&&(e.x0=m,e.y0=k,e.x1=x,e.y1=y,e.x2=c,e.y2=u,e.x3=this.x3,e.y3=this.y3),this}subdivideInto(t,e,s){return this.subdivideLowerInto(t,s),t.subdivideUpperInto(t,e/s),this}getBezierPointInto(t,e){switch(e){case 0:t.set(this.x0,this.y0);break;case 1:t.set(this.x1,this.y1);break;case 2:t.set(this.x2,this.y2);break;default:case 3:t.set(this.x3,this.y3);break}return this}getBoundingBoxInto(t,e){return t.set(Math.min(this.x0,this.x1,this.x2,this.x3),Math.min(this.y0,this.y1,this.y2,this.y3)),e.set(Math.max(this.x0,this.x1,this.x2,this.x3),Math.max(this.y0,this.y1,this.y2,this.y3)),this}controlPointsFlatness(){const t=this.x3-this.x0,e=this.y3-this.y0,s=Math.max(Math.hypot(t,e),1e-12),i=Math.abs(t*(this.y0-this.y1)-(this.x0-this.x1)*e)/s,n=Math.abs(t*(this.y0-this.y2)-(this.x0-this.x2)*e)/s;return Math.max(i,n)}}class Ve extends I{fill;stroke;opacity;transform;path;constructor(t){super(),this.stroke=new b(t),this.opacity=new d(1),this.fill=new A,this.transform=new S,this.path=new Z}setOwner(t=null){super.setOwner(t),this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.path.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.path.clearDirty()}}class Pe extends D{element;constructor(t){super(t,new Ve(t)),this.element=document.createElementNS(P,"path")}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;l.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),l.applyFill(this.data.fill,this.element,this.scene),l.applyStroke(this.data.stroke,this.element,this.scene),l.applyOpacity(this.data.opacity,this.element,this.scene),l.applyTransform(this.data.transform,this.element,this.scene);const t=this.data.path.get();this.element.setAttribute("d",t.trim()),this.clearDirty()}}class Te extends wt{startAngle;endAngle;bendAngle;startTension;endTension;constructor(t){super(t),this.startAngle=new d(-1/0),this.endAngle=new d(-1/0),this.startTension=new d(.3),this.endTension=new d(.3),this.bendAngle=new d(0)}setOwner(t=null){super.setOwner(t),this.startAngle.setOwner(t),this.endAngle.setOwner(t),this.startTension.setOwner(t),this.endTension.setOwner(t),this.bendAngle.setOwner(t)}clearDirty(){super.clearDirty(),this.startAngle.clearDirty(),this.endAngle.clearDirty(),this.startTension.clearDirty(),this.endTension.clearDirty(),this.bendAngle.clearDirty()}}class Ie extends vt{curve;lengthMapper;path;constructor(t,e,s){super(t,new Te(t),e,s),this.curve=new ke,this.path=new Pe(t),this.lengthMapper=new ve(this.curve),this.path.setParent(this),e.attachEdge(this),s.attachEdge(this)}getTipTransformAtInto(t,e){const s=this.scene.getWorldSpace();return e=this.lengthMapper.getTFromU(e),t.space=s,t.pathLength=this.lengthMapper.getLength(),t.strokeWidth=this.data.stroke.width.get(s),this.curve.getPointInto(t.position,e),this.curve.getTangentInto(t.tangent,e),t}updateCurve(){const t=this.scene.getWorldSpace(),e=this.scene.acquireVec2(),s=this.scene.acquireVec2(),i=this.scene.acquireVec2(),n=this.scene.acquireVec2();this.start.getCenterInto(e,t),this.end.getCenterInto(n,t);const r=e.distance(n);s.copy(n).subV(e),s.scale(1/r),i.copy(s).negate(),this.data.startAngle.get()!==-1/0&&s.setPolar(this.data.startAngle.get(),1,"deg"),this.data.endAngle.get()!==-1/0&&i.setPolar(this.data.endAngle.get(),1,"deg");const a=this.data.bendAngle.get()!==-1/0?this.data.bendAngle.get():0;s.rotate(-a,"deg"),i.rotate(+a,"deg"),s.scale(this.data.startTension.get()*r).addV(e),i.scale(this.data.endTension.get()*r).addV(n),this.curve.setControlPointsV(e,s,i,n),this.scene.releaseVec2(e),this.scene.releaseVec2(s),this.scene.releaseVec2(i),this.scene.releaseVec2(n);const c=this.start.getSDF(),u=this.end.getSDF(),p=this.start.data.space.get(),g=this.end.data.space.get(),x=this.data.startDistance.get(p),y=this.data.endDistance.get(g);t.getThisToSpaceInto(Y,p);let m=Q.findPointAtDistance(c,this.curve,Y,x,0,1);t.getThisToSpaceInto(Y,g);let k=Q.findPointAtDistance(u,this.curve,Y,y,0,1);const E=k-m;m+=this.data.pathFrom.get()*E,k-=(1-this.data.pathTo.get())*E,this.curve.subdivideInto(this.curve,m,k),this.lengthMapper.update()}updatePath(){const t=this.scene.getWorldSpace(),e=this.scene.getViewSpace(),s=this.curve,i=this.scene.acquireVec2();let n="";i.set(s.x0,s.y0),t.convertPointIntoV(i,i,e),n+=`M ${i.x.toFixed(2)},${i.y.toFixed(2)} `,i.set(s.x1,s.y1),t.convertPointIntoV(i,i,e),n+=`C ${i.x.toFixed(2)},${i.y.toFixed(2)} `,i.set(s.x2,s.y2),t.convertPointIntoV(i,i,e),n+=`${i.x.toFixed(2)},${i.y.toFixed(2)} `,i.set(s.x3,s.y3),t.convertPointIntoV(i,i,e),n+=`${i.x.toFixed(2)},${i.y.toFixed(2)} `,this.scene.releaseVec2(i),this.path.data.path.set(n),this.path.data.stroke.copyIfUnlocked(this.data.stroke),this.path.data.opacity.copyIfUnlocked(this.data.opacity),this.path.data.fill.opacity.set(0),this.path.update()}update(){this.skipUpdate()||(this.updateSVGChildren(),this.updateCurve(),this.updatePath(),this.updateArrowTips(),this.clearDirty())}}const Y=new V;class Ee extends ne{constructor(t){super(t)}addCircle(t=this.svg){const e=new Vt(this);return e.setParent(t),e}addRect(t=this.svg){const e=new Tt(this);return e.setParent(t),e}addFillRect(t=this.svg){const e=new te(this);return e.setParent(t),e}addGrid(t=this.svg){const e=new at(this);return e.setParent(t),e}addWorldGrid(t=this.svg){const e=new at(this),s=e.data;return s.stroke.width.set(1,this.getViewSpace()),s.geometry.boundA.set(0,0,this.getViewSpace()),s.geometry.boundB.set(this.getViewportWidth(),this.getViewportHeight(),this.getViewSpace()),s.geometry.referencePoint.set(0,0,this.getWorldSpace()),s.geometry.steps.set(1,1,this.getWorldSpace()),s.geometry.space.set(this.getWorldSpace()),e.update(),e.setParent(t),e}addText(t=this.svg){const e=new Mt(this);return e.setParent(t),e}addPlainNode(t=this.svg){const e=new xe(this);return e.setParent(t),e}addPath(t=this.svg){const e=new Kt(this);return e.setParent(t),e}addGroup(t,e=this.svg){const s=new ee(this,t);return s.setParent(e),s}addLine(t=this.svg){const e=new ft(this);return e.setParent(t),e}addLineEdge(t,e,s=this.svg){const i=new fe(this,t,e);return i.setParent(s),i}addCubicEdge(t,e,s=this.svg){const i=new Ie(this,t,e);return i.setParent(s),i}}class Fe{scene;cycleIndex=0;cycleCount=1;cycleDuration=0;rawCycleAlpha=0;rawElapsed=0;rawDuration=0;wrapedCycleAlpha=0;wrapedCycleElapsed=0;ease=mt.linear;reversed=!1;alternate=!1;properties;constructor(t){this.scene=t,this.properties=new Set}getScene(){return this.scene}getProperties(){return this.properties}getElapsed(){return this.rawElapsed}getDuration(){return this.rawDuration}getCycleDuration(){return this.cycleDuration}getCycleIndex(){return this.cycleIndex}getCycleCount(){return this.cycleCount}setCycleCount(t){return this.cycleCount=t,this.updateRawDuration(),this}setEasing(t){return this.ease=t,this}setReversed(t=!0){return this.reversed=t,this}setAlternate(t=!0){return this.alternate=t,this}setElapsed(t){this.setRawElapsed(t);for(const e of this.properties)this.setElapsedPropertyImpl(e);return this}setElapsedProperty(t,e){return this.setRawElapsed(e),this.setElapsedPropertyImpl(t),this}updateRawDuration(){this.rawDuration=this.cycleDuration*(this.cycleCount<0?1:this.cycleCount)}setRawElapsed(t){this.rawElapsed!==t&&(this.rawElapsed=t,this.cycleIndex=w.clamp(Math.floor(this.rawElapsed/this.cycleDuration),0,this.cycleCount-1),t>=this.cycleCount*this.cycleDuration?this.rawCycleAlpha=1:this.rawCycleAlpha=this.rawElapsed%this.cycleDuration/this.cycleDuration,this.wrapedCycleAlpha=this.reversed?1-this.rawCycleAlpha:this.rawCycleAlpha,this.alternate&&this.cycleIndex%2===1&&(this.wrapedCycleAlpha=1-this.wrapedCycleAlpha),this.wrapedCycleAlpha=this.ease(this.wrapedCycleAlpha),this.wrapedCycleElapsed=w.clamp(this.wrapedCycleAlpha,0,1)*this.cycleDuration)}}class be{currentTime=0;delta=0;unscaledDelta=0;scale=1;maxDelta=200;elapsed=0;unscaledElapsed=0;start(t){return this.currentTime=t,this.delta=0,this}update(t){const e=t-this.currentTime;return this.unscaledDelta=Math.min(e,this.maxDelta),this.delta=this.unscaledDelta*this.scale,this.currentTime=t,this.unscaledElapsed+=this.unscaledDelta,this.elapsed+=this.delta,this}setMaximumDeltaTime(t){return this.maxDelta=t,this}setTimeScale(t){return this.scale=t,this}getTimeScale(){return this.scale}getDelta(){return this.delta}getUnscaledDelta(){return this.unscaledDelta}getElapsed(){return this.elapsed}getUnscaledElapsed(){return this.unscaledElapsed}}class F{static _instance=null;timer;activeAnimations=new Set;sceneToUpdate=new Set;constructor(){this.timer=new be}static getInstance(){if(!F._instance){const t=new F;requestAnimationFrame(t.onFirstFrame),requestAnimationFrame(t.onUpdate),F._instance=t}return F._instance}static addAnimation(t){F.getInstance().activeAnimations.add(t)}static removeAnimation(t){F.getInstance().activeAnimations.delete(t)}static requestUpdate(t){F.getInstance().sceneToUpdate.add(t)}addAnimation(t){return this.activeAnimations.add(t),this}removeAnimation(t){return this.activeAnimations.delete(t),this}wakeUp(){return requestAnimationFrame(this.onUpdate),this}onFirstFrame=t=>{this.timer.start(t)};onUpdate=t=>{this.timer.update(t);const e=this.timer.getDelta();for(const s of this.activeAnimations)s.update(e);for(const s of this.sceneToUpdate)s.update();this.sceneToUpdate.clear(),requestAnimationFrame(this.onUpdate)}}class Ce{animation;state;repeat=!1;speed=1;playFrom;playTo;constructor(t){this.animation=t,this.playFrom=0,this.playTo=this.animation.getDuration(),this.state="stopped"}setRange(t,e){return this.playFrom=Math.max(0,t),this.playTo=Math.min(e,this.animation.getDuration()),this}getAnimation(){return this.animation}setSpeed(t){return this.speed=t,this}getSpeed(){return this.speed}setElapsed(t){return this.animation.setElapsed(t),this}getElapsed(){return this.animation.getElapsed()}isPlaying(){return this.state==="playing"}isPaused(){return this.state==="paused"}isStopped(){return this.state==="stopped"}play(t=!1){return this.state="playing",this.animation.setElapsed(this.playFrom),F.addAnimation(this),this.repeat=t,this}pause(){return this.state="paused",F.removeAnimation(this),this}stop(){return this.state="stopped",F.removeAnimation(this),this}resume(){return this.state="playing",F.addAnimation(this),this}update(t){if(this.state!=="playing")return this;const e=this.animation.getElapsed()+t*this.speed,s=this.playTo-this.playFrom;if(e>=this.playTo)if(this.repeat){const i=(e-this.playFrom)%s;this.animation.setElapsed(i+this.playFrom)}else this.animation.setElapsed(this.playTo),this.stop();else e<this.playFrom?(this.animation.setElapsed(this.playFrom),this.stop()):this.animation.setElapsed(e);return F.requestUpdate(this.animation.getScene()),this}}export{xt as A,Ie as B,Vt as C,Ce as D,R as E,z as F,F as G,U as H,Fe as I,V as J,at as K,w as S,Ee as a,h as b,nt as c,he as d,Mt as e,mt as f,I as g,fe as h,xe as i,f as j,v as k,N as l,O as m,T as n,L as o,A as p,b as q,d as r,q as s,ft as t,Tt as u,D as v,P as w,l as x,S as y,At as z};
