import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as I,j as u,b as S,S as C,f,u as w,C as D,t as F}from"./s2-playable-Bdq8E5_G.js";import{S as y,b as v}from"./s2-step-animator-B7uTbjFC.js";import{S as E}from"./s2-lerp-anim-CJb7usyt.js";import{S as A}from"./s2-color-theme-C5HLvbcQ.js";import{c as b,a as P,b as W,s as T,l as z}from"./radix-colors-dark-TbHFpvSs.js";class ${vertices=new Map;adjacency=new Map;addVertex(t,e){if(this.vertices.has(t))throw new Error(`Vertex ${t} already exists`);this.vertices.set(t,e),this.adjacency.set(t,[])}setEdge(t,e,s){if(!this.vertices.has(t)||!this.vertices.has(e))throw new Error("Vertex does not exist");const a=this.adjacency.get(t),i=a.find(r=>r.to===e);i?i.data=s:a.push({to:e,data:s})}removeEdge(t,e){const s=this.adjacency.get(t);if(s){const a=s.findIndex(i=>i.to===e);a!==-1&&s.splice(a,1)}}removeEdgesFrom(t){const e=this.adjacency.get(t);e&&(e.length=0)}clearEdges(){for(const t of this.adjacency.values())t.length=0}hasEdge(t,e){return this.adjacency.get(t)?.some(s=>s.to===e)??!1}edgesOf(t){return this.adjacency.get(t)??[]}getVertices(){return[...this.vertices.keys()]}getVertex(t){const e=this.vertices.get(t);if(!e)throw new Error(`Vertex ${t} does not exist`);return e}}let k;k={back:T,main:b,secondary:z,wall:T,blue:W,red:P,cyan:b};const d=new A(k);class B{input=[];output=[];enqueue(t){this.input.push(t)}dequeue(){if(this.output.length===0)for(;this.input.length>0;)this.output.push(this.input.pop());return this.output.pop()}get length(){return this.input.length+this.output.length}}class O{isWall=!1;visited=!1;prevId=null;depth=-1;cell;cellEmph;circle;lineToPrev;constructor(t){this.cell=new w(t),this.cell.setParent(t.getSVG()),this.cellEmph=new w(t),this.cellEmph.setParent(t.getSVG()),this.circle=new D(t),this.circle.setParent(t.getSVG()),this.circle.data.isEnabled.set(!1),this.lineToPrev=new F(t),this.lineToPrev.setParent(t.getSVG()),this.lineToPrev.data.isEnabled.set(!1)}}class R extends I{animator;graph;size=10;mode="search";traversal="dfs";startI=0;startJ=0;cellWidth;stepByStep=!1;showHelperGrid=!1;color0=new u;color1=new u;strokeColor0=new u;strokeColor1=new u;treeColor0=new u;treeColor1=new u;directionOrder=["U","D","L","R"];directionVectors={U:[-1,0],D:[1,0],L:[0,-1],R:[0,1]};constructor(t){super(t),this.camera.setExtents(8,4.5),this.setViewportSize(640*1.5,360*1.5),this.tracePoolAllocations=!0,this.animator=new y(this);const e=this.getViewSpace(),s=this.getWorldSpace();if(this.color0.setFromTheme(d,"main",4),this.color1.setFromTheme(d,"secondary",4),this.strokeColor0.setFromTheme(d,"main",9),this.strokeColor1.setFromTheme(d,"secondary",9),this.treeColor0.setFromTheme(d,"main",12),this.treeColor1.setFromTheme(d,"secondary",12),console.log("view",e),console.log("world",s),this.addFillRect().data.color.setFromTheme(d,"back",2),this.showHelperGrid){const c=this.addWorldGrid();c.data.stroke.color.setFromTheme(d,"back",4),c.data.stroke.width.set(2,e),c.data.geometry.boundA.set(-8,-4.5,s),c.data.geometry.boundB.set(8,4.5,s),c.data.geometry.space.set(s)}const o=(8-.1*(this.size-1))/this.size;this.cellWidth=o;const n=new $;this.graph=n;for(let c=0;c<this.size;c++)for(let l=0;l<this.size;l++){const p=new O(this);p.cell.getSVGElement().addEventListener("pointerdown",h=>{this.onClick(c,l)},{passive:!1}),n.addVertex(`${c},${l}`,p)}this.createRandomWalls(),this.createEdges(),this.initializeGraphCells(),this.update(),this.createAnimation(),this.animator.playMaster(),this.animator.pause()}onClick(t,e){const s=this.graph.getVertex(`${t},${e}`);switch(this.mode){case"wall":if(t==this.startI&&e==this.startJ)return;s.isWall=!s.isWall,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update();break;case"search":if(s.isWall)return;if(t==this.startI&&e==this.startJ){this.animator.playMaster();return}this.startI=t,this.startJ=e,this.createAnimation(),this.animator.playMaster();break}}createRandomWalls(){for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const a=Math.random()<.2;this.graph.getVertex(`${e},${s}`).isWall=a}this.graph.getVertex(`${this.startI},${this.startJ}`).isWall=!1}initializeGraphCells(){const t=this.getViewSpace(),e=this.getWorldSpace(),s=8,a=.1,i=(s-a*(this.size-1))/this.size,r=i+a;this.cellWidth=i;const o=new S(-s/2,-s/2);for(let n=0;n<this.size;n++)for(let c=0;c<this.size;c++){const l=this.graph.getVertex(`${n},${c}`);l.visited=!1,l.prevId=null,l.depth=-1;const p=new S(o.x+c*r+i/2,o.y+(this.size-1-n)*r+i/2),h=l.cell;h.data.layer.set(1),h.data.extents.set(i/2,i/2,e),h.data.position.setV(p,e),h.data.anchor.set(0,0),h.data.pointerEvents.set("auto");const m=l.cellEmph;m.data.layer.set(2),m.data.extents.set(1,1,t),m.data.position.setV(p,e),m.data.anchor.set(0,0),m.data.opacity.set(0)}}setInitialStyle(){const t=this.getViewSpace();for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const a=this.graph.getVertex(`${e},${s}`);a.visited=!1,a.prevId=null,a.depth=-1;const i=a.cell;i.data.layer.set(1),i.data.fill.color.setFromTheme(d,"back",1),i.data.stroke.color.setFromTheme(d,"back",5),i.data.stroke.width.set(2,t),i.data.pointerEvents.set("auto");const r=a.cellEmph;r.data.layer.set(2),r.data.opacity.set(1),r.data.fill.color.setFromTheme(d,"main",1),r.data.stroke.color.setFromTheme(d,"main",5),r.data.stroke.width.set(2,t),r.data.opacity.set(0),a.isWall&&(i.data.fill.color.setFromTheme(d,"wall",10),i.data.stroke.color.setFromTheme(d,"wall",10))}}createEdges(){this.graph.clearEdges();for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)for(let s=0;s<this.directionOrder.length;s++){let a=s;this.traversal==="dfs"&&(a=this.directionOrder.length-1-s);const i=this.directionOrder[a],r=this.directionVectors[i],o=t+r[0],n=e+r[1];o<0||o>=this.size||n<0||n>=this.size||this.graph.getVertex(`${o},${n}`).isWall||this.graph.setEdge(`${t},${e}`,`${o},${n}`,{})}}createAnimation(){switch(this.traversal){case"bfs":this.createBFSAnimation();break;case"dfs":this.createDFSAnimation();break}}createBFSAnimation(){const t=`${this.startI},${this.startJ}`;this.animator.stop(),this.animator.reset(),this.animator=new y(this),this.setInitialStyle();const e=new B,s=2*this.size;e.enqueue(t),this.graph.getVertex(t).depth=0,this.graph.getVertex(t).visited=!0;let a=0,i=50,r=500;this.stepByStep&&(i=300,r=300);const o=this.graph.getVertex(t);for(o.depth=0,o.visited=!0;e.length>0;){const n=e.dequeue(),c=this.graph.getVertex(n),l=n===t;this.animateVisitVertex(c,l,s,a,r,i),this.stepByStep&&this.animator.makeStep(),a+=i;for(const p of this.graph.edgesOf(n)){const h=p.to,m=this.graph.getVertex(h);m.visited||(e.enqueue(h),m.prevId=n,m.depth=c.depth+1,m.visited=!0)}}this.animator.finalize(),this.animator.setMasterElapsed(0),this.update()}createDFSAnimation(){const t=`${this.startI},${this.startJ}`;this.animator.stop(),this.animator.reset(),this.animator=new y(this),this.setInitialStyle();const e=[],s=.5*this.size*this.size-1;e.push(t),this.graph.getVertex(t).depth=0;let a=0,i=50,r=500;for(this.stepByStep&&(i=300,r=300);e.length>0;){const o=e.pop(),n=this.graph.getVertex(o);if(n.visited)continue;n.visited=!0;const c=o===t;this.animateVisitVertex(n,c,s,a,r,i),this.stepByStep&&this.animator.makeStep(),a+=i;for(const l of this.graph.edgesOf(o)){const p=l.to,h=this.graph.getVertex(p);h.visited||(e.push(p),h.prevId=o,h.depth=n.depth+1)}}this.animator.finalize(),this.animator.setMasterElapsed(0),this.update()}animateVisitVertex(t,e,s,a,i,r){const o=C.clamp01(t.depth/s);e?t.circle.data.fill.color.setFromTheme(d,"back",12):t.circle.data.fill.color.lerp(this.treeColor0,this.treeColor1,o),t.circle.data.isEnabled.set(!0),t.circle.data.layer.set(4),t.circle.data.position.copy(t.cell.data.position),t.circle.data.radius.set(1,this.getViewSpace()),t.circle.data.opacity.set(0);const n=E.create(this,t.circle.data.radius).setCycleDuration(i).setEasing(f.out);e?t.circle.data.radius.set(this.cellWidth/4,this.getWorldSpace()):t.circle.data.radius.set(5,this.getViewSpace()),this.animator.addAnimation(n.commitFinalState(),"timeline-start",a);const c=new v(t.circle.data.opacity,0);this.animator.addTrigger(c,"timeline-start",0);const l=new v(t.circle.data.opacity,1);this.animator.addTrigger(l,"timeline-start",a+1),t.cellEmph.data.fill.color.lerp(this.color0,this.color1,o),t.cellEmph.data.stroke.color.lerp(this.strokeColor0,this.strokeColor1,o);const p=E.create(this,t.cellEmph.data.opacity).setCycleDuration(i).setEasing(f.out);t.cellEmph.data.opacity.set(1),this.animator.addAnimation(p.commitFinalState(),"timeline-start",a);const h=E.create(this,t.cellEmph.data.extents).setCycleDuration(i).setEasing(f.out);if(t.cellEmph.data.extents.set(this.cellWidth/2,this.cellWidth/2,this.getWorldSpace()),this.animator.addAnimation(h.commitFinalState(),"timeline-start",a),t.prevId!==null){const m=this.graph.getVertex(t.prevId);t.lineToPrev.data.isEnabled.set(!0),t.lineToPrev.data.layer.set(3),t.lineToPrev.data.startPosition.copy(m.cell.data.position),t.lineToPrev.data.endPosition.copy(t.cell.data.position),t.lineToPrev.data.stroke.color.setFromTheme(d,"back",12),t.lineToPrev.data.stroke.width.set(3,this.getViewSpace()),t.lineToPrev.data.pathFrom.set(0),t.lineToPrev.data.pathTo.set(0),t.lineToPrev.data.opacity.set(0),t.lineToPrev.data.stroke.color.lerp(this.treeColor0,this.treeColor1,o);const x=new v(t.lineToPrev.data.opacity,0);this.animator.addTrigger(x,"timeline-start",0);const L=new v(t.lineToPrev.data.opacity,1);this.animator.addTrigger(L,"timeline-start",a);const M=E.create(this,t.lineToPrev.data.pathTo).setCycleDuration(r).setEasing(f.linear);t.lineToPrev.data.pathTo.set(1),this.animator.addAnimation(M.commitFinalState(),"timeline-start",a)}}setDirectionOrder(t){if(t.length!==4)throw new Error("Direction order must have exactly 4 elements.");this.directionOrder=t,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setStepByStep(t){this.stepByStep=t,this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setMode(t){this.mode=t}setTraversal(t){this.traversal=t,this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}}class G{container;scene;stepIndex=-1;constructor(t,e){this.container=t,this.scene=e}init(){this.container.classList.add("graph-search-controls"),this.container.append(this.createTraversalCard(),this.createDirectionOrderCard(),this.createInteractionModeCard(),this.createAnimationModeCard())}createTraversalCard(){const t=this.createCard("Type de parcours","Choisit la stratégie d’exploration du graphe."),e=this.createRadio("traversal","dfs","DFS",!0),s=this.createRadio("traversal","bfs","BFS",!1);return s.input.addEventListener("change",()=>{this.scene.setTraversal("bfs")}),e.input.addEventListener("change",()=>{this.scene.setTraversal("dfs")}),t.body.append(e.label,s.label),t.root}createDirectionOrderCard(){const t=this.createCard("Ordre des voisins","Définit l’ordre dans lequel les voisins sont explorés."),e=document.createElement("ul");e.className="dir-list";const s=[{dir:"U",icon:"fa-up-long"},{dir:"D",icon:"fa-down-long"},{dir:"L",icon:"fa-left-long"},{dir:"R",icon:"fa-right-long"}];let a=null;for(const i of s){const r=document.createElement("li");r.draggable=!0,r.dataset.dir=i.dir;const o=document.createElement("i");o.classList.add("fa-solid",i.icon),r.append(o),r.addEventListener("dragstart",()=>{a=r,r.classList.add("dragging")}),r.addEventListener("dragend",()=>{a=null,r.classList.remove("dragging")}),r.addEventListener("dragover",n=>{if(n.preventDefault(),!a||a===r)return;n.target.classList.add("over")}),r.addEventListener("dragleave",n=>{if(n.preventDefault(),!a||a===r)return;n.target.classList.remove("over")}),r.addEventListener("drop",n=>{n.preventDefault(),!(!a||a===r)&&r.classList.remove("over")}),e.appendChild(r)}return e.addEventListener("drop",i=>{i.preventDefault();const r=i.target;if(!a||r===a||r.tagName!=="LI")return;r.classList.remove("over");const o=a.getBoundingClientRect();i.clientX-o.x<0?e.insertBefore(a,r):e.insertBefore(a,r.nextSibling);const c=Array.from(e.children).map(l=>l.dataset.dir);this.scene.setDirectionOrder(c)}),t.body.appendChild(e),t.root}createInteractionModeCard(){const t=this.createCard("Interaction","Choisit ce que fait un clic sur la grille."),e=document.createElement("select");return e.innerHTML=`
            <option value="search">Choisir le départ</option>
            <option value="wall">Modifier les murs</option>
        `,e.addEventListener("change",()=>{this.scene.animator.stop();const s=e.value;this.scene.setMode(s)}),t.body.appendChild(e),t.root}createAnimationModeCard(){const t=this.createCard("Animation","Contrôle la vitesse de l’animation.");let e=!1;const s=document.createElement("input");s.type="checkbox";const a=document.createElement("label");a.append(s,document.createTextNode(" Pas à pas"));const i=document.createElement("div");i.className="playback-controls";const r=document.createElement("button");r.innerHTML='<i class="fa-solid fa-stop"></i>',r.classList.add("anim-button");const o=document.createElement("button");o.innerHTML='<i class="fa-solid fa-play"></i>',o.classList.add("anim-button");const n=document.createElement("button");n.innerHTML='<i class="fa-solid fa-step-forward"></i>',n.disabled=!0,n.classList.add("anim-button");const c=document.createElement("button");return c.innerHTML='<i class="fa-solid fa-step-backward"></i>',c.disabled=!0,c.classList.add("anim-button"),r.addEventListener("click",()=>{console.log("stop"),o.innerHTML='<i class="fa-solid fa-play"></i>',this.stepIndex=-1,this.scene.animator.stop(),this.scene.animator.setRangeAsMaster(),this.scene.animator.setMasterElapsed(0),this.scene.update(),e=!1}),o.addEventListener("click",()=>{console.log("play/pause"),e?(this.scene.animator.pause(),o.innerHTML='<i class="fa-solid fa-play"></i>'):(this.scene.animator.setRangeAsMaster(),this.scene.animator.getElapsed()>=this.scene.animator.getMasterDuration()&&this.scene.animator.setMasterElapsed(0),this.scene.animator.resume(),o.innerHTML='<i class="fa-solid fa-pause"></i>'),e=!e}),n.addEventListener("click",()=>{o.innerHTML='<i class="fa-solid fa-play"></i>';const l=this.scene.animator.getElapsed();l<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(l-1),this.stepIndex=C.clamp(this.stepIndex+1,0,this.scene.animator.getStepCount()-1),this.scene.animator.setRangeAsStep(this.stepIndex),this.scene.animator.resetStep(this.stepIndex),this.scene.animator.resume()}),c.addEventListener("click",()=>{o.innerHTML='<i class="fa-solid fa-play"></i>';const l=this.scene.animator.getElapsed();l<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(l-1),this.scene.animator.resetStep(this.stepIndex),this.scene.update()}),s.addEventListener("change",()=>{this.scene.setStepByStep(s.checked),s.checked?(n.disabled=!1,c.disabled=!1):(n.disabled=!0,c.disabled=!0)}),i.append(o,r,c,n),t.body.append(a,i),t.root}createCard(t,e){const s=document.createElement("div");s.className="ui-card";const a=document.createElement("h3");a.textContent=t;const i=document.createElement("p");i.textContent=e;const r=document.createElement("div");return r.className="ui-card-body",s.append(a,i,r),{root:s,body:r}}createRadio(t,e,s,a=!1){const i=document.createElement("input");i.type="radio",i.name=t,i.value=e,i.checked=a;const r=document.createElement("label");return r.append(i,document.createTextNode(" "+s)),{input:i,label:r}}}class N{container;scene;index=-1;constructor(t,e){this.container=t,this.scene=e}init(){this.container.classList.add("graph-search-navigation"),this.container.append(this.createSlider())}createSlider(){const t=document.createElement("input");return t.type="range",t.style.width="50%",t.addEventListener("input",()=>{const s=t.valueAsNumber/100*this.scene.animator.getMasterDuration();this.scene.animator.stop(),this.scene.animator.setMasterElapsed(s),this.index=this.scene.animator.getStepIndexFromElapsed(s),this.scene.getSVG().update()}),t}}class j{scene;controls;navigation;constructor(t){const e=document.createElement("div");e.className="controls";const s=document.createElement("div");s.className="figure";const a=document.createElement("div");a.className="navigation";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("responsive-svg"),i.setAttribute("preserveAspectRatio","xMidYMid meet"),s.appendChild(i),t.append(e,s,a),this.scene=new R(i),this.controls=new G(e,this.scene),this.controls.init(),this.navigation=new N(a,this.scene),this.navigation.init()}}const V=document.getElementById("graph-search-figure");if(!V)throw new Error("Figure container not found");new j(V);
