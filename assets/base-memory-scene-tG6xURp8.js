import{k as M,l as x,m as U,n as D,o as C,p as L,q as R,r as V,s as P,d as I,t as B,u as N,g as S,v as F,w as A,S as h,i as d,j as m,x as H,y as W,z as T,c as G,M as y,f as Y}from"./s2-lerp-anim-Del0poW1.js";import{a as O,S as _}from"./s2-step-animator-CFLkTpzR.js";class z extends M{position;anchor;extents;valueWidth;background;highlight;text;padding;constructor(){super(),this.position=new x(0,0,"world"),this.anchor=new U("center"),this.extents=new D(0,0,"view"),this.valueWidth=new C(2,"world"),this.background=new Z,this.highlight=new j,this.text=new q,this.padding=new D(15,5,"view")}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.anchor.setOwner(t),this.extents.setOwner(t),this.valueWidth.setOwner(t),this.background.setOwner(t),this.highlight.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.extents.clearDirty(),this.valueWidth.clearDirty(),this.background.clearDirty(),this.highlight.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class Z extends L{fill;stroke;opacity;cornerRadius;constructor(){super(),this.fill=new R,this.stroke=new V,this.opacity=new P(1),this.cornerRadius=new C(5,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.cornerRadius.clearDirty()}}class j extends L{cornerRadius;padding;constructor(){super(),this.cornerRadius=new C(7,"view"),this.padding=new D(2,2,"view")}setOwner(t=null){this.cornerRadius.setOwner(t),this.padding.setOwner(t)}clearDirty(){this.cornerRadius.clearDirty(),this.padding.clearDirty()}}class q extends L{fill;addressFill;stroke;opacity;font;constructor(){super(),this.fill=new R,this.addressFill=new R,this.stroke=new V,this.opacity=new P(1),this.font=new I,this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.addressFill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.font.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.addressFill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.font.clearDirty()}}class K extends B{space;polyCurve;constructor(t){super(t),this.space="world",this.polyCurve=new N}getSpace(){return this.space}setSpace(t){return this.space=t,this}getCurve(){return this.polyCurve}}class X extends K{property;constructor(t,e){super(t),this.property=e,this.properties.add(e),this.space=e.space}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.polyCurve.getPointAt(this.wrapedCycleAlpha);this.property.setV(e,this.space)}}class J{scene;parentMemory;index;values;names;address;highlight;hLine;isStacked;lowerBound;upperBound;basePosName;basePosValue;available;constructor(t,e){const s=t.getScene();this.scene=s,this.parentMemory=t,this.index=e,this.values=[],this.names=[],this.address=new S(s),this.hLine=new F(s),this.lowerBound=new x,this.upperBound=new x,this.basePosName=new x,this.basePosValue=new x,this.highlight=new A(s),this.hLine.setParent(t),this.highlight.setParent(t),this.highlight.data.isEnabled.set(!1),this.address.setParent(t),this.address.data.textAnchor.set("end"),this.isStacked=!1,this.available=!0}setAvailability(t){this.available=t}isAvailable(){return this.available}setAddress(t){this.address.setContent(t)}setValue(t,e={}){const s=new S(this.scene);return s.setParent(this.parentMemory),s.data.layer.set(2),s.data.textAnchor.set("start"),s.data.position.copyIfUnlocked(this.basePosValue),s.data.font.copyIfUnlocked(this.parentMemory.data.text.font),s.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),s.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),e.color&&s.data.fill.color.copy(e.color).lock(),s.setContent(t),this.values.push(s),s}setName(t,e={}){const s=new S(this.scene);return s.setParent(this.parentMemory),s.data.layer.set(2),s.data.textAnchor.set("start"),s.data.position.copyIfUnlocked(this.basePosName),s.data.font.copyIfUnlocked(this.parentMemory.data.text.font),s.data.fill.color.copyIfUnlocked(this.parentMemory.data.text.fill.color),s.data.fill.opacity.copyIfUnlocked(this.parentMemory.data.text.fill.opacity),e.color&&s.data.fill.color.copy(e.color).lock(),s.setContent(t),this.names.push(s),s}animateSetValue(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;let o=0;if(this.values.length>0){const l=this.values[this.values.length-1];l.data.isEnabled&&(this.animateFadeOut(l,e,new h(30,0),a,i,n),o=250)}const r=this.setValue(t,{color:s.color});return this.animateFadeIn(r,e,new h(-5,0),a,i,n+o),r}animateSetName(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;let o=0;if(this.names.length>0){const l=this.names[this.names.length-1];l.data.isEnabled&&(this.animateFadeOut(l,e,new h(30,0),a,i,n),o=250)}const r=this.setName(t,{color:s.color});return this.animateFadeIn(r,e,new h(-5,0),a,i,n+o),r}animateDestroy(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;if(this.values.length>0){const i=this.values[this.values.length-1];this.animateFadeOut(i,t,new h(30,0),s,n,a)}if(this.names.length>0){const i=this.names[this.names.length-1];this.animateFadeOut(i,t,new h(30,0),s,n,a)}}animateCopyValue(t,e,s={}){if(t.values.length===0)throw new Error("Source row has no value to copy");const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.values[t.values.length-1],i=this.setValue(n.getContent());return this.animateCopy(n,i,e,{lastText:a,...s}),i}animateCopyAddress(t,e,s={}){const a=this.values.length>0?this.values[this.values.length-1]:void 0,n=t.address,i=this.setValue(n.getContent());return this.animateCopy(n,i,e,{lastText:a,...s}),i}animateColor(t,e,s={}){const a=e.ensureLabel(s.label),n=s.offset??0,i=s.duration??500;if(this.values.length>0){const o=this.values[this.values.length-1],r=d.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),e.addAnimation(r,a,n)}if(this.names.length>0){const o=this.names[this.names.length-1],r=d.create(this.scene,o.data.fill.color);o.data.fill.color.copy(t).lock(),r.setCycleDuration(i).commitFinalState(),e.addAnimation(r,a,n)}}animateHighlightIn(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;this.highlight.data.opacity.set(0),this.highlight.data.fill.opacity.set(.15),this.highlight.data.stroke.width.set(1,"view");const i=d.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(m.inOut);this.highlight.data.opacity.set(1),i.commitFinalState(),t.addAnimation(i,s,a),t.enableElement(this.highlight,!0,s,a),e.color&&(t.addTrigger(new O(this.highlight.data.fill.color,e.color),s,a),t.addTrigger(new O(this.highlight.data.stroke.color,e.color),s,a))}animateHighlightOut(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;this.highlight.data.opacity.set(1);const i=d.create(this.scene,this.highlight.data.opacity).setCycleDuration(n).setEasing(m.inOut);this.highlight.data.opacity.set(0),i.commitFinalState(),t.addAnimation(i,s,a),t.enableElement(this.highlight,!1,s,a+n)}animateHLine(t,e={}){const s=t.ensureLabel(e.label),a=e.offset??0,n=e.duration??500;if(e.color){const i=d.create(this.scene,this.hLine.data.stroke.color).setCycleDuration(n);this.hLine.data.stroke.color.copy(e.color).lock(),i.commitFinalState(),t.addAnimation(i,s,a)}if(e.width){const i=d.create(this.scene,this.hLine.data.stroke.width).setCycleDuration(n).setEasing(m.inOut);this.hLine.data.stroke.width.set(e.width,"view").lock(),i.commitFinalState(),t.addAnimation(i,s,a)}}animateCopy(t,e,s,a={}){const n=s.ensureLabel(a.label),i=a.offset??0,o=a.duration??500,r=a.srcAngle??180,l=a.dstAngle??180,c=a.curveTension??.4;let g=0;a.lastText&&a.lastText.data.isEnabled&&(this.animateFadeOut(a.lastText,s,new h(30,0),n,o,i),g=250);const u="world",p=t.getPosition(u),v=e.getPosition(u);t.data.textAnchor.get()==="end"&&(p.x-=2*t.getExtents(u).x);const b=new X(this.scene,e.data.localShift).setCycleDuration(o).setEasing(m.inOut).setSpace(u),w=p.subV(v),k=w.length();if(b.getCurve().clear().addCubic(w,h.addV(w,h.fromPolarDeg(r,c*k)),h.fromPolarDeg(l,c*k),new h(0,0),16).updateLength(),e.data.localShift.set(0,0,u),s.enableElement(e,!0,n,i+g),s.addAnimation(b,n,i+g),a.color){e.data.fill.color.copy(t.data.fill.color);const E=d.create(this.scene,e.data.fill.color).setCycleDuration(o);e.data.fill.color.copy(a.color).lock(),E.commitFinalState(),s.addAnimation(E,n,i+g)}}animateFadeIn(t,e,s,a,n,i){t.data.opacity.set(0);const o=d.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(m.out);if(t.data.opacity.set(1),o.commitFinalState(),e.enableElement(t,!0,a,i),e.addAnimation(o,a,i),h.isZeroV(s)===!1){t.data.localShift.setV(s,"view");const r=d.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(m.inOut);t.data.localShift.set(0,0,"view"),r.commitFinalState(),e.addAnimation(r,a,i)}}animateFadeOut(t,e,s,a,n,i){t.data.opacity.set(1);const o=d.create(this.scene,t.data.opacity).setCycleDuration(n).setEasing(m.out);if(t.data.opacity.set(0),o.commitFinalState(),e.addAnimation(o,a,i),h.isZeroV(s)===!1){t.data.localShift.set(0,0,"view");const r=d.create(this.scene,t.data.localShift).setCycleDuration(n).setEasing(m.inOut);t.data.localShift.setV(s,"view"),r.commitFinalState(),e.addAnimation(r,a,i)}e.enableElement(t,!1,a,i+n)}setWorldBounds(t,e){this.lowerBound.setV(t,"world"),this.upperBound.setV(e,"world")}updateGeometry(){const t=this.parentMemory.data;if((this.lowerBound.isDirty()||this.upperBound.isDirty()||t.padding.isDirty()||t.text.font.isDirty())===!1)return;const s="world",a=this.scene.getActiveCamera(),n=this.lowerBound.get(s,a),i=this.upperBound.get(s,a),o=i.y-n.y,r=i.x-n.x,l=t.text.font,c=l.relativeAscenderHeight.value*l.size.get(s,a),g=n.y+o/2-c/2,u=t.padding.get(s,a).x,p=t.valueWidth.get(s,a),v=r-p;this.address.data.position.set(n.x-u,g,s),this.basePosValue.set(n.x+u,g,s),this.basePosName.set(n.x+p+u,g,s);for(const k of this.values)k.data.position.setV(this.basePosValue.value,s);for(const k of this.names)k.data.position.setV(this.basePosName.value,s);this.isStacked?(this.hLine.data.startPosition.set(n.x,i.y,s),this.hLine.data.endPosition.set(i.x,i.y,s)):(this.hLine.data.startPosition.set(n.x,n.y,s),this.hLine.data.endPosition.set(i.x,n.y,s));const b=new h(n.x+.75*r,n.y+.5*o);this.highlight.data.position.setV(b,s);const w=t.highlight.padding.get(s,a);this.highlight.data.position.setV(b,s),this.highlight.data.extents.set(.5*v-2*w.x,.5*o-2*w.y,s),this.highlight.data.cornerRadius.set(t.highlight.cornerRadius.get(s,a),s),this.highlight.data.anchor.set("center")}update(){this.updateGeometry();for(const t of this.values)t.update();for(const t of this.names)t.update();this.address.update(),this.hLine.update(),this.highlight.update()}}class Q{memoryRef;index;constructor(t,e){this.memoryRef=t,this.index=e}free(){this.memoryRef.destroyMemoryId(this)}setValue(t,e={}){return this.memoryRef.getRow(this.index).setValue(t,e)}setName(t,e={}){return this.memoryRef.getRow(this.index).setName(t,e)}animateSetValue(t,e,s={}){return this.memoryRef.getRow(this.index).animateSetValue(t,e,s)}animateSetName(t,e,s={}){return this.memoryRef.getRow(this.index).animateSetName(t,e,s)}animateSetNameAndValue(t,e,s,a={}){const n=a.offset??0,i=a.delay??100,o=s.ensureLabel(a.label),r={duration:a.duration,label:o,color:a.valueColor,offset:n},l={duration:a.duration,label:o,color:a.nameColor,offset:n+i};return{value:this.memoryRef.getRow(this.index).animateSetValue(e,s,r),name:this.memoryRef.getRow(this.index).animateSetName(t,s,l)}}animateDestroy(t,e={}){this.memoryRef.getRow(this.index).animateDestroy(t,e),this.free()}animateCopyValue(t,e,s={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyValue(a,e,s)}animateCopyAddress(t,e,s={}){const a=t.memoryRef.getRow(t.index);return this.memoryRef.getRow(this.index).animateCopyAddress(a,e,s)}animateColor(t,e,s={}){this.memoryRef.getRow(this.index).animateColor(t,e,s)}animateHighlightIn(t,e={}){this.memoryRef.getRow(this.index).animateHighlightIn(t,e)}animateHighlightOut(t,e={}){this.memoryRef.getRow(this.index).animateHighlightOut(t,e)}animateHLine(t,e={}){this.memoryRef.getRow(this.index).animateHLine(t,e)}animateRestoreHLine(t,e={}){const s=this.memoryRef.getScene().getActiveCamera(),a={...e,color:this.memoryRef.data.background.stroke.color,width:this.memoryRef.data.background.stroke.width.get("view",s)};this.memoryRef.getRow(this.index).animateHLine(t,a)}}class at extends H{element;addressCount;background;vLine;rows;isStacked;constructor(t,e,s={}){super(t,new z);const a=s.isStacked??!1,n=s.addressStart??0,i=s.addressPrefix??"@",o=s.addressRadix??10;this.element=document.createElementNS(W,"g"),this.addressCount=e,this.isStacked=a,this.background=new A(t),this.vLine=new F(t),this.background.setParent(this),this.vLine.setParent(this),this.rows=[];for(let r=0;r<this.addressCount;r++){const l=n+(this.isStacked?this.addressCount-1-r:r),c=new J(this,r);c.isStacked=this.isStacked,c.setAddress(i+l.toString(o).toUpperCase()),this.rows.push(c)}this.rows[this.addressCount-1].hLine.setEnabled(!1),this.element.dataset.role="memory"}getSVGElement(){return this.element}getExtents(t){return this.data.extents.get(t,this.scene.getActiveCamera())}getCenter(t){return T.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.data.extents)}getRow(t){if(t<0||t>=this.addressCount)throw new Error("Invalid row ID");return this.rows[t]}createMemoryId(){let t=0;for(;t<this.addressCount&&!this.rows[t].isAvailable();)t++;if(t>=this.addressCount)throw new Error("Memory is full");return this.rows[t].setAvailability(!1),new Q(this,t)}destroyMemoryId(t){if(t.memoryRef!==this||t.index<0||t.index>=this.addressCount)throw new Error("Invalid memory ID");this.rows[t.index].setAvailability(!0)}updateBackground(){const t="view",e=this.getCenter(t),s=this.getExtents(t);this.background.data.stroke.copyIfUnlocked(this.data.background.stroke),this.background.data.fill.copyIfUnlocked(this.data.background.fill),this.background.data.opacity.copyIfUnlocked(this.data.background.opacity),this.background instanceof A&&this.background.data.cornerRadius.copyIfUnlocked(this.data.background.cornerRadius),this.background.data.position.setV(e,t),this.background.data.extents.setV(s,t),this.background.data.anchor.set("center");const a=this.data.valueWidth.get(t,this.scene.getActiveCamera()),n=e.x-s.x+a;this.vLine.data.startPosition.set(n,e.y+s.y,t),this.vLine.data.endPosition.set(n,e.y-s.y,t),this.vLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),this.vLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width),this.background.update(),this.vLine.update()}updateVariables(){const t="world",e=this.getCenter(t),s=this.getExtents(t),a=this.isStacked?1:-1,n=2*s.y/this.addressCount;for(let i=0;i<this.rows.length;i++){const o=this.rows[i],r=e.y+a*((i+.5)*n-s.y),l=new h(e.x-s.x,r-.5*n),c=new h(e.x+s.x,r+.5*n);o.setWorldBounds(l,c),o.hLine.data.stroke.color.copyIfUnlocked(this.data.background.stroke.color),o.hLine.data.stroke.width.copyIfUnlocked(this.data.background.stroke.width)}if(this.data.text.font.isDirty())for(const i of this.rows){for(const o of i.values)o.data.font.copyIfUnlocked(this.data.text.font);for(const o of i.names)o.data.font.copyIfUnlocked(this.data.text.font);i.address.data.font.copyIfUnlocked(this.data.text.font)}for(const i of this.rows)i.address.data.fill.copyIfUnlocked(this.data.text.addressFill),i.update()}update(){this.skipUpdate()||(this.updateSVGChildren(),this.updateBackground(),this.updateVariables(),this.clearDirty())}}class it extends G{animator;font;fillRect;setDefaultFont(t=16){this.font.family.set("monospace"),this.font.size.set(t,"view"),this.font.relativeAscenderHeight.set(.7),this.font.relativeLineHeight.set(1.3)}setDefaultCodeStyle(t){const e=t.data;e.text.font.copy(this.font),e.text.fill.color.copy(y.WHITE),e.padding.set(20,15,"view"),e.background.fill.color.copy(y.GREY_9),e.background.stroke.color.copy(y.GREY_7),e.background.stroke.width.set(2,"view"),e.background.cornerRadius.set(10,"view"),e.currentLine.opacity.set(1),e.currentLine.fill.color.copy(y.BLACK),e.currentLine.fill.opacity.set(.5),e.currentLine.stroke.color.copy(y.WHITE),e.currentLine.stroke.width.set(1,"view"),e.currentLine.stroke.opacity.set(.2),e.currentLine.padding.set(-.5,2,"view"),e.currentLine.index.set(0),e.position.set(-6,4,"world"),e.anchor.set("north-west"),e.minExtents.set(2.5,1,"world")}setDefaultMemoryStyle(t){const e=t.data;e.extents.set(2,4,"world"),e.padding.set(15,0,"view"),e.valueWidth.set(2,"world"),e.text.fill.color.copyIfUnlocked(y.WHITE),e.text.addressFill.color.copyIfUnlocked(y.GREY_4),e.text.font.copyIfUnlocked(this.font),e.background.fill.color.copyIfUnlocked(y.GREY_9),e.background.stroke.color.copyIfUnlocked(y.GREY_7),e.background.stroke.width.set(2,"view"),e.background.cornerRadius.set(10,"view"),e.highlight.cornerRadius.set(7,"view"),e.highlight.padding.set(3,3,"view"),e.position.set(6,0,"world"),e.anchor.set("east")}constructor(t,e){super(t,e),this.animator=new _(this),this.font=new I,this.fillRect=this.addFillRect(),this.fillRect.data.color.copy(Y.lerp(y.GREY_8,y.GREY_9,.7)),this.setDefaultFont(16)}animateCallIn(t,e,s,a={}){const n=this.getActiveCamera(),i=t.findTokenTSpan(s,{category:"fn"});if(!i)return;const o=this.animator.ensureLabel(a.label),r=a.offset??0,l=a.duration??500,c=30,g=t.data.position.get("view",n),u=i.getUpper("view");e.data.position.set(g.x+10+c,u.y+5,"view"),e.data.anchor.set("north-west"),e.data.opacity.set(0);const p=d.create(this,e.data.position).setCycleDuration(l).setEasing(m.inOut),v=d.create(this,e.data.opacity).setCycleDuration(l).setEasing(m.inOut);e.data.position.set(g.x+10,u.y+5,"view"),e.data.opacity.set(1),this.animator.enableElement(e,!0,o,r),this.animator.addAnimation(p.commitFinalState(),o,r),this.animator.addAnimation(v.commitFinalState(),o,r)}animateCallOut(t,e={}){const s=this.getActiveCamera(),a=this.animator.ensureLabel(e.label),n=e.offset??0,i=e.duration??500,o=30,r=d.create(this,t.data.position).setCycleDuration(i).setEasing(m.inOut),l=d.create(this,t.data.opacity).setCycleDuration(i).setEasing(m.inOut),c=t.data.position.get("view",s);t.data.position.set(c.x+o,c.y,"view"),t.data.opacity.set(0),this.animator.addAnimation(r.commitFinalState(),a,n),this.animator.addAnimation(l.commitFinalState(),a,n),this.animator.enableElement(t,!1,a,n+i)}}export{it as B,at as S};
