import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as U,b as x,d as S,S as G,g as M,u as P,C as q,t as X}from"./s2-playable-CCYpOjF1.js";import{S as $,b as F}from"./s2-step-animator-Btxnf0HZ.js";import{S as Y,c as A,r as K,b as Q,s as R,l as Z}from"./radix-colors-dark-CaDw3abP.js";import{S as I}from"./s2-lerp-anim-BiCWT6VV.js";class _{vertices=new Map;adjacency=new Map;addVertex(e,t){if(this.vertices.has(e))throw new Error(`Vertex ${e} already exists`);this.vertices.set(e,t),this.adjacency.set(e,[])}setEdge(e,t,s){if(!this.vertices.has(e)||!this.vertices.has(t))throw new Error("Vertex does not exist");const r=this.adjacency.get(e),i=r.find(a=>a.to===t);i?i.data=s:r.push({to:t,data:s})}removeEdge(e,t){const s=this.adjacency.get(e);if(s){const r=s.findIndex(i=>i.to===t);r!==-1&&s.splice(r,1)}}removeEdgesFrom(e){const t=this.adjacency.get(e);t&&(t.length=0)}clearEdges(){for(const e of this.adjacency.values())e.length=0}hasEdge(e,t){return this.adjacency.get(e)?.some(s=>s.to===t)??!1}edgesOf(e){return this.adjacency.get(e)??[]}getVertices(){return[...this.vertices.keys()]}getVertex(e){const t=this.vertices.get(e);if(!t)throw new Error(`Vertex ${e} does not exist`);return t}}let O;O={back:R,main:A,secondary:Z,wall:R,blue:Q,red:K,cyan:A};const p=new Y(O);class ee{isWall=!1;visited=!1;prevId=null;depth=-1;cell;cellEmph;circle;lineToPrev;constructor(e){this.cell=new P(e),this.cell.setParent(e.getSVG()),this.cellEmph=new P(e),this.cellEmph.setParent(e.getSVG()),this.circle=new q(e),this.circle.setParent(e.getSVG()),this.circle.data.isEnabled.set(!1),this.lineToPrev=new X(e),this.lineToPrev.setParent(e.getSVG()),this.lineToPrev.data.isEnabled.set(!1)}}class te extends U{animator;graph;size=10;mode="search";startI=0;startJ=0;cellWidth;stepByStep=!1;showHelperGrid=!1;directionOrder=["U","D","L","R"];directionVectors={U:[-1,0],D:[1,0],L:[0,-1],R:[0,1]};constructor(e){super(e),this.camera.setExtents(8,4.5),this.setViewportSize(640*1.5,360*1.5),this.tracePoolAllocations=!0,this.animator=new $(this);const t=this.getViewSpace(),s=this.getWorldSpace();if(console.log("view",t),console.log("world",s),this.addFillRect().data.color.setFromTheme(p,"back",2),this.showHelperGrid){const o=this.addWorldGrid();o.data.stroke.color.setFromTheme(p,"back",4),o.data.stroke.width.set(2,t),o.data.geometry.boundA.set(-8,-4.5,s),o.data.geometry.boundB.set(8,4.5,s),o.data.geometry.space.set(s)}const l=(8-.1*(this.size-1))/this.size;this.cellWidth=l;const c=new _;this.graph=c;for(let o=0;o<this.size;o++)for(let d=0;d<this.size;d++){const g=new ee(this),h=g.cell;h.data.layer.set(1),h.getSVGElement().addEventListener("pointerdown",k=>{this.onClick(o,d)},{passive:!1}),g.cellEmph.data.layer.set(2),c.addVertex(`${o},${d}`,g)}this.createRandomWalls(),this.createEdges(),this.update(),this.createAnimation(),this.animator.playMaster(),this.animator.pause()}onClick(e,t){console.log(`Cell clicked: ${e},${t}`);const s=this.graph.getVertex(`${e},${t}`);switch(this.mode){case"wall":if(e==this.startI&&t==this.startJ)return;s.isWall=!s.isWall,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update();break;case"search":if(s.isWall)return;if(e==this.startI&&t==this.startJ){this.animator.playMaster();return}this.startI=e,this.startJ=t,this.createAnimation(),this.animator.playMaster();break}}createRandomWalls(){for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){const r=Math.random()<.25;this.graph.getVertex(`${t},${s}`).isWall=r}this.graph.getVertex(`${this.startI},${this.startJ}`).isWall=!1}initializeGraphCells(){const e=this.getViewSpace(),t=this.getWorldSpace(),s=8,r=.1,i=(s-r*(this.size-1))/this.size,a=i+r;this.cellWidth=i;const l=new x(-s/2,-s/2);for(let c=0;c<this.size;c++)for(let o=0;o<this.size;o++){const d=this.graph.getVertex(`${c},${o}`);d.visited=!1,d.prevId=null,d.depth=-1;const g=new x(l.x+o*a+i/2,l.y+(this.size-1-c)*a+i/2),h=d.cell;h.data.layer.set(1),h.data.extents.set(i/2,i/2,t),h.data.position.setV(g,t),h.data.anchor.set(0,0),h.data.pointerEvents.set("auto");const m=d.cellEmph;m.data.layer.set(2),m.data.extents.set(1,1,e),m.data.position.setV(g,t),m.data.anchor.set(0,0),m.data.opacity.set(0)}}setInitialStyle(){const e=this.getViewSpace(),t=this.getWorldSpace(),s=8,r=.1,i=(s-r*(this.size-1))/this.size,a=i+r;this.cellWidth=i;const l=new x(-s/2,-s/2);for(let c=0;c<this.size;c++)for(let o=0;o<this.size;o++){const d=this.graph.getVertex(`${c},${o}`);d.visited=!1,d.prevId=null,d.depth=-1;const g=new x(l.x+o*a+i/2,l.y+(this.size-1-c)*a+i/2),h=d.cell;h.data.layer.set(1),h.data.extents.set(i/2,i/2,t),h.data.position.setV(g,t),h.data.anchor.set(0,0),h.data.fill.color.setFromTheme(p,"back",1),h.data.stroke.color.setFromTheme(p,"back",5),h.data.stroke.width.set(2,e),h.data.pointerEvents.set("auto");const m=d.cellEmph;m.data.layer.set(2),m.data.extents.set(1,1,e),m.data.position.setV(g,t),m.data.anchor.set(0,0),m.data.opacity.set(1),m.data.fill.color.setFromTheme(p,"main",1),m.data.stroke.color.setFromTheme(p,"main",5),m.data.stroke.width.set(2,e),m.data.opacity.set(0),d.isWall&&(h.data.fill.color.setFromTheme(p,"wall",10),h.data.stroke.color.setFromTheme(p,"wall",10))}}createEdges(){this.graph.clearEdges();for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)for(let s=this.directionOrder.length-1;s>=0;s--){const r=this.directionOrder[s],i=this.directionVectors[r],a=e+i[0],l=t+i[1];a<0||a>=this.size||l<0||l>=this.size||this.graph.getVertex(`${a},${l}`).isWall||this.graph.setEdge(`${e},${t}`,`${a},${l}`,{})}}createAnimation(){const e=`${this.startI},${this.startJ}`;this.animator.stop(),this.animator.reset(),this.animator=new $(this);const t=this.getViewSpace(),s=this.getWorldSpace(),r=8,i=.1,a=(r-i*(this.size-1))/this.size,l=a+i;this.cellWidth=a;const c=new x(-r/2,-r/2);for(let y=0;y<this.size;y++)for(let n=0;n<this.size;n++){const f=this.graph.getVertex(`${y},${n}`);f.visited=!1,f.prevId=null,f.depth=-1;const L=new x(c.x+n*l+a/2,c.y+(this.size-1-y)*l+a/2),u=f.cell;u.data.layer.set(1),u.data.extents.set(a/2,a/2,s),u.data.position.setV(L,s),u.data.anchor.set(0,0),u.data.fill.color.setFromTheme(p,"back",1),u.data.stroke.color.setFromTheme(p,"back",5),u.data.stroke.width.set(2,t),u.data.pointerEvents.set("auto");const v=f.cellEmph;v.data.layer.set(2),v.data.extents.set(1,1,t),v.data.position.setV(L,s),v.data.anchor.set(0,0),v.data.opacity.set(1),v.data.fill.color.setFromTheme(p,"main",1),v.data.stroke.color.setFromTheme(p,"main",5),v.data.stroke.width.set(2,t),v.data.opacity.set(0),f.isWall&&(u.data.fill.color.setFromTheme(p,"wall",10),u.data.stroke.color.setFromTheme(p,"wall",10))}console.log("Creating animation");const o=[],d=new S,g=new S,h=new S,m=new S,k=new S,W=new S,E=new S;d.setFromTheme(p,"main",4),g.setFromTheme(p,"secondary",4),h.setFromTheme(p,"main",9),m.setFromTheme(p,"secondary",9),k.setFromTheme(p,"main",12),W.setFromTheme(p,"secondary",12);const B=.5*this.size*this.size-1;o.push(e),this.graph.getVertex(e).depth=0;let w=0,D=50,C=500;for(this.stepByStep&&(D=300,C=300);o.length>0;){const y=o.pop(),n=this.graph.getVertex(y);if(n.visited)continue;n.visited=!0;const f=G.clamp01(n.depth/B);E.lerp(k,W,f),n.circle.data.fill.color.copy(E),n.circle.data.isEnabled.set(!0),n.circle.data.layer.set(4),n.circle.data.position.copy(n.cell.data.position),n.circle.data.radius.set(1,this.getViewSpace()),n.circle.data.opacity.set(0);const L=I.create(this,n.circle.data.radius).setCycleDuration(C).setEasing(M.out);n.circle.data.radius.set(5,this.getViewSpace()),this.animator.addAnimation(L.commitFinalState(),"timeline-start",w);const u=new F(n.circle.data.opacity,0);this.animator.addTrigger(u,"timeline-start",0);const v=new F(n.circle.data.opacity,1);this.animator.addTrigger(v,"timeline-start",w+1),E.lerp(d,g,f),n.cellEmph.data.fill.color.copy(E),E.lerp(h,m,f),n.cellEmph.data.stroke.color.copy(E);const H=I.create(this,n.cellEmph.data.opacity).setCycleDuration(C).setEasing(M.out);n.cellEmph.data.opacity.set(1),this.animator.addAnimation(H.commitFinalState(),"timeline-start",w);const j=I.create(this,n.cellEmph.data.extents).setCycleDuration(C).setEasing(M.out);if(n.cellEmph.data.extents.set(this.cellWidth/2,this.cellWidth/2,this.getWorldSpace()),this.animator.addAnimation(j.commitFinalState(),"timeline-start",w),n.prevId!==null){const z=this.graph.getVertex(n.prevId);n.lineToPrev.data.isEnabled.set(!0),n.lineToPrev.data.layer.set(3),n.lineToPrev.data.startPosition.copy(z.cell.data.position),n.lineToPrev.data.endPosition.copy(n.cell.data.position),n.lineToPrev.data.stroke.color.setFromTheme(p,"back",12),n.lineToPrev.data.stroke.width.set(3,this.getViewSpace()),n.lineToPrev.data.pathFrom.set(0),n.lineToPrev.data.pathTo.set(0),n.lineToPrev.data.opacity.set(0),E.lerp(k,W,f),n.lineToPrev.data.stroke.color.copy(E);const V=new F(n.lineToPrev.data.opacity,0);this.animator.addTrigger(V,"timeline-start",0);const b=new F(n.lineToPrev.data.opacity,1);this.animator.addTrigger(b,"timeline-start",w);const J=I.create(this,n.lineToPrev.data.pathTo).setCycleDuration(D).setEasing(M.linear);n.lineToPrev.data.pathTo.set(1),this.animator.addAnimation(J.commitFinalState(),"timeline-start",w)}w+=D;for(const z of this.graph.edgesOf(y)){const V=z.to,b=this.graph.getVertex(V);b.visited||(o.push(V),b.prevId=y,b.depth=n.depth+1)}this.animator.makeStep()}this.animator.finalize(),this.animator.setMasterElapsed(0),this.update()}setDirectionOrder(e){if(e.length!==4)throw new Error("Direction order must have exactly 4 elements.");this.directionOrder=e,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setStepByStep(e){this.stepByStep=e,this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setMode(e){this.mode=e}}class se{container;scene;stepIndex=-1;constructor(e,t){this.container=e,this.scene=t}init(){this.container.classList.add("graph-search-controls"),this.container.append(this.createTraversalCard(),this.createDirectionOrderCard(),this.createInteractionModeCard(),this.createAnimationModeCard())}createTraversalCard(){const e=this.createCard("Type de parcours","Choisit la stratégie d’exploration du graphe."),t=this.createRadio("traversal","dfs","DFS");return t.input.checked=!0,t.input.addEventListener("change",()=>{}),e.body.append(t.label),e.root}createDirectionOrderCard(){const e=this.createCard("Ordre des voisins","Définit l’ordre dans lequel les voisins sont explorés."),t=document.createElement("ul");t.className="dir-list";const s=[{dir:"U",icon:"fa-up-long"},{dir:"D",icon:"fa-down-long"},{dir:"L",icon:"fa-left-long"},{dir:"R",icon:"fa-right-long"}];let r=null;for(const i of s){const a=document.createElement("li");a.draggable=!0,a.dataset.dir=i.dir;const l=document.createElement("i");l.classList.add("fa-solid",i.icon),a.append(l),a.addEventListener("dragstart",()=>{r=a,a.classList.add("dragging")}),a.addEventListener("dragend",()=>{r=null,a.classList.remove("dragging")}),a.addEventListener("dragover",c=>{if(c.preventDefault(),!r||r===a)return;c.target.classList.add("over")}),a.addEventListener("dragleave",c=>{if(c.preventDefault(),!r||r===a)return;c.target.classList.remove("over")}),a.addEventListener("drop",c=>{c.preventDefault(),!(!r||r===a)&&a.classList.remove("over")}),t.appendChild(a)}return t.addEventListener("drop",i=>{i.preventDefault();const a=i.target;if(!r||a===r||a.tagName!=="LI")return;a.classList.remove("over");const l=r.getBoundingClientRect();i.clientX-l.x<0?t.insertBefore(r,a):t.insertBefore(r,a.nextSibling);const o=Array.from(t.children).map(d=>d.dataset.dir);this.scene.setDirectionOrder(o)}),e.body.appendChild(t),e.root}createInteractionModeCard(){const e=this.createCard("Interaction","Choisit ce que fait un clic sur la grille."),t=document.createElement("select");return t.innerHTML=`
            <option value="search">Choisir le départ</option>
            <option value="wall">Modifier les murs</option>
        `,t.addEventListener("change",()=>{this.scene.animator.stop();const s=t.value;this.scene.setMode(s)}),e.body.appendChild(t),e.root}createAnimationModeCard(){const e=this.createCard("Animation","Contrôle la vitesse de l’animation.");let t=!1;const s=document.createElement("input");s.type="checkbox";const r=document.createElement("label");r.append(s,document.createTextNode(" Pas à pas"));const i=document.createElement("div");i.className="playback-controls";const a=document.createElement("button");a.innerHTML='<i class="fa-solid fa-stop"></i>',a.classList.add("anim-button");const l=document.createElement("button");l.innerHTML='<i class="fa-solid fa-play"></i>',l.classList.add("anim-button");const c=document.createElement("button");c.innerHTML='<i class="fa-solid fa-step-forward"></i>',c.disabled=!0,c.classList.add("anim-button");const o=document.createElement("button");return o.innerHTML='<i class="fa-solid fa-step-backward"></i>',o.disabled=!0,o.classList.add("anim-button"),a.addEventListener("click",()=>{console.log("stop"),l.innerHTML='<i class="fa-solid fa-play"></i>',this.stepIndex=-1,this.scene.animator.stop(),this.scene.animator.setRangeAsMaster(),this.scene.animator.setMasterElapsed(0),this.scene.update(),t=!1}),l.addEventListener("click",()=>{console.log("play/pause"),t?(this.scene.animator.pause(),l.innerHTML='<i class="fa-solid fa-play"></i>'):(this.scene.animator.setRangeAsMaster(),this.scene.animator.getElapsed()>=this.scene.animator.getMasterDuration()&&this.scene.animator.setMasterElapsed(0),this.scene.animator.resume(),l.innerHTML='<i class="fa-solid fa-pause"></i>'),t=!t}),c.addEventListener("click",()=>{l.innerHTML='<i class="fa-solid fa-play"></i>';const d=this.scene.animator.getElapsed();d<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(d-1),this.stepIndex=G.clamp(this.stepIndex+1,0,this.scene.animator.getStepCount()-1),this.scene.animator.setRangeAsStep(this.stepIndex),this.scene.animator.resetStep(this.stepIndex),this.scene.animator.resume()}),o.addEventListener("click",()=>{l.innerHTML='<i class="fa-solid fa-play"></i>';const d=this.scene.animator.getElapsed();d<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(d-1),this.scene.animator.resetStep(this.stepIndex),this.scene.update()}),s.addEventListener("change",()=>{this.scene.setStepByStep(s.checked),s.checked?(c.disabled=!1,o.disabled=!1):(c.disabled=!0,o.disabled=!0)}),i.append(l,a,o,c),e.body.append(r,i),e.root}createCard(e,t){const s=document.createElement("div");s.className="ui-card";const r=document.createElement("h3");r.textContent=e;const i=document.createElement("p");i.textContent=t;const a=document.createElement("div");return a.className="ui-card-body",s.append(r,i,a),{root:s,body:a}}createRadio(e,t,s,r=!1){const i=document.createElement("input");i.type="radio",i.name=e,i.value=t,i.checked=r;const a=document.createElement("label");return a.append(i,document.createTextNode(" "+s)),{input:i,label:a}}}class ae{container;scene;index=-1;constructor(e,t){this.container=e,this.scene=t}init(){this.container.classList.add("graph-search-navigation"),this.container.append(this.createSlider())}createSlider(){const e=document.createElement("input");return e.type="range",e.style.width="50%",e.addEventListener("input",()=>{const s=e.valueAsNumber/100*this.scene.animator.getMasterDuration();this.scene.animator.stop(),this.scene.animator.setMasterElapsed(s),this.index=this.scene.animator.getStepIndexFromElapsed(s),this.scene.getSVG().update()}),e}}class ie{scene;controls;navigation;constructor(e){const t=document.createElement("div");t.className="controls";const s=document.createElement("div");s.className="figure";const r=document.createElement("div");r.className="navigation";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("responsive-svg"),i.setAttribute("preserveAspectRatio","xMidYMid meet"),s.appendChild(i),e.append(t,s,r),this.scene=new te(i),this.controls=new se(t,this.scene),this.controls.init(),this.navigation=new ae(r,this.scene),this.navigation.init()}}const N=document.getElementById("graph-search-figure");if(!N)throw new Error("Figure container not found");new ie(N);
