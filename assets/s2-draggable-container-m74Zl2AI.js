import{x as g,F as o,l as a,S as h,G as l,k as D,H as c,m,y as w,s as y,B as r,o as P}from"./s2-lerp-anim-CO5UdZaq.js";class O extends D{position=new a(0,0,"world");xEnabled=new c(!0);yEnabled=new c(!0);containerBoundA=new a(-1/0,-1/0,"world");containerBoundB=new a(1/0,1/0,"world");space=new m("world");constructor(){super(),this.pointerEvents.set("auto")}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.xEnabled.setOwner(t),this.yEnabled.setOwner(t),this.containerBoundA.setOwner(t),this.containerBoundB.setOwner(t),this.space.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.xEnabled.clearDirty(),this.yEnabled.clearDirty(),this.containerBoundA.clearDirty(),this.containerBoundB.clearDirty(),this.space.clearDirty()}}class b extends g{grabDelta=new o(0,0,"view");pointerPosition=new a(0,0,"view");pointerDelta=new o(0,0,"view");delta=new o(0,0,"view");pointerId=null;dragging=!1;userOnGrab=null;userOnDrag=null;userOnRelease=null;container=null;constructor(t,e){super(t,e)}initSVGElement(t){t.style.touchAction="none",t.style.cursor="pointer",t.role="handle",t.addEventListener("pointerdown",this.onGrab,{passive:!1})}setContainer(t){this.container!==t&&(this.container=t,t?.setOwner(this),this.markDirty())}setOnGrab(t){this.userOnGrab=t}setOnDrag(t){this.userOnDrag=t}setOnRelease(t){this.userOnRelease=t}getPosition(t){return this.data.position.get(t,this.scene.getActiveCamera())}getDelta(t){return this.delta.get(t,this.scene.getActiveCamera())}getCenter(t){return this.data.position.get(t,this.scene.getActiveCamera())}getPointerDelta(t){return this.pointerDelta.get(t,this.scene.getActiveCamera())}getPointerPosition(t){return this.pointerPosition.get(t,this.scene.getActiveCamera())}updatePointerPosition(t,e){const s="view",i=this.scene.getActiveCamera(),p=this.pointerPosition.get(s,i);this.scene.convertDOMPointInto(t,e,this.pointerPosition);const u=this.pointerPosition.get(s,i),d=h.subV(u,p);this.pointerDelta.setValueFromSpaceV(d,s,i)}updatePositionFromPointer(){const t=this.data.position.space,e=this.scene.getActiveCamera(),s=this.data.position.get(t,e);let i=this.pointerPosition.get(t,e);i.addV(this.grabDelta.get(t,e)),this.data.position.setValueFromSpaceV(i,t,e),this.container&&(this.container.updatePosition(this.data.position),i=this.data.position.get(t,e)),this.delta.setV(i.subV(s),t)}onGrab=t=>{if(t.button!==void 0&&t.button!==0)return;t.preventDefault();const e="view",s=this.scene.getActiveCamera();this.updatePointerPosition(t.clientX,t.clientY);const i=this.data.position.get(e,s);this.grabDelta.setV(h.subV(i,this.pointerPosition.value),e),this.pointerDelta.set(0,0,e),this.delta.set(0,0,e),this.getSVGElement().setPointerCapture(t.pointerId),this.pointerId=t.pointerId,this.dragging=!0,window.addEventListener("pointermove",this.onDrag,{passive:!1}),window.addEventListener("pointerup",this.onRelease,{passive:!1}),this.onGrabImpl(t),this.userOnGrab?.(this,t),l.requestUpdate(this.scene)};onDrag=t=>{!this.dragging||t.pointerId!==this.pointerId||(t.preventDefault(),this.updatePointerPosition(t.clientX,t.clientY),this.updatePositionFromPointer(),this.onDragImpl(t),this.userOnDrag?.(this,t),l.requestUpdate(this.scene))};onRelease=t=>{if(!this.dragging||t.pointerId!==this.pointerId)return;t.preventDefault();const e="view";this.delta.set(0,0,e),this.pointerDelta.set(0,0,e),this.pointerPosition.set(0,0,e),this.dragging=!1,this.pointerId=null,window.removeEventListener("pointermove",this.onDrag),window.removeEventListener("pointerup",this.onRelease),this.getSVGElement().releasePointerCapture(t.pointerId),this.onReleaseImpl(t),this.userOnRelease?.(this,t),l.requestUpdate(this.scene)}}class v extends O{radius;constructor(){super(),this.radius=new P(1,"world")}setOwner(t=null){super.setOwner(t),this.radius.setOwner(t)}clearDirty(){super.clearDirty(),this.radius.clearDirty()}}class f extends b{element;opacity;constructor(t){super(t,new v),this.element=document.createElementNS(w,"circle"),this.opacity=new y(0),this.initSVGElement(this.element)}getRadius(t){return this.data.radius.get(t,this.scene.getActiveCamera())}getCenter(t){return this.data.position.get(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}update(){this.skipUpdate()||(r.applyPointerEvents(this.data.pointerEvents,this.element,this.scene),r.applyOpacity(this.opacity,this.element,this.scene),r.applyPosition(this.data.position,this.element,this.scene,"cx","cy"),r.applyRadius(this.data.radius,this.element,this.scene),this.clearDirty())}onGrabImpl(t){}onDragImpl(t){}onReleaseImpl(t){}}class E{data;scene;dirty=!0;owner=null;constructor(t,e){this.scene=t,this.data=e,this.data.setOwner(this)}setOwner(t=null){this.owner=t}getOwner(){return this.owner}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}clearDirty(){this.dirty=!1,this.data.clearDirty()}}export{E as S,f as a};
