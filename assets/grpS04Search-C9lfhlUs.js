import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as D,j as h,b as w,S as k,f,u as T,C as F,t as A}from"./s2-playable-Bdq8E5_G.js";import{S,b as E}from"./s2-step-animator-B7uTbjFC.js";import{S as v}from"./s2-lerp-anim-CJb7usyt.js";import{S as P}from"./s2-color-theme-C5HLvbcQ.js";import{s as b,l as z,d as W,r as $,p as B,i as N,c as C}from"./radix-colors-dark-CR1Y1j7h.js";class O{vertices=new Map;adjacency=new Map;addVertex(e,t){if(this.vertices.has(e))throw new Error(`Vertex ${e} already exists`);this.vertices.set(e,t),this.adjacency.set(e,[])}setEdge(e,t,s){if(!this.vertices.has(e)||!this.vertices.has(t))throw new Error("Vertex does not exist");const a=this.adjacency.get(e),i=a.find(r=>r.to===t);i?i.data=s:a.push({to:t,data:s})}removeEdge(e,t){const s=this.adjacency.get(e);if(s){const a=s.findIndex(i=>i.to===t);a!==-1&&s.splice(a,1)}}removeEdgesFrom(e){const t=this.adjacency.get(e);t&&(t.length=0)}clearEdges(){for(const e of this.adjacency.values())e.length=0}hasEdge(e,t){return this.adjacency.get(e)?.some(s=>s.to===t)??!1}edgesOf(e){return this.adjacency.get(e)??[]}getVertices(){return[...this.vertices.keys()]}getVertex(e){const t=this.vertices.get(e);if(!t)throw new Error(`Vertex ${e} does not exist`);return t}}let V;V={back:b,main:C,"scale-a":C,"scale-b":N,"scale-c":B,"scale-d":$,"scale-e":W,"scale-f":z,wall:b};const l=new P(V);class y{colors=[];getInto(e,t){if(this.colors.length===0){e.setBlack();return}const s=t*(this.colors.length-1),a=Math.floor(s),i=Math.min(a+1,this.colors.length-1),r=s-a;e.lerp(this.colors[a],this.colors[i],r)}}class G{input=[];output=[];enqueue(e){this.input.push(e)}dequeue(){if(this.output.length===0)for(;this.input.length>0;)this.output.push(this.input.pop());return this.output.pop()}get length(){return this.input.length+this.output.length}}class R{isWall=!1;visited=!1;prevId=null;depth=-1;cell;cellEmph;circle;lineToPrev;constructor(e){this.cell=new T(e),this.cell.setParent(e.getSVG()),this.cellEmph=new T(e),this.cellEmph.setParent(e.getSVG()),this.circle=new F(e),this.circle.setParent(e.getSVG()),this.circle.data.isEnabled.set(!1),this.lineToPrev=new A(e),this.lineToPrev.setParent(e.getSVG()),this.lineToPrev.data.isEnabled.set(!1)}}class j extends D{animator;graph;size=10;mode="search";traversal="dfs";startI=0;startJ=0;cellWidth;stepByStep=!1;showHelperGrid=!1;fillColorScale=new y;strokeColorScale=new y;treeColorScale=new y;directionOrder=["U","D","L","R"];directionVectors={U:[-1,0],D:[1,0],L:[0,-1],R:[0,1]};constructor(e){super(e),this.camera.setExtents(8,4.5),this.setViewportSize(640*1.5,360*1.5),this.tracePoolAllocations=!0,this.animator=new S(this);const t=this.getViewSpace(),s=this.getWorldSpace();if(this.fillColorScale.colors=[h.fromTheme(l,"scale-a",4),h.fromTheme(l,"scale-b",4),h.fromTheme(l,"scale-c",4),h.fromTheme(l,"scale-d",4),h.fromTheme(l,"scale-e",4),h.fromTheme(l,"scale-f",4)],this.strokeColorScale.colors=[h.fromTheme(l,"scale-a",9),h.fromTheme(l,"scale-b",9),h.fromTheme(l,"scale-c",9),h.fromTheme(l,"scale-d",9),h.fromTheme(l,"scale-e",9),h.fromTheme(l,"scale-f",9)],this.treeColorScale.colors=[h.fromTheme(l,"scale-a",12),h.fromTheme(l,"scale-b",12),h.fromTheme(l,"scale-c",12),h.fromTheme(l,"scale-d",12),h.fromTheme(l,"scale-e",12),h.fromTheme(l,"scale-f",12)],this.addFillRect().data.color.setFromTheme(l,"back",2),this.showHelperGrid){const c=this.addWorldGrid();c.data.stroke.color.setFromTheme(l,"back",4),c.data.stroke.width.set(2,t),c.data.geometry.boundA.set(-8,-4.5,s),c.data.geometry.boundB.set(8,4.5,s),c.data.geometry.space.set(s)}const o=(8-.1*(this.size-1))/this.size;this.cellWidth=o;const n=new O;this.graph=n;for(let c=0;c<this.size;c++)for(let d=0;d<this.size;d++){const m=new R(this);m.cell.getSVGElement().addEventListener("pointerdown",p=>{this.onClick(c,d)},{passive:!1}),n.addVertex(`${c},${d}`,m)}this.createRandomWalls(),this.createEdges(),this.initializeGraphCells(),this.update(),this.createAnimation(),this.animator.playMaster(),this.animator.pause()}onClick(e,t){const s=this.graph.getVertex(`${e},${t}`);switch(this.mode){case"wall":if(e==this.startI&&t==this.startJ)return;s.isWall=!s.isWall,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update();break;case"search":if(s.isWall)return;if(e==this.startI&&t==this.startJ){this.animator.playMaster();return}this.startI=e,this.startJ=t,this.createAnimation(),this.animator.playMaster();break}}createRandomWalls(){for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){const a=Math.random()<.2;this.graph.getVertex(`${t},${s}`).isWall=a}this.graph.getVertex(`${this.startI},${this.startJ}`).isWall=!1}initializeGraphCells(){const e=this.getViewSpace(),t=this.getWorldSpace(),s=8,a=.1,i=(s-a*(this.size-1))/this.size,r=i+a;this.cellWidth=i;const o=new w(-s/2,-s/2);for(let n=0;n<this.size;n++)for(let c=0;c<this.size;c++){const d=this.graph.getVertex(`${n},${c}`);d.visited=!1,d.prevId=null,d.depth=-1;const m=new w(o.x+c*r+i/2,o.y+(this.size-1-n)*r+i/2),p=d.cell;p.data.layer.set(1),p.data.extents.set(i/2,i/2,t),p.data.position.setV(m,t),p.data.anchor.set(0,0),p.data.pointerEvents.set("auto");const g=d.cellEmph;g.data.layer.set(2),g.data.extents.set(1,1,e),g.data.position.setV(m,t),g.data.anchor.set(0,0),g.data.opacity.set(0)}}setInitialStyle(){const e=this.getViewSpace();for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){const a=this.graph.getVertex(`${t},${s}`);a.visited=!1,a.prevId=null,a.depth=-1;const i=a.cell;i.data.layer.set(1),i.data.fill.color.setFromTheme(l,"back",1),i.data.stroke.color.setFromTheme(l,"back",5),i.data.stroke.width.set(2,e),i.data.pointerEvents.set("auto");const r=a.cellEmph;r.data.layer.set(2),r.data.opacity.set(1),r.data.fill.color.setFromTheme(l,"main",1),r.data.stroke.color.setFromTheme(l,"main",5),r.data.stroke.width.set(2,e),r.data.opacity.set(0),a.isWall&&(i.data.fill.color.setFromTheme(l,"wall",10),i.data.stroke.color.setFromTheme(l,"wall",10))}}createEdges(){this.graph.clearEdges();for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)for(let s=0;s<this.directionOrder.length;s++){let a=s;this.traversal==="dfs"&&(a=this.directionOrder.length-1-s);const i=this.directionOrder[a],r=this.directionVectors[i],o=e+r[0],n=t+r[1];o<0||o>=this.size||n<0||n>=this.size||this.graph.getVertex(`${o},${n}`).isWall||this.graph.setEdge(`${e},${t}`,`${o},${n}`,{})}}createAnimation(){switch(this.traversal){case"bfs":this.createBFSAnimation();break;case"dfs":this.createDFSAnimation();break}}createBFSAnimation(){const e=`${this.startI},${this.startJ}`;this.animator.stop(),this.animator.reset(),this.animator=new S(this),this.setInitialStyle();const t=new G,s=this.size*this.size;t.enqueue(e),this.graph.getVertex(e).depth=0,this.graph.getVertex(e).visited=!0;let a=0,i=50,r=500;this.stepByStep&&(i=300,r=300);const o=this.graph.getVertex(e);for(o.depth=0,o.visited=!0;t.length>0;){const n=t.dequeue(),c=this.graph.getVertex(n),d=n===e;this.animateVisitVertex(c,d,s,a,r,i),this.stepByStep&&this.animator.makeStep(),a+=i;for(const m of this.graph.edgesOf(n)){const p=m.to,g=this.graph.getVertex(p);g.visited||(t.enqueue(p),g.prevId=n,g.depth=c.depth+1,g.visited=!0)}}this.animator.finalize(),this.animator.setMasterElapsed(0),this.update()}createDFSAnimation(){const e=`${this.startI},${this.startJ}`;this.animator.stop(),this.animator.reset(),this.animator=new S(this),this.setInitialStyle();const t=[],s=this.size*this.size;t.push(e),this.graph.getVertex(e).depth=0;let a=0,i=50,r=500;for(this.stepByStep&&(i=300,r=300);t.length>0;){const o=t.pop(),n=this.graph.getVertex(o);if(n.visited)continue;n.visited=!0;const c=o===e;this.animateVisitVertex(n,c,s,a,r,i),this.stepByStep&&this.animator.makeStep(),a+=i;for(const d of this.graph.edgesOf(o)){const m=d.to,p=this.graph.getVertex(m);p.visited||(t.push(m),p.prevId=o,p.depth=n.depth+1)}}this.animator.finalize(),this.animator.setMasterElapsed(0),this.update()}animateVisitVertex(e,t,s,a,i,r){const o=k.clamp01(e.depth/s);t?e.circle.data.fill.color.setFromTheme(l,"back",12):this.treeColorScale.getInto(e.circle.data.fill.color,o),e.circle.data.isEnabled.set(!0),e.circle.data.layer.set(4),e.circle.data.position.copy(e.cell.data.position),e.circle.data.radius.set(1,this.getViewSpace()),e.circle.data.opacity.set(0);const n=v.create(this,e.circle.data.radius).setCycleDuration(i).setEasing(f.out);t?e.circle.data.radius.set(this.cellWidth/4,this.getWorldSpace()):e.circle.data.radius.set(5,this.getViewSpace()),this.animator.addAnimation(n.commitFinalState(),"timeline-start",a);const c=new E(e.circle.data.opacity,0);this.animator.addTrigger(c,"timeline-start",0);const d=new E(e.circle.data.opacity,1);this.animator.addTrigger(d,"timeline-start",a+1),this.fillColorScale.getInto(e.cellEmph.data.fill.color,o),this.strokeColorScale.getInto(e.cellEmph.data.stroke.color,o);const m=v.create(this,e.cellEmph.data.opacity).setCycleDuration(i).setEasing(f.out);e.cellEmph.data.opacity.set(1),this.animator.addAnimation(m.commitFinalState(),"timeline-start",a);const p=v.create(this,e.cellEmph.data.extents).setCycleDuration(i).setEasing(f.out);if(e.cellEmph.data.extents.set(this.cellWidth/2,this.cellWidth/2,this.getWorldSpace()),this.animator.addAnimation(p.commitFinalState(),"timeline-start",a),e.prevId!==null){const g=this.graph.getVertex(e.prevId);e.lineToPrev.data.isEnabled.set(!0),e.lineToPrev.data.layer.set(3),e.lineToPrev.data.startPosition.copy(g.cell.data.position),e.lineToPrev.data.endPosition.copy(e.cell.data.position),e.lineToPrev.data.stroke.color.setFromTheme(l,"back",12),e.lineToPrev.data.stroke.width.set(3,this.getViewSpace()),e.lineToPrev.data.pathFrom.set(0),e.lineToPrev.data.pathTo.set(0),e.lineToPrev.data.opacity.set(0),this.treeColorScale.getInto(e.lineToPrev.data.stroke.color,o);const L=new E(e.lineToPrev.data.opacity,0);this.animator.addTrigger(L,"timeline-start",0);const M=new E(e.lineToPrev.data.opacity,1);this.animator.addTrigger(M,"timeline-start",a);const I=v.create(this,e.lineToPrev.data.pathTo).setCycleDuration(r).setEasing(f.linear);e.lineToPrev.data.pathTo.set(1),this.animator.addAnimation(I.commitFinalState(),"timeline-start",a)}}setDirectionOrder(e){if(e.length!==4)throw new Error("Direction order must have exactly 4 elements.");this.directionOrder=e,this.createEdges(),this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setStepByStep(e){this.stepByStep=e,this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}setMode(e){this.mode=e}setTraversal(e){this.traversal=e,this.createAnimation(),this.animator.setMasterElapsed(this.animator.getMasterDuration()),this.update()}}class H{container;scene;stepIndex=-1;constructor(e,t){this.container=e,this.scene=t}init(){this.container.classList.add("graph-search-controls"),this.container.append(this.createTraversalCard(),this.createDirectionOrderCard(),this.createInteractionModeCard(),this.createAnimationModeCard())}createTraversalCard(){const e=this.createCard("Type de parcours","Choisit la stratégie d’exploration du graphe."),t=this.createRadio("traversal","dfs","DFS",!0),s=this.createRadio("traversal","bfs","BFS",!1);return s.input.addEventListener("change",()=>{this.scene.setTraversal("bfs")}),t.input.addEventListener("change",()=>{this.scene.setTraversal("dfs")}),e.body.append(t.label,s.label),e.root}swapElements(e,t){const s=e.parentNode;if(!s||s!==t.parentNode)return;const a=document.createTextNode("");s.insertBefore(a,e),s.insertBefore(e,t),s.insertBefore(t,a),s.removeChild(a)}createDirectionOrderCard(){const e=this.createCard("Ordre des voisins","Définit l’ordre dans lequel les voisins sont explorés."),t=document.createElement("ul");t.className="dir-list";const s=[{dir:"U",icon:"fa-up-long"},{dir:"D",icon:"fa-down-long"},{dir:"L",icon:"fa-left-long"},{dir:"R",icon:"fa-right-long"}];let a=null;for(const i of s){const r=document.createElement("li");r.draggable=!0,r.dataset.dir=i.dir;const o=document.createElement("i");o.classList.add("fa-solid",i.icon),r.append(o),r.addEventListener("dragstart",()=>{a=r,r.classList.add("dragging")}),r.addEventListener("dragend",()=>{a=null,r.classList.remove("dragging")}),r.addEventListener("dragover",n=>{if(n.preventDefault(),!a||a===r)return;n.target.classList.add("over")}),r.addEventListener("dragleave",n=>{if(n.preventDefault(),!a||a===r)return;n.target.classList.remove("over")}),r.addEventListener("drop",n=>{n.preventDefault(),!(!a||a===r)&&r.classList.remove("over")}),t.appendChild(r)}return t.addEventListener("drop",i=>{i.preventDefault();const r=i.target;if(!a||r===a||r.tagName!=="LI")return;r.classList.remove("over"),this.swapElements(a,r);const o=Array.from(t.children).map(n=>n.dataset.dir);this.scene.setDirectionOrder(o)}),e.body.appendChild(t),e.root}createInteractionModeCard(){const e=this.createCard("Interaction","Choisit ce que fait un clic sur la grille."),t=document.createElement("select");return t.innerHTML=`
            <option value="search">Choisir le départ</option>
            <option value="wall">Modifier les murs</option>
        `,t.addEventListener("change",()=>{this.scene.animator.stop();const s=t.value;this.scene.setMode(s)}),e.body.appendChild(t),e.root}createAnimationModeCard(){const e=this.createCard("Animation","Contrôle la vitesse de l’animation.");let t=!1;const s=document.createElement("input");s.type="checkbox";const a=document.createElement("label");a.append(s,document.createTextNode(" Pas à pas"));const i=document.createElement("div");i.className="playback-controls";const r=document.createElement("button");r.innerHTML='<i class="fa-solid fa-stop"></i>',r.classList.add("anim-button");const o=document.createElement("button");o.innerHTML='<i class="fa-solid fa-play"></i>',o.classList.add("anim-button");const n=document.createElement("button");n.innerHTML='<i class="fa-solid fa-step-forward"></i>',n.disabled=!0,n.classList.add("anim-button");const c=document.createElement("button");return c.innerHTML='<i class="fa-solid fa-step-backward"></i>',c.disabled=!0,c.classList.add("anim-button"),r.addEventListener("click",()=>{console.log("stop"),o.innerHTML='<i class="fa-solid fa-play"></i>',this.stepIndex=-1,this.scene.animator.stop(),this.scene.animator.setRangeAsMaster(),this.scene.animator.setMasterElapsed(0),this.scene.update(),t=!1}),o.addEventListener("click",()=>{console.log("play/pause"),t?(this.scene.animator.pause(),o.innerHTML='<i class="fa-solid fa-play"></i>'):(this.scene.animator.setRangeAsMaster(),this.scene.animator.getElapsed()>=this.scene.animator.getMasterDuration()&&this.scene.animator.setMasterElapsed(0),this.scene.animator.resume(),o.innerHTML='<i class="fa-solid fa-pause"></i>'),t=!t}),n.addEventListener("click",()=>{o.innerHTML='<i class="fa-solid fa-play"></i>';const d=this.scene.animator.getElapsed();d<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(d-1),this.stepIndex=k.clamp(this.stepIndex+1,0,this.scene.animator.getStepCount()-1),this.scene.animator.setRangeAsStep(this.stepIndex),this.scene.animator.resetStep(this.stepIndex),this.scene.animator.resume()}),c.addEventListener("click",()=>{o.innerHTML='<i class="fa-solid fa-play"></i>';const d=this.scene.animator.getElapsed();d<1?this.stepIndex=-1:this.stepIndex=this.scene.animator.getStepIndexFromElapsed(d-1),this.scene.animator.resetStep(this.stepIndex),this.scene.update()}),s.addEventListener("change",()=>{this.scene.setStepByStep(s.checked),s.checked?(n.disabled=!1,c.disabled=!1):(n.disabled=!0,c.disabled=!0)}),i.append(o,r,c,n),e.body.append(a,i),e.root}createCard(e,t){const s=document.createElement("div");s.className="ui-card";const a=document.createElement("h3");a.textContent=e;const i=document.createElement("p");i.textContent=t;const r=document.createElement("div");return r.className="ui-card-body",s.append(a,i,r),{root:s,body:r}}createRadio(e,t,s,a=!1){const i=document.createElement("input");i.type="radio",i.name=e,i.value=t,i.checked=a;const r=document.createElement("label");return r.append(i,document.createTextNode(" "+s)),{input:i,label:r}}}class q{container;scene;index=-1;constructor(e,t){this.container=e,this.scene=t}init(){this.container.classList.add("graph-search-navigation"),this.container.append(this.createSlider())}createSlider(){const e=document.createElement("input");return e.type="range",e.style.width="50%",e.addEventListener("input",()=>{const s=e.valueAsNumber/100*this.scene.animator.getMasterDuration();this.scene.animator.stop(),this.scene.animator.setMasterElapsed(s),this.index=this.scene.animator.getStepIndexFromElapsed(s),this.scene.getSVG().update()}),e}}class J{scene;controls;navigation;constructor(e){const t=document.createElement("div");t.className="controls";const s=document.createElement("div");s.className="figure";const a=document.createElement("div");a.className="navigation";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("responsive-svg"),i.setAttribute("preserveAspectRatio","xMidYMid meet"),s.appendChild(i),e.append(t,s,a),this.scene=new j(i),this.controls=new H(t,this.scene),this.controls.init(),this.navigation=new q(a,this.scene),this.navigation.init()}}const x=document.getElementById("graph-search-figure");if(!x)throw new Error("Figure container not found");new J(x);
