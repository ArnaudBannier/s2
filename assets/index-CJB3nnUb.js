(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class W{elements=[0,0,0,0,0,0];constructor(t=0,e=0,s=0,i=0,n=0,a=0){this.set(t,e,s,i,n,a)}static createIdentity(){return new W(1,0,0,0,1,0)}static lerp(t,e,s){return new W().lerp(t,e,s)}static eq(t,e,s=1e-4){for(let i=0;i<6;i++)if(Math.abs(t.elements[i]-e.elements[i])>=s)return!1;return!0}lerp(t,e,s){const i=1-s;for(let n=0;n<6;n++)this.elements[n]=i*t.elements[n]+s*e.elements[n];return this}set(t=0,e=0,s=0,i=0,n=0,a=0){return this.elements[0]=t,this.elements[2]=e,this.elements[4]=s,this.elements[1]=i,this.elements[3]=n,this.elements[5]=a,this}fromArray(t,e=0){for(let s=0;s<6;s++)this.elements[s]=t[s+e];return this}isIdentity(){const t=this.elements;return t[0]===1&&t[2]===0&&t[4]===0&&t[1]===0&&t[3]===1&&t[5]===0}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,a=s[0],h=s[1],c=s[2],u=s[3],f=s[4],p=s[5],m=i[0],w=i[1],C=i[2],_=i[3],I=i[4],T=i[5];return n[0]=a*m+c*w,n[1]=h*m+u*w,n[2]=a*C+c*_,n[3]=h*C+u*_,n[4]=a*I+c*T+f,n[5]=h*I+u*T+p,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}copy(t){for(let e=0;e<6;e++)this.elements[e]=t.elements[e];return this}clone(){return new W().copy(this)}makeIdentity(){return this.set(1,0,0,0,1,0)}makeTranslation(t,e){return this.set(1,0,t,0,1,e)}makeScale(t,e){return this.set(t,0,0,0,e,0)}makeScaleFrom(t,e,s,i){return this.set(t,0,-t*s+s,0,e,-e*i+i)}makeRotationRad(t){const e=Math.sin(t),s=Math.cos(t);return this.set(s,-e,0,+e,s,0)}makeRotationDeg(t){return this.makeRotationRad(t*Math.PI/180)}makeRotationFromRad(t,e,s){const i=Math.sin(t),n=Math.cos(t);return this.set(n,-i,-e*n+s*i+e,+i,n,-s*n-e*i+s)}makeRotationFromDeg(t,e,s){return this.makeRotationFromRad(t*Math.PI/180,e,s)}}class l{x;y;constructor(t=0,e=0){this.x=t,this.y=e}static fromPolarRad(t,e=1){return new l(e*Math.cos(t),e*Math.sin(t))}static fromPolarDeg(t,e=1){return t*=Math.PI/180,new l(e*Math.cos(t),e*Math.sin(t))}static add(t,e){return new l(t.x+e.x,t.y+e.y)}static sub(t,e){return new l(t.x-e.x,t.y-e.y)}static mul(t,e){return new l(t.x*e.x,t.y*e.y)}static scale(t,e){return new l(t.x*e,t.y*e)}static lerp(t,e,s){const i=1-s;return new l(i*t.x+s*e.x,i*t.y+s*e.y)}static eq(t,e,s=1e-4){return Math.abs(t.x-e.x)<s&&Math.abs(t.y-e.y)<s}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPolarRad(t,e=1){return this.set(e*Math.cos(t),e*Math.sin(t))}setFromPolarDeg(t,e=1){return t*=Math.PI/180,this.set(e*Math.cos(t),e*Math.sin(t))}shiftX(t){return this.x+=t,this}shiftY(t){return this.y+=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new l(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return this.x+=t,this.y+=e,this}addV(t){return this.x+=t.x,this.y+=t.y,this}sub(t,e){return this.x-=t,this.y-=e,this}subV(t){return this.x-=t.x,this.y-=t.y,this}mul(t,e){return this.x*=t,this.y*=e,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}scale(t){return this.x*=t,this.y*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this}min(t,e){return this.x=Math.min(this.x,t),this.y=Math.min(this.y,e),this}minV(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t,e){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,e),this}maxV(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}apply2x2(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i,this.y=e[1]*s+e[3]*i,this}apply2x3(t){const e=t.elements,s=this.x,i=this.y;return this.x=e[0]*s+e[2]*i+e[4],this.y=e[1]*s+e[3]*i+e[5],this}dot(t){return this.x*t.x+this.y*t.y}det(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceSq(t){const e=t.x-this.x,s=t.y-this.y;return e*e+s*s}distance(t){return Math.sqrt(this.distanceSq(t))}normalize(){return this.length()===0?this:this.scale(1/this.length())}setLength(t){return this.scale(t/this.length())}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}angle(){return Math.atan2(-this.y,this.x)}angleTo(t){const e=this.det(t),s=this.dot(t);return Math.atan2(e,s)}perp(t=!1){const e=this.x,s=t?-1:1;return this.x=-s*this.y,this.y=s*e,this}rotateRad(t){const e=Math.sin(t),s=Math.cos(t),i=this.x,n=this.y;return this.x=s*i-e*n,this.y=e*i+s*n,this}rotateDeg(t){return this.rotateRad(t*Math.PI/180)}*[Symbol.iterator](){yield this.x,yield this.y}}class _t{position;viewExtents;viewScale;viewport;constructor(t,e,s,i=1){this.position=t,this.viewExtents=e,this.viewport=s,this.viewScale=i}viewToWorldX(t){const e=t/this.viewport.x,s=2*this.viewExtents.x*this.viewScale;return this.position.x-this.viewExtents.x*this.viewScale+e*s}viewToWorldY(t){const e=1-t/this.viewport.y,s=2*this.viewExtents.y*this.viewScale;return this.position.y-this.viewExtents.y*this.viewScale+e*s}viewToWorld(t,e){return new l(this.viewToWorldX(t),this.viewToWorldY(e))}viewToWorldV(t){return this.viewToWorld(t.x,t.y)}viewToWorldLength(t){return t*this.getViewToWorldScaleX()}getWorldToViewScaleX(){return .5*this.viewport.x/(this.viewExtents.x*this.viewScale)}getWorldToViewScaleY(){return .5*this.viewport.y/(this.viewExtents.y*this.viewScale)}getViewToWorldScaleX(){return 2*(this.viewExtents.x*this.viewScale)/this.viewport.x}getViewToWorldScaleY(){return 2*(this.viewExtents.y*this.viewScale)/this.viewport.y}worldToViewX(t){const e=this.getWorldToViewScaleX();return(t-(this.position.x-this.viewExtents.x*this.viewScale))*e}worldToViewY(t){const e=this.getWorldToViewScaleY();return(this.position.y+this.viewExtents.y*this.viewScale-t)*e}worldToView(t,e){return new l(this.worldToViewX(t),this.worldToViewY(e))}worldToViewV(t){return this.worldToView(t.x,t.y)}worldToViewLength(t){return t*this.getWorldToViewScaleX()}getLower(){return l.sub(this.position,l.scale(this.viewExtents,this.viewScale))}getUpper(){return l.add(this.position,l.scale(this.viewExtents,this.viewScale))}}function Bt(o,t,e){return Math.max(t,Math.min(e,o))}function rt(o,t,e){return(1-e)*o+e*t}function at(o,t,e){return o!==t?(e-o)/(t-o):0}function It(o,t,e,s,i){return rt(e,s,at(o,t,i))}class b{static clamp(t,e,s){return Math.max(e,Math.min(s,t))}static lerp(t,e,s){return(1-s)*t+s*e}static invLerp(t,e,s){return t!==e?(s-t)/(e-t):0}static remap(t,e,s,i,n){return rt(s,i,at(t,e,n))}}var L=(o=>(o.Normal="normal",o.Important="important",o))(L||{});class U{priority="normal";dirty=!0;owner=null;setOwner(t=null){this.owner=t}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}clearDirty(){this.dirty=!1}setPriority(t){return this.priority===t?this:(this.priority=t,this.markDirty(),this)}}class S extends U{kind="enum";value;constructor(t,e="normal"){super(),this.value=t,this.priority=e}clone(){return new S(this.value,this.priority)}copy(t){return this.priority==="important"?this:this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}}class ot extends U{kind="string";value;constructor(t="",e="normal"){super(),this.value=t,this.priority=e}clone(){return new ot(this.value,this.priority)}copy(t){return this.priority==="important"?this:this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value}}class st extends U{kind="boolean";value;constructor(t=!1,e="normal"){super(),this.value=t,this.priority=e}clone(){return new st(this.value,this.priority)}copy(t){return this.priority==="important"?this:this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toString(){return this.value.toString()}}class g extends U{kind="number";value;constructor(t,e="normal"){super(),this.value=t,this.priority=e}clone(){return new g(this.value,this.priority)}copy(t){return this.priority==="important"?this:this.value===t.value?this:(this.value=t.value,this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(b.lerp(i,n,s)),this}static lerp(t,e,s){return new g(0).lerp(t,e,s)}set(t){return this.value===t?this:(this.value=t,this.markDirty(),this)}get(){return this.value}toFixed(t=2){return this.value.toFixed(t)}}class r extends U{kind="color";r;g;b;constructor(t=0,e=0,s=0,i="normal"){super(),this.r=t,this.g=e,this.b=s,this.priority=i}clone(){return new r(this.r,this.g,this.b,this.priority)}hardCopy(t){return this.r===t.r&&this.g===t.g&&this.b===t.b?this:(this.r=t.r,this.g=t.g,this.b=t.b,this.markDirty(),this)}copy(t){return this.priority==="important"?this:this.r===t.r&&this.g===t.g&&this.b===t.b?this:(this.r=t.r,this.g=t.g,this.b=t.b,this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get(),a=b.lerp(i.r,n.r,s),h=b.lerp(i.g,n.g,s),c=b.lerp(i.b,n.b,s);return this.set(a,h,c),this}static lerp(t,e,s){return new r().lerp(t,e,s)}set(t,e,s){return this.r===t&&this.g===e&&this.b===s?this:(this.r=t,this.g=e,this.b=s,this.markDirty(),this)}setFromHex(t){if(!/^#([0-9A-Fa-f]{6})$/.test(t))throw new Error(`Invalid hex color: ${t}`);const e=parseInt(t.substring(1),16);return this.r=e>>16&255,this.g=e>>8&255,this.b=e&255,this.markDirty(),this}static fromHex(t){return new r().setFromHex(t)}toHex(){return"#"+[this.r,this.g,this.b].map(t=>t.toString(16).padStart(2,"0")).join("")}toRgb(){return`rgb(${Math.floor(this.r)}, ${Math.floor(this.g)}, ${Math.floor(this.b)})`}get(){return{r:this.r,g:this.g,b:this.b}}}class x extends U{kind="position";value;space;constructor(t=0,e=0,s="world",i="normal"){super(),this.value=new l(t,e),this.space=s,this.priority=i}clone(){return new x(this.value.x,this.value.y,this.space,this.priority)}copy(t){return this.priority==="important"?this:l.eq(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.setV(l.lerp(a,h,s),n),this}static lerp(t,e,s,i){return new x().lerp(t,e,s,i)}set(t=0,e=0,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return l.eq(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s,i){return this.value.x===s&&this.value.y===i&&this.space===t?this:(this.space===t?this.value.set(s,i):this.space==="world"?(this.value.x=e.viewToWorldX(s),this.value.y=e.viewToWorldY(i)):(this.value.x=e.worldToViewX(s),this.value.y=e.worldToViewY(i)),this.markDirty(),this)}get(t,e){return this.toSpace(t,e)}changeSpace(t,e){return this.space===t?this:(this.space==="world"?(this.value.x=e.worldToViewX(this.value.x),this.value.y=e.worldToViewY(this.value.y)):(this.value.x=e.viewToWorldX(this.value.x),this.value.y=e.viewToWorldY(this.value.y)),this.space=t,this)}toSpace(t,e){return x.toSpace(this.value,this.space,t,e)}static toSpace(t,e,s,i){return e===s?t.clone():e==="world"?i.worldToViewV(t):i.viewToWorldV(t)}}class D extends U{kind="length";value;space;constructor(t=0,e="world",s="normal"){super(),this.value=t,this.space=e,this.priority=s}clone(){return new D(this.value,this.space,this.priority)}copy(t){return this.priority==="important"?this:this.value===t.value&&this.space===t.space?this:(this.value=t.value,this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.set(b.lerp(a,h,s),n),this}static lerp(t,e,s,i){return new D().lerp(t,e,s,i)}set(t,e){return this.value===t&&this.space===e?this:(this.value=t,e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s){return this.value===s&&this.space===t?this:(this.space===t?this.value=s:this.space==="world"?this.value=e.viewToWorldLength(s):this.value=e.worldToViewLength(s),this.markDirty(),this)}get(t,e){return this.toSpace(t,e)}changeSpace(t,e){return this.space===t?this:(this.space==="world"?this.value=e.worldToViewLength(this.value):this.value=e.viewToWorldLength(this.value),this.space=t,this)}toSpace(t,e){return D.toSpace(this.value,this.space,t,e)}static toSpace(t,e,s,i){return e===s?t:e==="world"?i.worldToViewLength(t):i.viewToWorldLength(t)}}class E extends U{kind="extents";value;space;constructor(t=0,e=0,s="world",i="normal"){super(),this.value=new l(t,e),this.space=s,this.priority=i}clone(){return new E(this.value.x,this.value.y,this.space,this.priority)}copy(t){return this.priority==="important"?this:l.eq(this.value,t.value)&&this.space===t.space?this:(this.value.copy(t.value),this.space=t.space,this.markDirty(),this)}lerp(t,e,s,i){const n=e.space,a=t.get(n,i),h=e.get(n,i);return this.setV(l.lerp(a,h,s),n),this}static lerp(t,e,s,i){return new E().lerp(t,e,s,i)}set(t,e,s){return this.value.x===t&&this.value.y===e&&this.space===s?this:(this.value.set(t,e),s&&(this.space=s),this.markDirty(),this)}setV(t,e){return l.eq(this.value,t)&&this.space===e?this:(this.value.copy(t),e&&(this.space=e),this.markDirty(),this)}setValueFromSpace(t,e,s,i){return this.value.x===s&&this.value.y===i&&this.space===t?this:(this.space===t?this.value.set(s,i):this.space==="world"?(this.value.x=e.viewToWorldLength(s),this.value.y=e.viewToWorldLength(i)):(this.value.x=e.worldToViewLength(s),this.value.y=e.worldToViewLength(i)),this.markDirty(),this)}get(t,e){return this.toSpace(t,e)}changeSpace(t,e){return this.space===t?this:(this.space==="world"?(this.value.x=e.worldToViewLength(this.value.x),this.value.y=e.worldToViewLength(this.value.y)):(this.value.x=e.viewToWorldLength(this.value.x),this.value.y=e.viewToWorldLength(this.value.y)),this.space=t,this.markDirty(),this)}toSpace(t,e){return E.toSpace(this.value,this.space,t,e)}static toSpace(t,e,s,i){return e===s?t.clone():e==="world"?new l(i.worldToViewLength(t.x),i.worldToViewLength(t.y)):new l(i.viewToWorldLength(t.x),i.viewToWorldLength(t.y))}}class R extends U{kind="transform";value;constructor(t=1,e=0,s=0,i=0,n=1,a=0,h="normal"){super(),this.value=new W(t,e,s,i,n,a),this.priority=h}clone(){return new R().copy(this)}copy(t){return this.priority==="important"?this:W.eq(this.value,t.value)?this:(this.value.copy(t.value),this.markDirty(),this)}lerp(t,e,s){const i=t.get(),n=e.get();return this.set(W.lerp(i,n,s)),this}static lerp(t,e,s){return new R().lerp(t,e,s)}set(t){return W.eq(this.value,t)?this:(this.value.copy(t),this.markDirty(),this)}hasActiveHierarchy(){return this.priority==="normal"}get(){return this.value}toFixed(t=2){return"matrix("+this.value.elements.map(e=>e.toFixed(t)).join(", ")+")"}}class Et extends U{kind="bbox";center;extents;constructor(){super(),this.center=new x(0,0,"view"),this.extents=new E(0,0,"view")}set(t,e,s){if(!t.isConnected){console.warn("Element is not connected to DOM, cannot compute bbox",t.isConnected);return}const i=t.getBBox(),n=e?e.toSpace("view",s):new l(0,0),a=new l(i.x+i.width/2,i.y+i.height/2).subV(n);this.center.setV(a,"view"),this.extents.set(i.width/2,i.height/2,"view"),this.markDirty()}getCenter(t,e){return this.center.toSpace(t,e)}getExtents(t,e){return this.extents.toSpace(t,e)}getLower(t,e){const s=this.getCenter(t,e),i=this.getExtents(t,e);return s.subV(i)}getUpper(t,e){const s=this.getCenter(t,e),i=this.getExtents(t,e);return s.addV(i)}}const v={RED:new r(244,67,54),PINK:new r(233,30,99),PURPLE:new r(156,39,176),DEEP_PURPLE:new r(103,58,183),INDIGO:new r(63,81,181),BLUE:new r(33,150,243),LIGHT_BLUE:new r(3,169,244),CYAN:new r(0,188,212),TEAL:new r(0,150,136),GREEN:new r(76,175,80),LIGHT_GREEN:new r(139,195,74),LIME:new r(205,220,57),YELLOW:new r(255,235,59),AMBER:new r(255,193,7),ORANGE:new r(255,152,0),DEEP_ORANGE:new r(255,87,34),BROWN:new r(121,85,72),GREY:new r(158,158,158),BLUE_GREY:new r(96,125,139),BLACK:new r(0,0,0),WHITE:new r(255,255,255),RED_0:new r(255,235,238),RED_1:new r(255,205,210),RED_2:new r(239,154,154),RED_3:new r(229,115,115),RED_4:new r(239,83,80),RED_5:new r(244,67,54),RED_6:new r(229,57,53),RED_7:new r(211,47,47),RED_8:new r(198,40,40),RED_9:new r(183,28,28),PINK_0:new r(252,228,236),PINK_1:new r(248,187,208),PINK_2:new r(244,143,177),PINK_3:new r(240,98,146),PINK_4:new r(236,64,122),PINK_5:new r(233,30,99),PINK_6:new r(216,27,96),PINK_7:new r(194,24,91),PINK_8:new r(173,20,87),PINK_9:new r(136,14,79),PURPLE_0:new r(243,229,245),PURPLE_1:new r(225,190,231),PURPLE_2:new r(206,147,216),PURPLE_3:new r(186,104,200),PURPLE_4:new r(171,71,188),PURPLE_5:new r(156,39,176),PURPLE_6:new r(142,36,170),PURPLE_7:new r(123,31,162),PURPLE_8:new r(106,27,154),PURPLE_9:new r(74,20,140),DEEP_PURPLE_0:new r(237,231,246),DEEP_PURPLE_1:new r(209,196,233),DEEP_PURPLE_2:new r(179,157,219),DEEP_PURPLE_3:new r(149,117,205),DEEP_PURPLE_4:new r(126,87,194),DEEP_PURPLE_5:new r(103,58,183),DEEP_PURPLE_6:new r(94,53,177),DEEP_PURPLE_7:new r(81,45,168),DEEP_PURPLE_8:new r(69,39,160),DEEP_PURPLE_9:new r(49,27,146),INDIGO_0:new r(232,234,246),INDIGO_1:new r(197,202,233),INDIGO_2:new r(159,168,218),INDIGO_3:new r(121,134,203),INDIGO_4:new r(92,107,192),INDIGO_5:new r(63,81,181),INDIGO_6:new r(57,73,171),INDIGO_7:new r(48,63,159),INDIGO_8:new r(40,53,147),INDIGO_9:new r(26,35,126),BLUE_0:new r(227,242,253),BLUE_1:new r(187,222,251),BLUE_2:new r(144,202,249),BLUE_3:new r(100,181,246),BLUE_4:new r(66,165,245),BLUE_5:new r(33,150,243),BLUE_6:new r(30,136,229),BLUE_7:new r(25,118,210),BLUE_8:new r(21,101,192),BLUE_9:new r(13,71,161),LIGHT_BLUE_0:new r(225,245,254),LIGHT_BLUE_1:new r(179,229,252),LIGHT_BLUE_2:new r(129,212,250),LIGHT_BLUE_3:new r(79,195,247),LIGHT_BLUE_4:new r(41,182,246),LIGHT_BLUE_5:new r(3,169,244),LIGHT_BLUE_6:new r(3,155,229),LIGHT_BLUE_7:new r(2,136,209),LIGHT_BLUE_8:new r(2,119,189),LIGHT_BLUE_9:new r(1,87,155),CYAN_0:new r(224,247,250),CYAN_1:new r(178,235,242),CYAN_2:new r(128,222,234),CYAN_3:new r(77,208,225),CYAN_4:new r(38,198,218),CYAN_5:new r(0,188,212),CYAN_6:new r(0,172,193),CYAN_7:new r(0,151,167),CYAN_8:new r(0,131,143),CYAN_9:new r(0,96,100),TEAL_0:new r(224,242,241),TEAL_1:new r(178,223,219),TEAL_2:new r(128,203,196),TEAL_3:new r(77,182,172),TEAL_4:new r(38,166,154),TEAL_5:new r(0,150,136),TEAL_6:new r(0,137,123),TEAL_7:new r(0,121,107),TEAL_8:new r(0,105,92),TEAL_9:new r(0,77,64),GREEN_0:new r(232,245,233),GREEN_1:new r(200,230,201),GREEN_2:new r(165,214,167),GREEN_3:new r(129,199,132),GREEN_4:new r(102,187,106),GREEN_5:new r(76,175,80),GREEN_6:new r(67,160,71),GREEN_7:new r(56,142,60),GREEN_8:new r(46,125,50),GREEN_9:new r(27,94,32),LIGHT_GREEN_0:new r(241,248,233),LIGHT_GREEN_1:new r(220,237,200),LIGHT_GREEN_2:new r(197,225,165),LIGHT_GREEN_3:new r(174,213,129),LIGHT_GREEN_4:new r(156,204,101),LIGHT_GREEN_5:new r(139,195,74),LIGHT_GREEN_6:new r(124,179,66),LIGHT_GREEN_7:new r(104,159,56),LIGHT_GREEN_8:new r(85,139,47),LIGHT_GREEN_9:new r(51,105,30),LIME_0:new r(249,251,231),LIME_1:new r(240,244,195),LIME_2:new r(230,238,156),LIME_3:new r(220,231,117),LIME_4:new r(212,225,87),LIME_5:new r(205,220,57),LIME_6:new r(192,202,51),LIME_7:new r(175,180,43),LIME_8:new r(158,157,36),LIME_9:new r(130,119,23),YELLOW_0:new r(255,253,231),YELLOW_1:new r(255,249,196),YELLOW_2:new r(255,245,157),YELLOW_3:new r(255,241,118),YELLOW_4:new r(255,238,88),YELLOW_5:new r(255,235,59),YELLOW_6:new r(253,216,53),YELLOW_7:new r(251,192,45),YELLOW_8:new r(249,168,37),YELLOW_9:new r(245,127,23),AMBER_0:new r(255,248,225),AMBER_1:new r(255,236,179),AMBER_2:new r(255,224,130),AMBER_3:new r(255,213,79),AMBER_4:new r(255,202,40),AMBER_5:new r(255,193,7),AMBER_6:new r(255,179,0),AMBER_7:new r(255,160,0),AMBER_8:new r(255,143,0),AMBER_9:new r(255,111,0),ORANGE_0:new r(255,243,224),ORANGE_1:new r(255,224,178),ORANGE_2:new r(255,204,128),ORANGE_3:new r(255,183,77),ORANGE_4:new r(255,167,38),ORANGE_5:new r(255,152,0),ORANGE_6:new r(251,140,0),ORANGE_7:new r(245,124,0),ORANGE_8:new r(239,108,0),ORANGE_9:new r(230,81,0),DEEP_ORANGE_0:new r(251,233,231),DEEP_ORANGE_1:new r(255,204,188),DEEP_ORANGE_2:new r(255,171,145),DEEP_ORANGE_3:new r(255,138,101),DEEP_ORANGE_4:new r(255,112,67),DEEP_ORANGE_5:new r(255,87,34),DEEP_ORANGE_6:new r(244,81,30),DEEP_ORANGE_7:new r(230,74,25),DEEP_ORANGE_8:new r(216,67,21),DEEP_ORANGE_9:new r(191,54,12),BROWN_0:new r(239,235,233),BROWN_1:new r(215,204,200),BROWN_2:new r(188,170,164),BROWN_3:new r(161,136,127),BROWN_4:new r(141,110,99),BROWN_5:new r(121,85,72),BROWN_6:new r(109,76,65),BROWN_7:new r(93,64,55),BROWN_8:new r(78,52,46),BROWN_9:new r(62,39,35),GREY_0:new r(250,250,250),GREY_1:new r(245,245,245),GREY_2:new r(238,238,238),GREY_3:new r(224,224,224),GREY_4:new r(189,189,189),GREY_5:new r(158,158,158),GREY_6:new r(117,117,117),GREY_7:new r(97,97,97),GREY_8:new r(66,66,66),GREY_9:new r(33,33,33),BLUE_GREY_0:new r(236,239,241),BLUE_GREY_1:new r(207,216,220),BLUE_GREY_2:new r(176,190,197),BLUE_GREY_3:new r(144,164,174),BLUE_GREY_4:new r(120,144,156),BLUE_GREY_5:new r(96,125,139),BLUE_GREY_6:new r(84,110,122),BLUE_GREY_7:new r(69,90,100),BLUE_GREY_8:new r(55,71,79),BLUE_GREY_9:new r(38,50,56)};class H{}class P extends H{layer;isActive;constructor(){super(),this.layer=new g(0),this.isActive=new st(!0)}setOwner(t=null){this.layer.setOwner(t),this.isActive.setOwner(t)}clearDirty(){this.layer.clearDirty(),this.isActive.clearDirty()}}class k extends H{color;width;opacity;lineCap;lineJoin;dirty;owner;constructor(){super(),this.color=new r(0,0,0,L.Normal),this.width=new D(0,"view"),this.opacity=new g(1,L.Normal),this.lineCap=new S("round",L.Normal),this.lineJoin=new S("miter",L.Normal),this.dirty=!0,this.owner=null,this.color.setOwner(this),this.width.setOwner(this),this.opacity.setOwner(this),this.lineCap.setOwner(this),this.lineJoin.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.width.copy(t.width),this.opacity.copy(t.opacity),this.lineCap.copy(t.lineCap),this.lineJoin.copy(t.lineJoin)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.width.clearDirty(),this.opacity.clearDirty(),this.lineCap.clearDirty(),this.lineJoin.clearDirty()}}class A extends H{color;opacity;dirty;owner;constructor(){super(),this.color=new r(255,255,255,L.Normal),this.opacity=new g(1,L.Normal),this.dirty=!0,this.owner=null,this.color.setOwner(this),this.opacity.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.color.copy(t.color),this.opacity.copy(t.opacity)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.color.clearDirty(),this.opacity.clearDirty()}}class B extends H{size;weight;relativeLineHeight;relativeAscenderHeight;family;style;dirty;owner;constructor(){super(),this.size=new D(16,"view"),this.weight=new g(400),this.relativeLineHeight=new g(21/16),this.relativeAscenderHeight=new g(16/16),this.family=new ot("system-ui"),this.style=new S("normal"),this.dirty=!0,this.owner=null,this.size.setOwner(this),this.weight.setOwner(this),this.relativeLineHeight.setOwner(this),this.relativeAscenderHeight.setOwner(this),this.family.setOwner(this),this.style.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}copy(t){this.size.copy(t.size),this.weight.copy(t.weight),this.relativeLineHeight.copy(t.relativeLineHeight),this.relativeAscenderHeight.copy(t.relativeAscenderHeight),this.family.copy(t.family),this.style.copy(t.style)}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.size.clearDirty(),this.weight.clearDirty(),this.relativeLineHeight.clearDirty(),this.relativeAscenderHeight.clearDirty(),this.family.clearDirty(),this.style.clearDirty()}}const G="http://www.w3.org/2000/svg";class kt{space="world";position=new l;tangent=new l;strokeWidth=1;pathLength=1}class j{static getCenter(t,e,s,i,n){const a=e==="world"?1:-1,h=n.toSpace(e,s),c=i.toSpace(e,s);switch(t){case"north-west":c.shiftY(-a*h.y).shiftX(+h.x);break;case"north":c.shiftY(-a*h.y);break;case"north-east":c.shiftY(-a*h.y).shiftX(-h.x);break;case"west":c.shiftX(+h.x);break;case"center":break;case"east":c.shiftX(-h.x);break;case"south-west":c.shiftY(+a*h.y).shiftX(+h.x);break;case"south":c.shiftY(+a*h.y);break;case"south-east":c.shiftY(+a*h.y).shiftX(-h.x);break}return c}static getNorthWest(t,e,s,i,n){const a=e==="world"?1:-1,h=n.toSpace(e,s),c=i.toSpace(e,s);switch(t){case"north-west":break;case"north":c.shiftX(-h.x);break;case"north-east":c.shiftX(-2*h.x);break;case"west":c.shiftY(a*h.y);break;case"center":c.shiftY(a*h.y).shiftX(-h.x);break;case"east":c.shiftY(a*h.y).shiftX(-2*h.x);break;case"south-west":c.shiftY(2*a*h.y);break;case"south":c.shiftY(2*a*h.y).shiftX(-h.x);break;case"south-east":c.shiftY(2*a*h.y).shiftX(-2*h.x);break}return c}}class Ft{static computeSizes(t,e,s,i,n){const a=e.reduce((u,f)=>u+f,0),h=2*i+n*Math.max(t.length-1,0),c=Math.max((s-h)/a,t.map((u,f)=>u/e[f]).reduce((u,f)=>Math.max(u,f),0));for(let u=0;u<t.length;u++)t[u]=e[u]*c;return c*a+h}}class O{data;id;dirty;scene;parent;children;childrenChanged;constructor(t,e){this.data=e,this.scene=t,this.id=t.getNextElementId(),this.parent=null,this.children=[],this.childrenChanged=!1,this.dirty=!0,this.data.setOwner(this)}skipUpdate(){return!this.isDirty()||!this.getSVGElement().isConnected}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.parent&&this.parent.markDirty())}clearDirty(){this.dirty=!1,this.data.clearDirty()}setIsActive(t){return this.data.isActive.set(t),this.parent&&this.parent.updateSVGChildren(),this}setParent(t){if(this.parent===t)return this;if(this.parent!==null){const e=this.parent.children.indexOf(this);e!==-1&&(this.parent.children.splice(e,1),this.parent.childrenChanged=!0),this.parent.markDirty()}return t!==null&&(t.children.push(this),t.childrenChanged=!0,t.markDirty()),this.parent=t,this}getParent(){return this.parent}getChildCount(){return this.children.length}getChild(t){return this.children[t]}updateSVGChildren(){if(this.childrenChanged===!1)return this;this.children.sort((i,n)=>i.data.layer.value!==n.data.layer.value?i.data.layer.value-n.data.layer.value:i.id-n.id);const t=[];for(const i of this.children)i.data.isActive&&t.push(i.getSVGElement());const e=this.getSVGElement();return(e.children.length!==t.length||t.some((i,n)=>i!==e.children[n]))&&e.replaceChildren(...t),this.childrenChanged=!1,this}}class Vt extends O{element;constructor(t,e){super(t,new P),this.element=e}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera();this.element.setAttribute("viewBox",`0 0 ${t.viewport.width} ${t.viewport.height}`),this.updateSVGChildren();for(const e of this.children)e.update();this.clearDirty()}}class Mt{svg;activeCamera;nextElementId;nextUpdateId;constructor(t,e){t.innerHTML="",this.activeCamera=e,this.svg=new Vt(this,t),this.svg.update(),this.nextElementId=0,this.nextUpdateId=0}getNextElementId(){return this.nextElementId++}getNextUpdateId(){return this.nextUpdateId++}getActiveCamera(){return this.activeCamera}getSVG(){return this.svg}}class K{curves=[];length=0;cumulativeLengths=[];constructor(){}clone(){const t=new K;for(const e of this.curves)t.curves.push(e.clone());return t.length=this.length,t.cumulativeLengths=this.cumulativeLengths.slice(),t}copy(t){return this.curves=t.curves.map(e=>e.clone()),this.length=t.length,this.cumulativeLengths=t.cumulativeLengths.slice(),this}clear(){return this.curves.length=0,this.length=0,this.cumulativeLengths.length=0,this}getCurve(t){return this.curves[t]}getCurveCount(){return this.curves.length}getLastCurve(){return this.curves[this.curves.length-1]}getCurveParam(t){const e=t*this.length;for(let s=0;s<this.cumulativeLengths.length;s++){const i=this.cumulativeLengths[s];if(e<i)return{index:s,t:at(i-this.curves[s].getLength(),i,e)}}return{index:this.curves.length-1,t:1}}getStart(){return this.curves[0].getStart()}getEnd(){return this.curves[this.curves.length].getEnd()}getStartTangent(){return this.curves[0].getStartTangent()}getEndTangent(){return this.curves[this.curves.length-1].getEndTangent()}updateLength(){this.cumulativeLengths.length=0,this.length=0;for(let t=0;t<this.curves.length;t++)this.length+=this.curves[t].getLength(),this.cumulativeLengths.push(this.length);return this}addLine(t,e){const s=new z(t,e);return this.length+=s.getLength(),this.curves.push(s),s}addQuadratic(t,e,s,i=0){const n=new Z(t,e,s).computeLinearLUT(i);return i>0&&n.computeLinearLUT(i),this.length+=n.getLength(),this.curves.push(n),n}addCubic(t,e,s,i,n=0){const a=new q(t,e,s,i);return n>0&&a.computeLinearLUT(n),this.length+=a.getLength(),this.curves.push(a),a}getPointAt(t){if(this.curves.length===0)return new l(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getPointAt(e.t)}getTangentAt(t){if(this.curves.length===0)return new l(0,0);const e=this.getCurveParam(t);return this.curves[e.index].getTangentAt(e.t)}createPartialCurveTo(t){const e=new K;if(this.curves.length===0)return e;const s=this.getCurveParam(t);for(let i=0;i<s.index;i++)e.curves.push(this.curves[i].clone());return e.curves.push(this.curves[s.index].createPartialCurveTo(s.t)),e.updateLength(),e}createPartialCurveFrom(t){const e=new K;if(this.curves.length===0)return e;const s=this.getCurveParam(t);e.curves.push(this.curves[s.index].createPartialCurveFrom(s.t));for(let i=s.index+1;i<this.curves.length;i++)e.curves.push(this.curves[i].clone());return e.updateLength(),e}createPartialCurveRange(t,e){const s=new K;if(this.curves.length===0||t>=e)return s;const i=this.getCurveParam(t),n=this.getCurveParam(e);if(i.index==n.index)s.curves.push(this.curves[i.index].createPartialCurveRange(i.t,n.t));else{s.curves.push(this.curves[i.index].createPartialCurveFrom(i.t));for(let a=i.index+1;a<n.index;a++)s.curves.push(this.curves[a].clone());s.curves.push(this.curves[n.index].createPartialCurveTo(n.t))}return s.updateLength(),s}getLength(){return this.length}}class z{p0;p1;length;constructor(t,e){this.p0=t.clone(),this.p1=e.clone(),this.length=this.p0.distance(this.p1)}copy(t){return this.p0.copy(t.p0),this.p1.copy(t.p1),this.length=t.length,this}getTangentAt(t){return l.sub(this.p1,this.p0)}getStartTangent(){return l.sub(this.p1,this.p0)}getEndTangent(){return l.sub(this.p1,this.p0)}clone(){return new z(this.p0,this.p1)}getLength(){return this.length}getStart(){return this.p0.clone()}getEnd(){return this.p1.clone()}getPointAt(t){return l.lerp(this.p0,this.p1,t)}createPartialCurveTo(t){return new z(this.p0,this.getPointAt(t))}createPartialCurveFrom(t){return new z(this.getPointAt(t),this.p1)}createPartialCurveRange(t,e){return new z(this.getPointAt(t),this.getPointAt(e))}}class St{points=[];linearLUT=null;sampleCount=0;length=0;copy(t){return this.points=t.points.map(e=>e.clone()),t.linearLUT&&(this.linearLUT=t.linearLUT.slice(),this.length=t.length,this.sampleCount=t.sampleCount),this}getLength(){return this.length}linearize(t){if(this.linearLUT===null)return t;const e=t*(this.sampleCount+0),s=Math.floor(e);return s<0?0:s>=this.linearLUT.length-1?1:rt(this.linearLUT[s],this.linearLUT[s+1],e-s)}computeLinearLUT(t=8){const e=[0];let s=this.getPointAtCasteljau(0),i=0;for(let a=1;a<=t;a++){const h=this.getPointAtCasteljau(a/t);i+=s.distance(h),e.push(i),s=h}this.length=i,this.sampleCount=t,e.forEach((a,h,c)=>{c[h]=a/i}),this.linearLUT=[0];let n=1;for(let a=1;a<=t;a++){const h=a/t;for(;e[n]<h&&n<e.length-1;)n++;this.linearLUT.push(It(e[n-1],e[n],(n-1)/t,n/t,h))}return this}getPointAt(t){return this.getPointAtCasteljau(this.linearize(t))}getBezierPoint(t){return this.points[t]}getBezierPoints(){return this.points.map(t=>t.clone())}}class Z extends St{constructor(t,e,s){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.length=t.distance(s)}clone(){const t=this.points,e=new Z(t[0],t[1],t[2]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[2].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,a=t*t;return new l(i*e[0].x+n*e[1].x+a*e[2].x,i*e[0].y+n*e[1].y+a*e[2].y)}getTangentAtCasteljau(t){const e=this.points;return new l((1-t)*(e[1].x-e[0].x)+t*(e[2].x-e[1].x),(1-t)*(e[1].y-e[0].y)+t*(e[2].y-e[1].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return l.sub(this.points[1],this.points[0])}getEndTangent(){return l.sub(this.points[2],this.points[1])}reduceToCasteljau(t){const e=l.lerp(this.points[0],this.points[1],t),s=l.lerp(this.points[1],this.points[2],t),i=l.lerp(e,s,t);return new Z(this.points[0],e,i)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=l.lerp(this.points[0],this.points[1],t),s=l.lerp(this.points[1],this.points[2],t),i=l.lerp(e,s,t);return new Z(i,s,this.points[2])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}class q extends St{constructor(t,e,s,i){super(),this.points.push(t.clone()),this.points.push(e.clone()),this.points.push(s.clone()),this.points.push(i.clone()),this.length=t.distance(i)}clone(){const t=this.points,e=new q(t[0],t[1],t[2],t[3]);return this.linearLUT&&(e.linearLUT=this.linearLUT.slice(),e.length=this.length,e.sampleCount=this.sampleCount),e}getStart(){return this.points[0].clone()}getEnd(){return this.points[3].clone()}getPointAtCasteljau(t){const e=this.points,s=1-t,i=s*s*s,n=s*s*t*3,a=s*t*t*3,h=t*t*t;return new l(i*e[0].x+n*e[1].x+a*e[2].x+h*e[3].x,i*e[0].y+n*e[1].y+a*e[2].y+h*e[3].y)}getTangentAtCasteljau(t){const e=this.points,s=1-t,i=s*s,n=s*t*2,a=t*t;return new l(i*(e[1].x-e[0].x)+n*(e[2].x-e[1].x)+a*(e[3].x-e[2].x),i*(e[1].y-e[0].y)+n*(e[2].y-e[1].y)+a*(e[3].y-e[2].y))}getTangentAt(t){return this.getTangentAtCasteljau(this.linearize(t))}getStartTangent(){return l.sub(this.points[1],this.points[0])}getEndTangent(){return l.sub(this.points[3],this.points[2])}reduceToCasteljau(t){const e=l.lerp(this.points[0],this.points[1],t),s=l.lerp(this.points[1],this.points[2],t),i=l.lerp(this.points[2],this.points[3],t),n=l.lerp(e,s,t),a=l.lerp(s,i,t),h=l.lerp(n,a,t);return new q(this.points[0],e,n,h)}createPartialCurveTo(t){return this.reduceToCasteljau(this.linearize(t))}reduceFromCasteljau(t){const e=l.lerp(this.points[0],this.points[1],t),s=l.lerp(this.points[1],this.points[2],t),i=l.lerp(this.points[2],this.points[3],t),n=l.lerp(e,s,t),a=l.lerp(s,i,t),h=l.lerp(n,a,t);return new q(h,a,i,this.points[3])}createPartialCurveFrom(t){return this.reduceFromCasteljau(this.linearize(t))}makePartialCasteljau(t,e){return this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}createPartialCurveRange(t,e){return e=this.linearize(e),t=this.linearize(t),this.reduceToCasteljau(e).reduceFromCasteljau(t/e)}}function Nt(o){return o}function dt(o){return o*o}function yt(o){const t=1-o;return 1-t*t}function gt(o){if(o<.5)return 2*o*o;{const t=1-o;return 1-2*t*t}}function Ut(o){return o*o*o}function Wt(o){const t=1-o;return 1-t*t*t}function Ht(o){if(o<.5)return 4*o*o*o;{const t=1-o;return 1-2*t*t*t}}function Yt(o){return o*o*o*o}function zt(o){const t=1-o;return 1-t*t*t*t}function qt(o){if(o<.5)return 8*o*o*o*o;{const t=1-o;return 1-8*t*t*t*t}}function jt(o){return 1-Math.cos(o*(Math.PI/2))}function Xt(o){return Math.sin(o*(Math.PI/2))}function $t(o){return .5*(1-Math.cos(Math.PI*o))}function Kt(o){return o*o*(3-2*o)}function Jt(o){return o*o*o*(o*(o*6-15)+10)}const V={linear:Nt,in:dt,inSine:jt,inQuad:dt,inCubic:Ut,inQuart:Yt,out:yt,outSine:Xt,outQuad:yt,outCubic:Wt,outQuart:zt,inOut:gt,inOutSine:$t,inOutQuad:gt,inOutCubic:Ht,inOutQuart:qt,smoothStep:Kt,smootherStep:Jt};class ht{matrix;tmp;constructor(){this.tmp=new W,this.matrix=this.tmp}static setTarget(t,e=!0){return new ht().setTarget(t,e)}setTarget(t,e=!0){return this.matrix=t,e&&this.matrix.makeIdentity(),this}identity(){return this.matrix.makeIdentity(),this}rotateRad(t){return this.tmp.makeRotationRad(t),this.matrix.premultiply(this.tmp),this}rotateDeg(t){return this.tmp.makeRotationDeg(t),this.matrix.premultiply(this.tmp),this}translate(t,e){return this.tmp.makeTranslation(t,e),this.matrix.premultiply(this.tmp),this}translateV(t){return this.tmp.makeTranslation(t.x,t.y),this.matrix.premultiply(this.tmp),this}scale(t,e){return this.tmp.makeScale(t,e),this.matrix.premultiply(this.tmp),this}scaleFrom(t,e,s,i){return this.tmp.makeScaleFrom(t,e,s,i),this.matrix.premultiply(this.tmp),this}scaleFromV(t,e,s){return this.scaleFrom(t,e,s.x,s.y)}scaleUniform(t){return this.tmp.makeScale(t,t),this.matrix.premultiply(this.tmp),this}scaleUniformFrom(t,e,s){return this.scaleFrom(t,t,e,s)}scaleUniformFromV(t,e){return this.scaleFrom(t,t,e.x,e.y)}rotateFromRad(t,e,s){return this.tmp.makeRotationFromRad(t,e,s),this.matrix.premultiply(this.tmp),this}rotateFromRadV(t,e){return this.rotateFromRad(t,e.x,e.y)}rotateFromDeg(t,e,s){return this.tmp.makeRotationFromDeg(t,e,s),this.matrix.premultiply(this.tmp),this}rotateFromDegV(t,e){return this.rotateFromDeg(t,e.x,e.y)}}class Qt extends P{fill;stroke;opacity;extents;pathPosition;pathThreshold;pathStrokeFactor;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.pathPosition=new g(1),this.pathThreshold=new D(30,"view"),this.extents=new E(5,5,"view"),this.pathStrokeFactor=new g(1),this.stroke.width.set(0,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.extents.setOwner(t),this.pathPosition.setOwner(t),this.pathThreshold.setOwner(t),this.pathStrokeFactor.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.extents.clearDirty(),this.pathPosition.clearDirty(),this.pathThreshold.clearDirty(),this.pathStrokeFactor.clearDirty()}}class Zt extends O{element;transform;anchorAlignment;tipableReference=null;tipTransform;tipShape;tipInset;isReversed;constructor(t){super(t,new Qt),this.element=document.createElementNS(G,"path"),this.transform=new R,this.tipTransform=new kt,this.isReversed=!1,this.tipInset=.25,this.tipShape="",this.anchorAlignment=0,this.updateTipShape()}markDirty(){this.isDirty()||(this.dirty=!0,this.tipableReference&&this.tipableReference.markDirty())}setReversed(t=!1){return this.isReversed=t,this}setTipInset(t=.25){return this.tipInset=t,this.updateTipShape(),this}setAnchorAlignment(t=0){return this.anchorAlignment=t,this}setTipableReference(t){return this.tipableReference=t,this}getSVGElement(){return this.element}updateTipShape(){const t=-10+this.tipInset*20;this.tipShape=`M ${t},0 L -10,10 L 10,0 L -10,-10 Z`}updateTipTransform(){if(this.tipableReference===null)return;this.tipTransform=this.tipableReference.getTipTransformAt(this.data.pathPosition.get());const t=this.data.extents.get("view",this.scene.getActiveCamera()),e=D.toSpace(this.tipTransform.strokeWidth,this.tipTransform.space,"view",this.scene.getActiveCamera());t.x+=e*this.data.pathStrokeFactor.get(),t.y+=e*this.data.pathStrokeFactor.get();const s=D.toSpace(this.tipTransform.pathLength,this.tipTransform.space,"view",this.scene.getActiveCamera()),i=this.data.pathThreshold.get("view",this.scene.getActiveCamera());i>0&&s<i&&t.scale(V.out(s/i));const n=x.toSpace(this.tipTransform.position,this.tipTransform.space,"view",this.scene.getActiveCamera()),a=this.isReversed?-1:1;ht.setTarget(this.transform.value).translate(this.anchorAlignment*10,0).scale(a*t.x/10,t.y/10).rotateRad(this.tipTransform.tangent.angle()).translateV(n)}update(){this.skipUpdate()||(this.updateTipTransform(),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.transform,this.element,this.scene),this.element.setAttribute("d",this.tipShape),this.clearDirty())}}class te extends P{stroke;opacity;fill;transform;space;polyCurve;pathFrom;pathTo;constructor(){super(),this.stroke=new k,this.opacity=new g(1),this.fill=new A,this.transform=new R,this.space=new S("world"),this.polyCurve=new K,this.pathFrom=new g(0),this.pathTo=new g(1),this.fill.opacity.set(0)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.space.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.space.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty()}}class ee{static polyCurveToSVGPath(t,e,s,i,n){e>0&&s<1?t=t.createPartialCurveRange(e,s):e>0?t=t.createPartialCurveFrom(e):s<1&&(t=t.createPartialCurveTo(s));const a=t.getCurveCount();if(a<=0||e>=s)return"";let h="";const c=t.getCurve(0).getStart(),u=new l(1/0,1/0);for(let f=0;f<a;f++){const p=t.getCurve(f);if(!l.eq(u,p.getStart())){const w=x.toSpace(c,n,"view",i);h+=`M ${w.x},${w.y} `}if(p instanceof z){const w=x.toSpace(p.getEnd(),n,"view",i);h+=`L ${w.x},${w.y} `}else if(p instanceof q){const w=p.getBezierPoints();h+="C ";for(let C=1;C<w.length;C++){const _=x.toSpace(w[C],n,"view",i);h+=`${_.x},${_.y} `}}const m=p.getEnd();l.eq(c,m)&&(h+="Z ",c.copy(m)),u.copy(m)}return h.trimEnd()}}class Dt extends O{element;sampleCount=0;currStart;endPosition;arrowTips=[];constructor(t){super(t,new te),this.element=document.createElementNS(G,"path"),this.endPosition=new l(0,0),this.currStart=new l(0,0)}createArrowTip(){const t=new Zt(this.scene);return t.setParent(this.scene.getSVG()),this.arrowTips.push(t),t.data.pathPosition.set(1),t.setTipableReference(this),this.markDirty(),t}getTip(t){return this.arrowTips[t]}getTipCount(){return this.arrowTips.length}detachTip(t){return t>=0&&t<this.arrowTips.length&&this.arrowTips.splice(t,1),this.markDirty(),this}detachTipElement(t){const e=this.arrowTips.indexOf(t);return e>=0&&this.arrowTips.splice(e,1),this.markDirty(),this}detachTipElements(){return this.arrowTips.length=0,this.markDirty(),this}getTipTransformAt(t){const e=this.data.pathFrom.get(),s=this.data.pathTo.get();t=t*(s-e)+e;const i=this.scene.getActiveCamera(),n=new kt;return n.space=this.data.space.get(),n.position=this.data.polyCurve.getPointAt(t),n.tangent=this.data.polyCurve.getTangentAt(t),n.pathLength=this.data.polyCurve.getLength()*(s-e),n.strokeWidth=this.data.stroke.width.get(n.space,i),n}setSampleCount(t){return this.sampleCount=t,this.markDirty(),this}getSVGElement(){return this.element}getStart(t){return x.toSpace(this.data.polyCurve.getStart(),this.data.space.get(),t,this.scene.getActiveCamera())}getEnd(t){return x.toSpace(this.data.polyCurve.getEnd(),this.data.space.get(),t,this.scene.getActiveCamera())}getPointAt(t,e){return x.toSpace(this.data.polyCurve.getPointAt(t),this.data.space.get(),e,this.scene.getActiveCamera())}getTangentAt(t,e){return x.toSpace(this.data.polyCurve.getTangentAt(t),this.data.space.get(),e,this.scene.getActiveCamera())}getStartTangent(t){return x.toSpace(this.data.polyCurve.getStartTangent(),this.data.space.get(),t,this.scene.getActiveCamera())}getEndTangent(t){return x.toSpace(this.data.polyCurve.getEndTangent(),this.data.space.get(),t,this.scene.getActiveCamera())}getLength(t){return D.toSpace(this.data.polyCurve.getLength(),this.data.space.get(),t,this.scene.getActiveCamera())}clear(){return this.data.polyCurve.clear(),this.endPosition.set(0,0),this.markDirty(),this}moveTo(t,e){return this.moveToV(new l(t,e))}moveToV(t){return this.currStart.copy(t),this.endPosition.copy(t),this.markDirty(),this}lineTo(t,e){return this.lineToV(new l(t,e))}lineToV(t){return this.data.polyCurve.addLine(this.endPosition,t),this.endPosition.copy(t),this.markDirty(),this}cubicTo(t,e,s,i,n,a,h=this.sampleCount){return this.cubicToV(new l(t,e),new l(s,i),new l(n,a),h)}cubicToV(t,e,s,i=this.sampleCount){return this.data.polyCurve.addCubic(this.endPosition,l.add(this.endPosition,t),l.add(s,e),s,i),this.endPosition.copy(s),this.markDirty(),this}smoothCubicTo(t,e,s,i,n=this.sampleCount){return this.smoothCubicToV(new l(t,e),new l(s,i),n)}smoothCubicToV(t,e,s=this.sampleCount){if(this.data.polyCurve.getCurveCount()<=0)return this;const i=this.data.polyCurve.getLastCurve();return i instanceof q?(this.data.polyCurve.addCubic(this.endPosition,l.sub(l.scale(this.endPosition,2),i.getBezierPoint(2)),l.add(e,t),e,s),this.endPosition.copy(e),this.markDirty(),this):this}close(){return l.eq(this.currStart,this.endPosition)?this:(this.data.polyCurve.addLine(this.endPosition,this.currStart),this.markDirty(),this)}update(){if(!this.skipUpdate()){d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPath(this.data.polyCurve,this.data.space,this.data.pathFrom,this.data.pathTo,this.element,this.scene);for(const t of this.arrowTips)t.data.fill.color.copy(this.data.stroke.color),t.data.fill.opacity.copy(this.data.stroke.opacity),t.markDirty(),t.update();this.clearDirty()}}}class d{static applyStroke(t,e,s){if(t.isDirty()!==!1){if(t.width.isDirty()){const i=t.width.get("view",s.getActiveCamera());e.setAttribute("stroke-width",i.toFixed(2))}t.color.isDirty()&&e.setAttribute("stroke",t.color.toRgb()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("stroke-opacity",t.opacity.toFixed(2)):e.removeAttribute("stroke-opacity")),t.lineCap.isDirty()&&e.setAttribute("stroke-linecap",t.lineCap.value),t.lineJoin.isDirty()&&e.setAttribute("stroke-linejoin",t.lineJoin.value)}}static applyFill(t,e,s){t.isDirty()!==!1&&(t.color.isDirty()&&e.setAttribute("fill",t.color.toRgb()),t.opacity.isDirty()&&(t.opacity.value<=1?e.setAttribute("fill-opacity",t.opacity.toFixed(2)):e.removeAttribute("fill-opacity")))}static applyColor(t,e,s){t.isDirty()&&e.setAttribute("fill",t.toRgb())}static applyOpacity(t,e,s){t.isDirty()&&(t.value<=1?e.setAttribute("opacity",t.toFixed(2)):e.removeAttribute("opacity"))}static applyTransform(t,e,s){t.isDirty()&&(t.value.isIdentity()===!1?e.setAttribute("transform",t.toFixed(2)):e.removeAttribute("transform"))}static applyFont(t,e,s){if(t.isDirty()!==!1){if(t.size.isDirty()){const i=t.size.toSpace("view",s.getActiveCamera());e.setAttribute("font-size",i.toFixed(1))}t.weight.isDirty()&&e.setAttribute("font-weight",t.weight.toFixed(0)),t.family.isDirty()&&e.setAttribute("font-family",t.family.toString()),t.style.isDirty()&&e.setAttribute("font-style",t.style.value)}}static applyPosition(t,e,s,i="x",n="y"){if(t.isDirty()){const a=t.toSpace("view",s.getActiveCamera());e.setAttribute(i,a.x.toFixed(2)),e.setAttribute(n,a.y.toFixed(2))}}static applyAnchoredPosition(t,e,s,i,n){if(t.isDirty()||e.isDirty()||s.isDirty()){const a=j.getNorthWest(s.value,"view",n.getActiveCamera(),t,e);i.setAttribute("x",a.x.toFixed(2)),i.setAttribute("y",a.y.toFixed(2))}}static applyExtents(t,e,s){if(t.isDirty()){const i=t.toSpace("view",s.getActiveCamera()).scale(2);e.setAttribute("width",i.width.toFixed(2)),e.setAttribute("height",i.height.toFixed(2))}}static applyRadius(t,e,s){if(t.isDirty()){const i=t.toSpace("view",s.getActiveCamera());e.setAttribute("r",i.toFixed(2))}}static applyCornerRadius(t,e,s){if(t.isDirty()){const i=t.toSpace("view",s.getActiveCamera());e.setAttribute("rx",i.toFixed(2)),e.setAttribute("ry",i.toFixed(2))}}static applyPath(t,e,s,i,n,a){t.updateLength();const h=ee.polyCurveToSVGPath(t,s.get(),i.get(),a.getActiveCamera(),e.get());h.length>=0?n.setAttribute("d",h):n.removeAttribute("d")}static applyPreserveWhitespace(t,e,s){t.isDirty()&&(t.value?e.style.whiteSpaceCollapse="preserve":e.style.whiteSpace="")}static applyTextAnchor(t,e,s){t.isDirty()&&e.setAttribute("text-anchor",t.value)}}class se extends P{fill;stroke;opacity;transform;position;radius;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.position=new x(0,0,"world"),this.radius=new D(1,"world"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.position.setOwner(t),this.radius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.radius.clearDirty()}}class tt extends O{element;constructor(t){super(t,new se),this.element=document.createElementNS(G,"circle")}getRadius(t){return this.data.radius.toSpace(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}getPointInDirection(t,e,s){const i=this.scene.getActiveCamera(),n=s.toSpace(e,i),a=Math.max(this.data.radius.toSpace(e,i)+n,0);return t.clone().normalize().scale(a).addV(this.data.position.toSpace(e,i))}update(){this.skipUpdate()||(d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPosition(this.data.position,this.element,this.scene,"cx","cy"),d.applyRadius(this.data.radius,this.element,this.scene),this.clearDirty())}}class ie{static intersectRayCircle(t,e,s,i){const n=t.clone().subV(s),a=e.dot(e),h=2*e.dot(n),c=n.dot(n)-i*i,u=h*h-4*a*c;if(u<0)return[];const f=Math.sqrt(u),p=(-h-f)/(2*a),m=(-h+f)/(2*a),w=[];return p>=0&&w.push(e.clone().scale(p).addV(t)),m>=0&&m!==p&&w.push(e.clone().scale(m).addV(t)),w}static intersectDirectionCircle(t,e,s){const i=t.dot(t),n=-2*t.dot(e),a=e.dot(e)-s*s,h=n*n-4*i*a;if(h<0)return-1;const c=Math.sqrt(h),u=(-n-c)/(2*i),f=(-n+c)/(2*i);return Math.max(u,f)}static intersectDirectionRoundedRectangle(t,e,s){const i=e.x-s+1e-5,n=e.y-s+1e-5;if(t.x>0){const u=t.clone().scale(+e.x/t.x);if(Math.abs(u.y)<=n)return u}if(t.x<0){const u=t.clone().scale(-e.x/t.x);if(Math.abs(u.y)<=n)return u}if(t.y>0){const u=t.clone().scale(+e.y/t.y);if(Math.abs(u.x)<=i)return u}if(t.y<0){const u=t.clone().scale(-e.y/t.y);if(Math.abs(u.x)<=i)return u}const a=e.x-s,h=e.y-s,c=new l;if(t.x>0&&t.y>0){c.set(+a,+h);const u=this.intersectDirectionCircle(t,c,s);if(u>=0)return t.clone().scale(u)}if(t.x<0&&t.y>0){c.set(-a,+h);const u=this.intersectDirectionCircle(t,c,s);if(u>=0)return t.clone().scale(u)}if(t.x>0&&t.y<0){c.set(+a,-h);const u=this.intersectDirectionCircle(t,c,s);if(u>=0)return t.clone().scale(u)}if(t.x<0&&t.y<0){c.set(-a,-h);const u=this.intersectDirectionCircle(t,c,s);if(u>=0)return t.clone().scale(u)}return new l(0,0)}static circleVsCircle(t,e,s,i,n,a){const h=i-t,c=n-e,u=Math.hypot(h,c);if(u>s+a||u<Math.abs(s-a)||u===0)return[];const f=(s*s-a*a+u*u)/(2*u),p=Math.sqrt(s*s-f*f),m=t+f*h/u,w=e+f*c/u,C=-c*(p/u),_=+h*(p/u);return[new l(m+C,w+_),new l(m-C,w-_)]}static getArcCenter(t,e,s,i=!1){const n=e.clone().subV(t),a=n.lengthSq(),h=Math.sqrt(s*s-a/4),c=n.clone().perp(i).scale(h/Math.sqrt(a));return t.clone().addV(n.scale(.5)).addV(c)}static getClosestPoint(t,e){if(e.length<=0)return new l(0,0);let s=0,i=t.distanceSq(e[0]);for(let n=1;n<e.length;n++){const a=t.distanceSq(e[n]);a<i&&(i=a,s=n)}return e[s].clone()}}class ne extends P{fill;stroke;opacity;transform;position;extents;anchor;cornerRadius;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.position=new x(0,0,"world"),this.extents=new E(1,1,"world"),this.anchor=new S("center"),this.cornerRadius=new D(0,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.extents.setOwner(t),this.anchor.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.extents.clearDirty(),this.anchor.clearDirty(),this.cornerRadius.clearDirty()}}class N extends O{element;constructor(t){super(t,new ne),this.element=document.createElementNS(G,"rect")}getExtents(t){return this.data.extents.toSpace(t,this.scene.getActiveCamera())}getCornerRadius(t){return this.data.cornerRadius.toSpace(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}getPointInDirection(t,e,s){const i=this.scene.getActiveCamera(),n=s.toSpace(e,i),a=this.data.extents.toSpace(e,i).add(n,n).max(0,0),h=Math.min(Math.max(this.data.cornerRadius.toSpace(e,i)+n,0),a.x,a.y),c=j.getCenter(this.data.anchor.get(),e,i,this.data.position,this.data.extents);return ie.intersectDirectionRoundedRectangle(t,a,h).addV(c)}update(){this.skipUpdate()||(d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyAnchoredPosition(this.data.position,this.data.extents,this.data.anchor,this.element,this.scene),d.applyExtents(this.data.extents,this.element,this.scene),d.applyCornerRadius(this.data.cornerRadius,this.element,this.scene),this.clearDirty())}}class re extends P{stroke;opacity;transform;geometry;constructor(){super(),this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.geometry=new ae,this.stroke.opacity.set(1)}setOwner(t=null){this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.geometry.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.geometry.clearDirty()}}class ae extends H{boundA;boundB;steps;referencePoint;constructor(){super(),this.boundA=new x(-8,-4.5,"world"),this.boundB=new x(8,4.5,"world"),this.steps=new E(1,1,"world"),this.referencePoint=new x(0,0,"world")}setOwner(t=null){this.boundA.setOwner(t),this.boundB.setOwner(t),this.steps.setOwner(t),this.referencePoint.setOwner(t)}clearDirty(){this.boundA.clearDirty(),this.boundB.clearDirty(),this.steps.clearDirty(),this.referencePoint.clearDirty()}}class mt extends O{element;constructor(t){super(t,new re),this.element=document.createElementNS(G,"path"),this.data.stroke.width.set(1,"view"),this.data.stroke.lineCap.set("butt")}getSVGElement(){return this.element}applyGeometry(){const t=this.scene,e=this.element,s=this.data.geometry,i=1e-5,n=t.getActiveCamera(),a=s.boundA.toSpace("view",n),h=s.boundB.toSpace("view",n),c=s.steps.toSpace("view",n),u=s.referencePoint.toSpace("view",n),f=Math.min(a.x,h.x),p=Math.max(a.x,h.x),m=Math.min(a.y,h.y),w=Math.max(a.y,h.y),C=u.x-Math.floor((u.x-f)/c.x)*c.x,_=u.y-Math.floor((u.y-m)/c.y)*c.y;let I="";for(let T=C;T<p+i;T+=c.x)I+=`M${T},${m} V ${w} `;for(let T=_;T<w+i;T+=c.y)I+=`M${f},${T} H ${p} `;e.setAttribute("d",I.trimEnd())}update(){this.skipUpdate()||(d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),this.applyGeometry(),this.clearDirty())}}class oe extends P{fill;stroke;opacity;transform;font;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.font=new B,this.fill.opacity.set(1),this.stroke.width.set(0,"view")}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty()}}class he extends O{category;content;element;localBBox;parentText;constructor(t,e){super(t,new oe),this.element=document.createElementNS(G,"tspan"),this.category="",this.content="",this.localBBox=new Et,this.parentText=e,this.localBBox.setOwner(this)}clearDirty(){super.clearDirty(),this.localBBox.clearDirty()}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.content=t,this.localBBox.markDirty(),this}getContent(){return this.content}getLocalCenter(t){return this.localBBox.getCenter(t,this.scene.getActiveCamera())}getPosition(t){const e=this.getLocalCenter(t),s=this.parentText.getPosition(t);return e.addV(s)}getExtents(t){return this.localBBox.getExtents(t,this.scene.getActiveCamera())}update(){if(this.skipUpdate())return;d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyFont(this.data.font,this.element,this.scene),(this.localBBox.isDirty()||this.data.font.isDirty()||this.parentText.data.preserveWhitespace.isDirty())&&this.localBBox.set(this.element,this.parentText.data.position,this.scene.getActiveCamera()),this.clearDirty()}}class ct extends P{fill;stroke;opacity;transform;position;font;textAnchor;preserveWhitespace;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.position=new x(0,0,"world"),this.font=new B,this.textAnchor=new S("start"),this.preserveWhitespace=new st(!1),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.position.setOwner(t),this.font.setOwner(t),this.textAnchor.setOwner(t),this.preserveWhitespace.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.font.clearDirty(),this.textAnchor.clearDirty(),this.preserveWhitespace.clearDirty()}}class At extends O{element;tspans;extents;localCenter;constructor(t,e){super(t,e),this.element=document.createElementNS(G,"text"),this.tspans=[],this.extents=new E(0,0,"view"),this.localCenter=new x(0,0,"view"),this.extents.setOwner(this),this.localCenter.setOwner(this)}getSVGElement(){return this.element}getPosition(t){return this.data.position.toSpace(t,this.scene.getActiveCamera())}setContent(t){return this.addTSpan(t),this}addTSpan(t,e){const s=new he(this.scene,this);return s.setParent(this),s.setContent(t),s.category=e??"",this.tspans.push(s),this.extents.markDirty(),this.localCenter.markDirty(),s}getExtents(t){return this.extents.toSpace(t,this.scene.getActiveCamera())}getCenter(t){const e=this.localCenter.toSpace(t,this.scene.getActiveCamera()),s=this.getPosition(t);return e.addV(s)}getTSpans(){return this.tspans}getTSpanCount(){return this.tspans.length}getTSpan(t){return this.tspans[t]}findTSpan(t){return this.tspans.find(e=>(t.content?e.getContent()===t.content:!0)&&(t.category?e.category===t.category:!0))}clearText(){return this.children.length=0,this.tspans.length=0,this.element.replaceChildren(),this.updateSVGChildren(),this.extents.markDirty(),this.localCenter.markDirty(),this}updateExtents(){const t=new l(1/0,1/0),e=new l(-1/0,-1/0);for(const s of this.tspans){const i=s.getLocalCenter("view"),n=s.getExtents("view");t.x=Math.min(t.x,i.x-n.x),t.y=Math.min(t.y,i.y-n.y),e.x=Math.max(e.x,i.x+n.x),e.y=Math.max(e.y,i.y+n.y)}return this.extents.set((e.x-t.x)/2,(e.y-t.y)/2,"view"),this.localCenter.set((e.x+t.x)/2,(e.y+t.y)/2,"view"),this.extents.clearDirty(),this.localCenter.clearDirty(),this}update(){if(!this.skipUpdate()){this.updateSVGChildren(),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPosition(this.data.position,this.element,this.scene,"x","y"),d.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),d.applyTextAnchor(this.data.textAnchor,this.element,this.scene);for(const t of this.tspans)(this.data.fill.isDirty()||t.isDirty())&&t.data.fill.copy(this.data.fill),(this.data.stroke.isDirty()||t.isDirty())&&t.data.stroke.copy(this.data.stroke),(this.data.font.isDirty()||t.isDirty())&&t.data.font.copy(this.data.font),t.update();this.updateExtents(),this.clearDirty()}}}class Pt extends At{constructor(t){super(t,new ct)}}class ce extends ct{skip;horizontalAlign;constructor(){super(),this.skip=new D(0,"view"),this.horizontalAlign=new S("left",L.Normal)}setOwner(t=null){super.setOwner(t),this.skip.setOwner(t),this.horizontalAlign.setOwner(t)}clearDirty(){super.clearDirty(),this.skip.clearDirty(),this.horizontalAlign.clearDirty()}}class le extends At{constructor(t){super(t,new ce)}}class ue extends P{fill;stroke;opacity;transform;position;font;skip;horizontalAlign;verticalAlign;minExtents;anchor;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.position=new x(0,0,"world"),this.font=new B,this.skip=new D(0,"view"),this.horizontalAlign=new S("left"),this.verticalAlign=new S("middle"),this.minExtents=new E(0,0,"view"),this.anchor=new S("center"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.position.setOwner(t),this.font.setOwner(t),this.skip.setOwner(t),this.horizontalAlign.setOwner(t),this.verticalAlign.setOwner(t),this.minExtents.setOwner(t),this.anchor.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.position.clearDirty(),this.font.clearDirty(),this.skip.clearDirty(),this.horizontalAlign.clearDirty(),this.verticalAlign.clearDirty(),this.minExtents.clearDirty(),this.anchor.clearDirty()}}class Ct extends O{element;textLines;contentExtents;extents;constructor(t){super(t,new ue),this.textLines=[],this.element=document.createElementNS(G,"g"),this.contentExtents=new E(0,0,"view"),this.extents=new E(0,0,"view"),this.element.dataset.role="text-group",this.element.style.whiteSpaceCollapse="preserve"}getSVGElement(){return this.element}addLine(t){const e=new le(this.scene);return e.setParent(this),t?.align&&e.data.horizontalAlign.set(t.align),t?.skip!==void 0&&e.data.skip.set(t.skip),this.textLines.push(e),this.updateSVGChildren(),e}getLineCount(){return this.textLines.length}getLine(t){return this.textLines[t]}getTextExtents(t){return this.contentExtents.toSpace(t,this.scene.getActiveCamera())}getExtents(t){return this.extents.toSpace(t,this.scene.getActiveCamera())}getCenter(t){return j.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}update(){if(this.skipUpdate()||this.textLines.length===0)return;const t=this.scene.getActiveCamera(),e="view";this.updateSVGChildren(),d.applyTransform(this.data.transform,this.element,this.scene);const s=this.data.font,i=s.relativeAscenderHeight.value*s.size.value,n=s.relativeLineHeight.value*s.size.value,a=new l(0,0);for(const p of this.textLines){p.data.font.copy(this.data.font),p.data.fill.copy(this.data.fill),p.data.stroke.copy(this.data.stroke),p.data.opacity.copy(this.data.opacity),p.data.horizontalAlign.copy(this.data.horizontalAlign),p.data.skip.copy(this.data.skip),p.update();const m=p.getExtents(e);a.x=Math.max(a.x,m.x),a.y+=n+p.data.skip.value}a.y/=2;const h=this.data.minExtents.toSpace(e,t);h.maxV(a),this.contentExtents.setValueFromSpace(e,t,a.x,a.y),this.extents.setValueFromSpace(e,t,h.x,h.y);const c=this.getCenter(e).subV(h);let u=0,f=c.y+i;switch(this.data.verticalAlign.get()){case"top":break;case"middle":f+=h.y-a.y;break;case"bottom":f+=2*(h.y-a.y);break}for(let p=0;p<this.textLines.length;p++){const m=this.textLines[p];switch(m.data.horizontalAlign.get()){case"left":u=c.x,m.data.textAnchor.set("start");break;case"center":u=c.x+h.x,m.data.textAnchor.set("middle");break;case"right":u=c.x+2*h.x,m.data.textAnchor.set("end");break}m.data.position.set(u,f,"view"),f+=m.data.skip.value+n}for(const p of this.textLines)p.update();this.clearDirty()}}class pe extends P{stroke;opacity;transform;startPosition;endPosition;constructor(){super(),this.stroke=new k,this.opacity=new g(1,L.Normal),this.transform=new R,this.startPosition=new x,this.endPosition=new x}setOwner(t=null){this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.startPosition.setOwner(t),this.endPosition.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.startPosition.clearDirty(),this.endPosition.clearDirty()}}class Tt extends O{element;constructor(t){super(t,new pe),this.element=document.createElementNS(G,"line")}getSVGElement(){return this.element}update(){this.skipUpdate()||(d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPosition(this.data.startPosition,this.element,this.scene,"x1","y1"),d.applyPosition(this.data.endPosition,this.element,this.scene,"x2","y2"),this.clearDirty())}}let de=class extends P{position;anchor;background;text;separator;padding;partSep;minExtents;constructor(){super(),this.position=new x(0,0,"world"),this.anchor=new S("center"),this.minExtents=new E(0,0,"view"),this.background=new ye,this.separator=new me,this.text=new ge,this.padding=new E(10,5,"view"),this.partSep=new D(5,"view")}},ye=class extends P{fill;stroke;opacity;transform;cornerRadius;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.cornerRadius=new D(5,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}},ge=class extends P{fill;stroke;opacity;transform;font;horizontalAlign;verticalAlign;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.font=new B,this.horizontalAlign=new S("center"),this.verticalAlign=new S("middle"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}};class me extends P{stroke;opacity;constructor(){super(),this.stroke=new k,this.opacity=new g(1),this.stroke.width.set(2,"view"),this.opacity.set(1)}}class it extends O{element;textGroups;textGrows;sepLines;background=null;extents;constructor(t,e=1){super(t,new de),this.element=document.createElementNS(G,"g"),this.textGroups=[],this.textGrows=[],this.sepLines=[];for(let s=0;s<e;s++){const i=new Ct(this.scene);i.data.layer.set(2),i.setParent(this),this.textGroups.push(i),this.textGrows.push(1)}for(let s=0;s<e-1;s++){const i=new Tt(this.scene);i.data.layer.set(1),i.setParent(this),this.sepLines.push(i)}this.extents=new E(0,0,"view"),this.element.dataset.role="node",this.updateSVGChildren()}getPosition(t){return this.data.position.toSpace(t,this.scene.getActiveCamera())}getMinExtents(t){return this.data.minExtents.toSpace(t,this.scene.getActiveCamera())}getPadding(t){return this.data.padding.toSpace(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}addLine(t){const e=Bt(t?.partIndex??0,0,this.textGroups.length-1);return this.textGroups[e].addLine(t)}createRectBackground(){return this.background!==null&&this.background.setParent(null),this.background=new N(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}createCircleBackground(){return this.background!==null&&this.background.setParent(null),this.background=new tt(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}setTextGrowFactor(t,e=1){return this.textGrows[t]=e,this}getBackground(){return this.background}getCenter(t=this.data.position.space){return j.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}getTextGroup(t=0){return this.textGroups[t]}getTextGroupCount(){return this.textGroups.length}getPointInDirection(t,e,s){return this.background?this.background.getPointInDirection(t,e,s):this.data.position.toSpace(e,this.scene.getActiveCamera())}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera();this.background!==null&&(this.background.data.stroke.copy(this.data.background.stroke),this.background.data.fill.copy(this.data.background.fill),this.background.data.opacity.copy(this.data.background.opacity),this.background.data.transform.copy(this.data.background.transform),this.background instanceof N&&this.background.data.cornerRadius.copy(this.data.background.cornerRadius));for(const p of this.textGroups)p.data.font.copy(this.data.text.font),p.data.horizontalAlign.copy(this.data.text.horizontalAlign),p.data.verticalAlign.copy(this.data.text.verticalAlign),p.data.fill.copy(this.data.text.fill),p.data.opacity.copy(this.data.text.opacity),p.data.stroke.copy(this.data.text.stroke);for(const p of this.sepLines)p.data.opacity.copy(this.data.separator.opacity),p.data.stroke.copy(this.data.separator.stroke);const e=[];let s=0;for(let p=0;p<this.textGroups.length;p++){const w=this.textGroups[p].getTextExtents("view");s=Math.max(s,2*w.x),e.push(2*w.y)}const i=this.data.minExtents.toSpace("view",t),n=this.data.padding.toSpace("view",t),a=this.data.partSep.toSpace("view",t),h=Ft.computeSizes(e,this.textGrows,2*i.y,n.y,2*a),c=new l(Math.max(s/2+n.x,i.x),h/2);this.extents.setValueFromSpace("view",t,c.x,c.y);const u=j.getCenter(this.data.anchor.get(),"view",t,this.data.position,this.extents),f=u.clone().subV(c).addV(n);for(let p=0;p<this.textGroups.length;p++)this.textGroups[p].data.position.setV(f,"view"),this.textGroups[p].data.minExtents.set(c.x-n.x,e[p]/2,"view"),this.textGroups[p].data.anchor.set("north-west"),f.y+=e[p]+2*a;if(this.background instanceof N){this.background.data.position.setV(u,"view"),this.background.data.extents.setV(c,"view"),this.background.data.anchor.set("center");let p=u.y-c.y+n.y+e[0]+a;for(let m=0;m<this.textGroups.length-1;m++)this.sepLines[m].data.startPosition.set(u.x-c.x,p,"view"),this.sepLines[m].data.endPosition.set(u.x+c.x,p,"view"),p+=e[m+1]+2*a}else if(this.background instanceof tt){const p=Math.max(c.x,c.y);this.background.data.position.setV(u,"view"),this.background.data.radius.set(p,"view");let m=u.y-c.y+n.y+e[0]+a;for(let w=0;w<this.textGroups.length-1;w++){const C=Math.sqrt(p*p-(m-u.y)*(m-u.y));this.sepLines[w].data.startPosition.set(u.x-C,m,"view"),this.sepLines[w].data.endPosition.set(u.x+C,m,"view"),m+=e[w+1]+2*a}}d.applyFont(this.data.text.font,this.element,this.scene),d.applyFill(this.data.text.fill,this.element,this.scene),d.applyStroke(this.data.text.stroke,this.element,this.scene),d.applyOpacity(this.data.text.opacity,this.element,this.scene),d.applyTransform(this.data.text.transform,this.element,this.scene);for(const p of this.children)p.update();this.clearDirty()}}class fe extends P{color;opacity;constructor(){super(),this.color=new r,this.opacity=new g(1)}setOwner(t=null){this.opacity.setOwner(t),this.color.setOwner(t)}clearDirty(){super.clearDirty(),this.opacity.clearDirty(),this.color.clearDirty()}}class we extends O{element;constructor(t){super(t,new fe),this.element=document.createElementNS(G,"rect")}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera();this.element.setAttribute("x","0"),this.element.setAttribute("y","0"),this.element.setAttribute("width",t.viewport.x.toString()),this.element.setAttribute("height",t.viewport.y.toString()),d.applyColor(this.data.color,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),this.clearDirty()}}class xe extends O{element;constructor(t,e){super(t,e),this.element=document.createElementNS(G,"g")}getSVGElement(){return this.element}update(){if(!this.skipUpdate()){this.updateSVGChildren();for(const t of this.children)t.update();this.clearDirty()}}}class ve extends P{position;anchor;background;text;padding;minExtents;constructor(){super(),this.position=new x(0,0,"world"),this.anchor=new S("center"),this.minExtents=new E(0,0,"view"),this.background=new Ee,this.text=new ke,this.padding=new E(10,5,"view")}setOwner(t=null){super.setOwner(t),this.position.setOwner(t),this.anchor.setOwner(t),this.minExtents.setOwner(t),this.background.setOwner(t),this.text.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.minExtents.clearDirty(),this.background.clearDirty(),this.text.clearDirty(),this.padding.clearDirty()}}class Ee extends H{fill;stroke;opacity;transform;cornerRadius;shape;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.cornerRadius=new D(5,"view"),this.shape=new S("rectangle"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.cornerRadius.setOwner(t),this.shape.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.cornerRadius.clearDirty(),this.shape.clearDirty()}}class ke extends H{fill;stroke;opacity;transform;font;horizontalAlign;verticalAlign;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.transform=new R,this.font=new B,this.horizontalAlign=new S("center"),this.verticalAlign=new S("middle"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.transform.setOwner(t),this.font.setOwner(t),this.horizontalAlign.setOwner(t),this.verticalAlign.setOwner(t)}clearDirty(){this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.transform.clearDirty(),this.font.clearDirty(),this.horizontalAlign.clearDirty(),this.verticalAlign.clearDirty()}}class Lt extends O{element;background=null;extents;endPoints;constructor(t){super(t,new ve),this.element=document.createElementNS(G,"g"),this.extents=new E(0,0,"view"),this.element.dataset.role="plain-node",this.endPoints=[]}attachEndPoint(t){return this.endPoints.push(t),t.markDirty(),this}detachEndPoint(t){const e=this.endPoints.indexOf(t);return e===-1?this:(this.endPoints.splice(e,1),t.markDirty(),this)}getPosition(t){return this.data.position.toSpace(t,this.scene.getActiveCamera())}getExtents(t){return this.extents.toSpace(t,this.scene.getActiveCamera())}getMinExtents(t){return this.data.minExtents.toSpace(t,this.scene.getActiveCamera())}getPadding(t){return this.data.padding.toSpace(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}createRectBackground(){return this.background!==null&&this.background.setParent(null),this.background=new N(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}createCircleBackground(){return this.background!==null&&this.background.setParent(null),this.background=new tt(this.scene),this.background.data.layer.set(0),this.background.setParent(this),this.updateSVGChildren(),this.background}getBackground(){return this.background}getCenter(t){return j.getCenter(this.data.anchor.get(),t,this.scene.getActiveCamera(),this.data.position,this.extents)}getPointInDirection(t,e,s){return this.background?this.background.getPointInDirection(t,e,s):this.data.position.toSpace(e,this.scene.getActiveCamera())}}class ft{mode;node;position;owner;dirty=!0;edge;constructor(){this.mode="position",this.node=null,this.owner=null,this.position=new x(0,0,"world"),this.edge=null,this.position.setOwner(this)}isDirty(){return this.dirty}markDirty(){this.isDirty()||(this.dirty=!0,this.owner?.markDirty())}setOwner(t=null){this.owner=t}clearDirty(){this.dirty=!1,this.position.clearDirty()}set(t){return t instanceof Lt?(this.mode="node",this.node=t,this.position.copy(this.node.data.position),this.node.attachEndPoint(this)):(this.mode="position",this.node=null,this.position.copy(t)),this}copy(t){this.mode=t.mode,this.node=t.node,this.position.copy(t.position)}getCenter(t,e){return this.mode==="node"&&this.node?this.node.getCenter(t):this.position.toSpace(t,e)}getPointInDirection(t,e,s,i){if(this.mode==="node"&&this.node)return i.value!==-1/0?this.node.getPointInDirection(t,e,i):this.node.getCenter(e);{const n=this.position.toSpace(e,s),a=i.toSpace(e,s);return n.addV(t.clone().normalize().scale(a))}}}class bt extends P{stroke;opacity;pathFrom;pathTo;startDistance;endDistance;startAngle;endAngle;start;end;constructor(){super(),this.stroke=new k,this.opacity=new g(1),this.pathFrom=new g(0),this.pathTo=new g(1),this.startDistance=new D(-1/0,"view"),this.endDistance=new D(-1/0,"view"),this.startAngle=new g(-1/0),this.endAngle=new g(-1/0),this.start=new ft,this.end=new ft,this.stroke.width.set(4,"view"),this.stroke.color.set(0,0,0),this.opacity.set(1)}setOwner(t=null){this.stroke.setOwner(t),this.opacity.setOwner(t),this.pathFrom.setOwner(t),this.pathTo.setOwner(t),this.startDistance.setOwner(t),this.endDistance.setOwner(t),this.startAngle.setOwner(t),this.endAngle.setOwner(t),this.start.setOwner(t),this.end.setOwner(t)}clearDirty(){super.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.pathFrom.clearDirty(),this.pathTo.clearDirty(),this.startDistance.clearDirty(),this.endDistance.clearDirty(),this.startAngle.clearDirty(),this.endAngle.clearDirty(),this.start.clearDirty(),this.end.clearDirty()}}class Ot extends O{element;path;constructor(t,e){super(t,e),this.element=document.createElementNS(G,"g"),this.path=new Dt(t),this.element.appendChild(this.path.getSVGElement()),this.element.dataset.role="edge",this.data.start.edge=this,this.data.end.edge=this}createArrowTip(){return this.path.createArrowTip()}getTip(t){return this.path.getTip(t)}getTipCount(){return this.path.getTipCount()}detachTip(t){return this.path.detachTip(t),this}detachTipElement(t){return this.path.detachTipElement(t),this}detachTipElements(){return this.path.detachTipElements(),this}getTipTransformAt(t){return this.path.getTipTransformAt(t)}getSVGElement(){return this.element}getPointCenter(t,e){return t instanceof it?t.getCenter(e):t.toSpace(e,this.scene.getActiveCamera())}getPoint(t,e,s,i){if(t instanceof it)return s.value!==-1/0?t.getPointInDirection(i,e,s):t.getCenter(e);{const n=this.scene.getActiveCamera(),a=t.toSpace(e,n);if(s.value!==-1/0){const h=s.toSpace(e,n);a.addV(i.clone().normalize().scale(h))}return a}}getStartToEnd(t){const e=this.scene.getActiveCamera(),s=this.data.start.getCenter(t,e);return this.data.end.getCenter(t,e).subV(s)}applyStyleToPath(){this.path.data.pathFrom.copy(this.data.pathFrom),this.path.data.pathTo.copy(this.data.pathTo),this.path.data.stroke.copy(this.data.stroke),this.path.data.opacity.copy(this.data.opacity)}}class Se extends Ot{constructor(t){super(t,new bt)}update(){if(this.skipUpdate())return;const t="world",e=this.scene.getActiveCamera(),s=this.getStartToEnd(t).normalize(),i=s.clone().negate();this.data.startAngle.value!==-1/0&&s.setFromPolarDeg(this.data.startAngle.value),this.data.endAngle.value!==-1/0&&i.setFromPolarDeg(this.data.endAngle.value);const n=this.data.start.getPointInDirection(s,t,e,this.data.startDistance),a=this.data.end.getPointInDirection(i,t,e,this.data.endDistance);this.applyStyleToPath(),this.path.data.space.set(t),this.path.clear().moveToV(n).lineToV(a).update(),this.clearDirty()}}class De extends bt{curveBendAngle;curveStartTension;curveEndTension;constructor(){super(),this.curveStartTension=new g(.3,L.Normal),this.curveEndTension=new g(.3,L.Normal),this.curveBendAngle=new g(0,L.Normal)}setOwner(t=null){super.setOwner(t),this.curveStartTension.setOwner(t),this.curveEndTension.setOwner(t),this.curveBendAngle.setOwner(t)}clearDirty(){super.clearDirty(),this.curveStartTension.clearDirty(),this.curveEndTension.clearDirty(),this.curveBendAngle.clearDirty()}}class Ae extends Ot{constructor(t){super(t,new De)}update(){if(this.skipUpdate())return;const t="world",e=this.scene.getActiveCamera(),s=this.getStartToEnd(t).normalize(),i=s.clone().negate();this.data.startAngle.value!==-1/0&&s.setFromPolarDeg(this.data.startAngle.value),this.data.endAngle.value!==-1/0&&i.setFromPolarDeg(this.data.endAngle.value);const n=this.data.curveBendAngle.value!==-1/0?this.data.curveBendAngle.get():0;s.rotateDeg(-1*n),i.rotateDeg(1*n);const a=this.data.start.getPointInDirection(s,t,e,this.data.startDistance),h=this.data.end.getPointInDirection(i,t,e,this.data.endDistance),c=a.distance(h),u=this.data.curveStartTension.value!==-1/0?this.data.curveStartTension.get():.3,f=this.data.curveEndTension.value!==-1/0?this.data.curveEndTension.get():.3;s.scale(u*c),i.scale(f*c),this.applyStyleToPath(),this.path.data.space.set(t),this.path.clear().moveToV(a).cubicToV(s,i,h).update(),this.clearDirty()}}class y{static setAnchor(t,e){"anchor"in t&&t.anchor instanceof S&&t.anchor.set(e)}static setBackgroundFillColor(t,e){"background"in t&&t.background instanceof H&&"fill"in t.background&&t.background.fill instanceof A&&t.background.fill.color.copy(e)}static setColor(t,e){"color"in t&&t.color instanceof r&&t.color.copy(e),"fill"in t&&t.fill instanceof A&&t.fill.color.copy(e),"stroke"in t&&t.stroke instanceof k&&t.stroke.color.copy(e)}static setColorRGB(t,e,s,i){"color"in t&&t.color instanceof r&&t.color.set(e,s,i),"fill"in t&&t.fill instanceof A&&t.fill.color.set(e,s,i),"stroke"in t&&t.stroke instanceof k&&t.stroke.color.set(e,s,i)}static setColorHex(t,e){"color"in t&&t.color instanceof r&&t.color.setFromHex(e),"fill"in t&&t.fill instanceof A&&t.fill.color.setFromHex(e),"stroke"in t&&t.stroke instanceof k&&t.stroke.color.setFromHex(e)}static setCornerRadius(t,e,s){"cornerRadius"in t&&t.cornerRadius instanceof D&&t.cornerRadius.set(e,s)}static setEdgeStartDistance(t,e,s="view"){"startDistance"in t&&t.startDistance instanceof D&&t.startDistance.set(e,s)}static setEdgeEndDistance(t,e,s="view"){"endDistance"in t&&t.endDistance instanceof D&&t.endDistance.set(e,s)}static setEdgeStartAngle(t,e){"startAngle"in t&&t.startAngle instanceof g&&t.startAngle.set(e)}static setEdgeEndAngle(t,e){"endAngle"in t&&t.endAngle instanceof g&&t.endAngle.set(e)}static setEdgeBendAngle(t,e){"curveBendAngle"in t&&t.curveBendAngle instanceof g&&t.curveBendAngle.set(e)}static setEdgeTension(t,e){"curveStartTension"in t&&t.curveStartTension instanceof g&&t.curveStartTension.set(e),"curveEndTension"in t&&t.curveEndTension instanceof g&&t.curveEndTension.set(e)}static setEdgeStartTension(t,e){"curveStartTension"in t&&t.curveStartTension instanceof g&&t.curveStartTension.set(e)}static setEdgeEndTension(t,e){"curveEndTension"in t&&t.curveEndTension instanceof g&&t.curveEndTension.set(e)}static setEndPosition(t,e,s,i){"endPosition"in t&&t.endPosition instanceof x&&t.endPosition.set(e,s,i)}static setEndPositionV(t,e,s){"endPosition"in t&&t.endPosition instanceof x&&t.endPosition.setV(e,s)}static setExtents(t,e,s,i){"extents"in t&&t.extents instanceof E&&t.extents.set(e,s,i)}static setExtentsV(t,e,s){"extents"in t&&t.extents instanceof E&&t.extents.setV(e,s)}static setFillColor(t,e){"fill"in t&&t.fill instanceof A&&t.fill.color.copy(e)}static setFillColorRGB(t,e,s,i){"fill"in t&&t.fill instanceof A&&t.fill.color.set(e,s,i)}static setFillColorHex(t,e){"fill"in t&&t.fill instanceof A&&t.fill.color.setFromHex(e)}static setFillOpacity(t,e){"fill"in t&&t.fill instanceof A&&t.fill.opacity.set(e)}static setFont(t,e){"font"in t&&t.font instanceof B&&t.font.copy(e)}static setFontSize(t,e,s){"font"in t&&t.font instanceof B&&t.font.size.set(e,s)}static setFontWeight(t,e){"font"in t&&t.font instanceof B&&t.font.weight.set(e)}static setFontStyle(t,e){"font"in t&&t.font instanceof B&&t.font.style.set(e)}static setFontFamily(t,e){"font"in t&&t.font instanceof B&&t.font.family.set(e)}static setFontRelativeLineHeight(t,e){"font"in t&&t.font instanceof B&&t.font.relativeLineHeight.set(e)}static setFontRelativeAscenderHeight(t,e){"font"in t&&t.font instanceof B&&t.font.relativeAscenderHeight.set(e)}static setHorizontalAlign(t,e){"horizontalAlign"in t&&t.horizontalAlign instanceof S&&t.horizontalAlign.set(e)}static setVerticalAlign(t,e){"verticalAlign"in t&&t.verticalAlign instanceof S&&t.verticalAlign.set(e)}static setLayer(t,e){"layer"in t&&t.layer instanceof g&&t.layer.set(e)}static setMinExtents(t,e,s,i){"minExtents"in t&&t.minExtents instanceof E&&t.minExtents.set(e,s,i)}static setMinExtentsV(t,e,s){"minExtents"in t&&t.minExtents instanceof E&&t.minExtents.setV(e,s)}static setOpacity(t,e){"opacity"in t&&t.opacity instanceof g&&t.opacity.set(e)}static setPadding(t,e,s,i){"padding"in t&&t.padding instanceof E&&t.padding.set(e,s,i)}static setPaddingV(t,e,s){"padding"in t&&t.padding instanceof E&&t.padding.setV(e,s)}static setPathFrom(t,e){"pathFrom"in t&&t.pathFrom instanceof g&&t.pathFrom.set(e)}static setPathTo(t,e){"pathTo"in t&&t.pathTo instanceof g&&t.pathTo.set(e)}static setPosition(t,e,s,i){"position"in t&&t.position instanceof x&&t.position.set(e,s,i)}static setPositionV(t,e,s){"position"in t&&t.position instanceof x&&t.position.setV(e,s)}static setStartPosition(t,e,s,i){"startPosition"in t&&t.startPosition instanceof x&&t.startPosition.set(e,s,i)}static setStartPositionV(t,e,s){"startPosition"in t&&t.startPosition instanceof x&&t.startPosition.setV(e,s)}static setRadius(t,e,s){"radius"in t&&t.radius instanceof D&&t.radius.set(e,s)}static setStrokeColor(t,e){"stroke"in t&&t.stroke instanceof k&&t.stroke.color.copy(e)}static setSpace(t,e){"space"in t&&t.space instanceof S&&t.space.set(e)}static setStrokeColorRGB(t,e,s,i){"stroke"in t&&t.stroke instanceof k&&t.stroke.color.set(e,s,i)}static setStrokeColorHex(t,e){"stroke"in t&&t.stroke instanceof k&&t.stroke.color.setFromHex(e)}static setStrokeLineCap(t,e){"stroke"in t&&t.stroke instanceof k&&t.stroke.lineCap.set(e)}static setStrokeLineJoin(t,e){"stroke"in t&&t.stroke instanceof k&&t.stroke.lineJoin.set(e)}static setStrokeOpacity(t,e){"stroke"in t&&t.stroke instanceof k&&t.stroke.opacity.set(e)}static setStrokeWidth(t,e,s){"stroke"in t&&t.stroke instanceof k&&t.stroke.width.set(e,s)}static setGridBoundA(t,e,s,i){"boundA"in t&&t.boundA instanceof x&&t.boundA.set(e,s,i)}static setGridBoundB(t,e,s,i){"boundB"in t&&t.boundB instanceof x&&t.boundB.set(e,s,i)}static setGridReferencePoint(t,e,s,i){"referencePoint"in t&&t.referencePoint instanceof x&&t.referencePoint.set(e,s,i)}static setGridSteps(t,e,s,i){"steps"in t&&t.steps instanceof E&&t.steps.set(e,s,i)}}class X{targets=[];static setTargets(...t){const e=new X;return e.targets.length=0,e.targets.push(...t),e}setTargets(...t){return this.targets.length=0,this.targets.push(...t),this}setAnchor(t){for(const e of this.targets)y.setAnchor(e,t);return this}setColor(t){for(const e of this.targets)y.setColor(e,t);return this}setColorRGB(t,e,s){for(const i of this.targets)y.setColorRGB(i,t,e,s);return this}setColorHex(t){for(const e of this.targets)y.setColorHex(e,t);return this}setCornerRadius(t,e){for(const s of this.targets)y.setCornerRadius(s,t,e);return this}setEdgeStartDistance(t,e="view"){for(const s of this.targets)y.setEdgeStartDistance(s,t,e);return this}setEdgeEndDistance(t,e="view"){for(const s of this.targets)y.setEdgeEndDistance(s,t,e);return this}setEdgeStartAngle(t){for(const e of this.targets)y.setEdgeStartAngle(e,t);return this}setEdgeEndAngle(t){for(const e of this.targets)y.setEdgeEndAngle(e,t);return this}setEdgeBendAngle(t){for(const e of this.targets)y.setEdgeBendAngle(e,t);return this}setEdgeTension(t){for(const e of this.targets)y.setEdgeTension(e,t);return this}setEdgeStartTension(t){for(const e of this.targets)y.setEdgeStartTension(e,t);return this}setEdgeEndTension(t){for(const e of this.targets)y.setEdgeEndTension(e,t);return this}setExtents(t,e,s){for(const i of this.targets)y.setExtents(i,t,e,s);return this}setExtentsV(t,e){for(const s of this.targets)y.setExtentsV(s,t,e);return this}setFont(t){for(const e of this.targets)y.setFont(e,t);return this}setFontSize(t,e){for(const s of this.targets)y.setFontSize(s,t,e);return this}setFontWeight(t){for(const e of this.targets)y.setFontWeight(e,t);return this}setFontStyle(t){for(const e of this.targets)y.setFontStyle(e,t);return this}setFontFamily(t){for(const e of this.targets)y.setFontFamily(e,t);return this}setFontRelativeLineHeight(t){for(const e of this.targets)y.setFontRelativeLineHeight(e,t);return this}setFontRelativeAscenderHeight(t){for(const e of this.targets)y.setFontRelativeAscenderHeight(e,t);return this}setFillColor(t){for(const e of this.targets)y.setFillColor(e,t);return this}setFillColorRGB(t,e,s){for(const i of this.targets)y.setFillColorRGB(i,t,e,s);return this}setFillColorHex(t){for(const e of this.targets)y.setFillColorHex(e,t);return this}setFillOpacity(t){for(const e of this.targets)y.setFillOpacity(e,t);return this}setHorizontalAlign(t){for(const e of this.targets)y.setHorizontalAlign(e,t);return this}setVerticalAlign(t){for(const e of this.targets)y.setVerticalAlign(e,t);return this}setLayer(t){for(const e of this.targets)y.setLayer(e,t);return this}setMinExtents(t,e,s){for(const i of this.targets)y.setMinExtents(i,t,e,s);return this}setMinExtentsV(t,e){for(const s of this.targets)y.setMinExtentsV(s,t,e);return this}setOpacity(t){for(const e of this.targets)y.setOpacity(e,t);return this}setPadding(t,e,s){for(const i of this.targets)y.setPadding(i,t,e,s);return this}setPaddingV(t,e){for(const s of this.targets)y.setPaddingV(s,t,e);return this}setPathFrom(t){for(const e of this.targets)y.setPathFrom(e,t);return this}setPathTo(t){for(const e of this.targets)y.setPathTo(e,t);return this}setPosition(t,e,s){for(const i of this.targets)y.setPosition(i,t,e,s);return this}setPositionV(t,e){for(const s of this.targets)y.setPositionV(s,t,e);return this}setStartPosition(t,e,s){for(const i of this.targets)y.setStartPosition(i,t,e,s);return this}setStartPositionV(t,e){for(const s of this.targets)y.setStartPositionV(s,t,e);return this}setEndPosition(t,e,s){for(const i of this.targets)y.setEndPosition(i,t,e,s);return this}setEndPositionV(t,e){for(const s of this.targets)y.setEndPositionV(s,t,e);return this}setRadius(t,e){for(const s of this.targets)y.setRadius(s,t,e);return this}setStrokeColor(t){for(const e of this.targets)y.setStrokeColor(e,t);return this}setSpace(t){for(const e of this.targets)y.setSpace(e,t);return this}setStrokeColorRGB(t,e,s){for(const i of this.targets)y.setStrokeColorRGB(i,t,e,s);return this}setStrokeColorHex(t){for(const e of this.targets)y.setStrokeColorHex(e,t);return this}setStrokeLineCap(t){for(const e of this.targets)y.setStrokeLineCap(e,t);return this}setStrokeLineJoin(t){for(const e of this.targets)y.setStrokeLineJoin(e,t);return this}setStrokeOpacity(t){for(const e of this.targets)y.setStrokeOpacity(e,t);return this}setStrokeWidth(t,e){for(const s of this.targets)y.setStrokeWidth(s,t,e);return this}setGridBoundA(t,e,s){for(const i of this.targets)y.setGridBoundA(i,t,e,s);return this}setGridBoundB(t,e,s){for(const i of this.targets)y.setGridBoundB(i,t,e,s);return this}setGridReferencePoint(t,e,s){for(const i of this.targets)y.setGridReferencePoint(i,t,e,s);return this}setGridSteps(t,e,s){for(const i of this.targets)y.setGridSteps(i,t,e,s);return this}}class Rt extends O{element;localBBox;constructor(t){super(t,new ct),this.element=document.createElementNS(G,"text"),this.localBBox=new Et,this.localBBox.setOwner(this)}getSVGElement(){return this.element}setContent(t){return this.element.textContent=t,this.localBBox.markDirty(),this}getPosition(t){return this.data.position.toSpace(t,this.scene.getActiveCamera())}getExtents(t){return this.localBBox.getExtents(t,this.scene.getActiveCamera())}getCenter(t){const e=this.localBBox.getCenter(t,this.scene.getActiveCamera()),s=this.getPosition(t);return e.addV(s)}clearText(){return this.element.replaceChildren(),this.localBBox.markDirty(),this}clearDirty(){super.clearDirty(),this.localBBox.clearDirty()}update(){if(this.skipUpdate())return;this.updateSVGChildren(),d.applyFill(this.data.fill,this.element,this.scene),d.applyStroke(this.data.stroke,this.element,this.scene),d.applyOpacity(this.data.opacity,this.element,this.scene),d.applyTransform(this.data.transform,this.element,this.scene),d.applyPosition(this.data.position,this.element,this.scene,"x","y"),d.applyFont(this.data.font,this.element,this.scene),d.applyPreserveWhitespace(this.data.preserveWhitespace,this.element,this.scene),d.applyTextAnchor(this.data.textAnchor,this.element,this.scene),(this.localBBox.isDirty()||this.data.textAnchor.isDirty()||this.data.font.isDirty()||this.data.preserveWhitespace.isDirty())&&this.localBBox.set(this.element,this.data.position,this.scene.getActiveCamera()),this.clearDirty()}}class Pe extends Lt{text;constructor(t){super(t),this.text=new Rt(this.scene),this.text.data.layer.set(2),this.text.setParent(this),this.element.dataset.role="plain-node"}setContent(t){return this.text.setContent(t),this}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera(),e="view";this.updateSVGChildren(),this.text.data.font.copy(this.data.text.font),this.text.data.fill.copy(this.data.text.fill),this.text.data.opacity.copy(this.data.text.opacity),this.text.data.stroke.copy(this.data.text.stroke),this.text.update();const s=this.text.getExtents(e),i=this.data.padding.toSpace(e,t),n=this.data.minExtents.toSpace(e,t);n.max(s.x+i.x,s.y+i.y);const a=n.clone().subV(i);this.extents.setValueFromSpace(e,t,n.x,n.y);const h=this.getCenter(e),c=h.clone().subV(a),u=this.data.text.font,f=u.relativeAscenderHeight.value*u.size.value;let p=0,m=c.y+f;switch(this.data.text.verticalAlign.value){case"top":break;case"middle":m+=a.y-s.y;break;case"bottom":m+=2*(a.y-s.y);break}switch(this.data.text.horizontalAlign.value){case"left":p=c.x,this.text.data.textAnchor.set("start");break;case"center":p=c.x+a.x,this.text.data.textAnchor.set("middle");break;case"right":p=c.x+2*a.x,this.text.data.textAnchor.set("end");break}if(this.text.data.position.set(p,m,"view"),this.text.update(),this.background!==null){if(this.background.data.stroke.copy(this.data.background.stroke),this.background.data.fill.copy(this.data.background.fill),this.background.data.opacity.copy(this.data.background.opacity),this.background.data.transform.copy(this.data.background.transform),this.background instanceof N&&this.background.data.cornerRadius.copy(this.data.background.cornerRadius),this.background instanceof N)this.background.data.position.setV(h,"view"),this.background.data.extents.setV(n,"view"),this.background.data.anchor.set("center");else if(this.background instanceof tt){const w=Math.max(n.x,n.y);this.background.data.position.setV(h,"view"),this.background.data.radius.set(w,"view")}this.background.update()}for(const w of this.endPoints)w.markDirty(),w.edge?.update();this.clearDirty()}}class Ce extends Mt{constructor(t,e){super(t,e)}addCircle(t=this.svg){const e=new tt(this);return e.setParent(t),e}addRect(t=this.svg){const e=new N(this);return e.setParent(t),e}addFillRect(t=this.svg){const e=new we(this);return e.setParent(t),e}addGrid(t=this.svg){const e=new mt(this);return e.setParent(t),e}addWorldGrid(t=this.svg){const e=new mt(this),s=this.getActiveCamera().viewport;return X.setTargets(e.data).setStrokeWidth(1,"view").setTargets(e.data.geometry).setGridBoundA(0,0,"view").setGridBoundB(s.x,s.y,"view").setGridReferencePoint(0,0,"world").setGridSteps(1,1,"world"),e.setParent(t),e}addText(t=this.svg){const e=new Pt(this);return e.setParent(t),e}addPlainNode(t=this.svg){const e=new Pe(this);return e.setParent(t),e}addNode(t=1,e=this.svg){const s=new it(this,t);return s.setParent(e),s}addPath(t=this.svg){const e=new Dt(this);return e.setParent(t),e}addGroup(t,e=this.svg){const s=new xe(this,t);return s.setParent(e),s}addLine(t=this.svg){const e=new Tt(this);return e.setParent(t),e}addLineEdge(t,e,s=this.svg){const i=new Se(this);return i.data.start.set(t),i.data.end.set(e),i.setParent(s),i}addCubicEdge(t,e,s=this.svg){const i=new Ae(this);return i.data.start.set(t),i.data.end.set(e),i.setParent(s),i}update(){return this.svg.update(),this}}class lt{scene;cycleIndex=0;cycleCount=1;cycleDuration=0;rawCycleAlpha=0;rawElapsed=0;rawDuration=0;wrapedCycleAlpha=0;wrapedCycleElapsed=0;ease=V.linear;reversed=!1;alternate=!1;properties;constructor(t){this.scene=t,this.properties=new Set}getScene(){return this.scene}getProperties(){return this.properties}getElapsed(){return this.rawElapsed}getDuration(){return this.rawDuration}getCycleDuration(){return this.cycleDuration}getCycleIndex(){return this.cycleIndex}getCycleCount(){return this.cycleCount}setCycleCount(t){return this.cycleCount=t,this.updateRawDuration(),this}setEasing(t){return this.ease=t,this}setReversed(t=!0){return this.reversed=t,this}setAlternate(t=!0){return this.alternate=t,this}setElapsed(t){this.setRawElapsed(t);for(const e of this.properties)this.setElapsedPropertyImpl(e);return this}setElapsedProperty(t,e){return this.setRawElapsed(e),this.setElapsedPropertyImpl(t),this}updateRawDuration(){this.rawDuration=this.cycleDuration*(this.cycleCount<0?1:this.cycleCount)}setRawElapsed(t){this.rawElapsed!==t&&(this.rawElapsed=t,this.cycleIndex=b.clamp(Math.floor(this.rawElapsed/this.cycleDuration),0,this.cycleCount-1),t>=this.cycleCount*this.cycleDuration?this.rawCycleAlpha=1:this.rawCycleAlpha=this.rawElapsed%this.cycleDuration/this.cycleDuration,this.wrapedCycleAlpha=this.reversed?1-this.rawCycleAlpha:this.rawCycleAlpha,this.alternate&&this.cycleIndex%2===1&&(this.wrapedCycleAlpha=1-this.wrapedCycleAlpha),this.wrapedCycleAlpha=this.ease(this.wrapedCycleAlpha),this.wrapedCycleElapsed=b.clamp(this.wrapedCycleAlpha,0,1)*this.cycleDuration)}}class Te{currentTime=0;delta=0;unscaledDelta=0;scale=1;maxDelta=200;elapsed=0;unscaledElapsed=0;start(t){return this.currentTime=t,this.delta=0,this}update(t){const e=t-this.currentTime;return this.unscaledDelta=Math.min(e,this.maxDelta),this.delta=this.unscaledDelta*this.scale,this.currentTime=t,this.unscaledElapsed+=this.unscaledDelta,this.elapsed+=this.delta,this}setMaximumDeltaTime(t){return this.maxDelta=t,this}setTimeScale(t){return this.scale=t,this}getTimeScale(){return this.scale}getDelta(){return this.delta}getUnscaledDelta(){return this.unscaledDelta}getElapsed(){return this.elapsed}getUnscaledElapsed(){return this.unscaledElapsed}}class wt{manager;animation;state="stopped";repeat=!1;speed=1;constructor(t){this.animation=t,this.manager=J.getInstance()}getAnimation(){return this.animation}setSpeed(t){return this.speed=t,this}getSpeed(){return this.speed}setElapsed(t){return this.animation.setElapsed(t),this}isPlaying(){return this.state==="playing"}isPaused(){return this.state==="paused"}isStopped(){return this.state==="stopped"}play(t=!1){return this.state="playing",this.animation.setElapsed(0),this.manager.addAnimation(this),this.repeat=t,this}pause(){return this.state="paused",this.manager.removeAnimation(this),this}stop(){return this.state="stopped",this.manager.removeAnimation(this),this}resume(){return this.state==="paused"?(this.state="playing",this.manager.addAnimation(this)):this.state==="stopped"&&this.play(),this}update(t){if(this.state!=="playing")return this;const e=this.animation.getElapsed()+t*this.speed,s=this.animation.getDuration();return e>=s?this.repeat?this.animation.setElapsed(e%s):(this.animation.setElapsed(s),this.stop()):e<0?(this.animation.setElapsed(0),this.stop()):this.animation.setElapsed(e),this.animation.getScene().getSVG().update(),this}}class J{static _instance=null;timer;activeAnimations=new Set;constructor(){this.timer=new Te,this.update=this.update.bind(this)}firstFrame(t){this.timer.start(t)}static getInstance(){if(!J._instance){const t=new J;requestAnimationFrame(t.firstFrame.bind(t)),requestAnimationFrame(t.update.bind(t)),J._instance=t}return J._instance}update(t){this.timer.update(t);const e=this.timer.getDelta();for(const s of this.activeAnimations)s.update(e);requestAnimationFrame(this.update)}addAnimation(t){return this.activeAnimations.add(t),this}removeAnimation(t){return this.activeAnimations.delete(t),this}}class Le{animation;position;offset;start;end;constructor(t,e,s){this.animation=t,this.start=0,this.end=0+t.getDuration(),this.position=e,this.offset=s}updateRange(t){if(this.start=this.offset,t!==null)switch(this.position){case"absolute":break;case"previous-start":t&&(this.start+=t.start);break;case"previous-end":t&&(this.start+=t.start+t.animation.getDuration());break}this.start=Math.max(this.start,0),this.end=this.start+this.animation.getDuration()}}class be{property;sortedParts=[];constructor(t){this.property=t}refreshState(){this.sortedParts.sort((t,e)=>t.start-e.start)}addPart(t){this.sortedParts.push(t),this.sortedParts.sort((e,s)=>e.start-s.start);for(let e=0;e<this.sortedParts.length-1;e++)this.sortedParts[e].end>this.sortedParts[e+1].start&&console.warn("S2Timeline: Overlapping animations on the same target are not supported.",this.property,this.sortedParts[e],this.sortedParts[e+1])}getActivePart(t){if(this.sortedParts.length===0)throw new Error("S2TimelineTargetParts: No parts available.");if(t<=this.sortedParts[0].start)return this.sortedParts[0];for(let e=0;e<this.sortedParts.length-1;e++)if(t<=this.sortedParts[e].end||t<this.sortedParts[e+1].start)return this.sortedParts[e];return this.sortedParts[this.sortedParts.length-1]}setElapsed(t){const e=this.getActivePart(t),s=e.animation;if(t<=e.start)s.setElapsedProperty(this.property,0);else if(t>=e.end)s.setElapsedProperty(this.property,s.getDuration());else{const i=t-e.start;s.setElapsedProperty(this.property,i)}}}class xt extends lt{parts;propertyTrackMap;constructor(t){super(t),this.cycleDuration=0,this.parts=[],this.propertyTrackMap=new Map}addAnimation(t,e="previous-end",s=0){const i=this.parts.length>0?this.parts[this.parts.length-1]:null,n=new Le(t,e,s);n.updateRange(i),this.cycleDuration=Math.max(this.cycleDuration,n.end),this.updateRawDuration();const a=t.getProperties();for(const h of a){this.properties.add(h);let c=this.propertyTrackMap.get(h);c===void 0&&(c=new be(h),this.propertyTrackMap.set(h,c)),c.addPart(n)}return this.parts.push(n),this}setElapsedPropertyImpl(t){const e=this.propertyTrackMap.get(t);e!==void 0&&e.setElapsed(this.wrapedCycleElapsed)}}class Oe{scene;masterTimeline;masterPlayable;stepTimelines;stepPlayables;shouldAddNewStep=!0;stepTimes;speed;currPlayable;constructor(t){this.scene=t,this.masterTimeline=new xt(this.scene),this.masterPlayable=new wt(this.masterTimeline),this.stepTimelines=[],this.stepPlayables=[],this.stepTimes=[0],this.speed=1,this.currPlayable=this.masterPlayable}setSpeed(t){this.speed=t,this.masterPlayable.setSpeed(t);for(const e of this.stepPlayables)e.setSpeed(t);return this}getSpeed(){return this.speed}getStepIndexFromElapsed(t){for(let e=0;e<this.stepTimes.length-1;e++)if(t>=this.stepTimes[e]&&t<this.stepTimes[e+1])return e;return this.stepTimes.length-1}getStepStartTime(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.stepTimes[t]}playStep(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.stop(),this.masterTimeline.setElapsed(this.stepTimes[t]),this.currPlayable=this.stepPlayables[t],this.currPlayable.play(),this}playMaster(){return this.stop(),this.currPlayable=this.masterPlayable,this.currPlayable.play(),this}isPlaying(){return this.currPlayable.isPlaying()}isPaused(){return this.currPlayable.isPaused()}pause(){return this.currPlayable.pause(),this}resume(){return this.currPlayable.resume(),this}resetStep(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.masterTimeline.setElapsed(this.stepTimes[t]),this}reset(){return this.masterTimeline.setElapsed(0),this.scene.getSVG().update(),this.currPlayable=this.masterPlayable,this}stop(){return this.currPlayable.stop(),this}setMasterElapsed(t){return this.masterTimeline.setElapsed(t),this}getMasterDuration(){return this.masterTimeline.getDuration()}getStepDuration(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.stepTimelines[t].getDuration()}getStepCount(){return this.stepTimelines.length}makeStep(){if(this.shouldAddNewStep)return this;if(this.stepTimelines.length===0)return this;const t=this.stepTimelines[this.stepTimelines.length-1];return this.masterTimeline.addAnimation(t,"previous-end",0),this.shouldAddNewStep=!0,this}addAnimation(t,e="previous-end",s=0){if(this.shouldAddNewStep){const n=new xt(this.scene),a=new wt(n);a.setSpeed(this.speed),this.stepTimelines.push(n),this.stepPlayables.push(a),this.stepTimes.push(0),this.shouldAddNewStep=!1}return this.stepTimelines[this.stepTimelines.length-1].addAnimation(t,e,s),this.update(),this}update(){let t=0;this.stepTimes[0]=0;for(let e=0;e<this.stepTimelines.length;e++){const s=this.stepTimelines[e];t+=s.getDuration(),this.stepTimes[e+1]=t}}getMasterTimeline(){return this.masterTimeline}getStepTimeline(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.stepTimelines[t]}getStepPlayable(t){return t=b.clamp(t,0,this.stepTimelines.length-1),this.stepPlayables[t]}getMasterPlayable(){return this.masterPlayable}}class Re extends lt{setCycleDuration(t){return this.cycleDuration=t,this.updateRawDuration(),this}}class F{static create(t,e){switch(e.kind){case"number":return new Ge(t,e);case"color":return new _e(t,e);case"position":return new Ie(t,e);case"length":return new Be(t,e);case"extents":return new Fe(t,e);default:throw new Error("Unsupported property type")}}}class $ extends Re{}class Ge extends ${property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.wrapedCycleAlpha;this.property.lerp(this.state0,this.state1,e)}}class _e extends ${property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.hardCopy(this.property),this}commitFinalState(){return this.state1.hardCopy(this.property),this}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.wrapedCycleAlpha;this.property.lerp(this.state0,this.state1,e)}}class Be extends ${property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.wrapedCycleAlpha,s=this.scene.getActiveCamera();this.property.lerp(this.state0,this.state1,e,s)}}class Ie extends ${property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.wrapedCycleAlpha,s=this.scene.getActiveCamera();this.property.lerp(this.state0,this.state1,e,s)}}class Fe extends ${property;state0;state1;constructor(t,e){super(t),this.property=e,this.state0=e.clone(),this.state1=e.clone(),this.properties.add(e)}commitInitialState(){return this.state0.copy(this.property),this}commitFinalState(){return this.state1.copy(this.property),this}setElapsedPropertyImpl(t){if(t!==this.property)return;const e=this.wrapedCycleAlpha,s=this.scene.getActiveCamera();this.property.lerp(this.state0,this.state1,e,s)}}function Ve(o){const t=[],e=/\*\*(\w+):(.*?)\*\*|(\s+)|([()=;,.])|([^\s()=;,.]+)/g;for(const s of o.split(`
`)){let i;for(;(i=e.exec(s))!==null;)i[1]?t.push({type:i[1],value:i[2]}):i[3]?t.push({type:"space",value:i[3]}):i[4]?t.push({type:"punct",value:i[4]}):i[5]&&t.push({type:"plain",value:i[5]});t.push({type:"newline",value:`
`})}return t.pop(),t}class Me extends P{position;opacity;anchor;padding;minExtents;text;background;currentLine;constructor(){super(),this.position=new x(0,0,"world"),this.anchor=new S("center"),this.padding=new E(10,5,"view"),this.minExtents=new E(0,0,"view"),this.text=new Ne,this.background=new Ue,this.currentLine=new We,this.opacity=new g(1)}setOwner(t=null){this.position.setOwner(t),this.anchor.setOwner(t),this.padding.setOwner(t),this.minExtents.setOwner(t),this.text.setOwner(t),this.background.setOwner(t),this.currentLine.setOwner(t),this.opacity.setOwner(t)}clearDirty(){super.clearDirty(),this.position.clearDirty(),this.anchor.clearDirty(),this.padding.clearDirty(),this.minExtents.clearDirty(),this.text.clearDirty(),this.background.clearDirty(),this.currentLine.clearDirty(),this.opacity.clearDirty()}}class Ne extends P{fill;stroke;opacity;font;verticalAlign;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.font=new B,this.verticalAlign=new S("middle"),this.stroke.width.set(0,"view"),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.font.setOwner(t),this.verticalAlign.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.font.clearDirty(),this.verticalAlign.clearDirty()}}class Ue extends P{fill;stroke;opacity;cornerRadius;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.cornerRadius=new D(5,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.cornerRadius.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.cornerRadius.clearDirty()}}class We extends P{fill;stroke;opacity;index;padding;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(0),this.index=new g(0),this.padding=new E(0,1,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.index.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.index.clearDirty(),this.padding.clearDirty()}}class ut extends O{element;textGroup;codeBackground;lineBackground;extents;tokenStyleSetter=ut.defaultTokenStyleSetter;tokenRects;constructor(t){super(t,new Me),this.element=document.createElementNS(G,"g"),this.textGroup=new Ct(t),this.codeBackground=new N(t),this.lineBackground=new N(t),this.extents=new E(0,0,"view"),this.tokenRects=[],this.textGroup.setParent(this),this.codeBackground.setParent(this),this.lineBackground.setParent(this),this.textGroup.data.layer.set(2),this.codeBackground.data.layer.set(0),this.lineBackground.data.layer.set(0),this.element.dataset.role="code",this.updateSVGChildren()}setTokenStyleSetter(t){return this.tokenStyleSetter=t,this}static defaultTokenStyleSetter(t,e){switch(e){case"fn":t.data.fill.color.copy(v.ORANGE_2),t.data.fill.color.setPriority(L.Important);break;case"type":t.data.fill.color.copy(v.CYAN_3),t.data.fill.color.setPriority(L.Important);break;case"kw":t.data.fill.color.copy(v.PURPLE_3),t.data.fill.color.setPriority(L.Important),t.data.font.weight.set(700),t.data.font.weight.setPriority(L.Important);break;case"var":t.data.fill.color.copy(v.LIGHT_BLUE_1),t.data.fill.color.setPriority(L.Important);break;case"punct":t.data.fill.color.copy(v.PURPLE_1),t.data.fill.color.setPriority(L.Important);break}}findTokenTSpan(t,e){return this.textGroup.getLine(t).findTSpan(e)}createEmphasisForToken(t,e){const s=this.findTokenTSpan(t,e);if(!s)return null;const i=new Ye(this.scene);return i.data.fill.opacity.set(.2),i.data.fill.color.copy(v.BLUE_9),i.data.stroke.color.copy(v.BLUE_5),i.data.stroke.width.set(1,"view"),i.data.layer.set(1),i.setParent(this),i.setTextReference(s),i.update(),this.tokenRects.push(i),i}detachEmphasisRect(t){const e=this.tokenRects.indexOf(t);return e!==-1&&this.tokenRects.splice(e,1),t.setParent(null),this}setContent(t){let e=this.textGroup.addLine();for(const s of t)if(e.data.preserveWhitespace.set(!0),s.type==="plain")e.addTSpan(s.value);else if(s.type==="newline")e=this.textGroup.addLine();else{const i=e.addTSpan(s.value,s.type);this.tokenStyleSetter(i,s.type)}}getExtents(t){return this.extents.toSpace(t,this.scene.getActiveCamera())}getSVGElement(){return this.element}update(){if(this.skipUpdate())return;const t=this.scene.getActiveCamera(),e="view";this.updateSVGChildren(),d.applyOpacity(this.data.opacity,this.element,this.scene),this.textGroup.data.font.copy(this.data.text.font),this.textGroup.data.horizontalAlign.set("left"),this.textGroup.data.verticalAlign.copy(this.data.text.verticalAlign),this.textGroup.data.fill.copy(this.data.text.fill),this.textGroup.data.opacity.copy(this.data.text.opacity),this.textGroup.data.stroke.copy(this.data.text.stroke),this.textGroup.update();const s=this.textGroup.getExtents(e),i=this.data.padding.toSpace(e,t),n=this.data.minExtents.toSpace(e,t),a=s.addV(i);a.maxV(n),this.extents.setV(a,e);const h=a.clone().subV(i),c=j.getCenter(this.data.anchor.get(),e,t,this.data.position,this.extents);this.textGroup.data.minExtents.setV(h,e),this.textGroup.data.position.setV(c,e),this.textGroup.update(),this.codeBackground.data.position.setV(c,"view"),this.codeBackground.data.extents.setV(a,"view"),this.codeBackground.data.cornerRadius.copy(this.data.background.cornerRadius),this.codeBackground.data.fill.copy(this.data.background.fill),this.codeBackground.data.stroke.copy(this.data.background.stroke),this.codeBackground.data.opacity.copy(this.data.background.opacity),this.codeBackground.update(),this.lineBackground.data.fill.copy(this.data.currentLine.fill),this.lineBackground.data.stroke.copy(this.data.currentLine.stroke),this.lineBackground.data.opacity.copy(this.data.currentLine.opacity);const u=this.textGroup.getLineCount();if(u>0){const f=this.data.currentLine.padding.toSpace(e,t),p=b.clamp(this.data.currentLine.index.get(),0,u-1),m=b.clamp(Math.floor(p),0,u-1),w=b.clamp(Math.ceil(p),0,u-1),C=p-m,_=this.textGroup.getLine(m).getExtents(e),I=this.textGroup.getLine(w).getExtents(e),T=this.textGroup.getLine(m).getCenter(e),M=this.textGroup.getLine(w).getCenter(e),pt=_.y*(1-C)+I.y*C,Gt=T.y*(1-C)+M.y*C;this.lineBackground.data.position.set(c.x,Gt,"view"),this.lineBackground.data.extents.set(a.x+f.x,pt+f.y,"view"),this.lineBackground.data.anchor.set("center"),this.lineBackground.update()}for(const f of this.tokenRects)f.update();this.clearDirty()}}class He extends P{fill;stroke;opacity;cornerRadius;padding;constructor(){super(),this.fill=new A,this.stroke=new k,this.opacity=new g(1),this.cornerRadius=new D(5,"view"),this.padding=new E(4,2,"view"),this.stroke.opacity.set(1),this.fill.opacity.set(1)}setOwner(t=null){this.fill.setOwner(t),this.stroke.setOwner(t),this.opacity.setOwner(t),this.cornerRadius.setOwner(t),this.padding.setOwner(t)}clearDirty(){super.clearDirty(),this.fill.clearDirty(),this.stroke.clearDirty(),this.opacity.clearDirty(),this.cornerRadius.clearDirty(),this.padding.clearDirty()}}class Ye extends O{rect;textReference;constructor(t){super(t,new He),this.rect=new N(t),this.textReference=null,this.children=[]}setTextReference(t){return this.textReference=t,this}getSVGElement(){return this.rect.getSVGElement()}update(){if(!this.isDirty()||this.textReference===null)return;const t=this.scene.getActiveCamera(),e="view",s=this.textReference.getPosition(e),i=this.textReference.getExtents(e),n=this.data.padding.toSpace(e,t);this.rect.data.position.setV(s,e),this.rect.data.extents.set(i.x+n.x,i.y+n.y,e),this.rect.data.anchor.set("center"),this.rect.data.fill.copy(this.data.fill),this.rect.data.stroke.copy(this.data.stroke),this.rect.data.opacity.copy(this.data.opacity),this.rect.data.cornerRadius.copy(this.data.cornerRadius),this.rect.update(),this.clearDirty()}}class vt extends lt{animations;propertyToAnimation;constructor(t){super(t),this.animations=[],this.propertyToAnimation=new Map}addAnimation(t){this.animations.push(t);for(const e of t.getProperties())this.properties.add(e),this.propertyToAnimation.set(e,t);return this.cycleDuration=Math.max(this.cycleDuration,t.getDuration()),this.updateRawDuration(),this}addAnimations(...t){for(const e of t)this.addAnimation(e);return this}addLerpProperties(t,e,s){for(const i of t)this.addAnimation(F.create(this.scene,i).setCycleDuration(e).setEasing(s));return this}commitLerpInitialStates(){for(const t of this.animations)t instanceof $&&t.commitInitialState();return this}commitLerpFinalStates(){for(const t of this.animations)t instanceof $&&t.commitFinalState();return this}setElapsedPropertyImpl(t){this.propertyToAnimation.get(t)?.setElapsedProperty(t,this.wrapedCycleElapsed)}}const ze=new l(720,360).scale(1.5),qe=new _t(new l(0,0),new l(9,4.5),ze,1),je=`**kw:fonction** **fn:parcoursInfixe**(**var:n**: **type:Noeud**):
  **kw:si** **var:n**.**var:gauche** existe **kw:alors**
    **fn:parcoursInfixe**(**var:n**.**var:gauche**)
  **fn:traiter**(**var:n**)
  **kw:si** **var:n**.**var:droit** existe **kw:alors**
    **fn:parcoursInfixe**(**var:n**.**var:droit**)`,Xe=`**kw:fonction** **fn:parcoursPrefixe**(**var:n**: **type:Noeud**):
  **fn:traiter**(**var:n**)
  **kw:si** **var:n**.**var:gauche** existe **kw:alors**
    **fn:parcoursPrefixe**(**var:n**.**var:gauche**)
  **kw:si** **var:n**.**var:droit** existe **kw:alors**
    **fn:parcoursPrefixe**(**var:n**.**var:droit**)`,$e=`**kw:fonction** **fn:parcoursSuffixe**(**var:n**: **type:Noeud**):
  **kw:si** **var:n**.**var:gauche** existe **kw:alors**
    **fn:parcoursSuffixe**(**var:n**.**var:gauche**)
  **kw:si** **var:n**.**var:droit** existe **kw:alors**
    **fn:parcoursSuffixe**(**var:n**.**var:droit**)
  **fn:traiter**(**var:n**)`;class Ke{scene;font;constructor(t){this.scene=t,this.font=new B,this.font.family.set("monospace"),this.font.size.set(20,"view"),this.font.relativeLineHeight.set(1.3)}setNodeDefault(t){const e=t.data;e.background.fill.color.copy(v.GREY_6),e.background.stroke.color.copy(v.GREY_4),e.background.stroke.width.set(4,"view"),e.text.fill.color.copy(v.WHITE),e.text.horizontalAlign.set("center"),e.text.verticalAlign.set("middle"),e.text.font.copy(this.font),e.text.font.weight.set(700),e.padding.set(0,0,"view"),e.minExtents.set(.4,.35,"world"),e.background.cornerRadius.set(10,"view"),e.layer.set(2)}setNodeSelected(t){const e=t.data;e.background.fill.color.copy(v.GREY_8),e.background.stroke.color.copy(v.BLUE_5),e.text.fill.color.copy(v.BLUE_2)}createSelectNodeAnim(t){const e=t.data,s=new vt(this.scene);return s.addLerpProperties([e.background.fill.color,e.background.stroke.color,e.text.fill.color],300,V.inOut),this.setNodeSelected(t),s.commitLerpFinalStates(),s}setNodeExplored(t){const e=t.data;e.background.fill.color.copy(v.CYAN_7),e.background.stroke.color.copy(v.CYAN_3),e.text.fill.color.copy(v.WHITE)}createExploreNodeAnim(t){const e=t.data,s=new vt(this.scene);return s.addLerpProperties([e.background.fill.color,e.background.stroke.color,e.text.fill.color],300,V.inOut),this.setNodeExplored(t),s.commitLerpFinalStates(),s}setEdgeBase(t){X.setTargets(t.data).setStrokeColor(v.GREY_6).setStrokeWidth(4,"view").setStrokeLineCap("round").setEdgeStartDistance(0,"view").setEdgeEndDistance(10,"view").setLayer(0)}setEdgeEmphasized(t){X.setTargets(t.data).setStrokeColor(v.WHITE).setStrokeWidth(5,"view").setStrokeLineCap("round").setEdgeStartDistance(0,"view").setEdgeEndDistance(11,"view").setLayer(1),t.createArrowTip().data.pathStrokeFactor.set(.3)}setEdgeSelected(t){t.data.stroke.color.copy(v.BLUE_5)}createSelectEdgeAnim(t){const e=F.create(this.scene,t.data.stroke.color).setCycleDuration(300).setEasing(V.inOut);return this.setEdgeSelected(t),e.commitFinalState(),e}setEdgeExplored(t){t.data.stroke.color.copy(v.GREY_7)}createExploreEdgeAnim(t){const e=F.create(this.scene,t.data.stroke.color).setCycleDuration(300).setEasing(V.inOut);return this.setEdgeExplored(t),e.commitFinalState(),e}}class Je{root;style;scene;mainGroup;bTreeNodes;levelDistance=1.5;baseSep=.6;height;size;center;extents;maxNodeExtents=new l;constructor(t,e,s=new Ke(t)){this.scene=t,this.style=s,this.center=new l,this.extents=new l,this.bTreeNodes=[],this.mainGroup=t.addGroup(new P),this.height=0,this.size=0,this.root=this.createNodes(e),this.createNodeLines(this.root,null)}createNodes(t,e=0){const s=new Qe(this.scene,t.data);if(this.height=Math.max(this.height,e+1),s.node.setParent(this.mainGroup),this.style.setNodeDefault(s.node),t.left){const i=this.createNodes(t.left,e+1);s.setLeft(i)}if(t.right){const i=this.createNodes(t.right,e+1);s.setRight(i)}return this.size++,this.bTreeNodes.push(s),s}createNodeLines(t,e){t!==null&&(e&&(t.parentEdge=this.scene.addLineEdge(e.node,t.node,this.mainGroup),t.parentEmphEdge=this.scene.addLineEdge(e.node,t.node,this.mainGroup),this.style.setEdgeBase(t.parentEdge),this.style.setEdgeEmphasized(t.parentEmphEdge)),this.createNodeLines(t.left,t),this.createNodeLines(t.right,t))}getExtents(){return this.extents}computeExtents(){this.extents.x=(this.size-1)*this.baseSep,this.extents.y=(this.height-1)*this.levelDistance,this.extents.scale(.5),this.maxNodeExtents.set(0,0);for(const t of this.bTreeNodes){const e=t.node.getExtents("world");this.maxNodeExtents.maxV(e)}return this.extents.addV(this.maxNodeExtents),this.extents}computeLayout(t){this.center.copy(t),this.computeExtents(),this.computeLayoutRec(this.root,0,0)}computeLayoutRec(t,e,s){return t===null||(e=this.computeLayoutRec(t.left,e,s+1),console.log("maxNodeExt",this.maxNodeExtents),t.node.data.position.set(this.center.x-this.extents.x+this.maxNodeExtents.x+e*this.baseSep,this.center.y+this.extents.y-this.maxNodeExtents.y-s*this.levelDistance,"world"),e++,e=this.computeLayoutRec(t.right,e,s+1)),e}animateSelectNode(t,e){if(e.parentEmphEdge){e.parentEmphEdge.data.pathTo.set(0);const i=F.create(this.scene,e.parentEmphEdge.data.pathTo).setCycleDuration(500).setEasing(V.inOut);e.parentEmphEdge.data.pathTo.set(1),t.addAnimation(i.commitFinalState())}let s=null;s=this.style.createSelectNodeAnim(e.node),t.addAnimation(s,"previous-start",e.parentEdge?100:0),e.left&&e.left.parentEdge&&(s=this.style.createSelectEdgeAnim(e.left.parentEdge),t.addAnimation(s,"previous-start",0)),e.right&&e.right.parentEdge&&(s=this.style.createSelectEdgeAnim(e.right.parentEdge),t.addAnimation(s,"previous-start",0))}animateExploreNode(t,e){const s=this.style.createExploreNodeAnim(e.node);t.addAnimation(s,"previous-end",0)}animateExitParentEdge(t,e){if(!e.parentEdge||!e.parentEmphEdge)return;const s=F.create(this.scene,e.parentEmphEdge.data.pathTo).setCycleDuration(500).setEasing(V.inOut);e.parentEmphEdge.data.pathTo.set(0),t.addAnimation(s.commitFinalState(),"previous-end",0);const i=this.style.createExploreEdgeAnim(e.parentEdge);t.addAnimation(i,"previous-start",200)}}class Qe{data;parent=null;left=null;right=null;node;parentEdge=null;parentEmphEdge=null;constructor(t,e=0){this.data=e,this.node=t.addPlainNode(),this.node.setContent(e.toString()),this.node.createRectBackground()}setLeft(t){this.left=t,t.parent=this}setRight(t){this.right=t,t.parent=this}}class et extends Ce{tree;animator;codeStack=[];codeNW=new l(-8,4);codePositions=[];outputText;outputBackground;outputTitle;setDefaultFont(t){t.family.set("monospace"),t.size.set(16,"view"),t.relativeLineHeight.set(1.3)}setCodeStyle(t){const e=new B;e.family.set("monospace"),e.size.set(16,"view"),e.relativeLineHeight.set(1.3),this.setDefaultFont(t.data.text.font),t.data.text.fill.color.copy(v.WHITE),t.data.padding.set(20,10,"view"),t.data.minExtents.set(3.5,1,"world"),t.data.background.fill.color.copy(v.GREY_9),t.data.background.stroke.color.copy(v.GREY_7),t.data.background.stroke.width.set(2,"view"),t.data.background.cornerRadius.set(10,"view"),t.data.currentLine.opacity.set(1),t.data.currentLine.fill.color.copy(v.BLACK),t.data.currentLine.fill.opacity.set(.5),t.data.currentLine.stroke.color.copy(v.WHITE),t.data.currentLine.stroke.width.set(1,"view"),t.data.currentLine.stroke.opacity.set(.2),t.data.currentLine.padding.set(-.5,2,"view"),t.data.currentLine.index.set(0)}setOutputTextStyle(t){this.setDefaultFont(t.data.font),t.data.fill.color.copy(v.WHITE)}setOutputBackgroundStyle(t){X.setTargets(t.data).setFillColor(v.GREY_9).setStrokeColor(v.GREY_7).setStrokeWidth(2,"view").setCornerRadius(10,"view")}constructor(t,e,s){super(t,qe),this.animator=new Oe(this);const i=this.addFillRect();X.setTargets(i.data).setColor(v.GREY_8),this.outputBackground=this.addRect(),this.outputTitle=new Rt(this),this.outputTitle.setParent(this.getSVG()),this.outputTitle.setContent("Noeuds explorés :"),this.outputTitle.data.fill.color.copy(v.ORANGE_2),this.setDefaultFont(this.outputTitle.data.font),this.outputText=new Pt(this),this.outputText.setParent(this.getSVG()),this.setOutputTextStyle(this.outputText),this.setOutputBackgroundStyle(this.outputBackground),this.update(),this.tree=new Je(this,e);let n="";switch(s){case"in-order":n=je;break;case"pre-order":n=Xe;break;case"post-order":n=$e;break}for(let T=0;T<this.tree.height;T++){const M=new ut(this);M.setParent(this.getSVG()),this.codeStack.push(M),this.setCodeStyle(M),M.setContent(Ve(n)),M.data.anchor.set("north-west")}this.update(),this.tree.computeExtents();const a=this.tree.getExtents(),h=this.codeStack[0].getExtents("world"),c=2*a.x+2*h.x+1.5,u=2*Math.max(a.y,h.y),f=new l(c/2-a.x,0),p=new l(-c/2,u/2);this.tree.computeLayout(f);for(let T=0;T<this.codeStack.length;T++){const M=new l(p.x+.2*T,p.y-.2*T);this.codePositions.push(M),this.codeStack[T].data.position.setV(M,"world")}const m=this.getActiveCamera().viewToWorldLength(20),w=this.getActiveCamera().viewToWorldLength(21),C=this.getActiveCamera().viewToWorldLength(16),_=2*w+1*m,I=new l(p.x,-p.y+_);switch(this.outputBackground.data.position.setV(I,"world"),this.outputBackground.data.extents.set(3.5,_/2,"world"),this.outputBackground.data.anchor.set("north-west"),this.outputTitle.data.position.set(I.x+m,I.y-C-.5*m,"world"),this.outputText.data.position.set(I.x+m,I.y-C-w-.5*m,"world"),this.update(),s){case"in-order":this.createInOrderAnimation(this.tree.root);break;case"pre-order":this.createPreOrderAnimation(this.tree.root);break;case"post-order":this.createPostOrderAnimation(this.tree.root);break}this.update()}animateCodeFadeIn(t){if(t<0||t>=this.codeStack.length)return;const e=this.codeStack[t];if(e.data.currentLine.index.set(0),t===0)return;const s=this.codePositions[t];e.data.currentLine.index.set(0),e.data.opacity.set(0),e.data.position.set(s.x+.5,s.y,"world");const i=F.create(this,e.data.position),n=F.create(this,e.data.opacity),a=F.create(this,e.data.currentLine.index);e.data.currentLine.index.set(0),e.data.opacity.set(1),e.data.position.setV(s,"world");for(const h of[i,n,a])h.setCycleDuration(500).setEasing(V.out).commitFinalState();this.animator.addAnimation(i,"previous-end",0),this.animator.addAnimation(n,"previous-start",0),this.animator.addAnimation(a,"previous-start",0)}animateCodeFadeOut(t){if(t<0||t>=this.codeStack.length)return;const e=this.codeStack[t];if(e.data.currentLine.index.set(0),t===0)return;const s=F.create(this,e.data.position),i=F.create(this,e.data.opacity),n=this.codePositions[t];e.data.opacity.set(0),e.data.position.set(n.x+.5,n.y,"world");for(const a of[s,i])a.setCycleDuration(500).setEasing(V.out).commitFinalState();this.animator.addAnimation(s,"previous-end",0),this.animator.addAnimation(i,"previous-start",0)}animateCodeLineIndex(t,e){if(t<0||t>=this.codeStack.length)return;const s=this.codeStack[t],i=F.create(this,s.data.currentLine.index).setCycleDuration(500).setEasing(V.inOut);s.data.currentLine.index.set(e),this.animator.addAnimation(i.commitFinalState(),"previous-end",0)}animateWriteOutput(t){if(this.outputText.getTSpanCount()>0){const i=this.outputText.getTSpan(this.outputText.getTSpanCount()-1),n=F.create(this,i.data.fill.color).setCycleDuration(500).setEasing(V.inOut);i.data.fill.color.hardCopy(v.GREY_4),this.animator.addAnimation(n.commitFinalState(),"previous-start",0)}const e=this.outputText.addTSpan(t);e.data.opacity.set(0),e.data.fill.color.hardCopy(v.WHITE),e.data.fill.color.setPriority(L.Important);const s=F.create(this,e.data.opacity).setCycleDuration(500).setEasing(V.inOut);e.data.opacity.set(1),this.animator.addAnimation(s.commitFinalState(),"previous-start",200)}createInOrderAnimation(t,e=0){t&&(this.tree.animateSelectNode(this.animator,t),this.animateCodeFadeIn(e),this.animator.makeStep(),this.animateCodeLineIndex(e,1),this.animator.makeStep(),t.left&&(this.animateCodeLineIndex(e,2),this.animator.makeStep(),this.createInOrderAnimation(t.left,e+1)),this.animateCodeLineIndex(e,3),this.animator.makeStep(),this.tree.animateExploreNode(this.animator,t),this.animateWriteOutput(t.data.toString()+", "),this.animator.makeStep(),this.animateCodeLineIndex(e,4),this.animator.makeStep(),t.right&&(this.animateCodeLineIndex(e,5),this.animator.makeStep(),this.createInOrderAnimation(t.right,e+1)),this.tree.animateExitParentEdge(this.animator,t),this.animateCodeFadeOut(e),this.animator.makeStep())}createPreOrderAnimation(t,e=0){t&&(this.tree.animateSelectNode(this.animator,t),this.animateCodeFadeIn(e),this.animator.makeStep(),this.animator.makeStep(),this.animateCodeLineIndex(e,1),this.animator.makeStep(),this.tree.animateExploreNode(this.animator,t),this.animateWriteOutput(t.data.toString()+", "),this.animator.makeStep(),this.animateCodeLineIndex(e,2),this.animator.makeStep(),t.left&&(this.animateCodeLineIndex(e,3),this.animator.makeStep(),this.createPreOrderAnimation(t.left,e+1)),this.animateCodeLineIndex(e,4),this.animator.makeStep(),t.right&&(this.animateCodeLineIndex(e,5),this.animator.makeStep(),this.createPreOrderAnimation(t.right,e+1)),this.tree.animateExitParentEdge(this.animator,t),this.animateCodeFadeOut(e),this.animator.makeStep())}createPostOrderAnimation(t,e=0){t&&(this.tree.animateSelectNode(this.animator,t),this.animateCodeFadeIn(e),this.animator.makeStep(),this.animator.makeStep(),this.animateCodeLineIndex(e,1),this.animator.makeStep(),t.left&&(this.animateCodeLineIndex(e,2),this.animator.makeStep(),this.createPostOrderAnimation(t.left,e+1)),this.animateCodeLineIndex(e,3),this.animator.makeStep(),t.right&&(this.animateCodeLineIndex(e,4),this.animator.makeStep(),this.createPostOrderAnimation(t.right,e+1)),this.animateCodeLineIndex(e,5),this.animator.makeStep(),this.tree.animateExploreNode(this.animator,t),this.animateWriteOutput(t.data.toString()+", "),this.animator.makeStep(),this.tree.animateExitParentEdge(this.animator,t),this.animateCodeFadeOut(e),this.animator.makeStep())}}const nt=document.querySelector("#app");nt&&(nt.innerHTML=`
        <div>
            <h1>Parcours d'un arbre binaire</h1>
            <svg xmlns="http://www.w3.org/2000/svg" id="test-svg" class="responsive-svg" preserveAspectRatio="xMidYMid meet"></svg>
            <div class="figure-nav">
                <div>Animation : <input type="range" id="slider" min="0" max="100" step="1" value="0" style="width:50%"></div>
                <select id="order-select">
                    <option value="pre-order">Préfixe</option>
                    <option value="in-order">Infixe</option>
                    <option value="post-order">Suffixe</option>
                </select>
                <button id="reset-button"><i class="fa-solid fa-backward-fast"></i></button>
                <button id="prev-button"><i class="fa-solid fa-step-backward"></i></button>
                <button id="play-button"><i class="fa-solid fa-redo"></i></button>
                <button id="next-button"><i class="fa-solid fa-step-forward"></i></button>
                <button id="full-button"><i class="fa-solid fa-play"></i></button>
            </div>
        </div>`);const Q=nt?.querySelector("#test-svg"),Y=document.querySelector("#slider");if(Q&&Y){const o={data:0,left:{data:1,left:{data:3,right:{data:7}},right:{data:4,left:{data:8}}},right:{data:2,left:{data:5,left:{data:9},right:{data:10}},right:{data:6,left:{data:11}}}};let t=new et(Q,o,"pre-order"),e=-1;t.animator.reset(),document.querySelector("#reset-button")?.addEventListener("click",()=>{e=-1,t.animator.stop(),t.animator.reset(),Y.value="0"}),document.querySelector("#prev-button")?.addEventListener("click",()=>{e=b.clamp(e-1,0,t.animator.getStepCount()-1),t.animator.resetStep(e),t.update();const n=t.animator.getStepStartTime(e)/t.animator.getMasterDuration();Y.value=(n*100).toString()}),document.querySelector("#next-button")?.addEventListener("click",()=>{e=b.clamp(e+1,0,t.animator.getStepCount()-1),t.animator.playStep(e);const n=t.animator.getStepStartTime(e)/t.animator.getMasterDuration();Y.value=(n*100).toString()}),document.querySelector("#play-button")?.addEventListener("click",()=>{t.animator.playStep(e)}),document.querySelector("#full-button")?.addEventListener("click",()=>{t.animator.playMaster(),Y.value="0"}),Y.addEventListener("input",()=>{const n=Y.valueAsNumber/100*t.animator.getMasterDuration();t.animator.stop(),t.animator.setMasterElapsed(n),e=t.animator.getStepIndexFromElapsed(n),t.getSVG().update()}),document.getElementById("order-select").addEventListener("change",i=>{const n=i.target;switch(t.animator.stop(),n.value){case"in-order":t=new et(Q,o,"in-order");break;case"pre-order":t=new et(Q,o,"pre-order");break;case"post-order":default:t=new et(Q,o,"post-order");break}e=-1,t.animator.stop(),t.animator.reset()})}
